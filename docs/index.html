<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />

<title>Full_Code_NLP_RAG_Project_Notebook_</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<style type="text/css">
    /*!
*
* Twitter Bootstrap
*
*/
/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */
html {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
}
body {
  margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
progress,
video {
  display: inline-block;
  vertical-align: baseline;
}
audio:not([controls]) {
  display: none;
  height: 0;
}
[hidden],
template {
  display: none;
}
a {
  background-color: transparent;
}
a:active,
a:hover {
  outline: 0;
}
abbr[title] {
  border-bottom: 1px dotted;
}
b,
strong {
  font-weight: bold;
}
dfn {
  font-style: italic;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
mark {
  background: #ff0;
  color: #000;
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}
img {
  border: 0;
}
svg:not(:root) {
  overflow: hidden;
}
figure {
  margin: 1em 40px;
}
hr {
  box-sizing: content-box;
  height: 0;
}
pre {
  overflow: auto;
}
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}
button,
input,
optgroup,
select,
textarea {
  color: inherit;
  font: inherit;
  margin: 0;
}
button {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
button,
html input[type="button"],
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button;
  cursor: pointer;
}
button[disabled],
html input[disabled] {
  cursor: default;
}
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}
input {
  line-height: normal;
}
input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box;
  padding: 0;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: textfield;
  box-sizing: content-box;
}
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  border: 0;
  padding: 0;
}
textarea {
  overflow: auto;
}
optgroup {
  font-weight: bold;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}
td,
th {
  padding: 0;
}
/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */
@media print {
  *,
  *:before,
  *:after {
    background: transparent !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }
  a,
  a:visited {
    text-decoration: underline;
  }
  a[href]:after {
    content: " (" attr(href) ")";
  }
  abbr[title]:after {
    content: " (" attr(title) ")";
  }
  a[href^="#"]:after,
  a[href^="javascript:"]:after {
    content: "";
  }
  pre,
  blockquote {
    border: 1px solid #999;
    page-break-inside: avoid;
  }
  thead {
    display: table-header-group;
  }
  tr,
  img {
    page-break-inside: avoid;
  }
  img {
    max-width: 100% !important;
  }
  p,
  h2,
  h3 {
    orphans: 3;
    widows: 3;
  }
  h2,
  h3 {
    page-break-after: avoid;
  }
  .navbar {
    display: none;
  }
  .btn > .caret,
  .dropup > .btn > .caret {
    border-top-color: #000 !important;
  }
  .label {
    border: 1px solid #000;
  }
  .table {
    border-collapse: collapse !important;
  }
  .table td,
  .table th {
    background-color: #fff !important;
  }
  .table-bordered th,
  .table-bordered td {
    border: 1px solid #ddd !important;
  }
}
@font-face {
  font-family: 'Glyphicons Halflings';
  src: url('../components/bootstrap/fonts/glyphicons-halflings-regular.eot');
  src: url('../components/bootstrap/fonts/glyphicons-halflings-regular.eot?#iefix') format('embedded-opentype'), url('../components/bootstrap/fonts/glyphicons-halflings-regular.woff2') format('woff2'), url('../components/bootstrap/fonts/glyphicons-halflings-regular.woff') format('woff'), url('../components/bootstrap/fonts/glyphicons-halflings-regular.ttf') format('truetype'), url('../components/bootstrap/fonts/glyphicons-halflings-regular.svg#glyphicons_halflingsregular') format('svg');
}
.glyphicon {
  position: relative;
  top: 1px;
  display: inline-block;
  font-family: 'Glyphicons Halflings';
  font-style: normal;
  font-weight: normal;
  line-height: 1;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
.glyphicon-asterisk:before {
  content: "\002a";
}
.glyphicon-plus:before {
  content: "\002b";
}
.glyphicon-euro:before,
.glyphicon-eur:before {
  content: "\20ac";
}
.glyphicon-minus:before {
  content: "\2212";
}
.glyphicon-cloud:before {
  content: "\2601";
}
.glyphicon-envelope:before {
  content: "\2709";
}
.glyphicon-pencil:before {
  content: "\270f";
}
.glyphicon-glass:before {
  content: "\e001";
}
.glyphicon-music:before {
  content: "\e002";
}
.glyphicon-search:before {
  content: "\e003";
}
.glyphicon-heart:before {
  content: "\e005";
}
.glyphicon-star:before {
  content: "\e006";
}
.glyphicon-star-empty:before {
  content: "\e007";
}
.glyphicon-user:before {
  content: "\e008";
}
.glyphicon-film:before {
  content: "\e009";
}
.glyphicon-th-large:before {
  content: "\e010";
}
.glyphicon-th:before {
  content: "\e011";
}
.glyphicon-th-list:before {
  content: "\e012";
}
.glyphicon-ok:before {
  content: "\e013";
}
.glyphicon-remove:before {
  content: "\e014";
}
.glyphicon-zoom-in:before {
  content: "\e015";
}
.glyphicon-zoom-out:before {
  content: "\e016";
}
.glyphicon-off:before {
  content: "\e017";
}
.glyphicon-signal:before {
  content: "\e018";
}
.glyphicon-cog:before {
  content: "\e019";
}
.glyphicon-trash:before {
  content: "\e020";
}
.glyphicon-home:before {
  content: "\e021";
}
.glyphicon-file:before {
  content: "\e022";
}
.glyphicon-time:before {
  content: "\e023";
}
.glyphicon-road:before {
  content: "\e024";
}
.glyphicon-download-alt:before {
  content: "\e025";
}
.glyphicon-download:before {
  content: "\e026";
}
.glyphicon-upload:before {
  content: "\e027";
}
.glyphicon-inbox:before {
  content: "\e028";
}
.glyphicon-play-circle:before {
  content: "\e029";
}
.glyphicon-repeat:before {
  content: "\e030";
}
.glyphicon-refresh:before {
  content: "\e031";
}
.glyphicon-list-alt:before {
  content: "\e032";
}
.glyphicon-lock:before {
  content: "\e033";
}
.glyphicon-flag:before {
  content: "\e034";
}
.glyphicon-headphones:before {
  content: "\e035";
}
.glyphicon-volume-off:before {
  content: "\e036";
}
.glyphicon-volume-down:before {
  content: "\e037";
}
.glyphicon-volume-up:before {
  content: "\e038";
}
.glyphicon-qrcode:before {
  content: "\e039";
}
.glyphicon-barcode:before {
  content: "\e040";
}
.glyphicon-tag:before {
  content: "\e041";
}
.glyphicon-tags:before {
  content: "\e042";
}
.glyphicon-book:before {
  content: "\e043";
}
.glyphicon-bookmark:before {
  content: "\e044";
}
.glyphicon-print:before {
  content: "\e045";
}
.glyphicon-camera:before {
  content: "\e046";
}
.glyphicon-font:before {
  content: "\e047";
}
.glyphicon-bold:before {
  content: "\e048";
}
.glyphicon-italic:before {
  content: "\e049";
}
.glyphicon-text-height:before {
  content: "\e050";
}
.glyphicon-text-width:before {
  content: "\e051";
}
.glyphicon-align-left:before {
  content: "\e052";
}
.glyphicon-align-center:before {
  content: "\e053";
}
.glyphicon-align-right:before {
  content: "\e054";
}
.glyphicon-align-justify:before {
  content: "\e055";
}
.glyphicon-list:before {
  content: "\e056";
}
.glyphicon-indent-left:before {
  content: "\e057";
}
.glyphicon-indent-right:before {
  content: "\e058";
}
.glyphicon-facetime-video:before {
  content: "\e059";
}
.glyphicon-picture:before {
  content: "\e060";
}
.glyphicon-map-marker:before {
  content: "\e062";
}
.glyphicon-adjust:before {
  content: "\e063";
}
.glyphicon-tint:before {
  content: "\e064";
}
.glyphicon-edit:before {
  content: "\e065";
}
.glyphicon-share:before {
  content: "\e066";
}
.glyphicon-check:before {
  content: "\e067";
}
.glyphicon-move:before {
  content: "\e068";
}
.glyphicon-step-backward:before {
  content: "\e069";
}
.glyphicon-fast-backward:before {
  content: "\e070";
}
.glyphicon-backward:before {
  content: "\e071";
}
.glyphicon-play:before {
  content: "\e072";
}
.glyphicon-pause:before {
  content: "\e073";
}
.glyphicon-stop:before {
  content: "\e074";
}
.glyphicon-forward:before {
  content: "\e075";
}
.glyphicon-fast-forward:before {
  content: "\e076";
}
.glyphicon-step-forward:before {
  content: "\e077";
}
.glyphicon-eject:before {
  content: "\e078";
}
.glyphicon-chevron-left:before {
  content: "\e079";
}
.glyphicon-chevron-right:before {
  content: "\e080";
}
.glyphicon-plus-sign:before {
  content: "\e081";
}
.glyphicon-minus-sign:before {
  content: "\e082";
}
.glyphicon-remove-sign:before {
  content: "\e083";
}
.glyphicon-ok-sign:before {
  content: "\e084";
}
.glyphicon-question-sign:before {
  content: "\e085";
}
.glyphicon-info-sign:before {
  content: "\e086";
}
.glyphicon-screenshot:before {
  content: "\e087";
}
.glyphicon-remove-circle:before {
  content: "\e088";
}
.glyphicon-ok-circle:before {
  content: "\e089";
}
.glyphicon-ban-circle:before {
  content: "\e090";
}
.glyphicon-arrow-left:before {
  content: "\e091";
}
.glyphicon-arrow-right:before {
  content: "\e092";
}
.glyphicon-arrow-up:before {
  content: "\e093";
}
.glyphicon-arrow-down:before {
  content: "\e094";
}
.glyphicon-share-alt:before {
  content: "\e095";
}
.glyphicon-resize-full:before {
  content: "\e096";
}
.glyphicon-resize-small:before {
  content: "\e097";
}
.glyphicon-exclamation-sign:before {
  content: "\e101";
}
.glyphicon-gift:before {
  content: "\e102";
}
.glyphicon-leaf:before {
  content: "\e103";
}
.glyphicon-fire:before {
  content: "\e104";
}
.glyphicon-eye-open:before {
  content: "\e105";
}
.glyphicon-eye-close:before {
  content: "\e106";
}
.glyphicon-warning-sign:before {
  content: "\e107";
}
.glyphicon-plane:before {
  content: "\e108";
}
.glyphicon-calendar:before {
  content: "\e109";
}
.glyphicon-random:before {
  content: "\e110";
}
.glyphicon-comment:before {
  content: "\e111";
}
.glyphicon-magnet:before {
  content: "\e112";
}
.glyphicon-chevron-up:before {
  content: "\e113";
}
.glyphicon-chevron-down:before {
  content: "\e114";
}
.glyphicon-retweet:before {
  content: "\e115";
}
.glyphicon-shopping-cart:before {
  content: "\e116";
}
.glyphicon-folder-close:before {
  content: "\e117";
}
.glyphicon-folder-open:before {
  content: "\e118";
}
.glyphicon-resize-vertical:before {
  content: "\e119";
}
.glyphicon-resize-horizontal:before {
  content: "\e120";
}
.glyphicon-hdd:before {
  content: "\e121";
}
.glyphicon-bullhorn:before {
  content: "\e122";
}
.glyphicon-bell:before {
  content: "\e123";
}
.glyphicon-certificate:before {
  content: "\e124";
}
.glyphicon-thumbs-up:before {
  content: "\e125";
}
.glyphicon-thumbs-down:before {
  content: "\e126";
}
.glyphicon-hand-right:before {
  content: "\e127";
}
.glyphicon-hand-left:before {
  content: "\e128";
}
.glyphicon-hand-up:before {
  content: "\e129";
}
.glyphicon-hand-down:before {
  content: "\e130";
}
.glyphicon-circle-arrow-right:before {
  content: "\e131";
}
.glyphicon-circle-arrow-left:before {
  content: "\e132";
}
.glyphicon-circle-arrow-up:before {
  content: "\e133";
}
.glyphicon-circle-arrow-down:before {
  content: "\e134";
}
.glyphicon-globe:before {
  content: "\e135";
}
.glyphicon-wrench:before {
  content: "\e136";
}
.glyphicon-tasks:before {
  content: "\e137";
}
.glyphicon-filter:before {
  content: "\e138";
}
.glyphicon-briefcase:before {
  content: "\e139";
}
.glyphicon-fullscreen:before {
  content: "\e140";
}
.glyphicon-dashboard:before {
  content: "\e141";
}
.glyphicon-paperclip:before {
  content: "\e142";
}
.glyphicon-heart-empty:before {
  content: "\e143";
}
.glyphicon-link:before {
  content: "\e144";
}
.glyphicon-phone:before {
  content: "\e145";
}
.glyphicon-pushpin:before {
  content: "\e146";
}
.glyphicon-usd:before {
  content: "\e148";
}
.glyphicon-gbp:before {
  content: "\e149";
}
.glyphicon-sort:before {
  content: "\e150";
}
.glyphicon-sort-by-alphabet:before {
  content: "\e151";
}
.glyphicon-sort-by-alphabet-alt:before {
  content: "\e152";
}
.glyphicon-sort-by-order:before {
  content: "\e153";
}
.glyphicon-sort-by-order-alt:before {
  content: "\e154";
}
.glyphicon-sort-by-attributes:before {
  content: "\e155";
}
.glyphicon-sort-by-attributes-alt:before {
  content: "\e156";
}
.glyphicon-unchecked:before {
  content: "\e157";
}
.glyphicon-expand:before {
  content: "\e158";
}
.glyphicon-collapse-down:before {
  content: "\e159";
}
.glyphicon-collapse-up:before {
  content: "\e160";
}
.glyphicon-log-in:before {
  content: "\e161";
}
.glyphicon-flash:before {
  content: "\e162";
}
.glyphicon-log-out:before {
  content: "\e163";
}
.glyphicon-new-window:before {
  content: "\e164";
}
.glyphicon-record:before {
  content: "\e165";
}
.glyphicon-save:before {
  content: "\e166";
}
.glyphicon-open:before {
  content: "\e167";
}
.glyphicon-saved:before {
  content: "\e168";
}
.glyphicon-import:before {
  content: "\e169";
}
.glyphicon-export:before {
  content: "\e170";
}
.glyphicon-send:before {
  content: "\e171";
}
.glyphicon-floppy-disk:before {
  content: "\e172";
}
.glyphicon-floppy-saved:before {
  content: "\e173";
}
.glyphicon-floppy-remove:before {
  content: "\e174";
}
.glyphicon-floppy-save:before {
  content: "\e175";
}
.glyphicon-floppy-open:before {
  content: "\e176";
}
.glyphicon-credit-card:before {
  content: "\e177";
}
.glyphicon-transfer:before {
  content: "\e178";
}
.glyphicon-cutlery:before {
  content: "\e179";
}
.glyphicon-header:before {
  content: "\e180";
}
.glyphicon-compressed:before {
  content: "\e181";
}
.glyphicon-earphone:before {
  content: "\e182";
}
.glyphicon-phone-alt:before {
  content: "\e183";
}
.glyphicon-tower:before {
  content: "\e184";
}
.glyphicon-stats:before {
  content: "\e185";
}
.glyphicon-sd-video:before {
  content: "\e186";
}
.glyphicon-hd-video:before {
  content: "\e187";
}
.glyphicon-subtitles:before {
  content: "\e188";
}
.glyphicon-sound-stereo:before {
  content: "\e189";
}
.glyphicon-sound-dolby:before {
  content: "\e190";
}
.glyphicon-sound-5-1:before {
  content: "\e191";
}
.glyphicon-sound-6-1:before {
  content: "\e192";
}
.glyphicon-sound-7-1:before {
  content: "\e193";
}
.glyphicon-copyright-mark:before {
  content: "\e194";
}
.glyphicon-registration-mark:before {
  content: "\e195";
}
.glyphicon-cloud-download:before {
  content: "\e197";
}
.glyphicon-cloud-upload:before {
  content: "\e198";
}
.glyphicon-tree-conifer:before {
  content: "\e199";
}
.glyphicon-tree-deciduous:before {
  content: "\e200";
}
.glyphicon-cd:before {
  content: "\e201";
}
.glyphicon-save-file:before {
  content: "\e202";
}
.glyphicon-open-file:before {
  content: "\e203";
}
.glyphicon-level-up:before {
  content: "\e204";
}
.glyphicon-copy:before {
  content: "\e205";
}
.glyphicon-paste:before {
  content: "\e206";
}
.glyphicon-alert:before {
  content: "\e209";
}
.glyphicon-equalizer:before {
  content: "\e210";
}
.glyphicon-king:before {
  content: "\e211";
}
.glyphicon-queen:before {
  content: "\e212";
}
.glyphicon-pawn:before {
  content: "\e213";
}
.glyphicon-bishop:before {
  content: "\e214";
}
.glyphicon-knight:before {
  content: "\e215";
}
.glyphicon-baby-formula:before {
  content: "\e216";
}
.glyphicon-tent:before {
  content: "\26fa";
}
.glyphicon-blackboard:before {
  content: "\e218";
}
.glyphicon-bed:before {
  content: "\e219";
}
.glyphicon-apple:before {
  content: "\f8ff";
}
.glyphicon-erase:before {
  content: "\e221";
}
.glyphicon-hourglass:before {
  content: "\231b";
}
.glyphicon-lamp:before {
  content: "\e223";
}
.glyphicon-duplicate:before {
  content: "\e224";
}
.glyphicon-piggy-bank:before {
  content: "\e225";
}
.glyphicon-scissors:before {
  content: "\e226";
}
.glyphicon-bitcoin:before {
  content: "\e227";
}
.glyphicon-btc:before {
  content: "\e227";
}
.glyphicon-xbt:before {
  content: "\e227";
}
.glyphicon-yen:before {
  content: "\00a5";
}
.glyphicon-jpy:before {
  content: "\00a5";
}
.glyphicon-ruble:before {
  content: "\20bd";
}
.glyphicon-rub:before {
  content: "\20bd";
}
.glyphicon-scale:before {
  content: "\e230";
}
.glyphicon-ice-lolly:before {
  content: "\e231";
}
.glyphicon-ice-lolly-tasted:before {
  content: "\e232";
}
.glyphicon-education:before {
  content: "\e233";
}
.glyphicon-option-horizontal:before {
  content: "\e234";
}
.glyphicon-option-vertical:before {
  content: "\e235";
}
.glyphicon-menu-hamburger:before {
  content: "\e236";
}
.glyphicon-modal-window:before {
  content: "\e237";
}
.glyphicon-oil:before {
  content: "\e238";
}
.glyphicon-grain:before {
  content: "\e239";
}
.glyphicon-sunglasses:before {
  content: "\e240";
}
.glyphicon-text-size:before {
  content: "\e241";
}
.glyphicon-text-color:before {
  content: "\e242";
}
.glyphicon-text-background:before {
  content: "\e243";
}
.glyphicon-object-align-top:before {
  content: "\e244";
}
.glyphicon-object-align-bottom:before {
  content: "\e245";
}
.glyphicon-object-align-horizontal:before {
  content: "\e246";
}
.glyphicon-object-align-left:before {
  content: "\e247";
}
.glyphicon-object-align-vertical:before {
  content: "\e248";
}
.glyphicon-object-align-right:before {
  content: "\e249";
}
.glyphicon-triangle-right:before {
  content: "\e250";
}
.glyphicon-triangle-left:before {
  content: "\e251";
}
.glyphicon-triangle-bottom:before {
  content: "\e252";
}
.glyphicon-triangle-top:before {
  content: "\e253";
}
.glyphicon-console:before {
  content: "\e254";
}
.glyphicon-superscript:before {
  content: "\e255";
}
.glyphicon-subscript:before {
  content: "\e256";
}
.glyphicon-menu-left:before {
  content: "\e257";
}
.glyphicon-menu-right:before {
  content: "\e258";
}
.glyphicon-menu-down:before {
  content: "\e259";
}
.glyphicon-menu-up:before {
  content: "\e260";
}
* {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
*:before,
*:after {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
html {
  font-size: 10px;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}
body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 13px;
  line-height: 1.42857143;
  color: #000;
  background-color: #fff;
}
input,
button,
select,
textarea {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
}
a {
  color: #337ab7;
  text-decoration: none;
}
a:hover,
a:focus {
  color: #23527c;
  text-decoration: underline;
}
a:focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
figure {
  margin: 0;
}
img {
  vertical-align: middle;
}
.img-responsive,
.thumbnail > img,
.thumbnail a > img,
.carousel-inner > .item > img,
.carousel-inner > .item > a > img {
  display: block;
  max-width: 100%;
  height: auto;
}
.img-rounded {
  border-radius: 3px;
}
.img-thumbnail {
  padding: 4px;
  line-height: 1.42857143;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 2px;
  -webkit-transition: all 0.2s ease-in-out;
  -o-transition: all 0.2s ease-in-out;
  transition: all 0.2s ease-in-out;
  display: inline-block;
  max-width: 100%;
  height: auto;
}
.img-circle {
  border-radius: 50%;
}
hr {
  margin-top: 18px;
  margin-bottom: 18px;
  border: 0;
  border-top: 1px solid #eeeeee;
}
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  padding: 0;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}
.sr-only-focusable:active,
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  clip: auto;
}
[role="button"] {
  cursor: pointer;
}
h1,
h2,
h3,
h4,
h5,
h6,
.h1,
.h2,
.h3,
.h4,
.h5,
.h6 {
  font-family: inherit;
  font-weight: 500;
  line-height: 1.1;
  color: inherit;
}
h1 small,
h2 small,
h3 small,
h4 small,
h5 small,
h6 small,
.h1 small,
.h2 small,
.h3 small,
.h4 small,
.h5 small,
.h6 small,
h1 .small,
h2 .small,
h3 .small,
h4 .small,
h5 .small,
h6 .small,
.h1 .small,
.h2 .small,
.h3 .small,
.h4 .small,
.h5 .small,
.h6 .small {
  font-weight: normal;
  line-height: 1;
  color: #777777;
}
h1,
.h1,
h2,
.h2,
h3,
.h3 {
  margin-top: 18px;
  margin-bottom: 9px;
}
h1 small,
.h1 small,
h2 small,
.h2 small,
h3 small,
.h3 small,
h1 .small,
.h1 .small,
h2 .small,
.h2 .small,
h3 .small,
.h3 .small {
  font-size: 65%;
}
h4,
.h4,
h5,
.h5,
h6,
.h6 {
  margin-top: 9px;
  margin-bottom: 9px;
}
h4 small,
.h4 small,
h5 small,
.h5 small,
h6 small,
.h6 small,
h4 .small,
.h4 .small,
h5 .small,
.h5 .small,
h6 .small,
.h6 .small {
  font-size: 75%;
}
h1,
.h1 {
  font-size: 33px;
}
h2,
.h2 {
  font-size: 27px;
}
h3,
.h3 {
  font-size: 23px;
}
h4,
.h4 {
  font-size: 17px;
}
h5,
.h5 {
  font-size: 13px;
}
h6,
.h6 {
  font-size: 12px;
}
p {
  margin: 0 0 9px;
}
.lead {
  margin-bottom: 18px;
  font-size: 14px;
  font-weight: 300;
  line-height: 1.4;
}
@media (min-width: 768px) {
  .lead {
    font-size: 19.5px;
  }
}
small,
.small {
  font-size: 92%;
}
mark,
.mark {
  background-color: #fcf8e3;
  padding: .2em;
}
.text-left {
  text-align: left;
}
.text-right {
  text-align: right;
}
.text-center {
  text-align: center;
}
.text-justify {
  text-align: justify;
}
.text-nowrap {
  white-space: nowrap;
}
.text-lowercase {
  text-transform: lowercase;
}
.text-uppercase {
  text-transform: uppercase;
}
.text-capitalize {
  text-transform: capitalize;
}
.text-muted {
  color: #777777;
}
.text-primary {
  color: #337ab7;
}
a.text-primary:hover,
a.text-primary:focus {
  color: #286090;
}
.text-success {
  color: #3c763d;
}
a.text-success:hover,
a.text-success:focus {
  color: #2b542c;
}
.text-info {
  color: #31708f;
}
a.text-info:hover,
a.text-info:focus {
  color: #245269;
}
.text-warning {
  color: #8a6d3b;
}
a.text-warning:hover,
a.text-warning:focus {
  color: #66512c;
}
.text-danger {
  color: #a94442;
}
a.text-danger:hover,
a.text-danger:focus {
  color: #843534;
}
.bg-primary {
  color: #fff;
  background-color: #337ab7;
}
a.bg-primary:hover,
a.bg-primary:focus {
  background-color: #286090;
}
.bg-success {
  background-color: #dff0d8;
}
a.bg-success:hover,
a.bg-success:focus {
  background-color: #c1e2b3;
}
.bg-info {
  background-color: #d9edf7;
}
a.bg-info:hover,
a.bg-info:focus {
  background-color: #afd9ee;
}
.bg-warning {
  background-color: #fcf8e3;
}
a.bg-warning:hover,
a.bg-warning:focus {
  background-color: #f7ecb5;
}
.bg-danger {
  background-color: #f2dede;
}
a.bg-danger:hover,
a.bg-danger:focus {
  background-color: #e4b9b9;
}
.page-header {
  padding-bottom: 8px;
  margin: 36px 0 18px;
  border-bottom: 1px solid #eeeeee;
}
ul,
ol {
  margin-top: 0;
  margin-bottom: 9px;
}
ul ul,
ol ul,
ul ol,
ol ol {
  margin-bottom: 0;
}
.list-unstyled {
  padding-left: 0;
  list-style: none;
}
.list-inline {
  padding-left: 0;
  list-style: none;
  margin-left: -5px;
}
.list-inline > li {
  display: inline-block;
  padding-left: 5px;
  padding-right: 5px;
}
dl {
  margin-top: 0;
  margin-bottom: 18px;
}
dt,
dd {
  line-height: 1.42857143;
}
dt {
  font-weight: bold;
}
dd {
  margin-left: 0;
}
@media (min-width: 541px) {
  .dl-horizontal dt {
    float: left;
    width: 160px;
    clear: left;
    text-align: right;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .dl-horizontal dd {
    margin-left: 180px;
  }
}
abbr[title],
abbr[data-original-title] {
  cursor: help;
  border-bottom: 1px dotted #777777;
}
.initialism {
  font-size: 90%;
  text-transform: uppercase;
}
blockquote {
  padding: 9px 18px;
  margin: 0 0 18px;
  font-size: inherit;
  border-left: 5px solid #eeeeee;
}
blockquote p:last-child,
blockquote ul:last-child,
blockquote ol:last-child {
  margin-bottom: 0;
}
blockquote footer,
blockquote small,
blockquote .small {
  display: block;
  font-size: 80%;
  line-height: 1.42857143;
  color: #777777;
}
blockquote footer:before,
blockquote small:before,
blockquote .small:before {
  content: '\2014 \00A0';
}
.blockquote-reverse,
blockquote.pull-right {
  padding-right: 15px;
  padding-left: 0;
  border-right: 5px solid #eeeeee;
  border-left: 0;
  text-align: right;
}
.blockquote-reverse footer:before,
blockquote.pull-right footer:before,
.blockquote-reverse small:before,
blockquote.pull-right small:before,
.blockquote-reverse .small:before,
blockquote.pull-right .small:before {
  content: '';
}
.blockquote-reverse footer:after,
blockquote.pull-right footer:after,
.blockquote-reverse small:after,
blockquote.pull-right small:after,
.blockquote-reverse .small:after,
blockquote.pull-right .small:after {
  content: '\00A0 \2014';
}
address {
  margin-bottom: 18px;
  font-style: normal;
  line-height: 1.42857143;
}
code,
kbd,
pre,
samp {
  font-family: monospace;
}
code {
  padding: 2px 4px;
  font-size: 90%;
  color: #c7254e;
  background-color: #f9f2f4;
  border-radius: 2px;
}
kbd {
  padding: 2px 4px;
  font-size: 90%;
  color: #888;
  background-color: transparent;
  border-radius: 1px;
  box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.25);
}
kbd kbd {
  padding: 0;
  font-size: 100%;
  font-weight: bold;
  box-shadow: none;
}
pre {
  display: block;
  padding: 8.5px;
  margin: 0 0 9px;
  font-size: 12px;
  line-height: 1.42857143;
  word-break: break-all;
  word-wrap: break-word;
  color: #333333;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 2px;
}
pre code {
  padding: 0;
  font-size: inherit;
  color: inherit;
  white-space: pre-wrap;
  background-color: transparent;
  border-radius: 0;
}
.pre-scrollable {
  max-height: 340px;
  overflow-y: scroll;
}
.container {
  margin-right: auto;
  margin-left: auto;
  padding-left: 0px;
  padding-right: 0px;
}
@media (min-width: 768px) {
  .container {
    width: 768px;
  }
}
@media (min-width: 992px) {
  .container {
    width: 940px;
  }
}
@media (min-width: 1200px) {
  .container {
    width: 1140px;
  }
}
.container-fluid {
  margin-right: auto;
  margin-left: auto;
  padding-left: 0px;
  padding-right: 0px;
}
.row {
  margin-left: 0px;
  margin-right: 0px;
}
.col-xs-1, .col-sm-1, .col-md-1, .col-lg-1, .col-xs-2, .col-sm-2, .col-md-2, .col-lg-2, .col-xs-3, .col-sm-3, .col-md-3, .col-lg-3, .col-xs-4, .col-sm-4, .col-md-4, .col-lg-4, .col-xs-5, .col-sm-5, .col-md-5, .col-lg-5, .col-xs-6, .col-sm-6, .col-md-6, .col-lg-6, .col-xs-7, .col-sm-7, .col-md-7, .col-lg-7, .col-xs-8, .col-sm-8, .col-md-8, .col-lg-8, .col-xs-9, .col-sm-9, .col-md-9, .col-lg-9, .col-xs-10, .col-sm-10, .col-md-10, .col-lg-10, .col-xs-11, .col-sm-11, .col-md-11, .col-lg-11, .col-xs-12, .col-sm-12, .col-md-12, .col-lg-12 {
  position: relative;
  min-height: 1px;
  padding-left: 0px;
  padding-right: 0px;
}
.col-xs-1, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12 {
  float: left;
}
.col-xs-12 {
  width: 100%;
}
.col-xs-11 {
  width: 91.66666667%;
}
.col-xs-10 {
  width: 83.33333333%;
}
.col-xs-9 {
  width: 75%;
}
.col-xs-8 {
  width: 66.66666667%;
}
.col-xs-7 {
  width: 58.33333333%;
}
.col-xs-6 {
  width: 50%;
}
.col-xs-5 {
  width: 41.66666667%;
}
.col-xs-4 {
  width: 33.33333333%;
}
.col-xs-3 {
  width: 25%;
}
.col-xs-2 {
  width: 16.66666667%;
}
.col-xs-1 {
  width: 8.33333333%;
}
.col-xs-pull-12 {
  right: 100%;
}
.col-xs-pull-11 {
  right: 91.66666667%;
}
.col-xs-pull-10 {
  right: 83.33333333%;
}
.col-xs-pull-9 {
  right: 75%;
}
.col-xs-pull-8 {
  right: 66.66666667%;
}
.col-xs-pull-7 {
  right: 58.33333333%;
}
.col-xs-pull-6 {
  right: 50%;
}
.col-xs-pull-5 {
  right: 41.66666667%;
}
.col-xs-pull-4 {
  right: 33.33333333%;
}
.col-xs-pull-3 {
  right: 25%;
}
.col-xs-pull-2 {
  right: 16.66666667%;
}
.col-xs-pull-1 {
  right: 8.33333333%;
}
.col-xs-pull-0 {
  right: auto;
}
.col-xs-push-12 {
  left: 100%;
}
.col-xs-push-11 {
  left: 91.66666667%;
}
.col-xs-push-10 {
  left: 83.33333333%;
}
.col-xs-push-9 {
  left: 75%;
}
.col-xs-push-8 {
  left: 66.66666667%;
}
.col-xs-push-7 {
  left: 58.33333333%;
}
.col-xs-push-6 {
  left: 50%;
}
.col-xs-push-5 {
  left: 41.66666667%;
}
.col-xs-push-4 {
  left: 33.33333333%;
}
.col-xs-push-3 {
  left: 25%;
}
.col-xs-push-2 {
  left: 16.66666667%;
}
.col-xs-push-1 {
  left: 8.33333333%;
}
.col-xs-push-0 {
  left: auto;
}
.col-xs-offset-12 {
  margin-left: 100%;
}
.col-xs-offset-11 {
  margin-left: 91.66666667%;
}
.col-xs-offset-10 {
  margin-left: 83.33333333%;
}
.col-xs-offset-9 {
  margin-left: 75%;
}
.col-xs-offset-8 {
  margin-left: 66.66666667%;
}
.col-xs-offset-7 {
  margin-left: 58.33333333%;
}
.col-xs-offset-6 {
  margin-left: 50%;
}
.col-xs-offset-5 {
  margin-left: 41.66666667%;
}
.col-xs-offset-4 {
  margin-left: 33.33333333%;
}
.col-xs-offset-3 {
  margin-left: 25%;
}
.col-xs-offset-2 {
  margin-left: 16.66666667%;
}
.col-xs-offset-1 {
  margin-left: 8.33333333%;
}
.col-xs-offset-0 {
  margin-left: 0%;
}
@media (min-width: 768px) {
  .col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12 {
    float: left;
  }
  .col-sm-12 {
    width: 100%;
  }
  .col-sm-11 {
    width: 91.66666667%;
  }
  .col-sm-10 {
    width: 83.33333333%;
  }
  .col-sm-9 {
    width: 75%;
  }
  .col-sm-8 {
    width: 66.66666667%;
  }
  .col-sm-7 {
    width: 58.33333333%;
  }
  .col-sm-6 {
    width: 50%;
  }
  .col-sm-5 {
    width: 41.66666667%;
  }
  .col-sm-4 {
    width: 33.33333333%;
  }
  .col-sm-3 {
    width: 25%;
  }
  .col-sm-2 {
    width: 16.66666667%;
  }
  .col-sm-1 {
    width: 8.33333333%;
  }
  .col-sm-pull-12 {
    right: 100%;
  }
  .col-sm-pull-11 {
    right: 91.66666667%;
  }
  .col-sm-pull-10 {
    right: 83.33333333%;
  }
  .col-sm-pull-9 {
    right: 75%;
  }
  .col-sm-pull-8 {
    right: 66.66666667%;
  }
  .col-sm-pull-7 {
    right: 58.33333333%;
  }
  .col-sm-pull-6 {
    right: 50%;
  }
  .col-sm-pull-5 {
    right: 41.66666667%;
  }
  .col-sm-pull-4 {
    right: 33.33333333%;
  }
  .col-sm-pull-3 {
    right: 25%;
  }
  .col-sm-pull-2 {
    right: 16.66666667%;
  }
  .col-sm-pull-1 {
    right: 8.33333333%;
  }
  .col-sm-pull-0 {
    right: auto;
  }
  .col-sm-push-12 {
    left: 100%;
  }
  .col-sm-push-11 {
    left: 91.66666667%;
  }
  .col-sm-push-10 {
    left: 83.33333333%;
  }
  .col-sm-push-9 {
    left: 75%;
  }
  .col-sm-push-8 {
    left: 66.66666667%;
  }
  .col-sm-push-7 {
    left: 58.33333333%;
  }
  .col-sm-push-6 {
    left: 50%;
  }
  .col-sm-push-5 {
    left: 41.66666667%;
  }
  .col-sm-push-4 {
    left: 33.33333333%;
  }
  .col-sm-push-3 {
    left: 25%;
  }
  .col-sm-push-2 {
    left: 16.66666667%;
  }
  .col-sm-push-1 {
    left: 8.33333333%;
  }
  .col-sm-push-0 {
    left: auto;
  }
  .col-sm-offset-12 {
    margin-left: 100%;
  }
  .col-sm-offset-11 {
    margin-left: 91.66666667%;
  }
  .col-sm-offset-10 {
    margin-left: 83.33333333%;
  }
  .col-sm-offset-9 {
    margin-left: 75%;
  }
  .col-sm-offset-8 {
    margin-left: 66.66666667%;
  }
  .col-sm-offset-7 {
    margin-left: 58.33333333%;
  }
  .col-sm-offset-6 {
    margin-left: 50%;
  }
  .col-sm-offset-5 {
    margin-left: 41.66666667%;
  }
  .col-sm-offset-4 {
    margin-left: 33.33333333%;
  }
  .col-sm-offset-3 {
    margin-left: 25%;
  }
  .col-sm-offset-2 {
    margin-left: 16.66666667%;
  }
  .col-sm-offset-1 {
    margin-left: 8.33333333%;
  }
  .col-sm-offset-0 {
    margin-left: 0%;
  }
}
@media (min-width: 992px) {
  .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11, .col-md-12 {
    float: left;
  }
  .col-md-12 {
    width: 100%;
  }
  .col-md-11 {
    width: 91.66666667%;
  }
  .col-md-10 {
    width: 83.33333333%;
  }
  .col-md-9 {
    width: 75%;
  }
  .col-md-8 {
    width: 66.66666667%;
  }
  .col-md-7 {
    width: 58.33333333%;
  }
  .col-md-6 {
    width: 50%;
  }
  .col-md-5 {
    width: 41.66666667%;
  }
  .col-md-4 {
    width: 33.33333333%;
  }
  .col-md-3 {
    width: 25%;
  }
  .col-md-2 {
    width: 16.66666667%;
  }
  .col-md-1 {
    width: 8.33333333%;
  }
  .col-md-pull-12 {
    right: 100%;
  }
  .col-md-pull-11 {
    right: 91.66666667%;
  }
  .col-md-pull-10 {
    right: 83.33333333%;
  }
  .col-md-pull-9 {
    right: 75%;
  }
  .col-md-pull-8 {
    right: 66.66666667%;
  }
  .col-md-pull-7 {
    right: 58.33333333%;
  }
  .col-md-pull-6 {
    right: 50%;
  }
  .col-md-pull-5 {
    right: 41.66666667%;
  }
  .col-md-pull-4 {
    right: 33.33333333%;
  }
  .col-md-pull-3 {
    right: 25%;
  }
  .col-md-pull-2 {
    right: 16.66666667%;
  }
  .col-md-pull-1 {
    right: 8.33333333%;
  }
  .col-md-pull-0 {
    right: auto;
  }
  .col-md-push-12 {
    left: 100%;
  }
  .col-md-push-11 {
    left: 91.66666667%;
  }
  .col-md-push-10 {
    left: 83.33333333%;
  }
  .col-md-push-9 {
    left: 75%;
  }
  .col-md-push-8 {
    left: 66.66666667%;
  }
  .col-md-push-7 {
    left: 58.33333333%;
  }
  .col-md-push-6 {
    left: 50%;
  }
  .col-md-push-5 {
    left: 41.66666667%;
  }
  .col-md-push-4 {
    left: 33.33333333%;
  }
  .col-md-push-3 {
    left: 25%;
  }
  .col-md-push-2 {
    left: 16.66666667%;
  }
  .col-md-push-1 {
    left: 8.33333333%;
  }
  .col-md-push-0 {
    left: auto;
  }
  .col-md-offset-12 {
    margin-left: 100%;
  }
  .col-md-offset-11 {
    margin-left: 91.66666667%;
  }
  .col-md-offset-10 {
    margin-left: 83.33333333%;
  }
  .col-md-offset-9 {
    margin-left: 75%;
  }
  .col-md-offset-8 {
    margin-left: 66.66666667%;
  }
  .col-md-offset-7 {
    margin-left: 58.33333333%;
  }
  .col-md-offset-6 {
    margin-left: 50%;
  }
  .col-md-offset-5 {
    margin-left: 41.66666667%;
  }
  .col-md-offset-4 {
    margin-left: 33.33333333%;
  }
  .col-md-offset-3 {
    margin-left: 25%;
  }
  .col-md-offset-2 {
    margin-left: 16.66666667%;
  }
  .col-md-offset-1 {
    margin-left: 8.33333333%;
  }
  .col-md-offset-0 {
    margin-left: 0%;
  }
}
@media (min-width: 1200px) {
  .col-lg-1, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-10, .col-lg-11, .col-lg-12 {
    float: left;
  }
  .col-lg-12 {
    width: 100%;
  }
  .col-lg-11 {
    width: 91.66666667%;
  }
  .col-lg-10 {
    width: 83.33333333%;
  }
  .col-lg-9 {
    width: 75%;
  }
  .col-lg-8 {
    width: 66.66666667%;
  }
  .col-lg-7 {
    width: 58.33333333%;
  }
  .col-lg-6 {
    width: 50%;
  }
  .col-lg-5 {
    width: 41.66666667%;
  }
  .col-lg-4 {
    width: 33.33333333%;
  }
  .col-lg-3 {
    width: 25%;
  }
  .col-lg-2 {
    width: 16.66666667%;
  }
  .col-lg-1 {
    width: 8.33333333%;
  }
  .col-lg-pull-12 {
    right: 100%;
  }
  .col-lg-pull-11 {
    right: 91.66666667%;
  }
  .col-lg-pull-10 {
    right: 83.33333333%;
  }
  .col-lg-pull-9 {
    right: 75%;
  }
  .col-lg-pull-8 {
    right: 66.66666667%;
  }
  .col-lg-pull-7 {
    right: 58.33333333%;
  }
  .col-lg-pull-6 {
    right: 50%;
  }
  .col-lg-pull-5 {
    right: 41.66666667%;
  }
  .col-lg-pull-4 {
    right: 33.33333333%;
  }
  .col-lg-pull-3 {
    right: 25%;
  }
  .col-lg-pull-2 {
    right: 16.66666667%;
  }
  .col-lg-pull-1 {
    right: 8.33333333%;
  }
  .col-lg-pull-0 {
    right: auto;
  }
  .col-lg-push-12 {
    left: 100%;
  }
  .col-lg-push-11 {
    left: 91.66666667%;
  }
  .col-lg-push-10 {
    left: 83.33333333%;
  }
  .col-lg-push-9 {
    left: 75%;
  }
  .col-lg-push-8 {
    left: 66.66666667%;
  }
  .col-lg-push-7 {
    left: 58.33333333%;
  }
  .col-lg-push-6 {
    left: 50%;
  }
  .col-lg-push-5 {
    left: 41.66666667%;
  }
  .col-lg-push-4 {
    left: 33.33333333%;
  }
  .col-lg-push-3 {
    left: 25%;
  }
  .col-lg-push-2 {
    left: 16.66666667%;
  }
  .col-lg-push-1 {
    left: 8.33333333%;
  }
  .col-lg-push-0 {
    left: auto;
  }
  .col-lg-offset-12 {
    margin-left: 100%;
  }
  .col-lg-offset-11 {
    margin-left: 91.66666667%;
  }
  .col-lg-offset-10 {
    margin-left: 83.33333333%;
  }
  .col-lg-offset-9 {
    margin-left: 75%;
  }
  .col-lg-offset-8 {
    margin-left: 66.66666667%;
  }
  .col-lg-offset-7 {
    margin-left: 58.33333333%;
  }
  .col-lg-offset-6 {
    margin-left: 50%;
  }
  .col-lg-offset-5 {
    margin-left: 41.66666667%;
  }
  .col-lg-offset-4 {
    margin-left: 33.33333333%;
  }
  .col-lg-offset-3 {
    margin-left: 25%;
  }
  .col-lg-offset-2 {
    margin-left: 16.66666667%;
  }
  .col-lg-offset-1 {
    margin-left: 8.33333333%;
  }
  .col-lg-offset-0 {
    margin-left: 0%;
  }
}
table {
  background-color: transparent;
}
caption {
  padding-top: 8px;
  padding-bottom: 8px;
  color: #777777;
  text-align: left;
}
th {
  text-align: left;
}
.table {
  width: 100%;
  max-width: 100%;
  margin-bottom: 18px;
}
.table > thead > tr > th,
.table > tbody > tr > th,
.table > tfoot > tr > th,
.table > thead > tr > td,
.table > tbody > tr > td,
.table > tfoot > tr > td {
  padding: 8px;
  line-height: 1.42857143;
  vertical-align: top;
  border-top: 1px solid #ddd;
}
.table > thead > tr > th {
  vertical-align: bottom;
  border-bottom: 2px solid #ddd;
}
.table > caption + thead > tr:first-child > th,
.table > colgroup + thead > tr:first-child > th,
.table > thead:first-child > tr:first-child > th,
.table > caption + thead > tr:first-child > td,
.table > colgroup + thead > tr:first-child > td,
.table > thead:first-child > tr:first-child > td {
  border-top: 0;
}
.table > tbody + tbody {
  border-top: 2px solid #ddd;
}
.table .table {
  background-color: #fff;
}
.table-condensed > thead > tr > th,
.table-condensed > tbody > tr > th,
.table-condensed > tfoot > tr > th,
.table-condensed > thead > tr > td,
.table-condensed > tbody > tr > td,
.table-condensed > tfoot > tr > td {
  padding: 5px;
}
.table-bordered {
  border: 1px solid #ddd;
}
.table-bordered > thead > tr > th,
.table-bordered > tbody > tr > th,
.table-bordered > tfoot > tr > th,
.table-bordered > thead > tr > td,
.table-bordered > tbody > tr > td,
.table-bordered > tfoot > tr > td {
  border: 1px solid #ddd;
}
.table-bordered > thead > tr > th,
.table-bordered > thead > tr > td {
  border-bottom-width: 2px;
}
.table-striped > tbody > tr:nth-of-type(odd) {
  background-color: #f9f9f9;
}
.table-hover > tbody > tr:hover {
  background-color: #f5f5f5;
}
table col[class*="col-"] {
  position: static;
  float: none;
  display: table-column;
}
table td[class*="col-"],
table th[class*="col-"] {
  position: static;
  float: none;
  display: table-cell;
}
.table > thead > tr > td.active,
.table > tbody > tr > td.active,
.table > tfoot > tr > td.active,
.table > thead > tr > th.active,
.table > tbody > tr > th.active,
.table > tfoot > tr > th.active,
.table > thead > tr.active > td,
.table > tbody > tr.active > td,
.table > tfoot > tr.active > td,
.table > thead > tr.active > th,
.table > tbody > tr.active > th,
.table > tfoot > tr.active > th {
  background-color: #f5f5f5;
}
.table-hover > tbody > tr > td.active:hover,
.table-hover > tbody > tr > th.active:hover,
.table-hover > tbody > tr.active:hover > td,
.table-hover > tbody > tr:hover > .active,
.table-hover > tbody > tr.active:hover > th {
  background-color: #e8e8e8;
}
.table > thead > tr > td.success,
.table > tbody > tr > td.success,
.table > tfoot > tr > td.success,
.table > thead > tr > th.success,
.table > tbody > tr > th.success,
.table > tfoot > tr > th.success,
.table > thead > tr.success > td,
.table > tbody > tr.success > td,
.table > tfoot > tr.success > td,
.table > thead > tr.success > th,
.table > tbody > tr.success > th,
.table > tfoot > tr.success > th {
  background-color: #dff0d8;
}
.table-hover > tbody > tr > td.success:hover,
.table-hover > tbody > tr > th.success:hover,
.table-hover > tbody > tr.success:hover > td,
.table-hover > tbody > tr:hover > .success,
.table-hover > tbody > tr.success:hover > th {
  background-color: #d0e9c6;
}
.table > thead > tr > td.info,
.table > tbody > tr > td.info,
.table > tfoot > tr > td.info,
.table > thead > tr > th.info,
.table > tbody > tr > th.info,
.table > tfoot > tr > th.info,
.table > thead > tr.info > td,
.table > tbody > tr.info > td,
.table > tfoot > tr.info > td,
.table > thead > tr.info > th,
.table > tbody > tr.info > th,
.table > tfoot > tr.info > th {
  background-color: #d9edf7;
}
.table-hover > tbody > tr > td.info:hover,
.table-hover > tbody > tr > th.info:hover,
.table-hover > tbody > tr.info:hover > td,
.table-hover > tbody > tr:hover > .info,
.table-hover > tbody > tr.info:hover > th {
  background-color: #c4e3f3;
}
.table > thead > tr > td.warning,
.table > tbody > tr > td.warning,
.table > tfoot > tr > td.warning,
.table > thead > tr > th.warning,
.table > tbody > tr > th.warning,
.table > tfoot > tr > th.warning,
.table > thead > tr.warning > td,
.table > tbody > tr.warning > td,
.table > tfoot > tr.warning > td,
.table > thead > tr.warning > th,
.table > tbody > tr.warning > th,
.table > tfoot > tr.warning > th {
  background-color: #fcf8e3;
}
.table-hover > tbody > tr > td.warning:hover,
.table-hover > tbody > tr > th.warning:hover,
.table-hover > tbody > tr.warning:hover > td,
.table-hover > tbody > tr:hover > .warning,
.table-hover > tbody > tr.warning:hover > th {
  background-color: #faf2cc;
}
.table > thead > tr > td.danger,
.table > tbody > tr > td.danger,
.table > tfoot > tr > td.danger,
.table > thead > tr > th.danger,
.table > tbody > tr > th.danger,
.table > tfoot > tr > th.danger,
.table > thead > tr.danger > td,
.table > tbody > tr.danger > td,
.table > tfoot > tr.danger > td,
.table > thead > tr.danger > th,
.table > tbody > tr.danger > th,
.table > tfoot > tr.danger > th {
  background-color: #f2dede;
}
.table-hover > tbody > tr > td.danger:hover,
.table-hover > tbody > tr > th.danger:hover,
.table-hover > tbody > tr.danger:hover > td,
.table-hover > tbody > tr:hover > .danger,
.table-hover > tbody > tr.danger:hover > th {
  background-color: #ebcccc;
}
.table-responsive {
  overflow-x: auto;
  min-height: 0.01%;
}
@media screen and (max-width: 767px) {
  .table-responsive {
    width: 100%;
    margin-bottom: 13.5px;
    overflow-y: hidden;
    -ms-overflow-style: -ms-autohiding-scrollbar;
    border: 1px solid #ddd;
  }
  .table-responsive > .table {
    margin-bottom: 0;
  }
  .table-responsive > .table > thead > tr > th,
  .table-responsive > .table > tbody > tr > th,
  .table-responsive > .table > tfoot > tr > th,
  .table-responsive > .table > thead > tr > td,
  .table-responsive > .table > tbody > tr > td,
  .table-responsive > .table > tfoot > tr > td {
    white-space: nowrap;
  }
  .table-responsive > .table-bordered {
    border: 0;
  }
  .table-responsive > .table-bordered > thead > tr > th:first-child,
  .table-responsive > .table-bordered > tbody > tr > th:first-child,
  .table-responsive > .table-bordered > tfoot > tr > th:first-child,
  .table-responsive > .table-bordered > thead > tr > td:first-child,
  .table-responsive > .table-bordered > tbody > tr > td:first-child,
  .table-responsive > .table-bordered > tfoot > tr > td:first-child {
    border-left: 0;
  }
  .table-responsive > .table-bordered > thead > tr > th:last-child,
  .table-responsive > .table-bordered > tbody > tr > th:last-child,
  .table-responsive > .table-bordered > tfoot > tr > th:last-child,
  .table-responsive > .table-bordered > thead > tr > td:last-child,
  .table-responsive > .table-bordered > tbody > tr > td:last-child,
  .table-responsive > .table-bordered > tfoot > tr > td:last-child {
    border-right: 0;
  }
  .table-responsive > .table-bordered > tbody > tr:last-child > th,
  .table-responsive > .table-bordered > tfoot > tr:last-child > th,
  .table-responsive > .table-bordered > tbody > tr:last-child > td,
  .table-responsive > .table-bordered > tfoot > tr:last-child > td {
    border-bottom: 0;
  }
}
fieldset {
  padding: 0;
  margin: 0;
  border: 0;
  min-width: 0;
}
legend {
  display: block;
  width: 100%;
  padding: 0;
  margin-bottom: 18px;
  font-size: 19.5px;
  line-height: inherit;
  color: #333333;
  border: 0;
  border-bottom: 1px solid #e5e5e5;
}
label {
  display: inline-block;
  max-width: 100%;
  margin-bottom: 5px;
  font-weight: bold;
}
input[type="search"] {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
input[type="radio"],
input[type="checkbox"] {
  margin: 4px 0 0;
  margin-top: 1px \9;
  line-height: normal;
}
input[type="file"] {
  display: block;
}
input[type="range"] {
  display: block;
  width: 100%;
}
select[multiple],
select[size] {
  height: auto;
}
input[type="file"]:focus,
input[type="radio"]:focus,
input[type="checkbox"]:focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
output {
  display: block;
  padding-top: 7px;
  font-size: 13px;
  line-height: 1.42857143;
  color: #555555;
}
.form-control {
  display: block;
  width: 100%;
  height: 32px;
  padding: 6px 12px;
  font-size: 13px;
  line-height: 1.42857143;
  color: #555555;
  background-color: #fff;
  background-image: none;
  border: 1px solid #ccc;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  -webkit-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
}
.form-control:focus {
  border-color: #66afe9;
  outline: 0;
  -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
}
.form-control::-moz-placeholder {
  color: #999;
  opacity: 1;
}
.form-control:-ms-input-placeholder {
  color: #999;
}
.form-control::-webkit-input-placeholder {
  color: #999;
}
.form-control::-ms-expand {
  border: 0;
  background-color: transparent;
}
.form-control[disabled],
.form-control[readonly],
fieldset[disabled] .form-control {
  background-color: #eeeeee;
  opacity: 1;
}
.form-control[disabled],
fieldset[disabled] .form-control {
  cursor: not-allowed;
}
textarea.form-control {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: none;
}
@media screen and (-webkit-min-device-pixel-ratio: 0) {
  input[type="date"].form-control,
  input[type="time"].form-control,
  input[type="datetime-local"].form-control,
  input[type="month"].form-control {
    line-height: 32px;
  }
  input[type="date"].input-sm,
  input[type="time"].input-sm,
  input[type="datetime-local"].input-sm,
  input[type="month"].input-sm,
  .input-group-sm input[type="date"],
  .input-group-sm input[type="time"],
  .input-group-sm input[type="datetime-local"],
  .input-group-sm input[type="month"] {
    line-height: 30px;
  }
  input[type="date"].input-lg,
  input[type="time"].input-lg,
  input[type="datetime-local"].input-lg,
  input[type="month"].input-lg,
  .input-group-lg input[type="date"],
  .input-group-lg input[type="time"],
  .input-group-lg input[type="datetime-local"],
  .input-group-lg input[type="month"] {
    line-height: 45px;
  }
}
.form-group {
  margin-bottom: 15px;
}
.radio,
.checkbox {
  position: relative;
  display: block;
  margin-top: 10px;
  margin-bottom: 10px;
}
.radio label,
.checkbox label {
  min-height: 18px;
  padding-left: 20px;
  margin-bottom: 0;
  font-weight: normal;
  cursor: pointer;
}
.radio input[type="radio"],
.radio-inline input[type="radio"],
.checkbox input[type="checkbox"],
.checkbox-inline input[type="checkbox"] {
  position: absolute;
  margin-left: -20px;
  margin-top: 4px \9;
}
.radio + .radio,
.checkbox + .checkbox {
  margin-top: -5px;
}
.radio-inline,
.checkbox-inline {
  position: relative;
  display: inline-block;
  padding-left: 20px;
  margin-bottom: 0;
  vertical-align: middle;
  font-weight: normal;
  cursor: pointer;
}
.radio-inline + .radio-inline,
.checkbox-inline + .checkbox-inline {
  margin-top: 0;
  margin-left: 10px;
}
input[type="radio"][disabled],
input[type="checkbox"][disabled],
input[type="radio"].disabled,
input[type="checkbox"].disabled,
fieldset[disabled] input[type="radio"],
fieldset[disabled] input[type="checkbox"] {
  cursor: not-allowed;
}
.radio-inline.disabled,
.checkbox-inline.disabled,
fieldset[disabled] .radio-inline,
fieldset[disabled] .checkbox-inline {
  cursor: not-allowed;
}
.radio.disabled label,
.checkbox.disabled label,
fieldset[disabled] .radio label,
fieldset[disabled] .checkbox label {
  cursor: not-allowed;
}
.form-control-static {
  padding-top: 7px;
  padding-bottom: 7px;
  margin-bottom: 0;
  min-height: 31px;
}
.form-control-static.input-lg,
.form-control-static.input-sm {
  padding-left: 0;
  padding-right: 0;
}
.input-sm {
  height: 30px;
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
select.input-sm {
  height: 30px;
  line-height: 30px;
}
textarea.input-sm,
select[multiple].input-sm {
  height: auto;
}
.form-group-sm .form-control {
  height: 30px;
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
.form-group-sm select.form-control {
  height: 30px;
  line-height: 30px;
}
.form-group-sm textarea.form-control,
.form-group-sm select[multiple].form-control {
  height: auto;
}
.form-group-sm .form-control-static {
  height: 30px;
  min-height: 30px;
  padding: 6px 10px;
  font-size: 12px;
  line-height: 1.5;
}
.input-lg {
  height: 45px;
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
  border-radius: 3px;
}
select.input-lg {
  height: 45px;
  line-height: 45px;
}
textarea.input-lg,
select[multiple].input-lg {
  height: auto;
}
.form-group-lg .form-control {
  height: 45px;
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
  border-radius: 3px;
}
.form-group-lg select.form-control {
  height: 45px;
  line-height: 45px;
}
.form-group-lg textarea.form-control,
.form-group-lg select[multiple].form-control {
  height: auto;
}
.form-group-lg .form-control-static {
  height: 45px;
  min-height: 35px;
  padding: 11px 16px;
  font-size: 17px;
  line-height: 1.3333333;
}
.has-feedback {
  position: relative;
}
.has-feedback .form-control {
  padding-right: 40px;
}
.form-control-feedback {
  position: absolute;
  top: 0;
  right: 0;
  z-index: 2;
  display: block;
  width: 32px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  pointer-events: none;
}
.input-lg + .form-control-feedback,
.input-group-lg + .form-control-feedback,
.form-group-lg .form-control + .form-control-feedback {
  width: 45px;
  height: 45px;
  line-height: 45px;
}
.input-sm + .form-control-feedback,
.input-group-sm + .form-control-feedback,
.form-group-sm .form-control + .form-control-feedback {
  width: 30px;
  height: 30px;
  line-height: 30px;
}
.has-success .help-block,
.has-success .control-label,
.has-success .radio,
.has-success .checkbox,
.has-success .radio-inline,
.has-success .checkbox-inline,
.has-success.radio label,
.has-success.checkbox label,
.has-success.radio-inline label,
.has-success.checkbox-inline label {
  color: #3c763d;
}
.has-success .form-control {
  border-color: #3c763d;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
}
.has-success .form-control:focus {
  border-color: #2b542c;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #67b168;
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #67b168;
}
.has-success .input-group-addon {
  color: #3c763d;
  border-color: #3c763d;
  background-color: #dff0d8;
}
.has-success .form-control-feedback {
  color: #3c763d;
}
.has-warning .help-block,
.has-warning .control-label,
.has-warning .radio,
.has-warning .checkbox,
.has-warning .radio-inline,
.has-warning .checkbox-inline,
.has-warning.radio label,
.has-warning.checkbox label,
.has-warning.radio-inline label,
.has-warning.checkbox-inline label {
  color: #8a6d3b;
}
.has-warning .form-control {
  border-color: #8a6d3b;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
}
.has-warning .form-control:focus {
  border-color: #66512c;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #c0a16b;
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #c0a16b;
}
.has-warning .input-group-addon {
  color: #8a6d3b;
  border-color: #8a6d3b;
  background-color: #fcf8e3;
}
.has-warning .form-control-feedback {
  color: #8a6d3b;
}
.has-error .help-block,
.has-error .control-label,
.has-error .radio,
.has-error .checkbox,
.has-error .radio-inline,
.has-error .checkbox-inline,
.has-error.radio label,
.has-error.checkbox label,
.has-error.radio-inline label,
.has-error.checkbox-inline label {
  color: #a94442;
}
.has-error .form-control {
  border-color: #a94442;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
}
.has-error .form-control:focus {
  border-color: #843534;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #ce8483;
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #ce8483;
}
.has-error .input-group-addon {
  color: #a94442;
  border-color: #a94442;
  background-color: #f2dede;
}
.has-error .form-control-feedback {
  color: #a94442;
}
.has-feedback label ~ .form-control-feedback {
  top: 23px;
}
.has-feedback label.sr-only ~ .form-control-feedback {
  top: 0;
}
.help-block {
  display: block;
  margin-top: 5px;
  margin-bottom: 10px;
  color: #404040;
}
@media (min-width: 768px) {
  .form-inline .form-group {
    display: inline-block;
    margin-bottom: 0;
    vertical-align: middle;
  }
  .form-inline .form-control {
    display: inline-block;
    width: auto;
    vertical-align: middle;
  }
  .form-inline .form-control-static {
    display: inline-block;
  }
  .form-inline .input-group {
    display: inline-table;
    vertical-align: middle;
  }
  .form-inline .input-group .input-group-addon,
  .form-inline .input-group .input-group-btn,
  .form-inline .input-group .form-control {
    width: auto;
  }
  .form-inline .input-group > .form-control {
    width: 100%;
  }
  .form-inline .control-label {
    margin-bottom: 0;
    vertical-align: middle;
  }
  .form-inline .radio,
  .form-inline .checkbox {
    display: inline-block;
    margin-top: 0;
    margin-bottom: 0;
    vertical-align: middle;
  }
  .form-inline .radio label,
  .form-inline .checkbox label {
    padding-left: 0;
  }
  .form-inline .radio input[type="radio"],
  .form-inline .checkbox input[type="checkbox"] {
    position: relative;
    margin-left: 0;
  }
  .form-inline .has-feedback .form-control-feedback {
    top: 0;
  }
}
.form-horizontal .radio,
.form-horizontal .checkbox,
.form-horizontal .radio-inline,
.form-horizontal .checkbox-inline {
  margin-top: 0;
  margin-bottom: 0;
  padding-top: 7px;
}
.form-horizontal .radio,
.form-horizontal .checkbox {
  min-height: 25px;
}
.form-horizontal .form-group {
  margin-left: 0px;
  margin-right: 0px;
}
@media (min-width: 768px) {
  .form-horizontal .control-label {
    text-align: right;
    margin-bottom: 0;
    padding-top: 7px;
  }
}
.form-horizontal .has-feedback .form-control-feedback {
  right: 0px;
}
@media (min-width: 768px) {
  .form-horizontal .form-group-lg .control-label {
    padding-top: 11px;
    font-size: 17px;
  }
}
@media (min-width: 768px) {
  .form-horizontal .form-group-sm .control-label {
    padding-top: 6px;
    font-size: 12px;
  }
}
.btn {
  display: inline-block;
  margin-bottom: 0;
  font-weight: normal;
  text-align: center;
  vertical-align: middle;
  touch-action: manipulation;
  cursor: pointer;
  background-image: none;
  border: 1px solid transparent;
  white-space: nowrap;
  padding: 6px 12px;
  font-size: 13px;
  line-height: 1.42857143;
  border-radius: 2px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.btn:focus,
.btn:active:focus,
.btn.active:focus,
.btn.focus,
.btn:active.focus,
.btn.active.focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
.btn:hover,
.btn:focus,
.btn.focus {
  color: #333;
  text-decoration: none;
}
.btn:active,
.btn.active {
  outline: 0;
  background-image: none;
  -webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn.disabled,
.btn[disabled],
fieldset[disabled] .btn {
  cursor: not-allowed;
  opacity: 0.65;
  filter: alpha(opacity=65);
  -webkit-box-shadow: none;
  box-shadow: none;
}
a.btn.disabled,
fieldset[disabled] a.btn {
  pointer-events: none;
}
.btn-default {
  color: #333;
  background-color: #fff;
  border-color: #ccc;
}
.btn-default:focus,
.btn-default.focus {
  color: #333;
  background-color: #e6e6e6;
  border-color: #8c8c8c;
}
.btn-default:hover {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
.btn-default:active,
.btn-default.active,
.open > .dropdown-toggle.btn-default {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
.btn-default:active:hover,
.btn-default.active:hover,
.open > .dropdown-toggle.btn-default:hover,
.btn-default:active:focus,
.btn-default.active:focus,
.open > .dropdown-toggle.btn-default:focus,
.btn-default:active.focus,
.btn-default.active.focus,
.open > .dropdown-toggle.btn-default.focus {
  color: #333;
  background-color: #d4d4d4;
  border-color: #8c8c8c;
}
.btn-default:active,
.btn-default.active,
.open > .dropdown-toggle.btn-default {
  background-image: none;
}
.btn-default.disabled:hover,
.btn-default[disabled]:hover,
fieldset[disabled] .btn-default:hover,
.btn-default.disabled:focus,
.btn-default[disabled]:focus,
fieldset[disabled] .btn-default:focus,
.btn-default.disabled.focus,
.btn-default[disabled].focus,
fieldset[disabled] .btn-default.focus {
  background-color: #fff;
  border-color: #ccc;
}
.btn-default .badge {
  color: #fff;
  background-color: #333;
}
.btn-primary {
  color: #fff;
  background-color: #337ab7;
  border-color: #2e6da4;
}
.btn-primary:focus,
.btn-primary.focus {
  color: #fff;
  background-color: #286090;
  border-color: #122b40;
}
.btn-primary:hover {
  color: #fff;
  background-color: #286090;
  border-color: #204d74;
}
.btn-primary:active,
.btn-primary.active,
.open > .dropdown-toggle.btn-primary {
  color: #fff;
  background-color: #286090;
  border-color: #204d74;
}
.btn-primary:active:hover,
.btn-primary.active:hover,
.open > .dropdown-toggle.btn-primary:hover,
.btn-primary:active:focus,
.btn-primary.active:focus,
.open > .dropdown-toggle.btn-primary:focus,
.btn-primary:active.focus,
.btn-primary.active.focus,
.open > .dropdown-toggle.btn-primary.focus {
  color: #fff;
  background-color: #204d74;
  border-color: #122b40;
}
.btn-primary:active,
.btn-primary.active,
.open > .dropdown-toggle.btn-primary {
  background-image: none;
}
.btn-primary.disabled:hover,
.btn-primary[disabled]:hover,
fieldset[disabled] .btn-primary:hover,
.btn-primary.disabled:focus,
.btn-primary[disabled]:focus,
fieldset[disabled] .btn-primary:focus,
.btn-primary.disabled.focus,
.btn-primary[disabled].focus,
fieldset[disabled] .btn-primary.focus {
  background-color: #337ab7;
  border-color: #2e6da4;
}
.btn-primary .badge {
  color: #337ab7;
  background-color: #fff;
}
.btn-success {
  color: #fff;
  background-color: #5cb85c;
  border-color: #4cae4c;
}
.btn-success:focus,
.btn-success.focus {
  color: #fff;
  background-color: #449d44;
  border-color: #255625;
}
.btn-success:hover {
  color: #fff;
  background-color: #449d44;
  border-color: #398439;
}
.btn-success:active,
.btn-success.active,
.open > .dropdown-toggle.btn-success {
  color: #fff;
  background-color: #449d44;
  border-color: #398439;
}
.btn-success:active:hover,
.btn-success.active:hover,
.open > .dropdown-toggle.btn-success:hover,
.btn-success:active:focus,
.btn-success.active:focus,
.open > .dropdown-toggle.btn-success:focus,
.btn-success:active.focus,
.btn-success.active.focus,
.open > .dropdown-toggle.btn-success.focus {
  color: #fff;
  background-color: #398439;
  border-color: #255625;
}
.btn-success:active,
.btn-success.active,
.open > .dropdown-toggle.btn-success {
  background-image: none;
}
.btn-success.disabled:hover,
.btn-success[disabled]:hover,
fieldset[disabled] .btn-success:hover,
.btn-success.disabled:focus,
.btn-success[disabled]:focus,
fieldset[disabled] .btn-success:focus,
.btn-success.disabled.focus,
.btn-success[disabled].focus,
fieldset[disabled] .btn-success.focus {
  background-color: #5cb85c;
  border-color: #4cae4c;
}
.btn-success .badge {
  color: #5cb85c;
  background-color: #fff;
}
.btn-info {
  color: #fff;
  background-color: #5bc0de;
  border-color: #46b8da;
}
.btn-info:focus,
.btn-info.focus {
  color: #fff;
  background-color: #31b0d5;
  border-color: #1b6d85;
}
.btn-info:hover {
  color: #fff;
  background-color: #31b0d5;
  border-color: #269abc;
}
.btn-info:active,
.btn-info.active,
.open > .dropdown-toggle.btn-info {
  color: #fff;
  background-color: #31b0d5;
  border-color: #269abc;
}
.btn-info:active:hover,
.btn-info.active:hover,
.open > .dropdown-toggle.btn-info:hover,
.btn-info:active:focus,
.btn-info.active:focus,
.open > .dropdown-toggle.btn-info:focus,
.btn-info:active.focus,
.btn-info.active.focus,
.open > .dropdown-toggle.btn-info.focus {
  color: #fff;
  background-color: #269abc;
  border-color: #1b6d85;
}
.btn-info:active,
.btn-info.active,
.open > .dropdown-toggle.btn-info {
  background-image: none;
}
.btn-info.disabled:hover,
.btn-info[disabled]:hover,
fieldset[disabled] .btn-info:hover,
.btn-info.disabled:focus,
.btn-info[disabled]:focus,
fieldset[disabled] .btn-info:focus,
.btn-info.disabled.focus,
.btn-info[disabled].focus,
fieldset[disabled] .btn-info.focus {
  background-color: #5bc0de;
  border-color: #46b8da;
}
.btn-info .badge {
  color: #5bc0de;
  background-color: #fff;
}
.btn-warning {
  color: #fff;
  background-color: #f0ad4e;
  border-color: #eea236;
}
.btn-warning:focus,
.btn-warning.focus {
  color: #fff;
  background-color: #ec971f;
  border-color: #985f0d;
}
.btn-warning:hover {
  color: #fff;
  background-color: #ec971f;
  border-color: #d58512;
}
.btn-warning:active,
.btn-warning.active,
.open > .dropdown-toggle.btn-warning {
  color: #fff;
  background-color: #ec971f;
  border-color: #d58512;
}
.btn-warning:active:hover,
.btn-warning.active:hover,
.open > .dropdown-toggle.btn-warning:hover,
.btn-warning:active:focus,
.btn-warning.active:focus,
.open > .dropdown-toggle.btn-warning:focus,
.btn-warning:active.focus,
.btn-warning.active.focus,
.open > .dropdown-toggle.btn-warning.focus {
  color: #fff;
  background-color: #d58512;
  border-color: #985f0d;
}
.btn-warning:active,
.btn-warning.active,
.open > .dropdown-toggle.btn-warning {
  background-image: none;
}
.btn-warning.disabled:hover,
.btn-warning[disabled]:hover,
fieldset[disabled] .btn-warning:hover,
.btn-warning.disabled:focus,
.btn-warning[disabled]:focus,
fieldset[disabled] .btn-warning:focus,
.btn-warning.disabled.focus,
.btn-warning[disabled].focus,
fieldset[disabled] .btn-warning.focus {
  background-color: #f0ad4e;
  border-color: #eea236;
}
.btn-warning .badge {
  color: #f0ad4e;
  background-color: #fff;
}
.btn-danger {
  color: #fff;
  background-color: #d9534f;
  border-color: #d43f3a;
}
.btn-danger:focus,
.btn-danger.focus {
  color: #fff;
  background-color: #c9302c;
  border-color: #761c19;
}
.btn-danger:hover {
  color: #fff;
  background-color: #c9302c;
  border-color: #ac2925;
}
.btn-danger:active,
.btn-danger.active,
.open > .dropdown-toggle.btn-danger {
  color: #fff;
  background-color: #c9302c;
  border-color: #ac2925;
}
.btn-danger:active:hover,
.btn-danger.active:hover,
.open > .dropdown-toggle.btn-danger:hover,
.btn-danger:active:focus,
.btn-danger.active:focus,
.open > .dropdown-toggle.btn-danger:focus,
.btn-danger:active.focus,
.btn-danger.active.focus,
.open > .dropdown-toggle.btn-danger.focus {
  color: #fff;
  background-color: #ac2925;
  border-color: #761c19;
}
.btn-danger:active,
.btn-danger.active,
.open > .dropdown-toggle.btn-danger {
  background-image: none;
}
.btn-danger.disabled:hover,
.btn-danger[disabled]:hover,
fieldset[disabled] .btn-danger:hover,
.btn-danger.disabled:focus,
.btn-danger[disabled]:focus,
fieldset[disabled] .btn-danger:focus,
.btn-danger.disabled.focus,
.btn-danger[disabled].focus,
fieldset[disabled] .btn-danger.focus {
  background-color: #d9534f;
  border-color: #d43f3a;
}
.btn-danger .badge {
  color: #d9534f;
  background-color: #fff;
}
.btn-link {
  color: #337ab7;
  font-weight: normal;
  border-radius: 0;
}
.btn-link,
.btn-link:active,
.btn-link.active,
.btn-link[disabled],
fieldset[disabled] .btn-link {
  background-color: transparent;
  -webkit-box-shadow: none;
  box-shadow: none;
}
.btn-link,
.btn-link:hover,
.btn-link:focus,
.btn-link:active {
  border-color: transparent;
}
.btn-link:hover,
.btn-link:focus {
  color: #23527c;
  text-decoration: underline;
  background-color: transparent;
}
.btn-link[disabled]:hover,
fieldset[disabled] .btn-link:hover,
.btn-link[disabled]:focus,
fieldset[disabled] .btn-link:focus {
  color: #777777;
  text-decoration: none;
}
.btn-lg,
.btn-group-lg > .btn {
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
  border-radius: 3px;
}
.btn-sm,
.btn-group-sm > .btn {
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
.btn-xs,
.btn-group-xs > .btn {
  padding: 1px 5px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
.btn-block {
  display: block;
  width: 100%;
}
.btn-block + .btn-block {
  margin-top: 5px;
}
input[type="submit"].btn-block,
input[type="reset"].btn-block,
input[type="button"].btn-block {
  width: 100%;
}
.fade {
  opacity: 0;
  -webkit-transition: opacity 0.15s linear;
  -o-transition: opacity 0.15s linear;
  transition: opacity 0.15s linear;
}
.fade.in {
  opacity: 1;
}
.collapse {
  display: none;
}
.collapse.in {
  display: block;
}
tr.collapse.in {
  display: table-row;
}
tbody.collapse.in {
  display: table-row-group;
}
.collapsing {
  position: relative;
  height: 0;
  overflow: hidden;
  -webkit-transition-property: height, visibility;
  transition-property: height, visibility;
  -webkit-transition-duration: 0.35s;
  transition-duration: 0.35s;
  -webkit-transition-timing-function: ease;
  transition-timing-function: ease;
}
.caret {
  display: inline-block;
  width: 0;
  height: 0;
  margin-left: 2px;
  vertical-align: middle;
  border-top: 4px dashed;
  border-top: 4px solid \9;
  border-right: 4px solid transparent;
  border-left: 4px solid transparent;
}
.dropup,
.dropdown {
  position: relative;
}
.dropdown-toggle:focus {
  outline: 0;
}
.dropdown-menu {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1000;
  display: none;
  float: left;
  min-width: 160px;
  padding: 5px 0;
  margin: 2px 0 0;
  list-style: none;
  font-size: 13px;
  text-align: left;
  background-color: #fff;
  border: 1px solid #ccc;
  border: 1px solid rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
  background-clip: padding-box;
}
.dropdown-menu.pull-right {
  right: 0;
  left: auto;
}
.dropdown-menu .divider {
  height: 1px;
  margin: 8px 0;
  overflow: hidden;
  background-color: #e5e5e5;
}
.dropdown-menu > li > a {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: normal;
  line-height: 1.42857143;
  color: #333333;
  white-space: nowrap;
}
.dropdown-menu > li > a:hover,
.dropdown-menu > li > a:focus {
  text-decoration: none;
  color: #262626;
  background-color: #f5f5f5;
}
.dropdown-menu > .active > a,
.dropdown-menu > .active > a:hover,
.dropdown-menu > .active > a:focus {
  color: #fff;
  text-decoration: none;
  outline: 0;
  background-color: #337ab7;
}
.dropdown-menu > .disabled > a,
.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  color: #777777;
}
.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  text-decoration: none;
  background-color: transparent;
  background-image: none;
  filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
  cursor: not-allowed;
}
.open > .dropdown-menu {
  display: block;
}
.open > a {
  outline: 0;
}
.dropdown-menu-right {
  left: auto;
  right: 0;
}
.dropdown-menu-left {
  left: 0;
  right: auto;
}
.dropdown-header {
  display: block;
  padding: 3px 20px;
  font-size: 12px;
  line-height: 1.42857143;
  color: #777777;
  white-space: nowrap;
}
.dropdown-backdrop {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  z-index: 990;
}
.pull-right > .dropdown-menu {
  right: 0;
  left: auto;
}
.dropup .caret,
.navbar-fixed-bottom .dropdown .caret {
  border-top: 0;
  border-bottom: 4px dashed;
  border-bottom: 4px solid \9;
  content: "";
}
.dropup .dropdown-menu,
.navbar-fixed-bottom .dropdown .dropdown-menu {
  top: auto;
  bottom: 100%;
  margin-bottom: 2px;
}
@media (min-width: 541px) {
  .navbar-right .dropdown-menu {
    left: auto;
    right: 0;
  }
  .navbar-right .dropdown-menu-left {
    left: 0;
    right: auto;
  }
}
.btn-group,
.btn-group-vertical {
  position: relative;
  display: inline-block;
  vertical-align: middle;
}
.btn-group > .btn,
.btn-group-vertical > .btn {
  position: relative;
  float: left;
}
.btn-group > .btn:hover,
.btn-group-vertical > .btn:hover,
.btn-group > .btn:focus,
.btn-group-vertical > .btn:focus,
.btn-group > .btn:active,
.btn-group-vertical > .btn:active,
.btn-group > .btn.active,
.btn-group-vertical > .btn.active {
  z-index: 2;
}
.btn-group .btn + .btn,
.btn-group .btn + .btn-group,
.btn-group .btn-group + .btn,
.btn-group .btn-group + .btn-group {
  margin-left: -1px;
}
.btn-toolbar {
  margin-left: -5px;
}
.btn-toolbar .btn,
.btn-toolbar .btn-group,
.btn-toolbar .input-group {
  float: left;
}
.btn-toolbar > .btn,
.btn-toolbar > .btn-group,
.btn-toolbar > .input-group {
  margin-left: 5px;
}
.btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
  border-radius: 0;
}
.btn-group > .btn:first-child {
  margin-left: 0;
}
.btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
  border-bottom-right-radius: 0;
  border-top-right-radius: 0;
}
.btn-group > .btn:last-child:not(:first-child),
.btn-group > .dropdown-toggle:not(:first-child) {
  border-bottom-left-radius: 0;
  border-top-left-radius: 0;
}
.btn-group > .btn-group {
  float: left;
}
.btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
  border-radius: 0;
}
.btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child,
.btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
  border-bottom-right-radius: 0;
  border-top-right-radius: 0;
}
.btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
  border-bottom-left-radius: 0;
  border-top-left-radius: 0;
}
.btn-group .dropdown-toggle:active,
.btn-group.open .dropdown-toggle {
  outline: 0;
}
.btn-group > .btn + .dropdown-toggle {
  padding-left: 8px;
  padding-right: 8px;
}
.btn-group > .btn-lg + .dropdown-toggle {
  padding-left: 12px;
  padding-right: 12px;
}
.btn-group.open .dropdown-toggle {
  -webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn-group.open .dropdown-toggle.btn-link {
  -webkit-box-shadow: none;
  box-shadow: none;
}
.btn .caret {
  margin-left: 0;
}
.btn-lg .caret {
  border-width: 5px 5px 0;
  border-bottom-width: 0;
}
.dropup .btn-lg .caret {
  border-width: 0 5px 5px;
}
.btn-group-vertical > .btn,
.btn-group-vertical > .btn-group,
.btn-group-vertical > .btn-group > .btn {
  display: block;
  float: none;
  width: 100%;
  max-width: 100%;
}
.btn-group-vertical > .btn-group > .btn {
  float: none;
}
.btn-group-vertical > .btn + .btn,
.btn-group-vertical > .btn + .btn-group,
.btn-group-vertical > .btn-group + .btn,
.btn-group-vertical > .btn-group + .btn-group {
  margin-top: -1px;
  margin-left: 0;
}
.btn-group-vertical > .btn:not(:first-child):not(:last-child) {
  border-radius: 0;
}
.btn-group-vertical > .btn:first-child:not(:last-child) {
  border-top-right-radius: 2px;
  border-top-left-radius: 2px;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group-vertical > .btn:last-child:not(:first-child) {
  border-top-right-radius: 0;
  border-top-left-radius: 0;
  border-bottom-right-radius: 2px;
  border-bottom-left-radius: 2px;
}
.btn-group-vertical > .btn-group:not(:first-child):not(:last-child) > .btn {
  border-radius: 0;
}
.btn-group-vertical > .btn-group:first-child:not(:last-child) > .btn:last-child,
.btn-group-vertical > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group-vertical > .btn-group:last-child:not(:first-child) > .btn:first-child {
  border-top-right-radius: 0;
  border-top-left-radius: 0;
}
.btn-group-justified {
  display: table;
  width: 100%;
  table-layout: fixed;
  border-collapse: separate;
}
.btn-group-justified > .btn,
.btn-group-justified > .btn-group {
  float: none;
  display: table-cell;
  width: 1%;
}
.btn-group-justified > .btn-group .btn {
  width: 100%;
}
.btn-group-justified > .btn-group .dropdown-menu {
  left: auto;
}
[data-toggle="buttons"] > .btn input[type="radio"],
[data-toggle="buttons"] > .btn-group > .btn input[type="radio"],
[data-toggle="buttons"] > .btn input[type="checkbox"],
[data-toggle="buttons"] > .btn-group > .btn input[type="checkbox"] {
  position: absolute;
  clip: rect(0, 0, 0, 0);
  pointer-events: none;
}
.input-group {
  position: relative;
  display: table;
  border-collapse: separate;
}
.input-group[class*="col-"] {
  float: none;
  padding-left: 0;
  padding-right: 0;
}
.input-group .form-control {
  position: relative;
  z-index: 2;
  float: left;
  width: 100%;
  margin-bottom: 0;
}
.input-group .form-control:focus {
  z-index: 3;
}
.input-group-lg > .form-control,
.input-group-lg > .input-group-addon,
.input-group-lg > .input-group-btn > .btn {
  height: 45px;
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
  border-radius: 3px;
}
select.input-group-lg > .form-control,
select.input-group-lg > .input-group-addon,
select.input-group-lg > .input-group-btn > .btn {
  height: 45px;
  line-height: 45px;
}
textarea.input-group-lg > .form-control,
textarea.input-group-lg > .input-group-addon,
textarea.input-group-lg > .input-group-btn > .btn,
select[multiple].input-group-lg > .form-control,
select[multiple].input-group-lg > .input-group-addon,
select[multiple].input-group-lg > .input-group-btn > .btn {
  height: auto;
}
.input-group-sm > .form-control,
.input-group-sm > .input-group-addon,
.input-group-sm > .input-group-btn > .btn {
  height: 30px;
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
select.input-group-sm > .form-control,
select.input-group-sm > .input-group-addon,
select.input-group-sm > .input-group-btn > .btn {
  height: 30px;
  line-height: 30px;
}
textarea.input-group-sm > .form-control,
textarea.input-group-sm > .input-group-addon,
textarea.input-group-sm > .input-group-btn > .btn,
select[multiple].input-group-sm > .form-control,
select[multiple].input-group-sm > .input-group-addon,
select[multiple].input-group-sm > .input-group-btn > .btn {
  height: auto;
}
.input-group-addon,
.input-group-btn,
.input-group .form-control {
  display: table-cell;
}
.input-group-addon:not(:first-child):not(:last-child),
.input-group-btn:not(:first-child):not(:last-child),
.input-group .form-control:not(:first-child):not(:last-child) {
  border-radius: 0;
}
.input-group-addon,
.input-group-btn {
  width: 1%;
  white-space: nowrap;
  vertical-align: middle;
}
.input-group-addon {
  padding: 6px 12px;
  font-size: 13px;
  font-weight: normal;
  line-height: 1;
  color: #555555;
  text-align: center;
  background-color: #eeeeee;
  border: 1px solid #ccc;
  border-radius: 2px;
}
.input-group-addon.input-sm {
  padding: 5px 10px;
  font-size: 12px;
  border-radius: 1px;
}
.input-group-addon.input-lg {
  padding: 10px 16px;
  font-size: 17px;
  border-radius: 3px;
}
.input-group-addon input[type="radio"],
.input-group-addon input[type="checkbox"] {
  margin-top: 0;
}
.input-group .form-control:first-child,
.input-group-addon:first-child,
.input-group-btn:first-child > .btn,
.input-group-btn:first-child > .btn-group > .btn,
.input-group-btn:first-child > .dropdown-toggle,
.input-group-btn:last-child > .btn:not(:last-child):not(.dropdown-toggle),
.input-group-btn:last-child > .btn-group:not(:last-child) > .btn {
  border-bottom-right-radius: 0;
  border-top-right-radius: 0;
}
.input-group-addon:first-child {
  border-right: 0;
}
.input-group .form-control:last-child,
.input-group-addon:last-child,
.input-group-btn:last-child > .btn,
.input-group-btn:last-child > .btn-group > .btn,
.input-group-btn:last-child > .dropdown-toggle,
.input-group-btn:first-child > .btn:not(:first-child),
.input-group-btn:first-child > .btn-group:not(:first-child) > .btn {
  border-bottom-left-radius: 0;
  border-top-left-radius: 0;
}
.input-group-addon:last-child {
  border-left: 0;
}
.input-group-btn {
  position: relative;
  font-size: 0;
  white-space: nowrap;
}
.input-group-btn > .btn {
  position: relative;
}
.input-group-btn > .btn + .btn {
  margin-left: -1px;
}
.input-group-btn > .btn:hover,
.input-group-btn > .btn:focus,
.input-group-btn > .btn:active {
  z-index: 2;
}
.input-group-btn:first-child > .btn,
.input-group-btn:first-child > .btn-group {
  margin-right: -1px;
}
.input-group-btn:last-child > .btn,
.input-group-btn:last-child > .btn-group {
  z-index: 2;
  margin-left: -1px;
}
.nav {
  margin-bottom: 0;
  padding-left: 0;
  list-style: none;
}
.nav > li {
  position: relative;
  display: block;
}
.nav > li > a {
  position: relative;
  display: block;
  padding: 10px 15px;
}
.nav > li > a:hover,
.nav > li > a:focus {
  text-decoration: none;
  background-color: #eeeeee;
}
.nav > li.disabled > a {
  color: #777777;
}
.nav > li.disabled > a:hover,
.nav > li.disabled > a:focus {
  color: #777777;
  text-decoration: none;
  background-color: transparent;
  cursor: not-allowed;
}
.nav .open > a,
.nav .open > a:hover,
.nav .open > a:focus {
  background-color: #eeeeee;
  border-color: #337ab7;
}
.nav .nav-divider {
  height: 1px;
  margin: 8px 0;
  overflow: hidden;
  background-color: #e5e5e5;
}
.nav > li > a > img {
  max-width: none;
}
.nav-tabs {
  border-bottom: 1px solid #ddd;
}
.nav-tabs > li {
  float: left;
  margin-bottom: -1px;
}
.nav-tabs > li > a {
  margin-right: 2px;
  line-height: 1.42857143;
  border: 1px solid transparent;
  border-radius: 2px 2px 0 0;
}
.nav-tabs > li > a:hover {
  border-color: #eeeeee #eeeeee #ddd;
}
.nav-tabs > li.active > a,
.nav-tabs > li.active > a:hover,
.nav-tabs > li.active > a:focus {
  color: #555555;
  background-color: #fff;
  border: 1px solid #ddd;
  border-bottom-color: transparent;
  cursor: default;
}
.nav-tabs.nav-justified {
  width: 100%;
  border-bottom: 0;
}
.nav-tabs.nav-justified > li {
  float: none;
}
.nav-tabs.nav-justified > li > a {
  text-align: center;
  margin-bottom: 5px;
}
.nav-tabs.nav-justified > .dropdown .dropdown-menu {
  top: auto;
  left: auto;
}
@media (min-width: 768px) {
  .nav-tabs.nav-justified > li {
    display: table-cell;
    width: 1%;
  }
  .nav-tabs.nav-justified > li > a {
    margin-bottom: 0;
  }
}
.nav-tabs.nav-justified > li > a {
  margin-right: 0;
  border-radius: 2px;
}
.nav-tabs.nav-justified > .active > a,
.nav-tabs.nav-justified > .active > a:hover,
.nav-tabs.nav-justified > .active > a:focus {
  border: 1px solid #ddd;
}
@media (min-width: 768px) {
  .nav-tabs.nav-justified > li > a {
    border-bottom: 1px solid #ddd;
    border-radius: 2px 2px 0 0;
  }
  .nav-tabs.nav-justified > .active > a,
  .nav-tabs.nav-justified > .active > a:hover,
  .nav-tabs.nav-justified > .active > a:focus {
    border-bottom-color: #fff;
  }
}
.nav-pills > li {
  float: left;
}
.nav-pills > li > a {
  border-radius: 2px;
}
.nav-pills > li + li {
  margin-left: 2px;
}
.nav-pills > li.active > a,
.nav-pills > li.active > a:hover,
.nav-pills > li.active > a:focus {
  color: #fff;
  background-color: #337ab7;
}
.nav-stacked > li {
  float: none;
}
.nav-stacked > li + li {
  margin-top: 2px;
  margin-left: 0;
}
.nav-justified {
  width: 100%;
}
.nav-justified > li {
  float: none;
}
.nav-justified > li > a {
  text-align: center;
  margin-bottom: 5px;
}
.nav-justified > .dropdown .dropdown-menu {
  top: auto;
  left: auto;
}
@media (min-width: 768px) {
  .nav-justified > li {
    display: table-cell;
    width: 1%;
  }
  .nav-justified > li > a {
    margin-bottom: 0;
  }
}
.nav-tabs-justified {
  border-bottom: 0;
}
.nav-tabs-justified > li > a {
  margin-right: 0;
  border-radius: 2px;
}
.nav-tabs-justified > .active > a,
.nav-tabs-justified > .active > a:hover,
.nav-tabs-justified > .active > a:focus {
  border: 1px solid #ddd;
}
@media (min-width: 768px) {
  .nav-tabs-justified > li > a {
    border-bottom: 1px solid #ddd;
    border-radius: 2px 2px 0 0;
  }
  .nav-tabs-justified > .active > a,
  .nav-tabs-justified > .active > a:hover,
  .nav-tabs-justified > .active > a:focus {
    border-bottom-color: #fff;
  }
}
.tab-content > .tab-pane {
  display: none;
}
.tab-content > .active {
  display: block;
}
.nav-tabs .dropdown-menu {
  margin-top: -1px;
  border-top-right-radius: 0;
  border-top-left-radius: 0;
}
.navbar {
  position: relative;
  min-height: 30px;
  margin-bottom: 18px;
  border: 1px solid transparent;
}
@media (min-width: 541px) {
  .navbar {
    border-radius: 2px;
  }
}
@media (min-width: 541px) {
  .navbar-header {
    float: left;
  }
}
.navbar-collapse {
  overflow-x: visible;
  padding-right: 0px;
  padding-left: 0px;
  border-top: 1px solid transparent;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
  -webkit-overflow-scrolling: touch;
}
.navbar-collapse.in {
  overflow-y: auto;
}
@media (min-width: 541px) {
  .navbar-collapse {
    width: auto;
    border-top: 0;
    box-shadow: none;
  }
  .navbar-collapse.collapse {
    display: block !important;
    height: auto !important;
    padding-bottom: 0;
    overflow: visible !important;
  }
  .navbar-collapse.in {
    overflow-y: visible;
  }
  .navbar-fixed-top .navbar-collapse,
  .navbar-static-top .navbar-collapse,
  .navbar-fixed-bottom .navbar-collapse {
    padding-left: 0;
    padding-right: 0;
  }
}
.navbar-fixed-top .navbar-collapse,
.navbar-fixed-bottom .navbar-collapse {
  max-height: 340px;
}
@media (max-device-width: 540px) and (orientation: landscape) {
  .navbar-fixed-top .navbar-collapse,
  .navbar-fixed-bottom .navbar-collapse {
    max-height: 200px;
  }
}
.container > .navbar-header,
.container-fluid > .navbar-header,
.container > .navbar-collapse,
.container-fluid > .navbar-collapse {
  margin-right: 0px;
  margin-left: 0px;
}
@media (min-width: 541px) {
  .container > .navbar-header,
  .container-fluid > .navbar-header,
  .container > .navbar-collapse,
  .container-fluid > .navbar-collapse {
    margin-right: 0;
    margin-left: 0;
  }
}
.navbar-static-top {
  z-index: 1000;
  border-width: 0 0 1px;
}
@media (min-width: 541px) {
  .navbar-static-top {
    border-radius: 0;
  }
}
.navbar-fixed-top,
.navbar-fixed-bottom {
  position: fixed;
  right: 0;
  left: 0;
  z-index: 1030;
}
@media (min-width: 541px) {
  .navbar-fixed-top,
  .navbar-fixed-bottom {
    border-radius: 0;
  }
}
.navbar-fixed-top {
  top: 0;
  border-width: 0 0 1px;
}
.navbar-fixed-bottom {
  bottom: 0;
  margin-bottom: 0;
  border-width: 1px 0 0;
}
.navbar-brand {
  float: left;
  padding: 6px 0px;
  font-size: 17px;
  line-height: 18px;
  height: 30px;
}
.navbar-brand:hover,
.navbar-brand:focus {
  text-decoration: none;
}
.navbar-brand > img {
  display: block;
}
@media (min-width: 541px) {
  .navbar > .container .navbar-brand,
  .navbar > .container-fluid .navbar-brand {
    margin-left: 0px;
  }
}
.navbar-toggle {
  position: relative;
  float: right;
  margin-right: 0px;
  padding: 9px 10px;
  margin-top: -2px;
  margin-bottom: -2px;
  background-color: transparent;
  background-image: none;
  border: 1px solid transparent;
  border-radius: 2px;
}
.navbar-toggle:focus {
  outline: 0;
}
.navbar-toggle .icon-bar {
  display: block;
  width: 22px;
  height: 2px;
  border-radius: 1px;
}
.navbar-toggle .icon-bar + .icon-bar {
  margin-top: 4px;
}
@media (min-width: 541px) {
  .navbar-toggle {
    display: none;
  }
}
.navbar-nav {
  margin: 3px 0px;
}
.navbar-nav > li > a {
  padding-top: 10px;
  padding-bottom: 10px;
  line-height: 18px;
}
@media (max-width: 540px) {
  .navbar-nav .open .dropdown-menu {
    position: static;
    float: none;
    width: auto;
    margin-top: 0;
    background-color: transparent;
    border: 0;
    box-shadow: none;
  }
  .navbar-nav .open .dropdown-menu > li > a,
  .navbar-nav .open .dropdown-menu .dropdown-header {
    padding: 5px 15px 5px 25px;
  }
  .navbar-nav .open .dropdown-menu > li > a {
    line-height: 18px;
  }
  .navbar-nav .open .dropdown-menu > li > a:hover,
  .navbar-nav .open .dropdown-menu > li > a:focus {
    background-image: none;
  }
}
@media (min-width: 541px) {
  .navbar-nav {
    float: left;
    margin: 0;
  }
  .navbar-nav > li {
    float: left;
  }
  .navbar-nav > li > a {
    padding-top: 6px;
    padding-bottom: 6px;
  }
}
.navbar-form {
  margin-left: 0px;
  margin-right: 0px;
  padding: 10px 0px;
  border-top: 1px solid transparent;
  border-bottom: 1px solid transparent;
  -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 0 rgba(255, 255, 255, 0.1);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 0 rgba(255, 255, 255, 0.1);
  margin-top: -1px;
  margin-bottom: -1px;
}
@media (min-width: 768px) {
  .navbar-form .form-group {
    display: inline-block;
    margin-bottom: 0;
    vertical-align: middle;
  }
  .navbar-form .form-control {
    display: inline-block;
    width: auto;
    vertical-align: middle;
  }
  .navbar-form .form-control-static {
    display: inline-block;
  }
  .navbar-form .input-group {
    display: inline-table;
    vertical-align: middle;
  }
  .navbar-form .input-group .input-group-addon,
  .navbar-form .input-group .input-group-btn,
  .navbar-form .input-group .form-control {
    width: auto;
  }
  .navbar-form .input-group > .form-control {
    width: 100%;
  }
  .navbar-form .control-label {
    margin-bottom: 0;
    vertical-align: middle;
  }
  .navbar-form .radio,
  .navbar-form .checkbox {
    display: inline-block;
    margin-top: 0;
    margin-bottom: 0;
    vertical-align: middle;
  }
  .navbar-form .radio label,
  .navbar-form .checkbox label {
    padding-left: 0;
  }
  .navbar-form .radio input[type="radio"],
  .navbar-form .checkbox input[type="checkbox"] {
    position: relative;
    margin-left: 0;
  }
  .navbar-form .has-feedback .form-control-feedback {
    top: 0;
  }
}
@media (max-width: 540px) {
  .navbar-form .form-group {
    margin-bottom: 5px;
  }
  .navbar-form .form-group:last-child {
    margin-bottom: 0;
  }
}
@media (min-width: 541px) {
  .navbar-form {
    width: auto;
    border: 0;
    margin-left: 0;
    margin-right: 0;
    padding-top: 0;
    padding-bottom: 0;
    -webkit-box-shadow: none;
    box-shadow: none;
  }
}
.navbar-nav > li > .dropdown-menu {
  margin-top: 0;
  border-top-right-radius: 0;
  border-top-left-radius: 0;
}
.navbar-fixed-bottom .navbar-nav > li > .dropdown-menu {
  margin-bottom: 0;
  border-top-right-radius: 2px;
  border-top-left-radius: 2px;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
.navbar-btn {
  margin-top: -1px;
  margin-bottom: -1px;
}
.navbar-btn.btn-sm {
  margin-top: 0px;
  margin-bottom: 0px;
}
.navbar-btn.btn-xs {
  margin-top: 4px;
  margin-bottom: 4px;
}
.navbar-text {
  margin-top: 6px;
  margin-bottom: 6px;
}
@media (min-width: 541px) {
  .navbar-text {
    float: left;
    margin-left: 0px;
    margin-right: 0px;
  }
}
@media (min-width: 541px) {
  .navbar-left {
    float: left !important;
    float: left;
  }
  .navbar-right {
    float: right !important;
    float: right;
    margin-right: 0px;
  }
  .navbar-right ~ .navbar-right {
    margin-right: 0;
  }
}
.navbar-default {
  background-color: #f8f8f8;
  border-color: #e7e7e7;
}
.navbar-default .navbar-brand {
  color: #777;
}
.navbar-default .navbar-brand:hover,
.navbar-default .navbar-brand:focus {
  color: #5e5e5e;
  background-color: transparent;
}
.navbar-default .navbar-text {
  color: #777;
}
.navbar-default .navbar-nav > li > a {
  color: #777;
}
.navbar-default .navbar-nav > li > a:hover,
.navbar-default .navbar-nav > li > a:focus {
  color: #333;
  background-color: transparent;
}
.navbar-default .navbar-nav > .active > a,
.navbar-default .navbar-nav > .active > a:hover,
.navbar-default .navbar-nav > .active > a:focus {
  color: #555;
  background-color: #e7e7e7;
}
.navbar-default .navbar-nav > .disabled > a,
.navbar-default .navbar-nav > .disabled > a:hover,
.navbar-default .navbar-nav > .disabled > a:focus {
  color: #ccc;
  background-color: transparent;
}
.navbar-default .navbar-toggle {
  border-color: #ddd;
}
.navbar-default .navbar-toggle:hover,
.navbar-default .navbar-toggle:focus {
  background-color: #ddd;
}
.navbar-default .navbar-toggle .icon-bar {
  background-color: #888;
}
.navbar-default .navbar-collapse,
.navbar-default .navbar-form {
  border-color: #e7e7e7;
}
.navbar-default .navbar-nav > .open > a,
.navbar-default .navbar-nav > .open > a:hover,
.navbar-default .navbar-nav > .open > a:focus {
  background-color: #e7e7e7;
  color: #555;
}
@media (max-width: 540px) {
  .navbar-default .navbar-nav .open .dropdown-menu > li > a {
    color: #777;
  }
  .navbar-default .navbar-nav .open .dropdown-menu > li > a:hover,
  .navbar-default .navbar-nav .open .dropdown-menu > li > a:focus {
    color: #333;
    background-color: transparent;
  }
  .navbar-default .navbar-nav .open .dropdown-menu > .active > a,
  .navbar-default .navbar-nav .open .dropdown-menu > .active > a:hover,
  .navbar-default .navbar-nav .open .dropdown-menu > .active > a:focus {
    color: #555;
    background-color: #e7e7e7;
  }
  .navbar-default .navbar-nav .open .dropdown-menu > .disabled > a,
  .navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:hover,
  .navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:focus {
    color: #ccc;
    background-color: transparent;
  }
}
.navbar-default .navbar-link {
  color: #777;
}
.navbar-default .navbar-link:hover {
  color: #333;
}
.navbar-default .btn-link {
  color: #777;
}
.navbar-default .btn-link:hover,
.navbar-default .btn-link:focus {
  color: #333;
}
.navbar-default .btn-link[disabled]:hover,
fieldset[disabled] .navbar-default .btn-link:hover,
.navbar-default .btn-link[disabled]:focus,
fieldset[disabled] .navbar-default .btn-link:focus {
  color: #ccc;
}
.navbar-inverse {
  background-color: #222;
  border-color: #080808;
}
.navbar-inverse .navbar-brand {
  color: #9d9d9d;
}
.navbar-inverse .navbar-brand:hover,
.navbar-inverse .navbar-brand:focus {
  color: #fff;
  background-color: transparent;
}
.navbar-inverse .navbar-text {
  color: #9d9d9d;
}
.navbar-inverse .navbar-nav > li > a {
  color: #9d9d9d;
}
.navbar-inverse .navbar-nav > li > a:hover,
.navbar-inverse .navbar-nav > li > a:focus {
  color: #fff;
  background-color: transparent;
}
.navbar-inverse .navbar-nav > .active > a,
.navbar-inverse .navbar-nav > .active > a:hover,
.navbar-inverse .navbar-nav > .active > a:focus {
  color: #fff;
  background-color: #080808;
}
.navbar-inverse .navbar-nav > .disabled > a,
.navbar-inverse .navbar-nav > .disabled > a:hover,
.navbar-inverse .navbar-nav > .disabled > a:focus {
  color: #444;
  background-color: transparent;
}
.navbar-inverse .navbar-toggle {
  border-color: #333;
}
.navbar-inverse .navbar-toggle:hover,
.navbar-inverse .navbar-toggle:focus {
  background-color: #333;
}
.navbar-inverse .navbar-toggle .icon-bar {
  background-color: #fff;
}
.navbar-inverse .navbar-collapse,
.navbar-inverse .navbar-form {
  border-color: #101010;
}
.navbar-inverse .navbar-nav > .open > a,
.navbar-inverse .navbar-nav > .open > a:hover,
.navbar-inverse .navbar-nav > .open > a:focus {
  background-color: #080808;
  color: #fff;
}
@media (max-width: 540px) {
  .navbar-inverse .navbar-nav .open .dropdown-menu > .dropdown-header {
    border-color: #080808;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu .divider {
    background-color: #080808;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu > li > a {
    color: #9d9d9d;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu > li > a:hover,
  .navbar-inverse .navbar-nav .open .dropdown-menu > li > a:focus {
    color: #fff;
    background-color: transparent;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu > .active > a,
  .navbar-inverse .navbar-nav .open .dropdown-menu > .active > a:hover,
  .navbar-inverse .navbar-nav .open .dropdown-menu > .active > a:focus {
    color: #fff;
    background-color: #080808;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu > .disabled > a,
  .navbar-inverse .navbar-nav .open .dropdown-menu > .disabled > a:hover,
  .navbar-inverse .navbar-nav .open .dropdown-menu > .disabled > a:focus {
    color: #444;
    background-color: transparent;
  }
}
.navbar-inverse .navbar-link {
  color: #9d9d9d;
}
.navbar-inverse .navbar-link:hover {
  color: #fff;
}
.navbar-inverse .btn-link {
  color: #9d9d9d;
}
.navbar-inverse .btn-link:hover,
.navbar-inverse .btn-link:focus {
  color: #fff;
}
.navbar-inverse .btn-link[disabled]:hover,
fieldset[disabled] .navbar-inverse .btn-link:hover,
.navbar-inverse .btn-link[disabled]:focus,
fieldset[disabled] .navbar-inverse .btn-link:focus {
  color: #444;
}
.breadcrumb {
  padding: 8px 15px;
  margin-bottom: 18px;
  list-style: none;
  background-color: #f5f5f5;
  border-radius: 2px;
}
.breadcrumb > li {
  display: inline-block;
}
.breadcrumb > li + li:before {
  content: "/\00a0";
  padding: 0 5px;
  color: #5e5e5e;
}
.breadcrumb > .active {
  color: #777777;
}
.pagination {
  display: inline-block;
  padding-left: 0;
  margin: 18px 0;
  border-radius: 2px;
}
.pagination > li {
  display: inline;
}
.pagination > li > a,
.pagination > li > span {
  position: relative;
  float: left;
  padding: 6px 12px;
  line-height: 1.42857143;
  text-decoration: none;
  color: #337ab7;
  background-color: #fff;
  border: 1px solid #ddd;
  margin-left: -1px;
}
.pagination > li:first-child > a,
.pagination > li:first-child > span {
  margin-left: 0;
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.pagination > li:last-child > a,
.pagination > li:last-child > span {
  border-bottom-right-radius: 2px;
  border-top-right-radius: 2px;
}
.pagination > li > a:hover,
.pagination > li > span:hover,
.pagination > li > a:focus,
.pagination > li > span:focus {
  z-index: 2;
  color: #23527c;
  background-color: #eeeeee;
  border-color: #ddd;
}
.pagination > .active > a,
.pagination > .active > span,
.pagination > .active > a:hover,
.pagination > .active > span:hover,
.pagination > .active > a:focus,
.pagination > .active > span:focus {
  z-index: 3;
  color: #fff;
  background-color: #337ab7;
  border-color: #337ab7;
  cursor: default;
}
.pagination > .disabled > span,
.pagination > .disabled > span:hover,
.pagination > .disabled > span:focus,
.pagination > .disabled > a,
.pagination > .disabled > a:hover,
.pagination > .disabled > a:focus {
  color: #777777;
  background-color: #fff;
  border-color: #ddd;
  cursor: not-allowed;
}
.pagination-lg > li > a,
.pagination-lg > li > span {
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
}
.pagination-lg > li:first-child > a,
.pagination-lg > li:first-child > span {
  border-bottom-left-radius: 3px;
  border-top-left-radius: 3px;
}
.pagination-lg > li:last-child > a,
.pagination-lg > li:last-child > span {
  border-bottom-right-radius: 3px;
  border-top-right-radius: 3px;
}
.pagination-sm > li > a,
.pagination-sm > li > span {
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
}
.pagination-sm > li:first-child > a,
.pagination-sm > li:first-child > span {
  border-bottom-left-radius: 1px;
  border-top-left-radius: 1px;
}
.pagination-sm > li:last-child > a,
.pagination-sm > li:last-child > span {
  border-bottom-right-radius: 1px;
  border-top-right-radius: 1px;
}
.pager {
  padding-left: 0;
  margin: 18px 0;
  list-style: none;
  text-align: center;
}
.pager li {
  display: inline;
}
.pager li > a,
.pager li > span {
  display: inline-block;
  padding: 5px 14px;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 15px;
}
.pager li > a:hover,
.pager li > a:focus {
  text-decoration: none;
  background-color: #eeeeee;
}
.pager .next > a,
.pager .next > span {
  float: right;
}
.pager .previous > a,
.pager .previous > span {
  float: left;
}
.pager .disabled > a,
.pager .disabled > a:hover,
.pager .disabled > a:focus,
.pager .disabled > span {
  color: #777777;
  background-color: #fff;
  cursor: not-allowed;
}
.label {
  display: inline;
  padding: .2em .6em .3em;
  font-size: 75%;
  font-weight: bold;
  line-height: 1;
  color: #fff;
  text-align: center;
  white-space: nowrap;
  vertical-align: baseline;
  border-radius: .25em;
}
a.label:hover,
a.label:focus {
  color: #fff;
  text-decoration: none;
  cursor: pointer;
}
.label:empty {
  display: none;
}
.btn .label {
  position: relative;
  top: -1px;
}
.label-default {
  background-color: #777777;
}
.label-default[href]:hover,
.label-default[href]:focus {
  background-color: #5e5e5e;
}
.label-primary {
  background-color: #337ab7;
}
.label-primary[href]:hover,
.label-primary[href]:focus {
  background-color: #286090;
}
.label-success {
  background-color: #5cb85c;
}
.label-success[href]:hover,
.label-success[href]:focus {
  background-color: #449d44;
}
.label-info {
  background-color: #5bc0de;
}
.label-info[href]:hover,
.label-info[href]:focus {
  background-color: #31b0d5;
}
.label-warning {
  background-color: #f0ad4e;
}
.label-warning[href]:hover,
.label-warning[href]:focus {
  background-color: #ec971f;
}
.label-danger {
  background-color: #d9534f;
}
.label-danger[href]:hover,
.label-danger[href]:focus {
  background-color: #c9302c;
}
.badge {
  display: inline-block;
  min-width: 10px;
  padding: 3px 7px;
  font-size: 12px;
  font-weight: bold;
  color: #fff;
  line-height: 1;
  vertical-align: middle;
  white-space: nowrap;
  text-align: center;
  background-color: #777777;
  border-radius: 10px;
}
.badge:empty {
  display: none;
}
.btn .badge {
  position: relative;
  top: -1px;
}
.btn-xs .badge,
.btn-group-xs > .btn .badge {
  top: 0;
  padding: 1px 5px;
}
a.badge:hover,
a.badge:focus {
  color: #fff;
  text-decoration: none;
  cursor: pointer;
}
.list-group-item.active > .badge,
.nav-pills > .active > a > .badge {
  color: #337ab7;
  background-color: #fff;
}
.list-group-item > .badge {
  float: right;
}
.list-group-item > .badge + .badge {
  margin-right: 5px;
}
.nav-pills > li > a > .badge {
  margin-left: 3px;
}
.jumbotron {
  padding-top: 30px;
  padding-bottom: 30px;
  margin-bottom: 30px;
  color: inherit;
  background-color: #eeeeee;
}
.jumbotron h1,
.jumbotron .h1 {
  color: inherit;
}
.jumbotron p {
  margin-bottom: 15px;
  font-size: 20px;
  font-weight: 200;
}
.jumbotron > hr {
  border-top-color: #d5d5d5;
}
.container .jumbotron,
.container-fluid .jumbotron {
  border-radius: 3px;
  padding-left: 0px;
  padding-right: 0px;
}
.jumbotron .container {
  max-width: 100%;
}
@media screen and (min-width: 768px) {
  .jumbotron {
    padding-top: 48px;
    padding-bottom: 48px;
  }
  .container .jumbotron,
  .container-fluid .jumbotron {
    padding-left: 60px;
    padding-right: 60px;
  }
  .jumbotron h1,
  .jumbotron .h1 {
    font-size: 59px;
  }
}
.thumbnail {
  display: block;
  padding: 4px;
  margin-bottom: 18px;
  line-height: 1.42857143;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 2px;
  -webkit-transition: border 0.2s ease-in-out;
  -o-transition: border 0.2s ease-in-out;
  transition: border 0.2s ease-in-out;
}
.thumbnail > img,
.thumbnail a > img {
  margin-left: auto;
  margin-right: auto;
}
a.thumbnail:hover,
a.thumbnail:focus,
a.thumbnail.active {
  border-color: #337ab7;
}
.thumbnail .caption {
  padding: 9px;
  color: #000;
}
.alert {
  padding: 15px;
  margin-bottom: 18px;
  border: 1px solid transparent;
  border-radius: 2px;
}
.alert h4 {
  margin-top: 0;
  color: inherit;
}
.alert .alert-link {
  font-weight: bold;
}
.alert > p,
.alert > ul {
  margin-bottom: 0;
}
.alert > p + p {
  margin-top: 5px;
}
.alert-dismissable,
.alert-dismissible {
  padding-right: 35px;
}
.alert-dismissable .close,
.alert-dismissible .close {
  position: relative;
  top: -2px;
  right: -21px;
  color: inherit;
}
.alert-success {
  background-color: #dff0d8;
  border-color: #d6e9c6;
  color: #3c763d;
}
.alert-success hr {
  border-top-color: #c9e2b3;
}
.alert-success .alert-link {
  color: #2b542c;
}
.alert-info {
  background-color: #d9edf7;
  border-color: #bce8f1;
  color: #31708f;
}
.alert-info hr {
  border-top-color: #a6e1ec;
}
.alert-info .alert-link {
  color: #245269;
}
.alert-warning {
  background-color: #fcf8e3;
  border-color: #faebcc;
  color: #8a6d3b;
}
.alert-warning hr {
  border-top-color: #f7e1b5;
}
.alert-warning .alert-link {
  color: #66512c;
}
.alert-danger {
  background-color: #f2dede;
  border-color: #ebccd1;
  color: #a94442;
}
.alert-danger hr {
  border-top-color: #e4b9c0;
}
.alert-danger .alert-link {
  color: #843534;
}
@-webkit-keyframes progress-bar-stripes {
  from {
    background-position: 40px 0;
  }
  to {
    background-position: 0 0;
  }
}
@keyframes progress-bar-stripes {
  from {
    background-position: 40px 0;
  }
  to {
    background-position: 0 0;
  }
}
.progress {
  overflow: hidden;
  height: 18px;
  margin-bottom: 18px;
  background-color: #f5f5f5;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
}
.progress-bar {
  float: left;
  width: 0%;
  height: 100%;
  font-size: 12px;
  line-height: 18px;
  color: #fff;
  text-align: center;
  background-color: #337ab7;
  -webkit-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  -webkit-transition: width 0.6s ease;
  -o-transition: width 0.6s ease;
  transition: width 0.6s ease;
}
.progress-striped .progress-bar,
.progress-bar-striped {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-size: 40px 40px;
}
.progress.active .progress-bar,
.progress-bar.active {
  -webkit-animation: progress-bar-stripes 2s linear infinite;
  -o-animation: progress-bar-stripes 2s linear infinite;
  animation: progress-bar-stripes 2s linear infinite;
}
.progress-bar-success {
  background-color: #5cb85c;
}
.progress-striped .progress-bar-success {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
}
.progress-bar-info {
  background-color: #5bc0de;
}
.progress-striped .progress-bar-info {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
}
.progress-bar-warning {
  background-color: #f0ad4e;
}
.progress-striped .progress-bar-warning {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
}
.progress-bar-danger {
  background-color: #d9534f;
}
.progress-striped .progress-bar-danger {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
}
.media {
  margin-top: 15px;
}
.media:first-child {
  margin-top: 0;
}
.media,
.media-body {
  zoom: 1;
  overflow: hidden;
}
.media-body {
  width: 10000px;
}
.media-object {
  display: block;
}
.media-object.img-thumbnail {
  max-width: none;
}
.media-right,
.media > .pull-right {
  padding-left: 10px;
}
.media-left,
.media > .pull-left {
  padding-right: 10px;
}
.media-left,
.media-right,
.media-body {
  display: table-cell;
  vertical-align: top;
}
.media-middle {
  vertical-align: middle;
}
.media-bottom {
  vertical-align: bottom;
}
.media-heading {
  margin-top: 0;
  margin-bottom: 5px;
}
.media-list {
  padding-left: 0;
  list-style: none;
}
.list-group {
  margin-bottom: 20px;
  padding-left: 0;
}
.list-group-item {
  position: relative;
  display: block;
  padding: 10px 15px;
  margin-bottom: -1px;
  background-color: #fff;
  border: 1px solid #ddd;
}
.list-group-item:first-child {
  border-top-right-radius: 2px;
  border-top-left-radius: 2px;
}
.list-group-item:last-child {
  margin-bottom: 0;
  border-bottom-right-radius: 2px;
  border-bottom-left-radius: 2px;
}
a.list-group-item,
button.list-group-item {
  color: #555;
}
a.list-group-item .list-group-item-heading,
button.list-group-item .list-group-item-heading {
  color: #333;
}
a.list-group-item:hover,
button.list-group-item:hover,
a.list-group-item:focus,
button.list-group-item:focus {
  text-decoration: none;
  color: #555;
  background-color: #f5f5f5;
}
button.list-group-item {
  width: 100%;
  text-align: left;
}
.list-group-item.disabled,
.list-group-item.disabled:hover,
.list-group-item.disabled:focus {
  background-color: #eeeeee;
  color: #777777;
  cursor: not-allowed;
}
.list-group-item.disabled .list-group-item-heading,
.list-group-item.disabled:hover .list-group-item-heading,
.list-group-item.disabled:focus .list-group-item-heading {
  color: inherit;
}
.list-group-item.disabled .list-group-item-text,
.list-group-item.disabled:hover .list-group-item-text,
.list-group-item.disabled:focus .list-group-item-text {
  color: #777777;
}
.list-group-item.active,
.list-group-item.active:hover,
.list-group-item.active:focus {
  z-index: 2;
  color: #fff;
  background-color: #337ab7;
  border-color: #337ab7;
}
.list-group-item.active .list-group-item-heading,
.list-group-item.active:hover .list-group-item-heading,
.list-group-item.active:focus .list-group-item-heading,
.list-group-item.active .list-group-item-heading > small,
.list-group-item.active:hover .list-group-item-heading > small,
.list-group-item.active:focus .list-group-item-heading > small,
.list-group-item.active .list-group-item-heading > .small,
.list-group-item.active:hover .list-group-item-heading > .small,
.list-group-item.active:focus .list-group-item-heading > .small {
  color: inherit;
}
.list-group-item.active .list-group-item-text,
.list-group-item.active:hover .list-group-item-text,
.list-group-item.active:focus .list-group-item-text {
  color: #c7ddef;
}
.list-group-item-success {
  color: #3c763d;
  background-color: #dff0d8;
}
a.list-group-item-success,
button.list-group-item-success {
  color: #3c763d;
}
a.list-group-item-success .list-group-item-heading,
button.list-group-item-success .list-group-item-heading {
  color: inherit;
}
a.list-group-item-success:hover,
button.list-group-item-success:hover,
a.list-group-item-success:focus,
button.list-group-item-success:focus {
  color: #3c763d;
  background-color: #d0e9c6;
}
a.list-group-item-success.active,
button.list-group-item-success.active,
a.list-group-item-success.active:hover,
button.list-group-item-success.active:hover,
a.list-group-item-success.active:focus,
button.list-group-item-success.active:focus {
  color: #fff;
  background-color: #3c763d;
  border-color: #3c763d;
}
.list-group-item-info {
  color: #31708f;
  background-color: #d9edf7;
}
a.list-group-item-info,
button.list-group-item-info {
  color: #31708f;
}
a.list-group-item-info .list-group-item-heading,
button.list-group-item-info .list-group-item-heading {
  color: inherit;
}
a.list-group-item-info:hover,
button.list-group-item-info:hover,
a.list-group-item-info:focus,
button.list-group-item-info:focus {
  color: #31708f;
  background-color: #c4e3f3;
}
a.list-group-item-info.active,
button.list-group-item-info.active,
a.list-group-item-info.active:hover,
button.list-group-item-info.active:hover,
a.list-group-item-info.active:focus,
button.list-group-item-info.active:focus {
  color: #fff;
  background-color: #31708f;
  border-color: #31708f;
}
.list-group-item-warning {
  color: #8a6d3b;
  background-color: #fcf8e3;
}
a.list-group-item-warning,
button.list-group-item-warning {
  color: #8a6d3b;
}
a.list-group-item-warning .list-group-item-heading,
button.list-group-item-warning .list-group-item-heading {
  color: inherit;
}
a.list-group-item-warning:hover,
button.list-group-item-warning:hover,
a.list-group-item-warning:focus,
button.list-group-item-warning:focus {
  color: #8a6d3b;
  background-color: #faf2cc;
}
a.list-group-item-warning.active,
button.list-group-item-warning.active,
a.list-group-item-warning.active:hover,
button.list-group-item-warning.active:hover,
a.list-group-item-warning.active:focus,
button.list-group-item-warning.active:focus {
  color: #fff;
  background-color: #8a6d3b;
  border-color: #8a6d3b;
}
.list-group-item-danger {
  color: #a94442;
  background-color: #f2dede;
}
a.list-group-item-danger,
button.list-group-item-danger {
  color: #a94442;
}
a.list-group-item-danger .list-group-item-heading,
button.list-group-item-danger .list-group-item-heading {
  color: inherit;
}
a.list-group-item-danger:hover,
button.list-group-item-danger:hover,
a.list-group-item-danger:focus,
button.list-group-item-danger:focus {
  color: #a94442;
  background-color: #ebcccc;
}
a.list-group-item-danger.active,
button.list-group-item-danger.active,
a.list-group-item-danger.active:hover,
button.list-group-item-danger.active:hover,
a.list-group-item-danger.active:focus,
button.list-group-item-danger.active:focus {
  color: #fff;
  background-color: #a94442;
  border-color: #a94442;
}
.list-group-item-heading {
  margin-top: 0;
  margin-bottom: 5px;
}
.list-group-item-text {
  margin-bottom: 0;
  line-height: 1.3;
}
.panel {
  margin-bottom: 18px;
  background-color: #fff;
  border: 1px solid transparent;
  border-radius: 2px;
  -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
}
.panel-body {
  padding: 15px;
}
.panel-heading {
  padding: 10px 15px;
  border-bottom: 1px solid transparent;
  border-top-right-radius: 1px;
  border-top-left-radius: 1px;
}
.panel-heading > .dropdown .dropdown-toggle {
  color: inherit;
}
.panel-title {
  margin-top: 0;
  margin-bottom: 0;
  font-size: 15px;
  color: inherit;
}
.panel-title > a,
.panel-title > small,
.panel-title > .small,
.panel-title > small > a,
.panel-title > .small > a {
  color: inherit;
}
.panel-footer {
  padding: 10px 15px;
  background-color: #f5f5f5;
  border-top: 1px solid #ddd;
  border-bottom-right-radius: 1px;
  border-bottom-left-radius: 1px;
}
.panel > .list-group,
.panel > .panel-collapse > .list-group {
  margin-bottom: 0;
}
.panel > .list-group .list-group-item,
.panel > .panel-collapse > .list-group .list-group-item {
  border-width: 1px 0;
  border-radius: 0;
}
.panel > .list-group:first-child .list-group-item:first-child,
.panel > .panel-collapse > .list-group:first-child .list-group-item:first-child {
  border-top: 0;
  border-top-right-radius: 1px;
  border-top-left-radius: 1px;
}
.panel > .list-group:last-child .list-group-item:last-child,
.panel > .panel-collapse > .list-group:last-child .list-group-item:last-child {
  border-bottom: 0;
  border-bottom-right-radius: 1px;
  border-bottom-left-radius: 1px;
}
.panel > .panel-heading + .panel-collapse > .list-group .list-group-item:first-child {
  border-top-right-radius: 0;
  border-top-left-radius: 0;
}
.panel-heading + .list-group .list-group-item:first-child {
  border-top-width: 0;
}
.list-group + .panel-footer {
  border-top-width: 0;
}
.panel > .table,
.panel > .table-responsive > .table,
.panel > .panel-collapse > .table {
  margin-bottom: 0;
}
.panel > .table caption,
.panel > .table-responsive > .table caption,
.panel > .panel-collapse > .table caption {
  padding-left: 15px;
  padding-right: 15px;
}
.panel > .table:first-child,
.panel > .table-responsive:first-child > .table:first-child {
  border-top-right-radius: 1px;
  border-top-left-radius: 1px;
}
.panel > .table:first-child > thead:first-child > tr:first-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child,
.panel > .table:first-child > tbody:first-child > tr:first-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child {
  border-top-left-radius: 1px;
  border-top-right-radius: 1px;
}
.panel > .table:first-child > thead:first-child > tr:first-child td:first-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child td:first-child,
.panel > .table:first-child > tbody:first-child > tr:first-child td:first-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child td:first-child,
.panel > .table:first-child > thead:first-child > tr:first-child th:first-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child th:first-child,
.panel > .table:first-child > tbody:first-child > tr:first-child th:first-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child th:first-child {
  border-top-left-radius: 1px;
}
.panel > .table:first-child > thead:first-child > tr:first-child td:last-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child td:last-child,
.panel > .table:first-child > tbody:first-child > tr:first-child td:last-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child td:last-child,
.panel > .table:first-child > thead:first-child > tr:first-child th:last-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child th:last-child,
.panel > .table:first-child > tbody:first-child > tr:first-child th:last-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child th:last-child {
  border-top-right-radius: 1px;
}
.panel > .table:last-child,
.panel > .table-responsive:last-child > .table:last-child {
  border-bottom-right-radius: 1px;
  border-bottom-left-radius: 1px;
}
.panel > .table:last-child > tbody:last-child > tr:last-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child {
  border-bottom-left-radius: 1px;
  border-bottom-right-radius: 1px;
}
.panel > .table:last-child > tbody:last-child > tr:last-child td:first-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child td:first-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child td:first-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child td:first-child,
.panel > .table:last-child > tbody:last-child > tr:last-child th:first-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child th:first-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child th:first-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child th:first-child {
  border-bottom-left-radius: 1px;
}
.panel > .table:last-child > tbody:last-child > tr:last-child td:last-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child td:last-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child td:last-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child td:last-child,
.panel > .table:last-child > tbody:last-child > tr:last-child th:last-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child th:last-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child th:last-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child th:last-child {
  border-bottom-right-radius: 1px;
}
.panel > .panel-body + .table,
.panel > .panel-body + .table-responsive,
.panel > .table + .panel-body,
.panel > .table-responsive + .panel-body {
  border-top: 1px solid #ddd;
}
.panel > .table > tbody:first-child > tr:first-child th,
.panel > .table > tbody:first-child > tr:first-child td {
  border-top: 0;
}
.panel > .table-bordered,
.panel > .table-responsive > .table-bordered {
  border: 0;
}
.panel > .table-bordered > thead > tr > th:first-child,
.panel > .table-responsive > .table-bordered > thead > tr > th:first-child,
.panel > .table-bordered > tbody > tr > th:first-child,
.panel > .table-responsive > .table-bordered > tbody > tr > th:first-child,
.panel > .table-bordered > tfoot > tr > th:first-child,
.panel > .table-responsive > .table-bordered > tfoot > tr > th:first-child,
.panel > .table-bordered > thead > tr > td:first-child,
.panel > .table-responsive > .table-bordered > thead > tr > td:first-child,
.panel > .table-bordered > tbody > tr > td:first-child,
.panel > .table-responsive > .table-bordered > tbody > tr > td:first-child,
.panel > .table-bordered > tfoot > tr > td:first-child,
.panel > .table-responsive > .table-bordered > tfoot > tr > td:first-child {
  border-left: 0;
}
.panel > .table-bordered > thead > tr > th:last-child,
.panel > .table-responsive > .table-bordered > thead > tr > th:last-child,
.panel > .table-bordered > tbody > tr > th:last-child,
.panel > .table-responsive > .table-bordered > tbody > tr > th:last-child,
.panel > .table-bordered > tfoot > tr > th:last-child,
.panel > .table-responsive > .table-bordered > tfoot > tr > th:last-child,
.panel > .table-bordered > thead > tr > td:last-child,
.panel > .table-responsive > .table-bordered > thead > tr > td:last-child,
.panel > .table-bordered > tbody > tr > td:last-child,
.panel > .table-responsive > .table-bordered > tbody > tr > td:last-child,
.panel > .table-bordered > tfoot > tr > td:last-child,
.panel > .table-responsive > .table-bordered > tfoot > tr > td:last-child {
  border-right: 0;
}
.panel > .table-bordered > thead > tr:first-child > td,
.panel > .table-responsive > .table-bordered > thead > tr:first-child > td,
.panel > .table-bordered > tbody > tr:first-child > td,
.panel > .table-responsive > .table-bordered > tbody > tr:first-child > td,
.panel > .table-bordered > thead > tr:first-child > th,
.panel > .table-responsive > .table-bordered > thead > tr:first-child > th,
.panel > .table-bordered > tbody > tr:first-child > th,
.panel > .table-responsive > .table-bordered > tbody > tr:first-child > th {
  border-bottom: 0;
}
.panel > .table-bordered > tbody > tr:last-child > td,
.panel > .table-responsive > .table-bordered > tbody > tr:last-child > td,
.panel > .table-bordered > tfoot > tr:last-child > td,
.panel > .table-responsive > .table-bordered > tfoot > tr:last-child > td,
.panel > .table-bordered > tbody > tr:last-child > th,
.panel > .table-responsive > .table-bordered > tbody > tr:last-child > th,
.panel > .table-bordered > tfoot > tr:last-child > th,
.panel > .table-responsive > .table-bordered > tfoot > tr:last-child > th {
  border-bottom: 0;
}
.panel > .table-responsive {
  border: 0;
  margin-bottom: 0;
}
.panel-group {
  margin-bottom: 18px;
}
.panel-group .panel {
  margin-bottom: 0;
  border-radius: 2px;
}
.panel-group .panel + .panel {
  margin-top: 5px;
}
.panel-group .panel-heading {
  border-bottom: 0;
}
.panel-group .panel-heading + .panel-collapse > .panel-body,
.panel-group .panel-heading + .panel-collapse > .list-group {
  border-top: 1px solid #ddd;
}
.panel-group .panel-footer {
  border-top: 0;
}
.panel-group .panel-footer + .panel-collapse .panel-body {
  border-bottom: 1px solid #ddd;
}
.panel-default {
  border-color: #ddd;
}
.panel-default > .panel-heading {
  color: #333333;
  background-color: #f5f5f5;
  border-color: #ddd;
}
.panel-default > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #ddd;
}
.panel-default > .panel-heading .badge {
  color: #f5f5f5;
  background-color: #333333;
}
.panel-default > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #ddd;
}
.panel-primary {
  border-color: #337ab7;
}
.panel-primary > .panel-heading {
  color: #fff;
  background-color: #337ab7;
  border-color: #337ab7;
}
.panel-primary > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #337ab7;
}
.panel-primary > .panel-heading .badge {
  color: #337ab7;
  background-color: #fff;
}
.panel-primary > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #337ab7;
}
.panel-success {
  border-color: #d6e9c6;
}
.panel-success > .panel-heading {
  color: #3c763d;
  background-color: #dff0d8;
  border-color: #d6e9c6;
}
.panel-success > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #d6e9c6;
}
.panel-success > .panel-heading .badge {
  color: #dff0d8;
  background-color: #3c763d;
}
.panel-success > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #d6e9c6;
}
.panel-info {
  border-color: #bce8f1;
}
.panel-info > .panel-heading {
  color: #31708f;
  background-color: #d9edf7;
  border-color: #bce8f1;
}
.panel-info > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #bce8f1;
}
.panel-info > .panel-heading .badge {
  color: #d9edf7;
  background-color: #31708f;
}
.panel-info > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #bce8f1;
}
.panel-warning {
  border-color: #faebcc;
}
.panel-warning > .panel-heading {
  color: #8a6d3b;
  background-color: #fcf8e3;
  border-color: #faebcc;
}
.panel-warning > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #faebcc;
}
.panel-warning > .panel-heading .badge {
  color: #fcf8e3;
  background-color: #8a6d3b;
}
.panel-warning > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #faebcc;
}
.panel-danger {
  border-color: #ebccd1;
}
.panel-danger > .panel-heading {
  color: #a94442;
  background-color: #f2dede;
  border-color: #ebccd1;
}
.panel-danger > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #ebccd1;
}
.panel-danger > .panel-heading .badge {
  color: #f2dede;
  background-color: #a94442;
}
.panel-danger > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #ebccd1;
}
.embed-responsive {
  position: relative;
  display: block;
  height: 0;
  padding: 0;
  overflow: hidden;
}
.embed-responsive .embed-responsive-item,
.embed-responsive iframe,
.embed-responsive embed,
.embed-responsive object,
.embed-responsive video {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  height: 100%;
  width: 100%;
  border: 0;
}
.embed-responsive-16by9 {
  padding-bottom: 56.25%;
}
.embed-responsive-4by3 {
  padding-bottom: 75%;
}
.well {
  min-height: 20px;
  padding: 19px;
  margin-bottom: 20px;
  background-color: #f5f5f5;
  border: 1px solid #e3e3e3;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
}
.well blockquote {
  border-color: #ddd;
  border-color: rgba(0, 0, 0, 0.15);
}
.well-lg {
  padding: 24px;
  border-radius: 3px;
}
.well-sm {
  padding: 9px;
  border-radius: 1px;
}
.close {
  float: right;
  font-size: 19.5px;
  font-weight: bold;
  line-height: 1;
  color: #000;
  text-shadow: 0 1px 0 #fff;
  opacity: 0.2;
  filter: alpha(opacity=20);
}
.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
  opacity: 0.5;
  filter: alpha(opacity=50);
}
button.close {
  padding: 0;
  cursor: pointer;
  background: transparent;
  border: 0;
  -webkit-appearance: none;
}
.modal-open {
  overflow: hidden;
}
.modal {
  display: none;
  overflow: hidden;
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 1050;
  -webkit-overflow-scrolling: touch;
  outline: 0;
}
.modal.fade .modal-dialog {
  -webkit-transform: translate(0, -25%);
  -ms-transform: translate(0, -25%);
  -o-transform: translate(0, -25%);
  transform: translate(0, -25%);
  -webkit-transition: -webkit-transform 0.3s ease-out;
  -moz-transition: -moz-transform 0.3s ease-out;
  -o-transition: -o-transform 0.3s ease-out;
  transition: transform 0.3s ease-out;
}
.modal.in .modal-dialog {
  -webkit-transform: translate(0, 0);
  -ms-transform: translate(0, 0);
  -o-transform: translate(0, 0);
  transform: translate(0, 0);
}
.modal-open .modal {
  overflow-x: hidden;
  overflow-y: auto;
}
.modal-dialog {
  position: relative;
  width: auto;
  margin: 10px;
}
.modal-content {
  position: relative;
  background-color: #fff;
  border: 1px solid #999;
  border: 1px solid rgba(0, 0, 0, 0.2);
  border-radius: 3px;
  -webkit-box-shadow: 0 3px 9px rgba(0, 0, 0, 0.5);
  box-shadow: 0 3px 9px rgba(0, 0, 0, 0.5);
  background-clip: padding-box;
  outline: 0;
}
.modal-backdrop {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 1040;
  background-color: #000;
}
.modal-backdrop.fade {
  opacity: 0;
  filter: alpha(opacity=0);
}
.modal-backdrop.in {
  opacity: 0.5;
  filter: alpha(opacity=50);
}
.modal-header {
  padding: 15px;
  border-bottom: 1px solid #e5e5e5;
}
.modal-header .close {
  margin-top: -2px;
}
.modal-title {
  margin: 0;
  line-height: 1.42857143;
}
.modal-body {
  position: relative;
  padding: 15px;
}
.modal-footer {
  padding: 15px;
  text-align: right;
  border-top: 1px solid #e5e5e5;
}
.modal-footer .btn + .btn {
  margin-left: 5px;
  margin-bottom: 0;
}
.modal-footer .btn-group .btn + .btn {
  margin-left: -1px;
}
.modal-footer .btn-block + .btn-block {
  margin-left: 0;
}
.modal-scrollbar-measure {
  position: absolute;
  top: -9999px;
  width: 50px;
  height: 50px;
  overflow: scroll;
}
@media (min-width: 768px) {
  .modal-dialog {
    width: 600px;
    margin: 30px auto;
  }
  .modal-content {
    -webkit-box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  }
  .modal-sm {
    width: 300px;
  }
}
@media (min-width: 992px) {
  .modal-lg {
    width: 900px;
  }
}
.tooltip {
  position: absolute;
  z-index: 1070;
  display: block;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-style: normal;
  font-weight: normal;
  letter-spacing: normal;
  line-break: auto;
  line-height: 1.42857143;
  text-align: left;
  text-align: start;
  text-decoration: none;
  text-shadow: none;
  text-transform: none;
  white-space: normal;
  word-break: normal;
  word-spacing: normal;
  word-wrap: normal;
  font-size: 12px;
  opacity: 0;
  filter: alpha(opacity=0);
}
.tooltip.in {
  opacity: 0.9;
  filter: alpha(opacity=90);
}
.tooltip.top {
  margin-top: -3px;
  padding: 5px 0;
}
.tooltip.right {
  margin-left: 3px;
  padding: 0 5px;
}
.tooltip.bottom {
  margin-top: 3px;
  padding: 5px 0;
}
.tooltip.left {
  margin-left: -3px;
  padding: 0 5px;
}
.tooltip-inner {
  max-width: 200px;
  padding: 3px 8px;
  color: #fff;
  text-align: center;
  background-color: #000;
  border-radius: 2px;
}
.tooltip-arrow {
  position: absolute;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
}
.tooltip.top .tooltip-arrow {
  bottom: 0;
  left: 50%;
  margin-left: -5px;
  border-width: 5px 5px 0;
  border-top-color: #000;
}
.tooltip.top-left .tooltip-arrow {
  bottom: 0;
  right: 5px;
  margin-bottom: -5px;
  border-width: 5px 5px 0;
  border-top-color: #000;
}
.tooltip.top-right .tooltip-arrow {
  bottom: 0;
  left: 5px;
  margin-bottom: -5px;
  border-width: 5px 5px 0;
  border-top-color: #000;
}
.tooltip.right .tooltip-arrow {
  top: 50%;
  left: 0;
  margin-top: -5px;
  border-width: 5px 5px 5px 0;
  border-right-color: #000;
}
.tooltip.left .tooltip-arrow {
  top: 50%;
  right: 0;
  margin-top: -5px;
  border-width: 5px 0 5px 5px;
  border-left-color: #000;
}
.tooltip.bottom .tooltip-arrow {
  top: 0;
  left: 50%;
  margin-left: -5px;
  border-width: 0 5px 5px;
  border-bottom-color: #000;
}
.tooltip.bottom-left .tooltip-arrow {
  top: 0;
  right: 5px;
  margin-top: -5px;
  border-width: 0 5px 5px;
  border-bottom-color: #000;
}
.tooltip.bottom-right .tooltip-arrow {
  top: 0;
  left: 5px;
  margin-top: -5px;
  border-width: 0 5px 5px;
  border-bottom-color: #000;
}
.popover {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1060;
  display: none;
  max-width: 276px;
  padding: 1px;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-style: normal;
  font-weight: normal;
  letter-spacing: normal;
  line-break: auto;
  line-height: 1.42857143;
  text-align: left;
  text-align: start;
  text-decoration: none;
  text-shadow: none;
  text-transform: none;
  white-space: normal;
  word-break: normal;
  word-spacing: normal;
  word-wrap: normal;
  font-size: 13px;
  background-color: #fff;
  background-clip: padding-box;
  border: 1px solid #ccc;
  border: 1px solid rgba(0, 0, 0, 0.2);
  border-radius: 3px;
  -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
}
.popover.top {
  margin-top: -10px;
}
.popover.right {
  margin-left: 10px;
}
.popover.bottom {
  margin-top: 10px;
}
.popover.left {
  margin-left: -10px;
}
.popover-title {
  margin: 0;
  padding: 8px 14px;
  font-size: 13px;
  background-color: #f7f7f7;
  border-bottom: 1px solid #ebebeb;
  border-radius: 2px 2px 0 0;
}
.popover-content {
  padding: 9px 14px;
}
.popover > .arrow,
.popover > .arrow:after {
  position: absolute;
  display: block;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
}
.popover > .arrow {
  border-width: 11px;
}
.popover > .arrow:after {
  border-width: 10px;
  content: "";
}
.popover.top > .arrow {
  left: 50%;
  margin-left: -11px;
  border-bottom-width: 0;
  border-top-color: #999999;
  border-top-color: rgba(0, 0, 0, 0.25);
  bottom: -11px;
}
.popover.top > .arrow:after {
  content: " ";
  bottom: 1px;
  margin-left: -10px;
  border-bottom-width: 0;
  border-top-color: #fff;
}
.popover.right > .arrow {
  top: 50%;
  left: -11px;
  margin-top: -11px;
  border-left-width: 0;
  border-right-color: #999999;
  border-right-color: rgba(0, 0, 0, 0.25);
}
.popover.right > .arrow:after {
  content: " ";
  left: 1px;
  bottom: -10px;
  border-left-width: 0;
  border-right-color: #fff;
}
.popover.bottom > .arrow {
  left: 50%;
  margin-left: -11px;
  border-top-width: 0;
  border-bottom-color: #999999;
  border-bottom-color: rgba(0, 0, 0, 0.25);
  top: -11px;
}
.popover.bottom > .arrow:after {
  content: " ";
  top: 1px;
  margin-left: -10px;
  border-top-width: 0;
  border-bottom-color: #fff;
}
.popover.left > .arrow {
  top: 50%;
  right: -11px;
  margin-top: -11px;
  border-right-width: 0;
  border-left-color: #999999;
  border-left-color: rgba(0, 0, 0, 0.25);
}
.popover.left > .arrow:after {
  content: " ";
  right: 1px;
  border-right-width: 0;
  border-left-color: #fff;
  bottom: -10px;
}
.carousel {
  position: relative;
}
.carousel-inner {
  position: relative;
  overflow: hidden;
  width: 100%;
}
.carousel-inner > .item {
  display: none;
  position: relative;
  -webkit-transition: 0.6s ease-in-out left;
  -o-transition: 0.6s ease-in-out left;
  transition: 0.6s ease-in-out left;
}
.carousel-inner > .item > img,
.carousel-inner > .item > a > img {
  line-height: 1;
}
@media all and (transform-3d), (-webkit-transform-3d) {
  .carousel-inner > .item {
    -webkit-transition: -webkit-transform 0.6s ease-in-out;
    -moz-transition: -moz-transform 0.6s ease-in-out;
    -o-transition: -o-transform 0.6s ease-in-out;
    transition: transform 0.6s ease-in-out;
    -webkit-backface-visibility: hidden;
    -moz-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-perspective: 1000px;
    -moz-perspective: 1000px;
    perspective: 1000px;
  }
  .carousel-inner > .item.next,
  .carousel-inner > .item.active.right {
    -webkit-transform: translate3d(100%, 0, 0);
    transform: translate3d(100%, 0, 0);
    left: 0;
  }
  .carousel-inner > .item.prev,
  .carousel-inner > .item.active.left {
    -webkit-transform: translate3d(-100%, 0, 0);
    transform: translate3d(-100%, 0, 0);
    left: 0;
  }
  .carousel-inner > .item.next.left,
  .carousel-inner > .item.prev.right,
  .carousel-inner > .item.active {
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
    left: 0;
  }
}
.carousel-inner > .active,
.carousel-inner > .next,
.carousel-inner > .prev {
  display: block;
}
.carousel-inner > .active {
  left: 0;
}
.carousel-inner > .next,
.carousel-inner > .prev {
  position: absolute;
  top: 0;
  width: 100%;
}
.carousel-inner > .next {
  left: 100%;
}
.carousel-inner > .prev {
  left: -100%;
}
.carousel-inner > .next.left,
.carousel-inner > .prev.right {
  left: 0;
}
.carousel-inner > .active.left {
  left: -100%;
}
.carousel-inner > .active.right {
  left: 100%;
}
.carousel-control {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  width: 15%;
  opacity: 0.5;
  filter: alpha(opacity=50);
  font-size: 20px;
  color: #fff;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
  background-color: rgba(0, 0, 0, 0);
}
.carousel-control.left {
  background-image: -webkit-linear-gradient(left, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.0001) 100%);
  background-image: -o-linear-gradient(left, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.0001) 100%);
  background-image: linear-gradient(to right, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.0001) 100%);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#80000000', endColorstr='#00000000', GradientType=1);
}
.carousel-control.right {
  left: auto;
  right: 0;
  background-image: -webkit-linear-gradient(left, rgba(0, 0, 0, 0.0001) 0%, rgba(0, 0, 0, 0.5) 100%);
  background-image: -o-linear-gradient(left, rgba(0, 0, 0, 0.0001) 0%, rgba(0, 0, 0, 0.5) 100%);
  background-image: linear-gradient(to right, rgba(0, 0, 0, 0.0001) 0%, rgba(0, 0, 0, 0.5) 100%);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00000000', endColorstr='#80000000', GradientType=1);
}
.carousel-control:hover,
.carousel-control:focus {
  outline: 0;
  color: #fff;
  text-decoration: none;
  opacity: 0.9;
  filter: alpha(opacity=90);
}
.carousel-control .icon-prev,
.carousel-control .icon-next,
.carousel-control .glyphicon-chevron-left,
.carousel-control .glyphicon-chevron-right {
  position: absolute;
  top: 50%;
  margin-top: -10px;
  z-index: 5;
  display: inline-block;
}
.carousel-control .icon-prev,
.carousel-control .glyphicon-chevron-left {
  left: 50%;
  margin-left: -10px;
}
.carousel-control .icon-next,
.carousel-control .glyphicon-chevron-right {
  right: 50%;
  margin-right: -10px;
}
.carousel-control .icon-prev,
.carousel-control .icon-next {
  width: 20px;
  height: 20px;
  line-height: 1;
  font-family: serif;
}
.carousel-control .icon-prev:before {
  content: '\2039';
}
.carousel-control .icon-next:before {
  content: '\203a';
}
.carousel-indicators {
  position: absolute;
  bottom: 10px;
  left: 50%;
  z-index: 15;
  width: 60%;
  margin-left: -30%;
  padding-left: 0;
  list-style: none;
  text-align: center;
}
.carousel-indicators li {
  display: inline-block;
  width: 10px;
  height: 10px;
  margin: 1px;
  text-indent: -999px;
  border: 1px solid #fff;
  border-radius: 10px;
  cursor: pointer;
  background-color: #000 \9;
  background-color: rgba(0, 0, 0, 0);
}
.carousel-indicators .active {
  margin: 0;
  width: 12px;
  height: 12px;
  background-color: #fff;
}
.carousel-caption {
  position: absolute;
  left: 15%;
  right: 15%;
  bottom: 20px;
  z-index: 10;
  padding-top: 20px;
  padding-bottom: 20px;
  color: #fff;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
}
.carousel-caption .btn {
  text-shadow: none;
}
@media screen and (min-width: 768px) {
  .carousel-control .glyphicon-chevron-left,
  .carousel-control .glyphicon-chevron-right,
  .carousel-control .icon-prev,
  .carousel-control .icon-next {
    width: 30px;
    height: 30px;
    margin-top: -10px;
    font-size: 30px;
  }
  .carousel-control .glyphicon-chevron-left,
  .carousel-control .icon-prev {
    margin-left: -10px;
  }
  .carousel-control .glyphicon-chevron-right,
  .carousel-control .icon-next {
    margin-right: -10px;
  }
  .carousel-caption {
    left: 20%;
    right: 20%;
    padding-bottom: 30px;
  }
  .carousel-indicators {
    bottom: 20px;
  }
}
.clearfix:before,
.clearfix:after,
.dl-horizontal dd:before,
.dl-horizontal dd:after,
.container:before,
.container:after,
.container-fluid:before,
.container-fluid:after,
.row:before,
.row:after,
.form-horizontal .form-group:before,
.form-horizontal .form-group:after,
.btn-toolbar:before,
.btn-toolbar:after,
.btn-group-vertical > .btn-group:before,
.btn-group-vertical > .btn-group:after,
.nav:before,
.nav:after,
.navbar:before,
.navbar:after,
.navbar-header:before,
.navbar-header:after,
.navbar-collapse:before,
.navbar-collapse:after,
.pager:before,
.pager:after,
.panel-body:before,
.panel-body:after,
.modal-header:before,
.modal-header:after,
.modal-footer:before,
.modal-footer:after,
.item_buttons:before,
.item_buttons:after {
  content: " ";
  display: table;
}
.clearfix:after,
.dl-horizontal dd:after,
.container:after,
.container-fluid:after,
.row:after,
.form-horizontal .form-group:after,
.btn-toolbar:after,
.btn-group-vertical > .btn-group:after,
.nav:after,
.navbar:after,
.navbar-header:after,
.navbar-collapse:after,
.pager:after,
.panel-body:after,
.modal-header:after,
.modal-footer:after,
.item_buttons:after {
  clear: both;
}
.center-block {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
.pull-right {
  float: right !important;
}
.pull-left {
  float: left !important;
}
.hide {
  display: none !important;
}
.show {
  display: block !important;
}
.invisible {
  visibility: hidden;
}
.text-hide {
  font: 0/0 a;
  color: transparent;
  text-shadow: none;
  background-color: transparent;
  border: 0;
}
.hidden {
  display: none !important;
}
.affix {
  position: fixed;
}
@-ms-viewport {
  width: device-width;
}
.visible-xs,
.visible-sm,
.visible-md,
.visible-lg {
  display: none !important;
}
.visible-xs-block,
.visible-xs-inline,
.visible-xs-inline-block,
.visible-sm-block,
.visible-sm-inline,
.visible-sm-inline-block,
.visible-md-block,
.visible-md-inline,
.visible-md-inline-block,
.visible-lg-block,
.visible-lg-inline,
.visible-lg-inline-block {
  display: none !important;
}
@media (max-width: 767px) {
  .visible-xs {
    display: block !important;
  }
  table.visible-xs {
    display: table !important;
  }
  tr.visible-xs {
    display: table-row !important;
  }
  th.visible-xs,
  td.visible-xs {
    display: table-cell !important;
  }
}
@media (max-width: 767px) {
  .visible-xs-block {
    display: block !important;
  }
}
@media (max-width: 767px) {
  .visible-xs-inline {
    display: inline !important;
  }
}
@media (max-width: 767px) {
  .visible-xs-inline-block {
    display: inline-block !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .visible-sm {
    display: block !important;
  }
  table.visible-sm {
    display: table !important;
  }
  tr.visible-sm {
    display: table-row !important;
  }
  th.visible-sm,
  td.visible-sm {
    display: table-cell !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .visible-sm-block {
    display: block !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .visible-sm-inline {
    display: inline !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .visible-sm-inline-block {
    display: inline-block !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .visible-md {
    display: block !important;
  }
  table.visible-md {
    display: table !important;
  }
  tr.visible-md {
    display: table-row !important;
  }
  th.visible-md,
  td.visible-md {
    display: table-cell !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .visible-md-block {
    display: block !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .visible-md-inline {
    display: inline !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .visible-md-inline-block {
    display: inline-block !important;
  }
}
@media (min-width: 1200px) {
  .visible-lg {
    display: block !important;
  }
  table.visible-lg {
    display: table !important;
  }
  tr.visible-lg {
    display: table-row !important;
  }
  th.visible-lg,
  td.visible-lg {
    display: table-cell !important;
  }
}
@media (min-width: 1200px) {
  .visible-lg-block {
    display: block !important;
  }
}
@media (min-width: 1200px) {
  .visible-lg-inline {
    display: inline !important;
  }
}
@media (min-width: 1200px) {
  .visible-lg-inline-block {
    display: inline-block !important;
  }
}
@media (max-width: 767px) {
  .hidden-xs {
    display: none !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .hidden-sm {
    display: none !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .hidden-md {
    display: none !important;
  }
}
@media (min-width: 1200px) {
  .hidden-lg {
    display: none !important;
  }
}
.visible-print {
  display: none !important;
}
@media print {
  .visible-print {
    display: block !important;
  }
  table.visible-print {
    display: table !important;
  }
  tr.visible-print {
    display: table-row !important;
  }
  th.visible-print,
  td.visible-print {
    display: table-cell !important;
  }
}
.visible-print-block {
  display: none !important;
}
@media print {
  .visible-print-block {
    display: block !important;
  }
}
.visible-print-inline {
  display: none !important;
}
@media print {
  .visible-print-inline {
    display: inline !important;
  }
}
.visible-print-inline-block {
  display: none !important;
}
@media print {
  .visible-print-inline-block {
    display: inline-block !important;
  }
}
@media print {
  .hidden-print {
    display: none !important;
  }
}
/*!
*
* Font Awesome
*
*/
/*!
 *  Font Awesome 4.7.0 by @davegandy - http://fontawesome.io - @fontawesome
 *  License - http://fontawesome.io/license (Font: SIL OFL 1.1, CSS: MIT License)
 */
/* FONT PATH
 * -------------------------- */
@font-face {
  font-family: 'FontAwesome';
  src: url('../components/font-awesome/fonts/fontawesome-webfont.eot?v=4.7.0');
  src: url('../components/font-awesome/fonts/fontawesome-webfont.eot?#iefix&v=4.7.0') format('embedded-opentype'), url('../components/font-awesome/fonts/fontawesome-webfont.woff2?v=4.7.0') format('woff2'), url('../components/font-awesome/fonts/fontawesome-webfont.woff?v=4.7.0') format('woff'), url('../components/font-awesome/fonts/fontawesome-webfont.ttf?v=4.7.0') format('truetype'), url('../components/font-awesome/fonts/fontawesome-webfont.svg?v=4.7.0#fontawesomeregular') format('svg');
  font-weight: normal;
  font-style: normal;
}
.fa {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
/* makes the font 33% larger relative to the icon container */
.fa-lg {
  font-size: 1.33333333em;
  line-height: 0.75em;
  vertical-align: -15%;
}
.fa-2x {
  font-size: 2em;
}
.fa-3x {
  font-size: 3em;
}
.fa-4x {
  font-size: 4em;
}
.fa-5x {
  font-size: 5em;
}
.fa-fw {
  width: 1.28571429em;
  text-align: center;
}
.fa-ul {
  padding-left: 0;
  margin-left: 2.14285714em;
  list-style-type: none;
}
.fa-ul > li {
  position: relative;
}
.fa-li {
  position: absolute;
  left: -2.14285714em;
  width: 2.14285714em;
  top: 0.14285714em;
  text-align: center;
}
.fa-li.fa-lg {
  left: -1.85714286em;
}
.fa-border {
  padding: .2em .25em .15em;
  border: solid 0.08em #eee;
  border-radius: .1em;
}
.fa-pull-left {
  float: left;
}
.fa-pull-right {
  float: right;
}
.fa.fa-pull-left {
  margin-right: .3em;
}
.fa.fa-pull-right {
  margin-left: .3em;
}
/* Deprecated as of 4.4.0 */
.pull-right {
  float: right;
}
.pull-left {
  float: left;
}
.fa.pull-left {
  margin-right: .3em;
}
.fa.pull-right {
  margin-left: .3em;
}
.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
  animation: fa-spin 2s infinite linear;
}
.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
  animation: fa-spin 1s infinite steps(8);
}
@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg);
  }
}
@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg);
  }
}
.fa-rotate-90 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";
  -webkit-transform: rotate(90deg);
  -ms-transform: rotate(90deg);
  transform: rotate(90deg);
}
.fa-rotate-180 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";
  -webkit-transform: rotate(180deg);
  -ms-transform: rotate(180deg);
  transform: rotate(180deg);
}
.fa-rotate-270 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";
  -webkit-transform: rotate(270deg);
  -ms-transform: rotate(270deg);
  transform: rotate(270deg);
}
.fa-flip-horizontal {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";
  -webkit-transform: scale(-1, 1);
  -ms-transform: scale(-1, 1);
  transform: scale(-1, 1);
}
.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(1, -1);
  -ms-transform: scale(1, -1);
  transform: scale(1, -1);
}
:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical {
  filter: none;
}
.fa-stack {
  position: relative;
  display: inline-block;
  width: 2em;
  height: 2em;
  line-height: 2em;
  vertical-align: middle;
}
.fa-stack-1x,
.fa-stack-2x {
  position: absolute;
  left: 0;
  width: 100%;
  text-align: center;
}
.fa-stack-1x {
  line-height: inherit;
}
.fa-stack-2x {
  font-size: 2em;
}
.fa-inverse {
  color: #fff;
}
/* Font Awesome uses the Unicode Private Use Area (PUA) to ensure screen
   readers do not read off random characters that represent icons */
.fa-glass:before {
  content: "\f000";
}
.fa-music:before {
  content: "\f001";
}
.fa-search:before {
  content: "\f002";
}
.fa-envelope-o:before {
  content: "\f003";
}
.fa-heart:before {
  content: "\f004";
}
.fa-star:before {
  content: "\f005";
}
.fa-star-o:before {
  content: "\f006";
}
.fa-user:before {
  content: "\f007";
}
.fa-film:before {
  content: "\f008";
}
.fa-th-large:before {
  content: "\f009";
}
.fa-th:before {
  content: "\f00a";
}
.fa-th-list:before {
  content: "\f00b";
}
.fa-check:before {
  content: "\f00c";
}
.fa-remove:before,
.fa-close:before,
.fa-times:before {
  content: "\f00d";
}
.fa-search-plus:before {
  content: "\f00e";
}
.fa-search-minus:before {
  content: "\f010";
}
.fa-power-off:before {
  content: "\f011";
}
.fa-signal:before {
  content: "\f012";
}
.fa-gear:before,
.fa-cog:before {
  content: "\f013";
}
.fa-trash-o:before {
  content: "\f014";
}
.fa-home:before {
  content: "\f015";
}
.fa-file-o:before {
  content: "\f016";
}
.fa-clock-o:before {
  content: "\f017";
}
.fa-road:before {
  content: "\f018";
}
.fa-download:before {
  content: "\f019";
}
.fa-arrow-circle-o-down:before {
  content: "\f01a";
}
.fa-arrow-circle-o-up:before {
  content: "\f01b";
}
.fa-inbox:before {
  content: "\f01c";
}
.fa-play-circle-o:before {
  content: "\f01d";
}
.fa-rotate-right:before,
.fa-repeat:before {
  content: "\f01e";
}
.fa-refresh:before {
  content: "\f021";
}
.fa-list-alt:before {
  content: "\f022";
}
.fa-lock:before {
  content: "\f023";
}
.fa-flag:before {
  content: "\f024";
}
.fa-headphones:before {
  content: "\f025";
}
.fa-volume-off:before {
  content: "\f026";
}
.fa-volume-down:before {
  content: "\f027";
}
.fa-volume-up:before {
  content: "\f028";
}
.fa-qrcode:before {
  content: "\f029";
}
.fa-barcode:before {
  content: "\f02a";
}
.fa-tag:before {
  content: "\f02b";
}
.fa-tags:before {
  content: "\f02c";
}
.fa-book:before {
  content: "\f02d";
}
.fa-bookmark:before {
  content: "\f02e";
}
.fa-print:before {
  content: "\f02f";
}
.fa-camera:before {
  content: "\f030";
}
.fa-font:before {
  content: "\f031";
}
.fa-bold:before {
  content: "\f032";
}
.fa-italic:before {
  content: "\f033";
}
.fa-text-height:before {
  content: "\f034";
}
.fa-text-width:before {
  content: "\f035";
}
.fa-align-left:before {
  content: "\f036";
}
.fa-align-center:before {
  content: "\f037";
}
.fa-align-right:before {
  content: "\f038";
}
.fa-align-justify:before {
  content: "\f039";
}
.fa-list:before {
  content: "\f03a";
}
.fa-dedent:before,
.fa-outdent:before {
  content: "\f03b";
}
.fa-indent:before {
  content: "\f03c";
}
.fa-video-camera:before {
  content: "\f03d";
}
.fa-photo:before,
.fa-image:before,
.fa-picture-o:before {
  content: "\f03e";
}
.fa-pencil:before {
  content: "\f040";
}
.fa-map-marker:before {
  content: "\f041";
}
.fa-adjust:before {
  content: "\f042";
}
.fa-tint:before {
  content: "\f043";
}
.fa-edit:before,
.fa-pencil-square-o:before {
  content: "\f044";
}
.fa-share-square-o:before {
  content: "\f045";
}
.fa-check-square-o:before {
  content: "\f046";
}
.fa-arrows:before {
  content: "\f047";
}
.fa-step-backward:before {
  content: "\f048";
}
.fa-fast-backward:before {
  content: "\f049";
}
.fa-backward:before {
  content: "\f04a";
}
.fa-play:before {
  content: "\f04b";
}
.fa-pause:before {
  content: "\f04c";
}
.fa-stop:before {
  content: "\f04d";
}
.fa-forward:before {
  content: "\f04e";
}
.fa-fast-forward:before {
  content: "\f050";
}
.fa-step-forward:before {
  content: "\f051";
}
.fa-eject:before {
  content: "\f052";
}
.fa-chevron-left:before {
  content: "\f053";
}
.fa-chevron-right:before {
  content: "\f054";
}
.fa-plus-circle:before {
  content: "\f055";
}
.fa-minus-circle:before {
  content: "\f056";
}
.fa-times-circle:before {
  content: "\f057";
}
.fa-check-circle:before {
  content: "\f058";
}
.fa-question-circle:before {
  content: "\f059";
}
.fa-info-circle:before {
  content: "\f05a";
}
.fa-crosshairs:before {
  content: "\f05b";
}
.fa-times-circle-o:before {
  content: "\f05c";
}
.fa-check-circle-o:before {
  content: "\f05d";
}
.fa-ban:before {
  content: "\f05e";
}
.fa-arrow-left:before {
  content: "\f060";
}
.fa-arrow-right:before {
  content: "\f061";
}
.fa-arrow-up:before {
  content: "\f062";
}
.fa-arrow-down:before {
  content: "\f063";
}
.fa-mail-forward:before,
.fa-share:before {
  content: "\f064";
}
.fa-expand:before {
  content: "\f065";
}
.fa-compress:before {
  content: "\f066";
}
.fa-plus:before {
  content: "\f067";
}
.fa-minus:before {
  content: "\f068";
}
.fa-asterisk:before {
  content: "\f069";
}
.fa-exclamation-circle:before {
  content: "\f06a";
}
.fa-gift:before {
  content: "\f06b";
}
.fa-leaf:before {
  content: "\f06c";
}
.fa-fire:before {
  content: "\f06d";
}
.fa-eye:before {
  content: "\f06e";
}
.fa-eye-slash:before {
  content: "\f070";
}
.fa-warning:before,
.fa-exclamation-triangle:before {
  content: "\f071";
}
.fa-plane:before {
  content: "\f072";
}
.fa-calendar:before {
  content: "\f073";
}
.fa-random:before {
  content: "\f074";
}
.fa-comment:before {
  content: "\f075";
}
.fa-magnet:before {
  content: "\f076";
}
.fa-chevron-up:before {
  content: "\f077";
}
.fa-chevron-down:before {
  content: "\f078";
}
.fa-retweet:before {
  content: "\f079";
}
.fa-shopping-cart:before {
  content: "\f07a";
}
.fa-folder:before {
  content: "\f07b";
}
.fa-folder-open:before {
  content: "\f07c";
}
.fa-arrows-v:before {
  content: "\f07d";
}
.fa-arrows-h:before {
  content: "\f07e";
}
.fa-bar-chart-o:before,
.fa-bar-chart:before {
  content: "\f080";
}
.fa-twitter-square:before {
  content: "\f081";
}
.fa-facebook-square:before {
  content: "\f082";
}
.fa-camera-retro:before {
  content: "\f083";
}
.fa-key:before {
  content: "\f084";
}
.fa-gears:before,
.fa-cogs:before {
  content: "\f085";
}
.fa-comments:before {
  content: "\f086";
}
.fa-thumbs-o-up:before {
  content: "\f087";
}
.fa-thumbs-o-down:before {
  content: "\f088";
}
.fa-star-half:before {
  content: "\f089";
}
.fa-heart-o:before {
  content: "\f08a";
}
.fa-sign-out:before {
  content: "\f08b";
}
.fa-linkedin-square:before {
  content: "\f08c";
}
.fa-thumb-tack:before {
  content: "\f08d";
}
.fa-external-link:before {
  content: "\f08e";
}
.fa-sign-in:before {
  content: "\f090";
}
.fa-trophy:before {
  content: "\f091";
}
.fa-github-square:before {
  content: "\f092";
}
.fa-upload:before {
  content: "\f093";
}
.fa-lemon-o:before {
  content: "\f094";
}
.fa-phone:before {
  content: "\f095";
}
.fa-square-o:before {
  content: "\f096";
}
.fa-bookmark-o:before {
  content: "\f097";
}
.fa-phone-square:before {
  content: "\f098";
}
.fa-twitter:before {
  content: "\f099";
}
.fa-facebook-f:before,
.fa-facebook:before {
  content: "\f09a";
}
.fa-github:before {
  content: "\f09b";
}
.fa-unlock:before {
  content: "\f09c";
}
.fa-credit-card:before {
  content: "\f09d";
}
.fa-feed:before,
.fa-rss:before {
  content: "\f09e";
}
.fa-hdd-o:before {
  content: "\f0a0";
}
.fa-bullhorn:before {
  content: "\f0a1";
}
.fa-bell:before {
  content: "\f0f3";
}
.fa-certificate:before {
  content: "\f0a3";
}
.fa-hand-o-right:before {
  content: "\f0a4";
}
.fa-hand-o-left:before {
  content: "\f0a5";
}
.fa-hand-o-up:before {
  content: "\f0a6";
}
.fa-hand-o-down:before {
  content: "\f0a7";
}
.fa-arrow-circle-left:before {
  content: "\f0a8";
}
.fa-arrow-circle-right:before {
  content: "\f0a9";
}
.fa-arrow-circle-up:before {
  content: "\f0aa";
}
.fa-arrow-circle-down:before {
  content: "\f0ab";
}
.fa-globe:before {
  content: "\f0ac";
}
.fa-wrench:before {
  content: "\f0ad";
}
.fa-tasks:before {
  content: "\f0ae";
}
.fa-filter:before {
  content: "\f0b0";
}
.fa-briefcase:before {
  content: "\f0b1";
}
.fa-arrows-alt:before {
  content: "\f0b2";
}
.fa-group:before,
.fa-users:before {
  content: "\f0c0";
}
.fa-chain:before,
.fa-link:before {
  content: "\f0c1";
}
.fa-cloud:before {
  content: "\f0c2";
}
.fa-flask:before {
  content: "\f0c3";
}
.fa-cut:before,
.fa-scissors:before {
  content: "\f0c4";
}
.fa-copy:before,
.fa-files-o:before {
  content: "\f0c5";
}
.fa-paperclip:before {
  content: "\f0c6";
}
.fa-save:before,
.fa-floppy-o:before {
  content: "\f0c7";
}
.fa-square:before {
  content: "\f0c8";
}
.fa-navicon:before,
.fa-reorder:before,
.fa-bars:before {
  content: "\f0c9";
}
.fa-list-ul:before {
  content: "\f0ca";
}
.fa-list-ol:before {
  content: "\f0cb";
}
.fa-strikethrough:before {
  content: "\f0cc";
}
.fa-underline:before {
  content: "\f0cd";
}
.fa-table:before {
  content: "\f0ce";
}
.fa-magic:before {
  content: "\f0d0";
}
.fa-truck:before {
  content: "\f0d1";
}
.fa-pinterest:before {
  content: "\f0d2";
}
.fa-pinterest-square:before {
  content: "\f0d3";
}
.fa-google-plus-square:before {
  content: "\f0d4";
}
.fa-google-plus:before {
  content: "\f0d5";
}
.fa-money:before {
  content: "\f0d6";
}
.fa-caret-down:before {
  content: "\f0d7";
}
.fa-caret-up:before {
  content: "\f0d8";
}
.fa-caret-left:before {
  content: "\f0d9";
}
.fa-caret-right:before {
  content: "\f0da";
}
.fa-columns:before {
  content: "\f0db";
}
.fa-unsorted:before,
.fa-sort:before {
  content: "\f0dc";
}
.fa-sort-down:before,
.fa-sort-desc:before {
  content: "\f0dd";
}
.fa-sort-up:before,
.fa-sort-asc:before {
  content: "\f0de";
}
.fa-envelope:before {
  content: "\f0e0";
}
.fa-linkedin:before {
  content: "\f0e1";
}
.fa-rotate-left:before,
.fa-undo:before {
  content: "\f0e2";
}
.fa-legal:before,
.fa-gavel:before {
  content: "\f0e3";
}
.fa-dashboard:before,
.fa-tachometer:before {
  content: "\f0e4";
}
.fa-comment-o:before {
  content: "\f0e5";
}
.fa-comments-o:before {
  content: "\f0e6";
}
.fa-flash:before,
.fa-bolt:before {
  content: "\f0e7";
}
.fa-sitemap:before {
  content: "\f0e8";
}
.fa-umbrella:before {
  content: "\f0e9";
}
.fa-paste:before,
.fa-clipboard:before {
  content: "\f0ea";
}
.fa-lightbulb-o:before {
  content: "\f0eb";
}
.fa-exchange:before {
  content: "\f0ec";
}
.fa-cloud-download:before {
  content: "\f0ed";
}
.fa-cloud-upload:before {
  content: "\f0ee";
}
.fa-user-md:before {
  content: "\f0f0";
}
.fa-stethoscope:before {
  content: "\f0f1";
}
.fa-suitcase:before {
  content: "\f0f2";
}
.fa-bell-o:before {
  content: "\f0a2";
}
.fa-coffee:before {
  content: "\f0f4";
}
.fa-cutlery:before {
  content: "\f0f5";
}
.fa-file-text-o:before {
  content: "\f0f6";
}
.fa-building-o:before {
  content: "\f0f7";
}
.fa-hospital-o:before {
  content: "\f0f8";
}
.fa-ambulance:before {
  content: "\f0f9";
}
.fa-medkit:before {
  content: "\f0fa";
}
.fa-fighter-jet:before {
  content: "\f0fb";
}
.fa-beer:before {
  content: "\f0fc";
}
.fa-h-square:before {
  content: "\f0fd";
}
.fa-plus-square:before {
  content: "\f0fe";
}
.fa-angle-double-left:before {
  content: "\f100";
}
.fa-angle-double-right:before {
  content: "\f101";
}
.fa-angle-double-up:before {
  content: "\f102";
}
.fa-angle-double-down:before {
  content: "\f103";
}
.fa-angle-left:before {
  content: "\f104";
}
.fa-angle-right:before {
  content: "\f105";
}
.fa-angle-up:before {
  content: "\f106";
}
.fa-angle-down:before {
  content: "\f107";
}
.fa-desktop:before {
  content: "\f108";
}
.fa-laptop:before {
  content: "\f109";
}
.fa-tablet:before {
  content: "\f10a";
}
.fa-mobile-phone:before,
.fa-mobile:before {
  content: "\f10b";
}
.fa-circle-o:before {
  content: "\f10c";
}
.fa-quote-left:before {
  content: "\f10d";
}
.fa-quote-right:before {
  content: "\f10e";
}
.fa-spinner:before {
  content: "\f110";
}
.fa-circle:before {
  content: "\f111";
}
.fa-mail-reply:before,
.fa-reply:before {
  content: "\f112";
}
.fa-github-alt:before {
  content: "\f113";
}
.fa-folder-o:before {
  content: "\f114";
}
.fa-folder-open-o:before {
  content: "\f115";
}
.fa-smile-o:before {
  content: "\f118";
}
.fa-frown-o:before {
  content: "\f119";
}
.fa-meh-o:before {
  content: "\f11a";
}
.fa-gamepad:before {
  content: "\f11b";
}
.fa-keyboard-o:before {
  content: "\f11c";
}
.fa-flag-o:before {
  content: "\f11d";
}
.fa-flag-checkered:before {
  content: "\f11e";
}
.fa-terminal:before {
  content: "\f120";
}
.fa-code:before {
  content: "\f121";
}
.fa-mail-reply-all:before,
.fa-reply-all:before {
  content: "\f122";
}
.fa-star-half-empty:before,
.fa-star-half-full:before,
.fa-star-half-o:before {
  content: "\f123";
}
.fa-location-arrow:before {
  content: "\f124";
}
.fa-crop:before {
  content: "\f125";
}
.fa-code-fork:before {
  content: "\f126";
}
.fa-unlink:before,
.fa-chain-broken:before {
  content: "\f127";
}
.fa-question:before {
  content: "\f128";
}
.fa-info:before {
  content: "\f129";
}
.fa-exclamation:before {
  content: "\f12a";
}
.fa-superscript:before {
  content: "\f12b";
}
.fa-subscript:before {
  content: "\f12c";
}
.fa-eraser:before {
  content: "\f12d";
}
.fa-puzzle-piece:before {
  content: "\f12e";
}
.fa-microphone:before {
  content: "\f130";
}
.fa-microphone-slash:before {
  content: "\f131";
}
.fa-shield:before {
  content: "\f132";
}
.fa-calendar-o:before {
  content: "\f133";
}
.fa-fire-extinguisher:before {
  content: "\f134";
}
.fa-rocket:before {
  content: "\f135";
}
.fa-maxcdn:before {
  content: "\f136";
}
.fa-chevron-circle-left:before {
  content: "\f137";
}
.fa-chevron-circle-right:before {
  content: "\f138";
}
.fa-chevron-circle-up:before {
  content: "\f139";
}
.fa-chevron-circle-down:before {
  content: "\f13a";
}
.fa-html5:before {
  content: "\f13b";
}
.fa-css3:before {
  content: "\f13c";
}
.fa-anchor:before {
  content: "\f13d";
}
.fa-unlock-alt:before {
  content: "\f13e";
}
.fa-bullseye:before {
  content: "\f140";
}
.fa-ellipsis-h:before {
  content: "\f141";
}
.fa-ellipsis-v:before {
  content: "\f142";
}
.fa-rss-square:before {
  content: "\f143";
}
.fa-play-circle:before {
  content: "\f144";
}
.fa-ticket:before {
  content: "\f145";
}
.fa-minus-square:before {
  content: "\f146";
}
.fa-minus-square-o:before {
  content: "\f147";
}
.fa-level-up:before {
  content: "\f148";
}
.fa-level-down:before {
  content: "\f149";
}
.fa-check-square:before {
  content: "\f14a";
}
.fa-pencil-square:before {
  content: "\f14b";
}
.fa-external-link-square:before {
  content: "\f14c";
}
.fa-share-square:before {
  content: "\f14d";
}
.fa-compass:before {
  content: "\f14e";
}
.fa-toggle-down:before,
.fa-caret-square-o-down:before {
  content: "\f150";
}
.fa-toggle-up:before,
.fa-caret-square-o-up:before {
  content: "\f151";
}
.fa-toggle-right:before,
.fa-caret-square-o-right:before {
  content: "\f152";
}
.fa-euro:before,
.fa-eur:before {
  content: "\f153";
}
.fa-gbp:before {
  content: "\f154";
}
.fa-dollar:before,
.fa-usd:before {
  content: "\f155";
}
.fa-rupee:before,
.fa-inr:before {
  content: "\f156";
}
.fa-cny:before,
.fa-rmb:before,
.fa-yen:before,
.fa-jpy:before {
  content: "\f157";
}
.fa-ruble:before,
.fa-rouble:before,
.fa-rub:before {
  content: "\f158";
}
.fa-won:before,
.fa-krw:before {
  content: "\f159";
}
.fa-bitcoin:before,
.fa-btc:before {
  content: "\f15a";
}
.fa-file:before {
  content: "\f15b";
}
.fa-file-text:before {
  content: "\f15c";
}
.fa-sort-alpha-asc:before {
  content: "\f15d";
}
.fa-sort-alpha-desc:before {
  content: "\f15e";
}
.fa-sort-amount-asc:before {
  content: "\f160";
}
.fa-sort-amount-desc:before {
  content: "\f161";
}
.fa-sort-numeric-asc:before {
  content: "\f162";
}
.fa-sort-numeric-desc:before {
  content: "\f163";
}
.fa-thumbs-up:before {
  content: "\f164";
}
.fa-thumbs-down:before {
  content: "\f165";
}
.fa-youtube-square:before {
  content: "\f166";
}
.fa-youtube:before {
  content: "\f167";
}
.fa-xing:before {
  content: "\f168";
}
.fa-xing-square:before {
  content: "\f169";
}
.fa-youtube-play:before {
  content: "\f16a";
}
.fa-dropbox:before {
  content: "\f16b";
}
.fa-stack-overflow:before {
  content: "\f16c";
}
.fa-instagram:before {
  content: "\f16d";
}
.fa-flickr:before {
  content: "\f16e";
}
.fa-adn:before {
  content: "\f170";
}
.fa-bitbucket:before {
  content: "\f171";
}
.fa-bitbucket-square:before {
  content: "\f172";
}
.fa-tumblr:before {
  content: "\f173";
}
.fa-tumblr-square:before {
  content: "\f174";
}
.fa-long-arrow-down:before {
  content: "\f175";
}
.fa-long-arrow-up:before {
  content: "\f176";
}
.fa-long-arrow-left:before {
  content: "\f177";
}
.fa-long-arrow-right:before {
  content: "\f178";
}
.fa-apple:before {
  content: "\f179";
}
.fa-windows:before {
  content: "\f17a";
}
.fa-android:before {
  content: "\f17b";
}
.fa-linux:before {
  content: "\f17c";
}
.fa-dribbble:before {
  content: "\f17d";
}
.fa-skype:before {
  content: "\f17e";
}
.fa-foursquare:before {
  content: "\f180";
}
.fa-trello:before {
  content: "\f181";
}
.fa-female:before {
  content: "\f182";
}
.fa-male:before {
  content: "\f183";
}
.fa-gittip:before,
.fa-gratipay:before {
  content: "\f184";
}
.fa-sun-o:before {
  content: "\f185";
}
.fa-moon-o:before {
  content: "\f186";
}
.fa-archive:before {
  content: "\f187";
}
.fa-bug:before {
  content: "\f188";
}
.fa-vk:before {
  content: "\f189";
}
.fa-weibo:before {
  content: "\f18a";
}
.fa-renren:before {
  content: "\f18b";
}
.fa-pagelines:before {
  content: "\f18c";
}
.fa-stack-exchange:before {
  content: "\f18d";
}
.fa-arrow-circle-o-right:before {
  content: "\f18e";
}
.fa-arrow-circle-o-left:before {
  content: "\f190";
}
.fa-toggle-left:before,
.fa-caret-square-o-left:before {
  content: "\f191";
}
.fa-dot-circle-o:before {
  content: "\f192";
}
.fa-wheelchair:before {
  content: "\f193";
}
.fa-vimeo-square:before {
  content: "\f194";
}
.fa-turkish-lira:before,
.fa-try:before {
  content: "\f195";
}
.fa-plus-square-o:before {
  content: "\f196";
}
.fa-space-shuttle:before {
  content: "\f197";
}
.fa-slack:before {
  content: "\f198";
}
.fa-envelope-square:before {
  content: "\f199";
}
.fa-wordpress:before {
  content: "\f19a";
}
.fa-openid:before {
  content: "\f19b";
}
.fa-institution:before,
.fa-bank:before,
.fa-university:before {
  content: "\f19c";
}
.fa-mortar-board:before,
.fa-graduation-cap:before {
  content: "\f19d";
}
.fa-yahoo:before {
  content: "\f19e";
}
.fa-google:before {
  content: "\f1a0";
}
.fa-reddit:before {
  content: "\f1a1";
}
.fa-reddit-square:before {
  content: "\f1a2";
}
.fa-stumbleupon-circle:before {
  content: "\f1a3";
}
.fa-stumbleupon:before {
  content: "\f1a4";
}
.fa-delicious:before {
  content: "\f1a5";
}
.fa-digg:before {
  content: "\f1a6";
}
.fa-pied-piper-pp:before {
  content: "\f1a7";
}
.fa-pied-piper-alt:before {
  content: "\f1a8";
}
.fa-drupal:before {
  content: "\f1a9";
}
.fa-joomla:before {
  content: "\f1aa";
}
.fa-language:before {
  content: "\f1ab";
}
.fa-fax:before {
  content: "\f1ac";
}
.fa-building:before {
  content: "\f1ad";
}
.fa-child:before {
  content: "\f1ae";
}
.fa-paw:before {
  content: "\f1b0";
}
.fa-spoon:before {
  content: "\f1b1";
}
.fa-cube:before {
  content: "\f1b2";
}
.fa-cubes:before {
  content: "\f1b3";
}
.fa-behance:before {
  content: "\f1b4";
}
.fa-behance-square:before {
  content: "\f1b5";
}
.fa-steam:before {
  content: "\f1b6";
}
.fa-steam-square:before {
  content: "\f1b7";
}
.fa-recycle:before {
  content: "\f1b8";
}
.fa-automobile:before,
.fa-car:before {
  content: "\f1b9";
}
.fa-cab:before,
.fa-taxi:before {
  content: "\f1ba";
}
.fa-tree:before {
  content: "\f1bb";
}
.fa-spotify:before {
  content: "\f1bc";
}
.fa-deviantart:before {
  content: "\f1bd";
}
.fa-soundcloud:before {
  content: "\f1be";
}
.fa-database:before {
  content: "\f1c0";
}
.fa-file-pdf-o:before {
  content: "\f1c1";
}
.fa-file-word-o:before {
  content: "\f1c2";
}
.fa-file-excel-o:before {
  content: "\f1c3";
}
.fa-file-powerpoint-o:before {
  content: "\f1c4";
}
.fa-file-photo-o:before,
.fa-file-picture-o:before,
.fa-file-image-o:before {
  content: "\f1c5";
}
.fa-file-zip-o:before,
.fa-file-archive-o:before {
  content: "\f1c6";
}
.fa-file-sound-o:before,
.fa-file-audio-o:before {
  content: "\f1c7";
}
.fa-file-movie-o:before,
.fa-file-video-o:before {
  content: "\f1c8";
}
.fa-file-code-o:before {
  content: "\f1c9";
}
.fa-vine:before {
  content: "\f1ca";
}
.fa-codepen:before {
  content: "\f1cb";
}
.fa-jsfiddle:before {
  content: "\f1cc";
}
.fa-life-bouy:before,
.fa-life-buoy:before,
.fa-life-saver:before,
.fa-support:before,
.fa-life-ring:before {
  content: "\f1cd";
}
.fa-circle-o-notch:before {
  content: "\f1ce";
}
.fa-ra:before,
.fa-resistance:before,
.fa-rebel:before {
  content: "\f1d0";
}
.fa-ge:before,
.fa-empire:before {
  content: "\f1d1";
}
.fa-git-square:before {
  content: "\f1d2";
}
.fa-git:before {
  content: "\f1d3";
}
.fa-y-combinator-square:before,
.fa-yc-square:before,
.fa-hacker-news:before {
  content: "\f1d4";
}
.fa-tencent-weibo:before {
  content: "\f1d5";
}
.fa-qq:before {
  content: "\f1d6";
}
.fa-wechat:before,
.fa-weixin:before {
  content: "\f1d7";
}
.fa-send:before,
.fa-paper-plane:before {
  content: "\f1d8";
}
.fa-send-o:before,
.fa-paper-plane-o:before {
  content: "\f1d9";
}
.fa-history:before {
  content: "\f1da";
}
.fa-circle-thin:before {
  content: "\f1db";
}
.fa-header:before {
  content: "\f1dc";
}
.fa-paragraph:before {
  content: "\f1dd";
}
.fa-sliders:before {
  content: "\f1de";
}
.fa-share-alt:before {
  content: "\f1e0";
}
.fa-share-alt-square:before {
  content: "\f1e1";
}
.fa-bomb:before {
  content: "\f1e2";
}
.fa-soccer-ball-o:before,
.fa-futbol-o:before {
  content: "\f1e3";
}
.fa-tty:before {
  content: "\f1e4";
}
.fa-binoculars:before {
  content: "\f1e5";
}
.fa-plug:before {
  content: "\f1e6";
}
.fa-slideshare:before {
  content: "\f1e7";
}
.fa-twitch:before {
  content: "\f1e8";
}
.fa-yelp:before {
  content: "\f1e9";
}
.fa-newspaper-o:before {
  content: "\f1ea";
}
.fa-wifi:before {
  content: "\f1eb";
}
.fa-calculator:before {
  content: "\f1ec";
}
.fa-paypal:before {
  content: "\f1ed";
}
.fa-google-wallet:before {
  content: "\f1ee";
}
.fa-cc-visa:before {
  content: "\f1f0";
}
.fa-cc-mastercard:before {
  content: "\f1f1";
}
.fa-cc-discover:before {
  content: "\f1f2";
}
.fa-cc-amex:before {
  content: "\f1f3";
}
.fa-cc-paypal:before {
  content: "\f1f4";
}
.fa-cc-stripe:before {
  content: "\f1f5";
}
.fa-bell-slash:before {
  content: "\f1f6";
}
.fa-bell-slash-o:before {
  content: "\f1f7";
}
.fa-trash:before {
  content: "\f1f8";
}
.fa-copyright:before {
  content: "\f1f9";
}
.fa-at:before {
  content: "\f1fa";
}
.fa-eyedropper:before {
  content: "\f1fb";
}
.fa-paint-brush:before {
  content: "\f1fc";
}
.fa-birthday-cake:before {
  content: "\f1fd";
}
.fa-area-chart:before {
  content: "\f1fe";
}
.fa-pie-chart:before {
  content: "\f200";
}
.fa-line-chart:before {
  content: "\f201";
}
.fa-lastfm:before {
  content: "\f202";
}
.fa-lastfm-square:before {
  content: "\f203";
}
.fa-toggle-off:before {
  content: "\f204";
}
.fa-toggle-on:before {
  content: "\f205";
}
.fa-bicycle:before {
  content: "\f206";
}
.fa-bus:before {
  content: "\f207";
}
.fa-ioxhost:before {
  content: "\f208";
}
.fa-angellist:before {
  content: "\f209";
}
.fa-cc:before {
  content: "\f20a";
}
.fa-shekel:before,
.fa-sheqel:before,
.fa-ils:before {
  content: "\f20b";
}
.fa-meanpath:before {
  content: "\f20c";
}
.fa-buysellads:before {
  content: "\f20d";
}
.fa-connectdevelop:before {
  content: "\f20e";
}
.fa-dashcube:before {
  content: "\f210";
}
.fa-forumbee:before {
  content: "\f211";
}
.fa-leanpub:before {
  content: "\f212";
}
.fa-sellsy:before {
  content: "\f213";
}
.fa-shirtsinbulk:before {
  content: "\f214";
}
.fa-simplybuilt:before {
  content: "\f215";
}
.fa-skyatlas:before {
  content: "\f216";
}
.fa-cart-plus:before {
  content: "\f217";
}
.fa-cart-arrow-down:before {
  content: "\f218";
}
.fa-diamond:before {
  content: "\f219";
}
.fa-ship:before {
  content: "\f21a";
}
.fa-user-secret:before {
  content: "\f21b";
}
.fa-motorcycle:before {
  content: "\f21c";
}
.fa-street-view:before {
  content: "\f21d";
}
.fa-heartbeat:before {
  content: "\f21e";
}
.fa-venus:before {
  content: "\f221";
}
.fa-mars:before {
  content: "\f222";
}
.fa-mercury:before {
  content: "\f223";
}
.fa-intersex:before,
.fa-transgender:before {
  content: "\f224";
}
.fa-transgender-alt:before {
  content: "\f225";
}
.fa-venus-double:before {
  content: "\f226";
}
.fa-mars-double:before {
  content: "\f227";
}
.fa-venus-mars:before {
  content: "\f228";
}
.fa-mars-stroke:before {
  content: "\f229";
}
.fa-mars-stroke-v:before {
  content: "\f22a";
}
.fa-mars-stroke-h:before {
  content: "\f22b";
}
.fa-neuter:before {
  content: "\f22c";
}
.fa-genderless:before {
  content: "\f22d";
}
.fa-facebook-official:before {
  content: "\f230";
}
.fa-pinterest-p:before {
  content: "\f231";
}
.fa-whatsapp:before {
  content: "\f232";
}
.fa-server:before {
  content: "\f233";
}
.fa-user-plus:before {
  content: "\f234";
}
.fa-user-times:before {
  content: "\f235";
}
.fa-hotel:before,
.fa-bed:before {
  content: "\f236";
}
.fa-viacoin:before {
  content: "\f237";
}
.fa-train:before {
  content: "\f238";
}
.fa-subway:before {
  content: "\f239";
}
.fa-medium:before {
  content: "\f23a";
}
.fa-yc:before,
.fa-y-combinator:before {
  content: "\f23b";
}
.fa-optin-monster:before {
  content: "\f23c";
}
.fa-opencart:before {
  content: "\f23d";
}
.fa-expeditedssl:before {
  content: "\f23e";
}
.fa-battery-4:before,
.fa-battery:before,
.fa-battery-full:before {
  content: "\f240";
}
.fa-battery-3:before,
.fa-battery-three-quarters:before {
  content: "\f241";
}
.fa-battery-2:before,
.fa-battery-half:before {
  content: "\f242";
}
.fa-battery-1:before,
.fa-battery-quarter:before {
  content: "\f243";
}
.fa-battery-0:before,
.fa-battery-empty:before {
  content: "\f244";
}
.fa-mouse-pointer:before {
  content: "\f245";
}
.fa-i-cursor:before {
  content: "\f246";
}
.fa-object-group:before {
  content: "\f247";
}
.fa-object-ungroup:before {
  content: "\f248";
}
.fa-sticky-note:before {
  content: "\f249";
}
.fa-sticky-note-o:before {
  content: "\f24a";
}
.fa-cc-jcb:before {
  content: "\f24b";
}
.fa-cc-diners-club:before {
  content: "\f24c";
}
.fa-clone:before {
  content: "\f24d";
}
.fa-balance-scale:before {
  content: "\f24e";
}
.fa-hourglass-o:before {
  content: "\f250";
}
.fa-hourglass-1:before,
.fa-hourglass-start:before {
  content: "\f251";
}
.fa-hourglass-2:before,
.fa-hourglass-half:before {
  content: "\f252";
}
.fa-hourglass-3:before,
.fa-hourglass-end:before {
  content: "\f253";
}
.fa-hourglass:before {
  content: "\f254";
}
.fa-hand-grab-o:before,
.fa-hand-rock-o:before {
  content: "\f255";
}
.fa-hand-stop-o:before,
.fa-hand-paper-o:before {
  content: "\f256";
}
.fa-hand-scissors-o:before {
  content: "\f257";
}
.fa-hand-lizard-o:before {
  content: "\f258";
}
.fa-hand-spock-o:before {
  content: "\f259";
}
.fa-hand-pointer-o:before {
  content: "\f25a";
}
.fa-hand-peace-o:before {
  content: "\f25b";
}
.fa-trademark:before {
  content: "\f25c";
}
.fa-registered:before {
  content: "\f25d";
}
.fa-creative-commons:before {
  content: "\f25e";
}
.fa-gg:before {
  content: "\f260";
}
.fa-gg-circle:before {
  content: "\f261";
}
.fa-tripadvisor:before {
  content: "\f262";
}
.fa-odnoklassniki:before {
  content: "\f263";
}
.fa-odnoklassniki-square:before {
  content: "\f264";
}
.fa-get-pocket:before {
  content: "\f265";
}
.fa-wikipedia-w:before {
  content: "\f266";
}
.fa-safari:before {
  content: "\f267";
}
.fa-chrome:before {
  content: "\f268";
}
.fa-firefox:before {
  content: "\f269";
}
.fa-opera:before {
  content: "\f26a";
}
.fa-internet-explorer:before {
  content: "\f26b";
}
.fa-tv:before,
.fa-television:before {
  content: "\f26c";
}
.fa-contao:before {
  content: "\f26d";
}
.fa-500px:before {
  content: "\f26e";
}
.fa-amazon:before {
  content: "\f270";
}
.fa-calendar-plus-o:before {
  content: "\f271";
}
.fa-calendar-minus-o:before {
  content: "\f272";
}
.fa-calendar-times-o:before {
  content: "\f273";
}
.fa-calendar-check-o:before {
  content: "\f274";
}
.fa-industry:before {
  content: "\f275";
}
.fa-map-pin:before {
  content: "\f276";
}
.fa-map-signs:before {
  content: "\f277";
}
.fa-map-o:before {
  content: "\f278";
}
.fa-map:before {
  content: "\f279";
}
.fa-commenting:before {
  content: "\f27a";
}
.fa-commenting-o:before {
  content: "\f27b";
}
.fa-houzz:before {
  content: "\f27c";
}
.fa-vimeo:before {
  content: "\f27d";
}
.fa-black-tie:before {
  content: "\f27e";
}
.fa-fonticons:before {
  content: "\f280";
}
.fa-reddit-alien:before {
  content: "\f281";
}
.fa-edge:before {
  content: "\f282";
}
.fa-credit-card-alt:before {
  content: "\f283";
}
.fa-codiepie:before {
  content: "\f284";
}
.fa-modx:before {
  content: "\f285";
}
.fa-fort-awesome:before {
  content: "\f286";
}
.fa-usb:before {
  content: "\f287";
}
.fa-product-hunt:before {
  content: "\f288";
}
.fa-mixcloud:before {
  content: "\f289";
}
.fa-scribd:before {
  content: "\f28a";
}
.fa-pause-circle:before {
  content: "\f28b";
}
.fa-pause-circle-o:before {
  content: "\f28c";
}
.fa-stop-circle:before {
  content: "\f28d";
}
.fa-stop-circle-o:before {
  content: "\f28e";
}
.fa-shopping-bag:before {
  content: "\f290";
}
.fa-shopping-basket:before {
  content: "\f291";
}
.fa-hashtag:before {
  content: "\f292";
}
.fa-bluetooth:before {
  content: "\f293";
}
.fa-bluetooth-b:before {
  content: "\f294";
}
.fa-percent:before {
  content: "\f295";
}
.fa-gitlab:before {
  content: "\f296";
}
.fa-wpbeginner:before {
  content: "\f297";
}
.fa-wpforms:before {
  content: "\f298";
}
.fa-envira:before {
  content: "\f299";
}
.fa-universal-access:before {
  content: "\f29a";
}
.fa-wheelchair-alt:before {
  content: "\f29b";
}
.fa-question-circle-o:before {
  content: "\f29c";
}
.fa-blind:before {
  content: "\f29d";
}
.fa-audio-description:before {
  content: "\f29e";
}
.fa-volume-control-phone:before {
  content: "\f2a0";
}
.fa-braille:before {
  content: "\f2a1";
}
.fa-assistive-listening-systems:before {
  content: "\f2a2";
}
.fa-asl-interpreting:before,
.fa-american-sign-language-interpreting:before {
  content: "\f2a3";
}
.fa-deafness:before,
.fa-hard-of-hearing:before,
.fa-deaf:before {
  content: "\f2a4";
}
.fa-glide:before {
  content: "\f2a5";
}
.fa-glide-g:before {
  content: "\f2a6";
}
.fa-signing:before,
.fa-sign-language:before {
  content: "\f2a7";
}
.fa-low-vision:before {
  content: "\f2a8";
}
.fa-viadeo:before {
  content: "\f2a9";
}
.fa-viadeo-square:before {
  content: "\f2aa";
}
.fa-snapchat:before {
  content: "\f2ab";
}
.fa-snapchat-ghost:before {
  content: "\f2ac";
}
.fa-snapchat-square:before {
  content: "\f2ad";
}
.fa-pied-piper:before {
  content: "\f2ae";
}
.fa-first-order:before {
  content: "\f2b0";
}
.fa-yoast:before {
  content: "\f2b1";
}
.fa-themeisle:before {
  content: "\f2b2";
}
.fa-google-plus-circle:before,
.fa-google-plus-official:before {
  content: "\f2b3";
}
.fa-fa:before,
.fa-font-awesome:before {
  content: "\f2b4";
}
.fa-handshake-o:before {
  content: "\f2b5";
}
.fa-envelope-open:before {
  content: "\f2b6";
}
.fa-envelope-open-o:before {
  content: "\f2b7";
}
.fa-linode:before {
  content: "\f2b8";
}
.fa-address-book:before {
  content: "\f2b9";
}
.fa-address-book-o:before {
  content: "\f2ba";
}
.fa-vcard:before,
.fa-address-card:before {
  content: "\f2bb";
}
.fa-vcard-o:before,
.fa-address-card-o:before {
  content: "\f2bc";
}
.fa-user-circle:before {
  content: "\f2bd";
}
.fa-user-circle-o:before {
  content: "\f2be";
}
.fa-user-o:before {
  content: "\f2c0";
}
.fa-id-badge:before {
  content: "\f2c1";
}
.fa-drivers-license:before,
.fa-id-card:before {
  content: "\f2c2";
}
.fa-drivers-license-o:before,
.fa-id-card-o:before {
  content: "\f2c3";
}
.fa-quora:before {
  content: "\f2c4";
}
.fa-free-code-camp:before {
  content: "\f2c5";
}
.fa-telegram:before {
  content: "\f2c6";
}
.fa-thermometer-4:before,
.fa-thermometer:before,
.fa-thermometer-full:before {
  content: "\f2c7";
}
.fa-thermometer-3:before,
.fa-thermometer-three-quarters:before {
  content: "\f2c8";
}
.fa-thermometer-2:before,
.fa-thermometer-half:before {
  content: "\f2c9";
}
.fa-thermometer-1:before,
.fa-thermometer-quarter:before {
  content: "\f2ca";
}
.fa-thermometer-0:before,
.fa-thermometer-empty:before {
  content: "\f2cb";
}
.fa-shower:before {
  content: "\f2cc";
}
.fa-bathtub:before,
.fa-s15:before,
.fa-bath:before {
  content: "\f2cd";
}
.fa-podcast:before {
  content: "\f2ce";
}
.fa-window-maximize:before {
  content: "\f2d0";
}
.fa-window-minimize:before {
  content: "\f2d1";
}
.fa-window-restore:before {
  content: "\f2d2";
}
.fa-times-rectangle:before,
.fa-window-close:before {
  content: "\f2d3";
}
.fa-times-rectangle-o:before,
.fa-window-close-o:before {
  content: "\f2d4";
}
.fa-bandcamp:before {
  content: "\f2d5";
}
.fa-grav:before {
  content: "\f2d6";
}
.fa-etsy:before {
  content: "\f2d7";
}
.fa-imdb:before {
  content: "\f2d8";
}
.fa-ravelry:before {
  content: "\f2d9";
}
.fa-eercast:before {
  content: "\f2da";
}
.fa-microchip:before {
  content: "\f2db";
}
.fa-snowflake-o:before {
  content: "\f2dc";
}
.fa-superpowers:before {
  content: "\f2dd";
}
.fa-wpexplorer:before {
  content: "\f2de";
}
.fa-meetup:before {
  content: "\f2e0";
}
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}
.sr-only-focusable:active,
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  clip: auto;
}
.sr-only-focusable:active,
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  clip: auto;
}
/*!
*
* IPython base
*
*/
.modal.fade .modal-dialog {
  -webkit-transform: translate(0, 0);
  -ms-transform: translate(0, 0);
  -o-transform: translate(0, 0);
  transform: translate(0, 0);
}
code {
  color: #000;
}
pre {
  font-size: inherit;
  line-height: inherit;
}
label {
  font-weight: normal;
}
/* Make the page background atleast 100% the height of the view port */
/* Make the page itself atleast 70% the height of the view port */
.border-box-sizing {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
.corner-all {
  border-radius: 2px;
}
.no-padding {
  padding: 0px;
}
/* Flexible box model classes */
/* Taken from Alex Russell http://infrequently.org/2009/08/css-3-progress/ */
/* This file is a compatability layer.  It allows the usage of flexible box 
model layouts accross multiple browsers, including older browsers.  The newest,
universal implementation of the flexible box model is used when available (see
`Modern browsers` comments below).  Browsers that are known to implement this 
new spec completely include:

    Firefox 28.0+
    Chrome 29.0+
    Internet Explorer 11+ 
    Opera 17.0+

Browsers not listed, including Safari, are supported via the styling under the
`Old browsers` comments below.
*/
.hbox {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
.hbox > * {
  /* Old browsers */
  -webkit-box-flex: 0;
  -moz-box-flex: 0;
  box-flex: 0;
  /* Modern browsers */
  flex: none;
}
.vbox {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
.vbox > * {
  /* Old browsers */
  -webkit-box-flex: 0;
  -moz-box-flex: 0;
  box-flex: 0;
  /* Modern browsers */
  flex: none;
}
.hbox.reverse,
.vbox.reverse,
.reverse {
  /* Old browsers */
  -webkit-box-direction: reverse;
  -moz-box-direction: reverse;
  box-direction: reverse;
  /* Modern browsers */
  flex-direction: row-reverse;
}
.hbox.box-flex0,
.vbox.box-flex0,
.box-flex0 {
  /* Old browsers */
  -webkit-box-flex: 0;
  -moz-box-flex: 0;
  box-flex: 0;
  /* Modern browsers */
  flex: none;
  width: auto;
}
.hbox.box-flex1,
.vbox.box-flex1,
.box-flex1 {
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
.hbox.box-flex,
.vbox.box-flex,
.box-flex {
  /* Old browsers */
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
.hbox.box-flex2,
.vbox.box-flex2,
.box-flex2 {
  /* Old browsers */
  -webkit-box-flex: 2;
  -moz-box-flex: 2;
  box-flex: 2;
  /* Modern browsers */
  flex: 2;
}
.box-group1 {
  /*  Deprecated */
  -webkit-box-flex-group: 1;
  -moz-box-flex-group: 1;
  box-flex-group: 1;
}
.box-group2 {
  /* Deprecated */
  -webkit-box-flex-group: 2;
  -moz-box-flex-group: 2;
  box-flex-group: 2;
}
.hbox.start,
.vbox.start,
.start {
  /* Old browsers */
  -webkit-box-pack: start;
  -moz-box-pack: start;
  box-pack: start;
  /* Modern browsers */
  justify-content: flex-start;
}
.hbox.end,
.vbox.end,
.end {
  /* Old browsers */
  -webkit-box-pack: end;
  -moz-box-pack: end;
  box-pack: end;
  /* Modern browsers */
  justify-content: flex-end;
}
.hbox.center,
.vbox.center,
.center {
  /* Old browsers */
  -webkit-box-pack: center;
  -moz-box-pack: center;
  box-pack: center;
  /* Modern browsers */
  justify-content: center;
}
.hbox.baseline,
.vbox.baseline,
.baseline {
  /* Old browsers */
  -webkit-box-pack: baseline;
  -moz-box-pack: baseline;
  box-pack: baseline;
  /* Modern browsers */
  justify-content: baseline;
}
.hbox.stretch,
.vbox.stretch,
.stretch {
  /* Old browsers */
  -webkit-box-pack: stretch;
  -moz-box-pack: stretch;
  box-pack: stretch;
  /* Modern browsers */
  justify-content: stretch;
}
.hbox.align-start,
.vbox.align-start,
.align-start {
  /* Old browsers */
  -webkit-box-align: start;
  -moz-box-align: start;
  box-align: start;
  /* Modern browsers */
  align-items: flex-start;
}
.hbox.align-end,
.vbox.align-end,
.align-end {
  /* Old browsers */
  -webkit-box-align: end;
  -moz-box-align: end;
  box-align: end;
  /* Modern browsers */
  align-items: flex-end;
}
.hbox.align-center,
.vbox.align-center,
.align-center {
  /* Old browsers */
  -webkit-box-align: center;
  -moz-box-align: center;
  box-align: center;
  /* Modern browsers */
  align-items: center;
}
.hbox.align-baseline,
.vbox.align-baseline,
.align-baseline {
  /* Old browsers */
  -webkit-box-align: baseline;
  -moz-box-align: baseline;
  box-align: baseline;
  /* Modern browsers */
  align-items: baseline;
}
.hbox.align-stretch,
.vbox.align-stretch,
.align-stretch {
  /* Old browsers */
  -webkit-box-align: stretch;
  -moz-box-align: stretch;
  box-align: stretch;
  /* Modern browsers */
  align-items: stretch;
}
div.error {
  margin: 2em;
  text-align: center;
}
div.error > h1 {
  font-size: 500%;
  line-height: normal;
}
div.error > p {
  font-size: 200%;
  line-height: normal;
}
div.traceback-wrapper {
  text-align: left;
  max-width: 800px;
  margin: auto;
}
div.traceback-wrapper pre.traceback {
  max-height: 600px;
  overflow: auto;
}
/**
 * Primary styles
 *
 * Author: Jupyter Development Team
 */
body {
  background-color: #fff;
  /* This makes sure that the body covers the entire window and needs to
       be in a different element than the display: box in wrapper below */
  position: absolute;
  left: 0px;
  right: 0px;
  top: 0px;
  bottom: 0px;
  overflow: visible;
}
body > #header {
  /* Initially hidden to prevent FLOUC */
  display: none;
  background-color: #fff;
  /* Display over codemirror */
  position: relative;
  z-index: 100;
}
body > #header #header-container {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  padding: 5px;
  padding-bottom: 5px;
  padding-top: 5px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
body > #header .header-bar {
  width: 100%;
  height: 1px;
  background: #e7e7e7;
  margin-bottom: -1px;
}
@media print {
  body > #header {
    display: none !important;
  }
}
#header-spacer {
  width: 100%;
  visibility: hidden;
}
@media print {
  #header-spacer {
    display: none;
  }
}
#ipython_notebook {
  padding-left: 0px;
  padding-top: 1px;
  padding-bottom: 1px;
}
[dir="rtl"] #ipython_notebook {
  margin-right: 10px;
  margin-left: 0;
}
[dir="rtl"] #ipython_notebook.pull-left {
  float: right !important;
  float: right;
}
.flex-spacer {
  flex: 1;
}
#noscript {
  width: auto;
  padding-top: 16px;
  padding-bottom: 16px;
  text-align: center;
  font-size: 22px;
  color: red;
  font-weight: bold;
}
#ipython_notebook img {
  height: 28px;
}
#site {
  width: 100%;
  display: none;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  overflow: auto;
}
@media print {
  #site {
    height: auto !important;
  }
}
/* Smaller buttons */
.ui-button .ui-button-text {
  padding: 0.2em 0.8em;
  font-size: 77%;
}
input.ui-button {
  padding: 0.3em 0.9em;
}
span#kernel_logo_widget {
  margin: 0 10px;
}
span#login_widget {
  float: right;
}
[dir="rtl"] span#login_widget {
  float: left;
}
span#login_widget > .button,
#logout {
  color: #333;
  background-color: #fff;
  border-color: #ccc;
}
span#login_widget > .button:focus,
#logout:focus,
span#login_widget > .button.focus,
#logout.focus {
  color: #333;
  background-color: #e6e6e6;
  border-color: #8c8c8c;
}
span#login_widget > .button:hover,
#logout:hover {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
span#login_widget > .button:active,
#logout:active,
span#login_widget > .button.active,
#logout.active,
.open > .dropdown-togglespan#login_widget > .button,
.open > .dropdown-toggle#logout {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
span#login_widget > .button:active:hover,
#logout:active:hover,
span#login_widget > .button.active:hover,
#logout.active:hover,
.open > .dropdown-togglespan#login_widget > .button:hover,
.open > .dropdown-toggle#logout:hover,
span#login_widget > .button:active:focus,
#logout:active:focus,
span#login_widget > .button.active:focus,
#logout.active:focus,
.open > .dropdown-togglespan#login_widget > .button:focus,
.open > .dropdown-toggle#logout:focus,
span#login_widget > .button:active.focus,
#logout:active.focus,
span#login_widget > .button.active.focus,
#logout.active.focus,
.open > .dropdown-togglespan#login_widget > .button.focus,
.open > .dropdown-toggle#logout.focus {
  color: #333;
  background-color: #d4d4d4;
  border-color: #8c8c8c;
}
span#login_widget > .button:active,
#logout:active,
span#login_widget > .button.active,
#logout.active,
.open > .dropdown-togglespan#login_widget > .button,
.open > .dropdown-toggle#logout {
  background-image: none;
}
span#login_widget > .button.disabled:hover,
#logout.disabled:hover,
span#login_widget > .button[disabled]:hover,
#logout[disabled]:hover,
fieldset[disabled] span#login_widget > .button:hover,
fieldset[disabled] #logout:hover,
span#login_widget > .button.disabled:focus,
#logout.disabled:focus,
span#login_widget > .button[disabled]:focus,
#logout[disabled]:focus,
fieldset[disabled] span#login_widget > .button:focus,
fieldset[disabled] #logout:focus,
span#login_widget > .button.disabled.focus,
#logout.disabled.focus,
span#login_widget > .button[disabled].focus,
#logout[disabled].focus,
fieldset[disabled] span#login_widget > .button.focus,
fieldset[disabled] #logout.focus {
  background-color: #fff;
  border-color: #ccc;
}
span#login_widget > .button .badge,
#logout .badge {
  color: #fff;
  background-color: #333;
}
.nav-header {
  text-transform: none;
}
#header > span {
  margin-top: 10px;
}
.modal_stretch .modal-dialog {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  min-height: 80vh;
}
.modal_stretch .modal-dialog .modal-body {
  max-height: calc(100vh - 200px);
  overflow: auto;
  flex: 1;
}
.modal-header {
  cursor: move;
}
@media (min-width: 768px) {
  .modal .modal-dialog {
    width: 700px;
  }
}
@media (min-width: 768px) {
  select.form-control {
    margin-left: 12px;
    margin-right: 12px;
  }
}
/*!
*
* IPython auth
*
*/
.center-nav {
  display: inline-block;
  margin-bottom: -4px;
}
[dir="rtl"] .center-nav form.pull-left {
  float: right !important;
  float: right;
}
[dir="rtl"] .center-nav .navbar-text {
  float: right;
}
[dir="rtl"] .navbar-inner {
  text-align: right;
}
[dir="rtl"] div.text-left {
  text-align: right;
}
/*!
*
* IPython tree view
*
*/
/* We need an invisible input field on top of the sentense*/
/* "Drag file onto the list ..." */
.alternate_upload {
  background-color: none;
  display: inline;
}
.alternate_upload.form {
  padding: 0;
  margin: 0;
}
.alternate_upload input.fileinput {
  position: absolute;
  display: block;
  width: 100%;
  height: 100%;
  overflow: hidden;
  cursor: pointer;
  opacity: 0;
  z-index: 2;
}
.alternate_upload .btn-xs > input.fileinput {
  margin: -1px -5px;
}
.alternate_upload .btn-upload {
  position: relative;
  height: 22px;
}
::-webkit-file-upload-button {
  cursor: pointer;
}
/**
 * Primary styles
 *
 * Author: Jupyter Development Team
 */
ul#tabs {
  margin-bottom: 4px;
}
ul#tabs a {
  padding-top: 6px;
  padding-bottom: 4px;
}
[dir="rtl"] ul#tabs.nav-tabs > li {
  float: right;
}
[dir="rtl"] ul#tabs.nav.nav-tabs {
  padding-right: 0;
}
ul.breadcrumb a:focus,
ul.breadcrumb a:hover {
  text-decoration: none;
}
ul.breadcrumb i.icon-home {
  font-size: 16px;
  margin-right: 4px;
}
ul.breadcrumb span {
  color: #5e5e5e;
}
.list_toolbar {
  padding: 4px 0 4px 0;
  vertical-align: middle;
}
.list_toolbar .tree-buttons {
  padding-top: 1px;
}
[dir="rtl"] .list_toolbar .tree-buttons .pull-right {
  float: left !important;
  float: left;
}
[dir="rtl"] .list_toolbar .col-sm-4,
[dir="rtl"] .list_toolbar .col-sm-8 {
  float: right;
}
.dynamic-buttons {
  padding-top: 3px;
  display: inline-block;
}
.list_toolbar [class*="span"] {
  min-height: 24px;
}
.list_header {
  font-weight: bold;
  background-color: #EEE;
}
.list_placeholder {
  font-weight: bold;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 7px;
  padding-right: 7px;
}
.list_container {
  margin-top: 4px;
  margin-bottom: 20px;
  border: 1px solid #ddd;
  border-radius: 2px;
}
.list_container > div {
  border-bottom: 1px solid #ddd;
}
.list_container > div:hover .list-item {
  background-color: red;
}
.list_container > div:last-child {
  border: none;
}
.list_item:hover .list_item {
  background-color: #ddd;
}
.list_item a {
  text-decoration: none;
}
.list_item:hover {
  background-color: #fafafa;
}
.list_header > div,
.list_item > div {
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 7px;
  padding-right: 7px;
  line-height: 22px;
}
.list_header > div input,
.list_item > div input {
  margin-right: 7px;
  margin-left: 14px;
  vertical-align: text-bottom;
  line-height: 22px;
  position: relative;
  top: -1px;
}
.list_header > div .item_link,
.list_item > div .item_link {
  margin-left: -1px;
  vertical-align: baseline;
  line-height: 22px;
}
[dir="rtl"] .list_item > div input {
  margin-right: 0;
}
.new-file input[type=checkbox] {
  visibility: hidden;
}
.item_name {
  line-height: 22px;
  height: 24px;
}
.item_icon {
  font-size: 14px;
  color: #5e5e5e;
  margin-right: 7px;
  margin-left: 7px;
  line-height: 22px;
  vertical-align: baseline;
}
.item_modified {
  margin-right: 7px;
  margin-left: 7px;
}
[dir="rtl"] .item_modified.pull-right {
  float: left !important;
  float: left;
}
.item_buttons {
  line-height: 1em;
  margin-left: -5px;
}
.item_buttons .btn,
.item_buttons .btn-group,
.item_buttons .input-group {
  float: left;
}
.item_buttons > .btn,
.item_buttons > .btn-group,
.item_buttons > .input-group {
  margin-left: 5px;
}
.item_buttons .btn {
  min-width: 13ex;
}
.item_buttons .running-indicator {
  padding-top: 4px;
  color: #5cb85c;
}
.item_buttons .kernel-name {
  padding-top: 4px;
  color: #5bc0de;
  margin-right: 7px;
  float: left;
}
[dir="rtl"] .item_buttons.pull-right {
  float: left !important;
  float: left;
}
[dir="rtl"] .item_buttons .kernel-name {
  margin-left: 7px;
  float: right;
}
.toolbar_info {
  height: 24px;
  line-height: 24px;
}
.list_item input:not([type=checkbox]) {
  padding-top: 3px;
  padding-bottom: 3px;
  height: 22px;
  line-height: 14px;
  margin: 0px;
}
.highlight_text {
  color: blue;
}
#project_name {
  display: inline-block;
  padding-left: 7px;
  margin-left: -2px;
}
#project_name > .breadcrumb {
  padding: 0px;
  margin-bottom: 0px;
  background-color: transparent;
  font-weight: bold;
}
.sort_button {
  display: inline-block;
  padding-left: 7px;
}
[dir="rtl"] .sort_button.pull-right {
  float: left !important;
  float: left;
}
#tree-selector {
  padding-right: 0px;
}
#button-select-all {
  min-width: 50px;
}
[dir="rtl"] #button-select-all.btn {
  float: right ;
}
#select-all {
  margin-left: 7px;
  margin-right: 2px;
  margin-top: 2px;
  height: 16px;
}
[dir="rtl"] #select-all.pull-left {
  float: right !important;
  float: right;
}
.menu_icon {
  margin-right: 2px;
}
.tab-content .row {
  margin-left: 0px;
  margin-right: 0px;
}
.folder_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f114";
}
.folder_icon:before.fa-pull-left {
  margin-right: .3em;
}
.folder_icon:before.fa-pull-right {
  margin-left: .3em;
}
.folder_icon:before.pull-left {
  margin-right: .3em;
}
.folder_icon:before.pull-right {
  margin-left: .3em;
}
.notebook_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f02d";
  position: relative;
  top: -1px;
}
.notebook_icon:before.fa-pull-left {
  margin-right: .3em;
}
.notebook_icon:before.fa-pull-right {
  margin-left: .3em;
}
.notebook_icon:before.pull-left {
  margin-right: .3em;
}
.notebook_icon:before.pull-right {
  margin-left: .3em;
}
.running_notebook_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f02d";
  position: relative;
  top: -1px;
  color: #5cb85c;
}
.running_notebook_icon:before.fa-pull-left {
  margin-right: .3em;
}
.running_notebook_icon:before.fa-pull-right {
  margin-left: .3em;
}
.running_notebook_icon:before.pull-left {
  margin-right: .3em;
}
.running_notebook_icon:before.pull-right {
  margin-left: .3em;
}
.file_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f016";
  position: relative;
  top: -2px;
}
.file_icon:before.fa-pull-left {
  margin-right: .3em;
}
.file_icon:before.fa-pull-right {
  margin-left: .3em;
}
.file_icon:before.pull-left {
  margin-right: .3em;
}
.file_icon:before.pull-right {
  margin-left: .3em;
}
#notebook_toolbar .pull-right {
  padding-top: 0px;
  margin-right: -1px;
}
ul#new-menu {
  left: auto;
  right: 0;
}
#new-menu .dropdown-header {
  font-size: 10px;
  border-bottom: 1px solid #e5e5e5;
  padding: 0 0 3px;
  margin: -3px 20px 0;
}
.kernel-menu-icon {
  padding-right: 12px;
  width: 24px;
  content: "\f096";
}
.kernel-menu-icon:before {
  content: "\f096";
}
.kernel-menu-icon-current:before {
  content: "\f00c";
}
#tab_content {
  padding-top: 20px;
}
#running .panel-group .panel {
  margin-top: 3px;
  margin-bottom: 1em;
}
#running .panel-group .panel .panel-heading {
  background-color: #EEE;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 7px;
  padding-right: 7px;
  line-height: 22px;
}
#running .panel-group .panel .panel-heading a:focus,
#running .panel-group .panel .panel-heading a:hover {
  text-decoration: none;
}
#running .panel-group .panel .panel-body {
  padding: 0px;
}
#running .panel-group .panel .panel-body .list_container {
  margin-top: 0px;
  margin-bottom: 0px;
  border: 0px;
  border-radius: 0px;
}
#running .panel-group .panel .panel-body .list_container .list_item {
  border-bottom: 1px solid #ddd;
}
#running .panel-group .panel .panel-body .list_container .list_item:last-child {
  border-bottom: 0px;
}
.delete-button {
  display: none;
}
.duplicate-button {
  display: none;
}
.rename-button {
  display: none;
}
.move-button {
  display: none;
}
.download-button {
  display: none;
}
.shutdown-button {
  display: none;
}
.dynamic-instructions {
  display: inline-block;
  padding-top: 4px;
}
/*!
*
* IPython text editor webapp
*
*/
.selected-keymap i.fa {
  padding: 0px 5px;
}
.selected-keymap i.fa:before {
  content: "\f00c";
}
#mode-menu {
  overflow: auto;
  max-height: 20em;
}
.edit_app #header {
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
}
.edit_app #menubar .navbar {
  /* Use a negative 1 bottom margin, so the border overlaps the border of the
    header */
  margin-bottom: -1px;
}
.dirty-indicator {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  width: 20px;
}
.dirty-indicator.fa-pull-left {
  margin-right: .3em;
}
.dirty-indicator.fa-pull-right {
  margin-left: .3em;
}
.dirty-indicator.pull-left {
  margin-right: .3em;
}
.dirty-indicator.pull-right {
  margin-left: .3em;
}
.dirty-indicator-dirty {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  width: 20px;
}
.dirty-indicator-dirty.fa-pull-left {
  margin-right: .3em;
}
.dirty-indicator-dirty.fa-pull-right {
  margin-left: .3em;
}
.dirty-indicator-dirty.pull-left {
  margin-right: .3em;
}
.dirty-indicator-dirty.pull-right {
  margin-left: .3em;
}
.dirty-indicator-clean {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  width: 20px;
}
.dirty-indicator-clean.fa-pull-left {
  margin-right: .3em;
}
.dirty-indicator-clean.fa-pull-right {
  margin-left: .3em;
}
.dirty-indicator-clean.pull-left {
  margin-right: .3em;
}
.dirty-indicator-clean.pull-right {
  margin-left: .3em;
}
.dirty-indicator-clean:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f00c";
}
.dirty-indicator-clean:before.fa-pull-left {
  margin-right: .3em;
}
.dirty-indicator-clean:before.fa-pull-right {
  margin-left: .3em;
}
.dirty-indicator-clean:before.pull-left {
  margin-right: .3em;
}
.dirty-indicator-clean:before.pull-right {
  margin-left: .3em;
}
#filename {
  font-size: 16pt;
  display: table;
  padding: 0px 5px;
}
#current-mode {
  padding-left: 5px;
  padding-right: 5px;
}
#texteditor-backdrop {
  padding-top: 20px;
  padding-bottom: 20px;
}
@media not print {
  #texteditor-backdrop {
    background-color: #EEE;
  }
}
@media print {
  #texteditor-backdrop #texteditor-container .CodeMirror-gutter,
  #texteditor-backdrop #texteditor-container .CodeMirror-gutters {
    background-color: #fff;
  }
}
@media not print {
  #texteditor-backdrop #texteditor-container .CodeMirror-gutter,
  #texteditor-backdrop #texteditor-container .CodeMirror-gutters {
    background-color: #fff;
  }
}
@media not print {
  #texteditor-backdrop #texteditor-container {
    padding: 0px;
    background-color: #fff;
    -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
    box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  }
}
.CodeMirror-dialog {
  background-color: #fff;
}
/*!
*
* IPython notebook
*
*/
/* CSS font colors for translated ANSI escape sequences */
/* The color values are a mix of
   http://www.xcolors.net/dl/baskerville-ivorylight and
   http://www.xcolors.net/dl/euphrasia */
.ansi-black-fg {
  color: #3E424D;
}
.ansi-black-bg {
  background-color: #3E424D;
}
.ansi-black-intense-fg {
  color: #282C36;
}
.ansi-black-intense-bg {
  background-color: #282C36;
}
.ansi-red-fg {
  color: #E75C58;
}
.ansi-red-bg {
  background-color: #E75C58;
}
.ansi-red-intense-fg {
  color: #B22B31;
}
.ansi-red-intense-bg {
  background-color: #B22B31;
}
.ansi-green-fg {
  color: #00A250;
}
.ansi-green-bg {
  background-color: #00A250;
}
.ansi-green-intense-fg {
  color: #007427;
}
.ansi-green-intense-bg {
  background-color: #007427;
}
.ansi-yellow-fg {
  color: #DDB62B;
}
.ansi-yellow-bg {
  background-color: #DDB62B;
}
.ansi-yellow-intense-fg {
  color: #B27D12;
}
.ansi-yellow-intense-bg {
  background-color: #B27D12;
}
.ansi-blue-fg {
  color: #208FFB;
}
.ansi-blue-bg {
  background-color: #208FFB;
}
.ansi-blue-intense-fg {
  color: #0065CA;
}
.ansi-blue-intense-bg {
  background-color: #0065CA;
}
.ansi-magenta-fg {
  color: #D160C4;
}
.ansi-magenta-bg {
  background-color: #D160C4;
}
.ansi-magenta-intense-fg {
  color: #A03196;
}
.ansi-magenta-intense-bg {
  background-color: #A03196;
}
.ansi-cyan-fg {
  color: #60C6C8;
}
.ansi-cyan-bg {
  background-color: #60C6C8;
}
.ansi-cyan-intense-fg {
  color: #258F8F;
}
.ansi-cyan-intense-bg {
  background-color: #258F8F;
}
.ansi-white-fg {
  color: #C5C1B4;
}
.ansi-white-bg {
  background-color: #C5C1B4;
}
.ansi-white-intense-fg {
  color: #A1A6B2;
}
.ansi-white-intense-bg {
  background-color: #A1A6B2;
}
.ansi-default-inverse-fg {
  color: #FFFFFF;
}
.ansi-default-inverse-bg {
  background-color: #000000;
}
.ansi-bold {
  font-weight: bold;
}
.ansi-underline {
  text-decoration: underline;
}
/* The following styles are deprecated an will be removed in a future version */
.ansibold {
  font-weight: bold;
}
.ansi-inverse {
  outline: 0.5px dotted;
}
/* use dark versions for foreground, to improve visibility */
.ansiblack {
  color: black;
}
.ansired {
  color: darkred;
}
.ansigreen {
  color: darkgreen;
}
.ansiyellow {
  color: #c4a000;
}
.ansiblue {
  color: darkblue;
}
.ansipurple {
  color: darkviolet;
}
.ansicyan {
  color: steelblue;
}
.ansigray {
  color: gray;
}
/* and light for background, for the same reason */
.ansibgblack {
  background-color: black;
}
.ansibgred {
  background-color: red;
}
.ansibggreen {
  background-color: green;
}
.ansibgyellow {
  background-color: yellow;
}
.ansibgblue {
  background-color: blue;
}
.ansibgpurple {
  background-color: magenta;
}
.ansibgcyan {
  background-color: cyan;
}
.ansibggray {
  background-color: gray;
}
div.cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-radius: 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border-width: 1px;
  border-style: solid;
  border-color: transparent;
  width: 100%;
  padding: 5px;
  /* This acts as a spacer between cells, that is outside the border */
  margin: 0px;
  outline: none;
  position: relative;
  overflow: visible;
}
div.cell:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: transparent;
}
div.cell.jupyter-soft-selected {
  border-left-color: #E3F2FD;
  border-left-width: 1px;
  padding-left: 5px;
  border-right-color: #E3F2FD;
  border-right-width: 1px;
  background: #E3F2FD;
}
@media print {
  div.cell.jupyter-soft-selected {
    border-color: transparent;
  }
}
div.cell.selected,
div.cell.selected.jupyter-soft-selected {
  border-color: #ababab;
}
div.cell.selected:before,
div.cell.selected.jupyter-soft-selected:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: #42A5F5;
}
@media print {
  div.cell.selected,
  div.cell.selected.jupyter-soft-selected {
    border-color: transparent;
  }
}
.edit_mode div.cell.selected {
  border-color: #66BB6A;
}
.edit_mode div.cell.selected:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: #66BB6A;
}
@media print {
  .edit_mode div.cell.selected {
    border-color: transparent;
  }
}
.prompt {
  /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
  min-width: 14ex;
  /* This padding is tuned to match the padding on the CodeMirror editor. */
  padding: 0.4em;
  margin: 0px;
  font-family: monospace;
  text-align: right;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
  /* Don't highlight prompt number selection */
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Use default cursor */
  cursor: default;
}
@media (max-width: 540px) {
  .prompt {
    text-align: left;
  }
}
div.inner_cell {
  min-width: 0;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
  border: 1px solid #cfcfcf;
  border-radius: 2px;
  background: #f7f7f7;
  line-height: 1.21429em;
}
/* This is needed so that empty prompt areas can collapse to zero height when there
   is no content in the output_subarea and the prompt. The main purpose of this is
   to make sure that empty JavaScript output_subareas have no height. */
div.prompt:empty {
  padding-top: 0;
  padding-bottom: 0;
}
div.unrecognized_cell {
  padding: 5px 5px 5px 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.unrecognized_cell .inner_cell {
  border-radius: 2px;
  padding: 5px;
  font-weight: bold;
  color: red;
  border: 1px solid #cfcfcf;
  background: #eaeaea;
}
div.unrecognized_cell .inner_cell a {
  color: inherit;
  text-decoration: none;
}
div.unrecognized_cell .inner_cell a:hover {
  color: inherit;
  text-decoration: none;
}
@media (max-width: 540px) {
  div.unrecognized_cell > div.prompt {
    display: none;
  }
}
div.code_cell {
  /* avoid page breaking on code cells when printing */
}
@media print {
  div.code_cell {
    page-break-inside: avoid;
  }
}
/* any special styling for code cells that are currently running goes here */
div.input {
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.input {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_prompt {
  color: #303F9F;
  border-top: 1px solid transparent;
}
div.input_area > div.highlight {
  margin: 0.4em;
  border: none;
  padding: 0px;
  background-color: transparent;
}
div.input_area > div.highlight > pre {
  margin: 0px;
  border: none;
  padding: 0px;
  background-color: transparent;
}
/* The following gets added to the <head> if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font.
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */
.CodeMirror {
  line-height: 1.21429em;
  /* Changed from 1em to our global default */
  font-size: 14px;
  height: auto;
  /* Changed to auto to autogrow */
  background: none;
  /* Changed from white to allow our bg to show through */
}
.CodeMirror-scroll {
  /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
  /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
  overflow-y: hidden;
  overflow-x: auto;
}
.CodeMirror-lines {
  /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */
  /* we have set a different line-height and want this to scale with that. */
  /* Note that this should set vertical padding only, since CodeMirror assumes
       that horizontal padding will be set on CodeMirror pre */
  padding: 0.4em 0;
}
.CodeMirror-linenumber {
  padding: 0 8px 0 4px;
}
.CodeMirror-gutters {
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.CodeMirror pre {
  /* In CM3 this went to 4px from 0 in CM2. This sets horizontal padding only,
    use .CodeMirror-lines for vertical */
  padding: 0 0.4em;
  border: 0;
  border-radius: 0;
}
.CodeMirror-cursor {
  border-left: 1.4px solid black;
}
@media screen and (min-width: 2138px) and (max-width: 4319px) {
  .CodeMirror-cursor {
    border-left: 2px solid black;
  }
}
@media screen and (min-width: 4320px) {
  .CodeMirror-cursor {
    border-left: 4px solid black;
  }
}
/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org>
Adapted from GitHub theme

*/
.highlight-base {
  color: #000;
}
.highlight-variable {
  color: #000;
}
.highlight-variable-2 {
  color: #1a1a1a;
}
.highlight-variable-3 {
  color: #333333;
}
.highlight-string {
  color: #BA2121;
}
.highlight-comment {
  color: #408080;
  font-style: italic;
}
.highlight-number {
  color: #080;
}
.highlight-atom {
  color: #88F;
}
.highlight-keyword {
  color: #008000;
  font-weight: bold;
}
.highlight-builtin {
  color: #008000;
}
.highlight-error {
  color: #f00;
}
.highlight-operator {
  color: #AA22FF;
  font-weight: bold;
}
.highlight-meta {
  color: #AA22FF;
}
/* previously not defined, copying from default codemirror */
.highlight-def {
  color: #00f;
}
.highlight-string-2 {
  color: #f50;
}
.highlight-qualifier {
  color: #555;
}
.highlight-bracket {
  color: #997;
}
.highlight-tag {
  color: #170;
}
.highlight-attribute {
  color: #00c;
}
.highlight-header {
  color: blue;
}
.highlight-quote {
  color: #090;
}
.highlight-link {
  color: #00c;
}
/* apply the same style to codemirror */
.cm-s-ipython span.cm-keyword {
  color: #008000;
  font-weight: bold;
}
.cm-s-ipython span.cm-atom {
  color: #88F;
}
.cm-s-ipython span.cm-number {
  color: #080;
}
.cm-s-ipython span.cm-def {
  color: #00f;
}
.cm-s-ipython span.cm-variable {
  color: #000;
}
.cm-s-ipython span.cm-operator {
  color: #AA22FF;
  font-weight: bold;
}
.cm-s-ipython span.cm-variable-2 {
  color: #1a1a1a;
}
.cm-s-ipython span.cm-variable-3 {
  color: #333333;
}
.cm-s-ipython span.cm-comment {
  color: #408080;
  font-style: italic;
}
.cm-s-ipython span.cm-string {
  color: #BA2121;
}
.cm-s-ipython span.cm-string-2 {
  color: #f50;
}
.cm-s-ipython span.cm-meta {
  color: #AA22FF;
}
.cm-s-ipython span.cm-qualifier {
  color: #555;
}
.cm-s-ipython span.cm-builtin {
  color: #008000;
}
.cm-s-ipython span.cm-bracket {
  color: #997;
}
.cm-s-ipython span.cm-tag {
  color: #170;
}
.cm-s-ipython span.cm-attribute {
  color: #00c;
}
.cm-s-ipython span.cm-header {
  color: blue;
}
.cm-s-ipython span.cm-quote {
  color: #090;
}
.cm-s-ipython span.cm-link {
  color: #00c;
}
.cm-s-ipython span.cm-error {
  color: #f00;
}
.cm-s-ipython span.cm-tab {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);
  background-position: right;
  background-repeat: no-repeat;
}
div.output_wrapper {
  /* this position must be relative to enable descendents to be absolute within it */
  position: relative;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 1;
}
/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  overflow: auto;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  display: block;
}
/* output div while it is collapsed */
div.output_collapsed {
  margin: 0px;
  padding: 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
div.out_prompt_overlay {
  height: 100%;
  padding: 0px 0.4em;
  position: absolute;
  border-radius: 2px;
}
div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  -webkit-box-shadow: inset 0 0 1px #000;
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}
div.output_prompt {
  color: #D84315;
}
/* This class is the outer container of all output sections. */
div.output_area {
  padding: 0px;
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.output_area .MathJax_Display {
  text-align: left !important;
}
div.output_area .rendered_html table {
  margin-left: 0;
  margin-right: 0;
}
div.output_area .rendered_html img {
  margin-left: 0;
  margin-right: 0;
}
div.output_area img,
div.output_area svg {
  max-width: 100%;
  height: auto;
}
div.output_area img.unconfined,
div.output_area svg.unconfined {
  max-width: none;
}
div.output_area .mglyph > img {
  max-width: none;
}
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
.output {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.output_area {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
div.output_area pre {
  margin: 0;
  padding: 1px 0 1px 0;
  border: 0;
  vertical-align: baseline;
  color: black;
  background-color: transparent;
  border-radius: 0;
}
/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
  overflow-x: auto;
  padding: 0.4em;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
  max-width: calc(100% - 14ex);
}
div.output_scroll div.output_subarea {
  overflow-x: visible;
}
/* The rest of the output_* classes are for special styling of the different
   output types */
/* all text output has this class: */
div.output_text {
  text-align: left;
  color: #000;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
}
/* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */
div.output_stderr {
  background: #fdd;
  /* very light red background for stderr */
}
div.output_latex {
  text-align: left;
}
/* Empty output_javascript divs should have no height */
div.output_javascript:empty {
  padding: 0;
}
.js-error {
  color: darkred;
}
/* raw_input styles */
div.raw_input_container {
  line-height: 1.21429em;
  padding-top: 5px;
}
pre.raw_input_prompt {
  /* nothing needed here. */
}
input.raw_input {
  font-family: monospace;
  font-size: inherit;
  color: inherit;
  width: auto;
  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;
  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0em 0.25em;
  margin: 0em 0.25em;
}
input.raw_input:focus {
  box-shadow: none;
}
p.p-space {
  margin-bottom: 10px;
}
div.output_unrecognized {
  padding: 5px;
  font-weight: bold;
  color: red;
}
div.output_unrecognized a {
  color: inherit;
  text-decoration: none;
}
div.output_unrecognized a:hover {
  color: inherit;
  text-decoration: none;
}
.rendered_html {
  color: #000;
  /* any extras will just be numbers: */
}
.rendered_html em {
  font-style: italic;
}
.rendered_html strong {
  font-weight: bold;
}
.rendered_html u {
  text-decoration: underline;
}
.rendered_html :link {
  text-decoration: underline;
}
.rendered_html :visited {
  text-decoration: underline;
}
.rendered_html h1 {
  font-size: 185.7%;
  margin: 1.08em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
}
.rendered_html h2 {
  font-size: 157.1%;
  margin: 1.27em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
}
.rendered_html h3 {
  font-size: 128.6%;
  margin: 1.55em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
}
.rendered_html h4 {
  font-size: 100%;
  margin: 2em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
}
.rendered_html h5 {
  font-size: 100%;
  margin: 2em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
  font-style: italic;
}
.rendered_html h6 {
  font-size: 100%;
  margin: 2em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
  font-style: italic;
}
.rendered_html h1:first-child {
  margin-top: 0.538em;
}
.rendered_html h2:first-child {
  margin-top: 0.636em;
}
.rendered_html h3:first-child {
  margin-top: 0.777em;
}
.rendered_html h4:first-child {
  margin-top: 1em;
}
.rendered_html h5:first-child {
  margin-top: 1em;
}
.rendered_html h6:first-child {
  margin-top: 1em;
}
.rendered_html ul:not(.list-inline),
.rendered_html ol:not(.list-inline) {
  padding-left: 2em;
}
.rendered_html ul {
  list-style: disc;
}
.rendered_html ul ul {
  list-style: square;
  margin-top: 0;
}
.rendered_html ul ul ul {
  list-style: circle;
}
.rendered_html ol {
  list-style: decimal;
}
.rendered_html ol ol {
  list-style: upper-alpha;
  margin-top: 0;
}
.rendered_html ol ol ol {
  list-style: lower-alpha;
}
.rendered_html ol ol ol ol {
  list-style: lower-roman;
}
.rendered_html ol ol ol ol ol {
  list-style: decimal;
}
.rendered_html * + ul {
  margin-top: 1em;
}
.rendered_html * + ol {
  margin-top: 1em;
}
.rendered_html hr {
  color: black;
  background-color: black;
}
.rendered_html pre {
  margin: 1em 2em;
  padding: 0px;
  background-color: #fff;
}
.rendered_html code {
  background-color: #eff0f1;
}
.rendered_html p code {
  padding: 1px 5px;
}
.rendered_html pre code {
  background-color: #fff;
}
.rendered_html pre,
.rendered_html code {
  border: 0;
  color: #000;
  font-size: 100%;
}
.rendered_html blockquote {
  margin: 1em 2em;
}
.rendered_html table {
  margin-left: auto;
  margin-right: auto;
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.rendered_html tr,
.rendered_html th,
.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.rendered_html th {
  font-weight: bold;
}
.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
.rendered_html * + table {
  margin-top: 1em;
}
.rendered_html p {
  text-align: left;
}
.rendered_html * + p {
  margin-top: 1em;
}
.rendered_html img {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
.rendered_html * + img {
  margin-top: 1em;
}
.rendered_html img,
.rendered_html svg {
  max-width: 100%;
  height: auto;
}
.rendered_html img.unconfined,
.rendered_html svg.unconfined {
  max-width: none;
}
.rendered_html .alert {
  margin-bottom: initial;
}
.rendered_html * + .alert {
  margin-top: 1em;
}
[dir="rtl"] .rendered_html p {
  text-align: right;
}
div.text_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.text_cell > div.prompt {
    display: none;
  }
}
div.text_cell_render {
  /*font-family: "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;*/
  outline: none;
  resize: none;
  width: inherit;
  border-style: none;
  padding: 0.5em 0.5em 0.5em 0.4em;
  color: #000;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
a.anchor-link:link {
  text-decoration: none;
  padding: 0px 20px;
  visibility: hidden;
}
h1:hover .anchor-link,
h2:hover .anchor-link,
h3:hover .anchor-link,
h4:hover .anchor-link,
h5:hover .anchor-link,
h6:hover .anchor-link {
  visibility: visible;
}
.text_cell.rendered .input_area {
  display: none;
}
.text_cell.rendered .rendered_html {
  overflow-x: auto;
  overflow-y: hidden;
}
.text_cell.rendered .rendered_html tr,
.text_cell.rendered .rendered_html th,
.text_cell.rendered .rendered_html td {
  max-width: none;
}
.text_cell.unrendered .text_cell_render {
  display: none;
}
.text_cell .dropzone .input_area {
  border: 2px dashed #bababa;
  margin: -1px;
}
.cm-header-1,
.cm-header-2,
.cm-header-3,
.cm-header-4,
.cm-header-5,
.cm-header-6 {
  font-weight: bold;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
.cm-header-1 {
  font-size: 185.7%;
}
.cm-header-2 {
  font-size: 157.1%;
}
.cm-header-3 {
  font-size: 128.6%;
}
.cm-header-4 {
  font-size: 110%;
}
.cm-header-5 {
  font-size: 100%;
  font-style: italic;
}
.cm-header-6 {
  font-size: 100%;
  font-style: italic;
}
/*!
*
* IPython notebook webapp
*
*/
@media (max-width: 767px) {
  .notebook_app {
    padding-left: 0px;
    padding-right: 0px;
  }
}
#ipython-main-app {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  height: 100%;
}
div#notebook_panel {
  margin: 0px;
  padding: 0px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  height: 100%;
}
div#notebook {
  font-size: 14px;
  line-height: 20px;
  overflow-y: hidden;
  overflow-x: auto;
  width: 100%;
  /* This spaces the page away from the edge of the notebook area */
  padding-top: 20px;
  margin: 0px;
  outline: none;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  min-height: 100%;
}
@media not print {
  #notebook-container {
    padding: 15px;
    background-color: #fff;
    min-height: 0;
    -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
    box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  }
}
@media print {
  #notebook-container {
    width: 100%;
  }
}
div.ui-widget-content {
  border: 1px solid #ababab;
  outline: none;
}
pre.dialog {
  background-color: #f7f7f7;
  border: 1px solid #ddd;
  border-radius: 2px;
  padding: 0.4em;
  padding-left: 2em;
}
p.dialog {
  padding: 0.2em;
}
/* Word-wrap output correctly.  This is the CSS3 spelling, though Firefox seems
   to not honor it correctly.  Webkit browsers (Chrome, rekonq, Safari) do.
 */
pre,
code,
kbd,
samp {
  white-space: pre-wrap;
}
#fonttest {
  font-family: monospace;
}
p {
  margin-bottom: 0;
}
.end_space {
  min-height: 100px;
  transition: height .2s ease;
}
.notebook_app > #header {
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
}
@media not print {
  .notebook_app {
    background-color: #EEE;
  }
}
kbd {
  border-style: solid;
  border-width: 1px;
  box-shadow: none;
  margin: 2px;
  padding-left: 2px;
  padding-right: 2px;
  padding-top: 1px;
  padding-bottom: 1px;
}
.jupyter-keybindings {
  padding: 1px;
  line-height: 24px;
  border-bottom: 1px solid gray;
}
.jupyter-keybindings input {
  margin: 0;
  padding: 0;
  border: none;
}
.jupyter-keybindings i {
  padding: 6px;
}
.well code {
  background-color: #ffffff;
  border-color: #ababab;
  border-width: 1px;
  border-style: solid;
  padding: 2px;
  padding-top: 1px;
  padding-bottom: 1px;
}
/* CSS for the cell toolbar */
.celltoolbar {
  border: thin solid #CFCFCF;
  border-bottom: none;
  background: #EEE;
  border-radius: 2px 2px 0px 0px;
  width: 100%;
  height: 29px;
  padding-right: 4px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-pack: end;
  -moz-box-pack: end;
  box-pack: end;
  /* Modern browsers */
  justify-content: flex-end;
  display: -webkit-flex;
}
@media print {
  .celltoolbar {
    display: none;
  }
}
.ctb_hideshow {
  display: none;
  vertical-align: bottom;
}
/* ctb_show is added to the ctb_hideshow div to show the cell toolbar.
   Cell toolbars are only shown when the ctb_global_show class is also set.
*/
.ctb_global_show .ctb_show.ctb_hideshow {
  display: block;
}
.ctb_global_show .ctb_show + .input_area,
.ctb_global_show .ctb_show + div.text_cell_input,
.ctb_global_show .ctb_show ~ div.text_cell_render {
  border-top-right-radius: 0px;
  border-top-left-radius: 0px;
}
.ctb_global_show .ctb_show ~ div.text_cell_render {
  border: 1px solid #cfcfcf;
}
.celltoolbar {
  font-size: 87%;
  padding-top: 3px;
}
.celltoolbar select {
  display: block;
  width: 100%;
  height: 32px;
  padding: 6px 12px;
  font-size: 13px;
  line-height: 1.42857143;
  color: #555555;
  background-color: #fff;
  background-image: none;
  border: 1px solid #ccc;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  -webkit-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  height: 30px;
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
  width: inherit;
  font-size: inherit;
  height: 22px;
  padding: 0px;
  display: inline-block;
}
.celltoolbar select:focus {
  border-color: #66afe9;
  outline: 0;
  -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
}
.celltoolbar select::-moz-placeholder {
  color: #999;
  opacity: 1;
}
.celltoolbar select:-ms-input-placeholder {
  color: #999;
}
.celltoolbar select::-webkit-input-placeholder {
  color: #999;
}
.celltoolbar select::-ms-expand {
  border: 0;
  background-color: transparent;
}
.celltoolbar select[disabled],
.celltoolbar select[readonly],
fieldset[disabled] .celltoolbar select {
  background-color: #eeeeee;
  opacity: 1;
}
.celltoolbar select[disabled],
fieldset[disabled] .celltoolbar select {
  cursor: not-allowed;
}
textarea.celltoolbar select {
  height: auto;
}
select.celltoolbar select {
  height: 30px;
  line-height: 30px;
}
textarea.celltoolbar select,
select[multiple].celltoolbar select {
  height: auto;
}
.celltoolbar label {
  margin-left: 5px;
  margin-right: 5px;
}
.tags_button_container {
  width: 100%;
  display: flex;
}
.tag-container {
  display: flex;
  flex-direction: row;
  flex-grow: 1;
  overflow: hidden;
  position: relative;
}
.tag-container > * {
  margin: 0 4px;
}
.remove-tag-btn {
  margin-left: 4px;
}
.tags-input {
  display: flex;
}
.cell-tag:last-child:after {
  content: "";
  position: absolute;
  right: 0;
  width: 40px;
  height: 100%;
  /* Fade to background color of cell toolbar */
  background: linear-gradient(to right, rgba(0, 0, 0, 0), #EEE);
}
.tags-input > * {
  margin-left: 4px;
}
.cell-tag,
.tags-input input,
.tags-input button {
  display: block;
  width: 100%;
  height: 32px;
  padding: 6px 12px;
  font-size: 13px;
  line-height: 1.42857143;
  color: #555555;
  background-color: #fff;
  background-image: none;
  border: 1px solid #ccc;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  -webkit-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  height: 30px;
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
  box-shadow: none;
  width: inherit;
  font-size: inherit;
  height: 22px;
  line-height: 22px;
  padding: 0px 4px;
  display: inline-block;
}
.cell-tag:focus,
.tags-input input:focus,
.tags-input button:focus {
  border-color: #66afe9;
  outline: 0;
  -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
}
.cell-tag::-moz-placeholder,
.tags-input input::-moz-placeholder,
.tags-input button::-moz-placeholder {
  color: #999;
  opacity: 1;
}
.cell-tag:-ms-input-placeholder,
.tags-input input:-ms-input-placeholder,
.tags-input button:-ms-input-placeholder {
  color: #999;
}
.cell-tag::-webkit-input-placeholder,
.tags-input input::-webkit-input-placeholder,
.tags-input button::-webkit-input-placeholder {
  color: #999;
}
.cell-tag::-ms-expand,
.tags-input input::-ms-expand,
.tags-input button::-ms-expand {
  border: 0;
  background-color: transparent;
}
.cell-tag[disabled],
.tags-input input[disabled],
.tags-input button[disabled],
.cell-tag[readonly],
.tags-input input[readonly],
.tags-input button[readonly],
fieldset[disabled] .cell-tag,
fieldset[disabled] .tags-input input,
fieldset[disabled] .tags-input button {
  background-color: #eeeeee;
  opacity: 1;
}
.cell-tag[disabled],
.tags-input input[disabled],
.tags-input button[disabled],
fieldset[disabled] .cell-tag,
fieldset[disabled] .tags-input input,
fieldset[disabled] .tags-input button {
  cursor: not-allowed;
}
textarea.cell-tag,
textarea.tags-input input,
textarea.tags-input button {
  height: auto;
}
select.cell-tag,
select.tags-input input,
select.tags-input button {
  height: 30px;
  line-height: 30px;
}
textarea.cell-tag,
textarea.tags-input input,
textarea.tags-input button,
select[multiple].cell-tag,
select[multiple].tags-input input,
select[multiple].tags-input button {
  height: auto;
}
.cell-tag,
.tags-input button {
  padding: 0px 4px;
}
.cell-tag {
  background-color: #fff;
  white-space: nowrap;
}
.tags-input input[type=text]:focus {
  outline: none;
  box-shadow: none;
  border-color: #ccc;
}
.completions {
  position: absolute;
  z-index: 110;
  overflow: hidden;
  border: 1px solid #ababab;
  border-radius: 2px;
  -webkit-box-shadow: 0px 6px 10px -1px #adadad;
  box-shadow: 0px 6px 10px -1px #adadad;
  line-height: 1;
}
.completions select {
  background: white;
  outline: none;
  border: none;
  padding: 0px;
  margin: 0px;
  overflow: auto;
  font-family: monospace;
  font-size: 110%;
  color: #000;
  width: auto;
}
.completions select option.context {
  color: #286090;
}
#kernel_logo_widget .current_kernel_logo {
  display: none;
  margin-top: -1px;
  margin-bottom: -1px;
  width: 32px;
  height: 32px;
}
[dir="rtl"] #kernel_logo_widget {
  float: left !important;
  float: left;
}
.modal .modal-body .move-path {
  display: flex;
  flex-direction: row;
  justify-content: space;
  align-items: center;
}
.modal .modal-body .move-path .server-root {
  padding-right: 20px;
}
.modal .modal-body .move-path .path-input {
  flex: 1;
}
#menubar {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  margin-top: 1px;
}
#menubar .navbar {
  border-top: 1px;
  border-radius: 0px 0px 2px 2px;
  margin-bottom: 0px;
}
#menubar .navbar-toggle {
  float: left;
  padding-top: 7px;
  padding-bottom: 7px;
  border: none;
}
#menubar .navbar-collapse {
  clear: left;
}
[dir="rtl"] #menubar .navbar-toggle {
  float: right;
}
[dir="rtl"] #menubar .navbar-collapse {
  clear: right;
}
[dir="rtl"] #menubar .navbar-nav {
  float: right;
}
[dir="rtl"] #menubar .nav {
  padding-right: 0px;
}
[dir="rtl"] #menubar .navbar-nav > li {
  float: right;
}
[dir="rtl"] #menubar .navbar-right {
  float: left !important;
}
[dir="rtl"] ul.dropdown-menu {
  text-align: right;
  left: auto;
}
[dir="rtl"] ul#new-menu.dropdown-menu {
  right: auto;
  left: 0;
}
.nav-wrapper {
  border-bottom: 1px solid #e7e7e7;
}
i.menu-icon {
  padding-top: 4px;
}
[dir="rtl"] i.menu-icon.pull-right {
  float: left !important;
  float: left;
}
ul#help_menu li a {
  overflow: hidden;
  padding-right: 2.2em;
}
ul#help_menu li a i {
  margin-right: -1.2em;
}
[dir="rtl"] ul#help_menu li a {
  padding-left: 2.2em;
}
[dir="rtl"] ul#help_menu li a i {
  margin-right: 0;
  margin-left: -1.2em;
}
[dir="rtl"] ul#help_menu li a i.pull-right {
  float: left !important;
  float: left;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu > .dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
}
[dir="rtl"] .dropdown-submenu > .dropdown-menu {
  right: 100%;
  margin-right: -1px;
}
.dropdown-submenu:hover > .dropdown-menu {
  display: block;
}
.dropdown-submenu > a:after {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  display: block;
  content: "\f0da";
  float: right;
  color: #333333;
  margin-top: 2px;
  margin-right: -10px;
}
.dropdown-submenu > a:after.fa-pull-left {
  margin-right: .3em;
}
.dropdown-submenu > a:after.fa-pull-right {
  margin-left: .3em;
}
.dropdown-submenu > a:after.pull-left {
  margin-right: .3em;
}
.dropdown-submenu > a:after.pull-right {
  margin-left: .3em;
}
[dir="rtl"] .dropdown-submenu > a:after {
  float: left;
  content: "\f0d9";
  margin-right: 0;
  margin-left: -10px;
}
.dropdown-submenu:hover > a:after {
  color: #262626;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left > .dropdown-menu {
  left: -100%;
  margin-left: 10px;
}
#notification_area {
  float: right !important;
  float: right;
  z-index: 10;
}
[dir="rtl"] #notification_area {
  float: left !important;
  float: left;
}
.indicator_area {
  float: right !important;
  float: right;
  color: #777;
  margin-left: 5px;
  margin-right: 5px;
  width: 11px;
  z-index: 10;
  text-align: center;
  width: auto;
}
[dir="rtl"] .indicator_area {
  float: left !important;
  float: left;
}
#kernel_indicator {
  float: right !important;
  float: right;
  color: #777;
  margin-left: 5px;
  margin-right: 5px;
  width: 11px;
  z-index: 10;
  text-align: center;
  width: auto;
  border-left: 1px solid;
}
#kernel_indicator .kernel_indicator_name {
  padding-left: 5px;
  padding-right: 5px;
}
[dir="rtl"] #kernel_indicator {
  float: left !important;
  float: left;
  border-left: 0;
  border-right: 1px solid;
}
#modal_indicator {
  float: right !important;
  float: right;
  color: #777;
  margin-left: 5px;
  margin-right: 5px;
  width: 11px;
  z-index: 10;
  text-align: center;
  width: auto;
}
[dir="rtl"] #modal_indicator {
  float: left !important;
  float: left;
}
#readonly-indicator {
  float: right !important;
  float: right;
  color: #777;
  margin-left: 5px;
  margin-right: 5px;
  width: 11px;
  z-index: 10;
  text-align: center;
  width: auto;
  margin-top: 2px;
  margin-bottom: 0px;
  margin-left: 0px;
  margin-right: 0px;
  display: none;
}
.modal_indicator:before {
  width: 1.28571429em;
  text-align: center;
}
.edit_mode .modal_indicator:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f040";
}
.edit_mode .modal_indicator:before.fa-pull-left {
  margin-right: .3em;
}
.edit_mode .modal_indicator:before.fa-pull-right {
  margin-left: .3em;
}
.edit_mode .modal_indicator:before.pull-left {
  margin-right: .3em;
}
.edit_mode .modal_indicator:before.pull-right {
  margin-left: .3em;
}
.command_mode .modal_indicator:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: ' ';
}
.command_mode .modal_indicator:before.fa-pull-left {
  margin-right: .3em;
}
.command_mode .modal_indicator:before.fa-pull-right {
  margin-left: .3em;
}
.command_mode .modal_indicator:before.pull-left {
  margin-right: .3em;
}
.command_mode .modal_indicator:before.pull-right {
  margin-left: .3em;
}
.kernel_idle_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f10c";
}
.kernel_idle_icon:before.fa-pull-left {
  margin-right: .3em;
}
.kernel_idle_icon:before.fa-pull-right {
  margin-left: .3em;
}
.kernel_idle_icon:before.pull-left {
  margin-right: .3em;
}
.kernel_idle_icon:before.pull-right {
  margin-left: .3em;
}
.kernel_busy_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f111";
}
.kernel_busy_icon:before.fa-pull-left {
  margin-right: .3em;
}
.kernel_busy_icon:before.fa-pull-right {
  margin-left: .3em;
}
.kernel_busy_icon:before.pull-left {
  margin-right: .3em;
}
.kernel_busy_icon:before.pull-right {
  margin-left: .3em;
}
.kernel_dead_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f1e2";
}
.kernel_dead_icon:before.fa-pull-left {
  margin-right: .3em;
}
.kernel_dead_icon:before.fa-pull-right {
  margin-left: .3em;
}
.kernel_dead_icon:before.pull-left {
  margin-right: .3em;
}
.kernel_dead_icon:before.pull-right {
  margin-left: .3em;
}
.kernel_disconnected_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f127";
}
.kernel_disconnected_icon:before.fa-pull-left {
  margin-right: .3em;
}
.kernel_disconnected_icon:before.fa-pull-right {
  margin-left: .3em;
}
.kernel_disconnected_icon:before.pull-left {
  margin-right: .3em;
}
.kernel_disconnected_icon:before.pull-right {
  margin-left: .3em;
}
.notification_widget {
  color: #777;
  z-index: 10;
  background: rgba(240, 240, 240, 0.5);
  margin-right: 4px;
  color: #333;
  background-color: #fff;
  border-color: #ccc;
}
.notification_widget:focus,
.notification_widget.focus {
  color: #333;
  background-color: #e6e6e6;
  border-color: #8c8c8c;
}
.notification_widget:hover {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
.notification_widget:active,
.notification_widget.active,
.open > .dropdown-toggle.notification_widget {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
.notification_widget:active:hover,
.notification_widget.active:hover,
.open > .dropdown-toggle.notification_widget:hover,
.notification_widget:active:focus,
.notification_widget.active:focus,
.open > .dropdown-toggle.notification_widget:focus,
.notification_widget:active.focus,
.notification_widget.active.focus,
.open > .dropdown-toggle.notification_widget.focus {
  color: #333;
  background-color: #d4d4d4;
  border-color: #8c8c8c;
}
.notification_widget:active,
.notification_widget.active,
.open > .dropdown-toggle.notification_widget {
  background-image: none;
}
.notification_widget.disabled:hover,
.notification_widget[disabled]:hover,
fieldset[disabled] .notification_widget:hover,
.notification_widget.disabled:focus,
.notification_widget[disabled]:focus,
fieldset[disabled] .notification_widget:focus,
.notification_widget.disabled.focus,
.notification_widget[disabled].focus,
fieldset[disabled] .notification_widget.focus {
  background-color: #fff;
  border-color: #ccc;
}
.notification_widget .badge {
  color: #fff;
  background-color: #333;
}
.notification_widget.warning {
  color: #fff;
  background-color: #f0ad4e;
  border-color: #eea236;
}
.notification_widget.warning:focus,
.notification_widget.warning.focus {
  color: #fff;
  background-color: #ec971f;
  border-color: #985f0d;
}
.notification_widget.warning:hover {
  color: #fff;
  background-color: #ec971f;
  border-color: #d58512;
}
.notification_widget.warning:active,
.notification_widget.warning.active,
.open > .dropdown-toggle.notification_widget.warning {
  color: #fff;
  background-color: #ec971f;
  border-color: #d58512;
}
.notification_widget.warning:active:hover,
.notification_widget.warning.active:hover,
.open > .dropdown-toggle.notification_widget.warning:hover,
.notification_widget.warning:active:focus,
.notification_widget.warning.active:focus,
.open > .dropdown-toggle.notification_widget.warning:focus,
.notification_widget.warning:active.focus,
.notification_widget.warning.active.focus,
.open > .dropdown-toggle.notification_widget.warning.focus {
  color: #fff;
  background-color: #d58512;
  border-color: #985f0d;
}
.notification_widget.warning:active,
.notification_widget.warning.active,
.open > .dropdown-toggle.notification_widget.warning {
  background-image: none;
}
.notification_widget.warning.disabled:hover,
.notification_widget.warning[disabled]:hover,
fieldset[disabled] .notification_widget.warning:hover,
.notification_widget.warning.disabled:focus,
.notification_widget.warning[disabled]:focus,
fieldset[disabled] .notification_widget.warning:focus,
.notification_widget.warning.disabled.focus,
.notification_widget.warning[disabled].focus,
fieldset[disabled] .notification_widget.warning.focus {
  background-color: #f0ad4e;
  border-color: #eea236;
}
.notification_widget.warning .badge {
  color: #f0ad4e;
  background-color: #fff;
}
.notification_widget.success {
  color: #fff;
  background-color: #5cb85c;
  border-color: #4cae4c;
}
.notification_widget.success:focus,
.notification_widget.success.focus {
  color: #fff;
  background-color: #449d44;
  border-color: #255625;
}
.notification_widget.success:hover {
  color: #fff;
  background-color: #449d44;
  border-color: #398439;
}
.notification_widget.success:active,
.notification_widget.success.active,
.open > .dropdown-toggle.notification_widget.success {
  color: #fff;
  background-color: #449d44;
  border-color: #398439;
}
.notification_widget.success:active:hover,
.notification_widget.success.active:hover,
.open > .dropdown-toggle.notification_widget.success:hover,
.notification_widget.success:active:focus,
.notification_widget.success.active:focus,
.open > .dropdown-toggle.notification_widget.success:focus,
.notification_widget.success:active.focus,
.notification_widget.success.active.focus,
.open > .dropdown-toggle.notification_widget.success.focus {
  color: #fff;
  background-color: #398439;
  border-color: #255625;
}
.notification_widget.success:active,
.notification_widget.success.active,
.open > .dropdown-toggle.notification_widget.success {
  background-image: none;
}
.notification_widget.success.disabled:hover,
.notification_widget.success[disabled]:hover,
fieldset[disabled] .notification_widget.success:hover,
.notification_widget.success.disabled:focus,
.notification_widget.success[disabled]:focus,
fieldset[disabled] .notification_widget.success:focus,
.notification_widget.success.disabled.focus,
.notification_widget.success[disabled].focus,
fieldset[disabled] .notification_widget.success.focus {
  background-color: #5cb85c;
  border-color: #4cae4c;
}
.notification_widget.success .badge {
  color: #5cb85c;
  background-color: #fff;
}
.notification_widget.info {
  color: #fff;
  background-color: #5bc0de;
  border-color: #46b8da;
}
.notification_widget.info:focus,
.notification_widget.info.focus {
  color: #fff;
  background-color: #31b0d5;
  border-color: #1b6d85;
}
.notification_widget.info:hover {
  color: #fff;
  background-color: #31b0d5;
  border-color: #269abc;
}
.notification_widget.info:active,
.notification_widget.info.active,
.open > .dropdown-toggle.notification_widget.info {
  color: #fff;
  background-color: #31b0d5;
  border-color: #269abc;
}
.notification_widget.info:active:hover,
.notification_widget.info.active:hover,
.open > .dropdown-toggle.notification_widget.info:hover,
.notification_widget.info:active:focus,
.notification_widget.info.active:focus,
.open > .dropdown-toggle.notification_widget.info:focus,
.notification_widget.info:active.focus,
.notification_widget.info.active.focus,
.open > .dropdown-toggle.notification_widget.info.focus {
  color: #fff;
  background-color: #269abc;
  border-color: #1b6d85;
}
.notification_widget.info:active,
.notification_widget.info.active,
.open > .dropdown-toggle.notification_widget.info {
  background-image: none;
}
.notification_widget.info.disabled:hover,
.notification_widget.info[disabled]:hover,
fieldset[disabled] .notification_widget.info:hover,
.notification_widget.info.disabled:focus,
.notification_widget.info[disabled]:focus,
fieldset[disabled] .notification_widget.info:focus,
.notification_widget.info.disabled.focus,
.notification_widget.info[disabled].focus,
fieldset[disabled] .notification_widget.info.focus {
  background-color: #5bc0de;
  border-color: #46b8da;
}
.notification_widget.info .badge {
  color: #5bc0de;
  background-color: #fff;
}
.notification_widget.danger {
  color: #fff;
  background-color: #d9534f;
  border-color: #d43f3a;
}
.notification_widget.danger:focus,
.notification_widget.danger.focus {
  color: #fff;
  background-color: #c9302c;
  border-color: #761c19;
}
.notification_widget.danger:hover {
  color: #fff;
  background-color: #c9302c;
  border-color: #ac2925;
}
.notification_widget.danger:active,
.notification_widget.danger.active,
.open > .dropdown-toggle.notification_widget.danger {
  color: #fff;
  background-color: #c9302c;
  border-color: #ac2925;
}
.notification_widget.danger:active:hover,
.notification_widget.danger.active:hover,
.open > .dropdown-toggle.notification_widget.danger:hover,
.notification_widget.danger:active:focus,
.notification_widget.danger.active:focus,
.open > .dropdown-toggle.notification_widget.danger:focus,
.notification_widget.danger:active.focus,
.notification_widget.danger.active.focus,
.open > .dropdown-toggle.notification_widget.danger.focus {
  color: #fff;
  background-color: #ac2925;
  border-color: #761c19;
}
.notification_widget.danger:active,
.notification_widget.danger.active,
.open > .dropdown-toggle.notification_widget.danger {
  background-image: none;
}
.notification_widget.danger.disabled:hover,
.notification_widget.danger[disabled]:hover,
fieldset[disabled] .notification_widget.danger:hover,
.notification_widget.danger.disabled:focus,
.notification_widget.danger[disabled]:focus,
fieldset[disabled] .notification_widget.danger:focus,
.notification_widget.danger.disabled.focus,
.notification_widget.danger[disabled].focus,
fieldset[disabled] .notification_widget.danger.focus {
  background-color: #d9534f;
  border-color: #d43f3a;
}
.notification_widget.danger .badge {
  color: #d9534f;
  background-color: #fff;
}
div#pager {
  background-color: #fff;
  font-size: 14px;
  line-height: 20px;
  overflow: hidden;
  display: none;
  position: fixed;
  bottom: 0px;
  width: 100%;
  max-height: 50%;
  padding-top: 8px;
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  /* Display over codemirror */
  z-index: 100;
  /* Hack which prevents jquery ui resizable from changing top. */
  top: auto !important;
}
div#pager pre {
  line-height: 1.21429em;
  color: #000;
  background-color: #f7f7f7;
  padding: 0.4em;
}
div#pager #pager-button-area {
  position: absolute;
  top: 8px;
  right: 20px;
}
div#pager #pager-contents {
  position: relative;
  overflow: auto;
  width: 100%;
  height: 100%;
}
div#pager #pager-contents #pager-container {
  position: relative;
  padding: 15px 0px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
div#pager .ui-resizable-handle {
  top: 0px;
  height: 8px;
  background: #f7f7f7;
  border-top: 1px solid #cfcfcf;
  border-bottom: 1px solid #cfcfcf;
  /* This injects handle bars (a short, wide = symbol) for 
        the resize handle. */
}
div#pager .ui-resizable-handle::after {
  content: '';
  top: 2px;
  left: 50%;
  height: 3px;
  width: 30px;
  margin-left: -15px;
  position: absolute;
  border-top: 1px solid #cfcfcf;
}
.quickhelp {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
  line-height: 1.8em;
}
.shortcut_key {
  display: inline-block;
  width: 21ex;
  text-align: right;
  font-family: monospace;
}
.shortcut_descr {
  display: inline-block;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
span.save_widget {
  height: 30px;
  margin-top: 4px;
  display: flex;
  justify-content: flex-start;
  align-items: baseline;
  width: 50%;
  flex: 1;
}
span.save_widget span.filename {
  height: 100%;
  line-height: 1em;
  margin-left: 16px;
  border: none;
  font-size: 146.5%;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
  border-radius: 2px;
}
span.save_widget span.filename:hover {
  background-color: #e6e6e6;
}
[dir="rtl"] span.save_widget.pull-left {
  float: right !important;
  float: right;
}
[dir="rtl"] span.save_widget span.filename {
  margin-left: 0;
  margin-right: 16px;
}
span.checkpoint_status,
span.autosave_status {
  font-size: small;
  white-space: nowrap;
  padding: 0 5px;
}
@media (max-width: 767px) {
  span.save_widget {
    font-size: small;
    padding: 0 0 0 5px;
  }
  span.checkpoint_status,
  span.autosave_status {
    display: none;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  span.checkpoint_status {
    display: none;
  }
  span.autosave_status {
    font-size: x-small;
  }
}
.toolbar {
  padding: 0px;
  margin-left: -5px;
  margin-top: 2px;
  margin-bottom: 5px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
.toolbar select,
.toolbar label {
  width: auto;
  vertical-align: middle;
  margin-right: 2px;
  margin-bottom: 0px;
  display: inline;
  font-size: 92%;
  margin-left: 0.3em;
  margin-right: 0.3em;
  padding: 0px;
  padding-top: 3px;
}
.toolbar .btn {
  padding: 2px 8px;
}
.toolbar .btn-group {
  margin-top: 0px;
  margin-left: 5px;
}
.toolbar-btn-label {
  margin-left: 6px;
}
#maintoolbar {
  margin-bottom: -3px;
  margin-top: -8px;
  border: 0px;
  min-height: 27px;
  margin-left: 0px;
  padding-top: 11px;
  padding-bottom: 3px;
}
#maintoolbar .navbar-text {
  float: none;
  vertical-align: middle;
  text-align: right;
  margin-left: 5px;
  margin-right: 0px;
  margin-top: 0px;
}
.select-xs {
  height: 24px;
}
[dir="rtl"] .btn-group > .btn,
.btn-group-vertical > .btn {
  float: right;
}
.pulse,
.dropdown-menu > li > a.pulse,
li.pulse > a.dropdown-toggle,
li.pulse.open > a.dropdown-toggle {
  background-color: #F37626;
  color: white;
}
/**
 * Primary styles
 *
 * Author: Jupyter Development Team
 */
/** WARNING IF YOU ARE EDITTING THIS FILE, if this is a .css file, It has a lot
 * of chance of beeing generated from the ../less/[samename].less file, you can
 * try to get back the less file by reverting somme commit in history
 **/
/*
 * We'll try to get something pretty, so we
 * have some strange css to have the scroll bar on
 * the left with fix button on the top right of the tooltip
 */
@-moz-keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
@-webkit-keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
@-moz-keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
@-webkit-keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
/*properties of tooltip after "expand"*/
.bigtooltip {
  overflow: auto;
  height: 200px;
  -webkit-transition-property: height;
  -webkit-transition-duration: 500ms;
  -moz-transition-property: height;
  -moz-transition-duration: 500ms;
  transition-property: height;
  transition-duration: 500ms;
}
/*properties of tooltip before "expand"*/
.smalltooltip {
  -webkit-transition-property: height;
  -webkit-transition-duration: 500ms;
  -moz-transition-property: height;
  -moz-transition-duration: 500ms;
  transition-property: height;
  transition-duration: 500ms;
  text-overflow: ellipsis;
  overflow: hidden;
  height: 80px;
}
.tooltipbuttons {
  position: absolute;
  padding-right: 15px;
  top: 0px;
  right: 0px;
}
.tooltiptext {
  /*avoid the button to overlap on some docstring*/
  padding-right: 30px;
}
.ipython_tooltip {
  max-width: 700px;
  /*fade-in animation when inserted*/
  -webkit-animation: fadeOut 400ms;
  -moz-animation: fadeOut 400ms;
  animation: fadeOut 400ms;
  -webkit-animation: fadeIn 400ms;
  -moz-animation: fadeIn 400ms;
  animation: fadeIn 400ms;
  vertical-align: middle;
  background-color: #f7f7f7;
  overflow: visible;
  border: #ababab 1px solid;
  outline: none;
  padding: 3px;
  margin: 0px;
  padding-left: 7px;
  font-family: monospace;
  min-height: 50px;
  -moz-box-shadow: 0px 6px 10px -1px #adadad;
  -webkit-box-shadow: 0px 6px 10px -1px #adadad;
  box-shadow: 0px 6px 10px -1px #adadad;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
}
.ipython_tooltip a {
  float: right;
}
.ipython_tooltip .tooltiptext pre {
  border: 0;
  border-radius: 0;
  font-size: 100%;
  background-color: #f7f7f7;
}
.pretooltiparrow {
  left: 0px;
  margin: 0px;
  top: -16px;
  width: 40px;
  height: 16px;
  overflow: hidden;
  position: absolute;
}
.pretooltiparrow:before {
  background-color: #f7f7f7;
  border: 1px #ababab solid;
  z-index: 11;
  content: "";
  position: absolute;
  left: 15px;
  top: 10px;
  width: 25px;
  height: 25px;
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  -o-transform: rotate(45deg);
}
ul.typeahead-list i {
  margin-left: -10px;
  width: 18px;
}
[dir="rtl"] ul.typeahead-list i {
  margin-left: 0;
  margin-right: -10px;
}
ul.typeahead-list {
  max-height: 80vh;
  overflow: auto;
}
ul.typeahead-list > li > a {
  /** Firefox bug **/
  /* see https://github.com/jupyter/notebook/issues/559 */
  white-space: normal;
}
ul.typeahead-list  > li > a.pull-right {
  float: left !important;
  float: left;
}
[dir="rtl"] .typeahead-list {
  text-align: right;
}
.cmd-palette .modal-body {
  padding: 7px;
}
.cmd-palette form {
  background: white;
}
.cmd-palette input {
  outline: none;
}
.no-shortcut {
  min-width: 20px;
  color: transparent;
}
[dir="rtl"] .no-shortcut.pull-right {
  float: left !important;
  float: left;
}
[dir="rtl"] .command-shortcut.pull-right {
  float: left !important;
  float: left;
}
.command-shortcut:before {
  content: "(command mode)";
  padding-right: 3px;
  color: #777777;
}
.edit-shortcut:before {
  content: "(edit)";
  padding-right: 3px;
  color: #777777;
}
[dir="rtl"] .edit-shortcut.pull-right {
  float: left !important;
  float: left;
}
#find-and-replace #replace-preview .match,
#find-and-replace #replace-preview .insert {
  background-color: #BBDEFB;
  border-color: #90CAF9;
  border-style: solid;
  border-width: 1px;
  border-radius: 0px;
}
[dir="ltr"] #find-and-replace .input-group-btn + .form-control {
  border-left: none;
}
[dir="rtl"] #find-and-replace .input-group-btn + .form-control {
  border-right: none;
}
#find-and-replace #replace-preview .replace .match {
  background-color: #FFCDD2;
  border-color: #EF9A9A;
  border-radius: 0px;
}
#find-and-replace #replace-preview .replace .insert {
  background-color: #C8E6C9;
  border-color: #A5D6A7;
  border-radius: 0px;
}
#find-and-replace #replace-preview {
  max-height: 60vh;
  overflow: auto;
}
#find-and-replace #replace-preview pre {
  padding: 5px 10px;
}
.terminal-app {
  background: #EEE;
}
.terminal-app #header {
  background: #fff;
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
}
.terminal-app .terminal {
  width: 100%;
  float: left;
  font-family: monospace;
  color: white;
  background: black;
  padding: 0.4em;
  border-radius: 2px;
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.4);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.4);
}
.terminal-app .terminal,
.terminal-app .terminal dummy-screen {
  line-height: 1em;
  font-size: 14px;
}
.terminal-app .terminal .xterm-rows {
  padding: 10px;
}
.terminal-app .terminal-cursor {
  color: black;
  background: white;
}
.terminal-app #terminado-container {
  margin-top: 20px;
}
/*# sourceMappingURL=style.min.css.map */
    </style>
<style type="text/css">
    .highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
<style type="text/css">
    
/* Temporary definitions which will become obsolete with Notebook release 5.0 */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }

    </style>


<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
body {
  overflow: visible;
  padding: 8px;
}

div#notebook {
  overflow: visible;
  border-top: none;
}@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  } 
  div.output_wrapper { 
    display: block;
    page-break-inside: avoid; 
  }
  div.output { 
    display: block;
    page-break-inside: avoid; 
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="custom.css">

<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --></head>
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Problem-Statement">Problem Statement<a class="anchor-link" href="#Problem-Statement">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Business-Context">Business Context<a class="anchor-link" href="#Business-Context">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The healthcare industry is rapidly evolving, with professionals facing increasing challenges in managing vast volumes of medical data while delivering accurate and timely diagnoses. The need for quick access to comprehensive, reliable, and up-to-date medical knowledge is critical for improving patient outcomes and ensuring informed decision-making in a fast-paced environment.</p>
<p>Healthcare professionals often encounter information overload, struggling to sift through extensive research and data to create accurate diagnoses and treatment plans. This challenge is amplified by the need for efficiency, particularly in emergencies, where time-sensitive decisions are vital. Furthermore, access to trusted, current medical information from renowned manuals and research papers is essential for maintaining high standards of care.</p>
<p>To address these challenges, healthcare centers can focus on integrating systems that streamline access to medical knowledge, provide tools to support quick decision-making, and enhance efficiency. Leveraging centralized knowledge platforms and ensuring healthcare providers have continuous access to reliable resources can significantly improve patient care and operational effectiveness.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Common Questions to Answer</strong></p>
<p><strong>1. Diagnostic Assistance</strong>: "What are the common symptoms and treatments for pulmonary embolism?"</p>
<p><strong>2. Drug Information</strong>: "Can you provide the trade names of medications used for treating hypertension?"</p>
<p><strong>3. Treatment Plans</strong>: "What are the first-line options and alternatives for managing rheumatoid arthritis?"</p>
<p><strong>4. Specialty Knowledge</strong>: "What are the diagnostic steps for suspected endocrine disorders?"</p>
<p><strong>5. Critical Care Protocols</strong>: "What is the protocol for managing sepsis in a critical care unit?"</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Objective">Objective<a class="anchor-link" href="#Objective">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As an AI specialist, your task is to develop a RAG-based AI solution using renowned medical manuals to address healthcare challenges. The objective is to <strong>understand</strong> issues like information overload, <strong>apply</strong> AI techniques to streamline decision-making, <strong>analyze</strong> its impact on diagnostics and patient outcomes, <strong>evaluate</strong> its potential to standardize care practices, and <strong>create</strong> a functional prototype demonstrating its feasibility and effectiveness.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Data-Description">Data Description<a class="anchor-link" href="#Data-Description">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <strong>Merck Manuals</strong> are medical references published by the American pharmaceutical company Merck &amp; Co., that cover a wide range of medical topics, including disorders, tests, diagnoses, and drugs. The manuals have been published since 1899, when Merck &amp; Co. was still a subsidiary of the German company Merck.</p>
<p>The manual is provided as a PDF with over 4,000 pages divided into 23 sections.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Installing-and-Importing-Necessary-Libraries-and-Dependencies">Installing and Importing Necessary Libraries and Dependencies<a class="anchor-link" href="#Installing-and-Importing-Necessary-Libraries-and-Dependencies">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Environment Note
The following cell includes installation steps for llama-cpp-python intended for Google Colab.
This project is executed locally on an NVIDIA RTX 5090 (Blackwell) using a PyTorch + Hugging Face stack within a preconfigured GPU environment.
As a result, runtime package compilation steps are skipped to preserve environment stability.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Installation for GPU llama-cpp-python</span>
<span class="c1"># uncomment and run the following code in case GPU is being used</span>
<span class="c1">#!CMAKE_ARGS=&quot;-DLLAMA_CUBLAS=on&quot; FORCE_CMAKE=1 pip install llama-cpp-python==0.2.28 --force-reinstall --no-cache-dir -q</span>

<span class="c1"># Installation for CPU llama-cpp-python</span>
<span class="c1"># uncomment and run the following code in case GPU is not being used</span>
<span class="c1"># !CMAKE_ARGS=&quot;-DLLAMA_CUBLAS=off&quot; FORCE_CMAKE=1 pip install llama-cpp-python==0.2.28 --force-reinstall --no-cache-dir -q</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note</strong>:</p>
<ul>
<li>After running the above cell, kindly restart the runtime (for Google Colab) or notebook kernel (for Jupyter Notebook), and run all cells sequentially from the next cell.</li>
<li>On executing the above line of code, you might see a warning regarding package dependencies. This error message can be ignored as the above code ensures that all necessary libraries and their dependencies are maintained to successfully execute the code in <strong><em>this notebook</em></strong>.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 0A  SYSTEM BOOT &amp; FORENSIC TELEMETRY</span>
<span class="c1"># ============================================================</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># CORE SYSTEM</span>
<span class="c1"># ----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="k">import</span> <span class="n">metadata</span> <span class="k">as</span> <span class="n">importlib_metadata</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PERFORMANCE &amp; MEMORY</span>
<span class="c1"># ----------------------------</span>
<span class="kn">import</span> <span class="nn">psutil</span>
<span class="kn">import</span> <span class="nn">tracemalloc</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># GLOBAL RUNTIME</span>
<span class="c1"># ----------------------------</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="k">import</span> <span class="n">get_ipython</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># REPRODUCIBILITY</span>
<span class="c1"># ----------------------------</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># GPU / CUDA</span>
<span class="c1"># ----------------------------</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># NVIDIA telemetry</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pynvml</span>
    <span class="n">pynvml</span><span class="o">.</span><span class="n">nvmlInit</span><span class="p">()</span>
    <span class="n">NVML_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">NVML_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># DATA / EDA</span>
<span class="c1"># ----------------------------</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># DOCUMENT PROCESSING</span>
<span class="c1"># ----------------------------</span>
<span class="kn">import</span> <span class="nn">fitz</span>  <span class="c1"># PyMuPDF</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">tiktoken</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Dict</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EMBEDDINGS &amp; VECTOR DB</span>
<span class="c1"># ----------------------------</span>
<span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="k">import</span> <span class="n">SentenceTransformer</span>
<span class="kn">import</span> <span class="nn">chromadb</span>
<span class="kn">from</span> <span class="nn">chromadb.config</span> <span class="k">import</span> <span class="n">Settings</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LLM &amp; HF STACK</span>
<span class="c1"># ----------------------------</span>
<span class="kn">from</span> <span class="nn">llama_cpp</span> <span class="k">import</span> <span class="n">Llama</span>
<span class="kn">import</span> <span class="nn">transformers</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="k">import</span> <span class="n">AutoTokenizer</span><span class="p">,</span> <span class="n">AutoModelForCausalLM</span>
<span class="kn">import</span> <span class="nn">accelerate</span>
<span class="kn">from</span> <span class="nn">huggingface_hub</span> <span class="k">import</span> <span class="n">hf_hub_download</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EVALUATION</span>
<span class="c1"># ----------------------------</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">classification_report</span>

<span class="c1"># ============================================================</span>
<span class="c1"># PROJECT ROOT NORMALIZATION</span>
<span class="c1"># ============================================================</span>

<span class="n">PROJECT_ROOT</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">)</span>

<span class="c1"># ============================================================</span>
<span class="c1"># GLOBAL CLOCKS &amp; SEEDS</span>
<span class="c1"># ============================================================</span>

<span class="n">NOTEBOOK_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">NOTEBOOK_START_UTC</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s2">&quot;seconds&quot;</span><span class="p">)</span>

<span class="n">SEED</span> <span class="o">=</span> <span class="mi">72</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed_all</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>

<span class="c1"># Start memory tracking early (Python allocations only)</span>
<span class="n">tracemalloc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># ============================================================</span>
<span class="c1"># PERSISTENT GLOBAL RUNTIME HUD (CELL + GLOBAL TIMING)</span>
<span class="c1"># ============================================================</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="k">import</span> <span class="n">get_ipython</span>

<span class="n">_ip</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>

<span class="c1"># Persistent timing state (lives for entire kernel session)</span>
<span class="n">_NEUROFORGE_LAST_CELL_START</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_NEUROFORGE_TOTAL_EXEC_TIME</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># accumulates ONLY execution time</span>

<span class="k">def</span> <span class="nf">_neuroforge_pre_cell</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs immediately before every cell execution.</span>
<span class="sd">    Captures the cell start time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_NEUROFORGE_LAST_CELL_START</span>
    <span class="n">_NEUROFORGE_LAST_CELL_START</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_neuroforge_post_cell</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs immediately after every cell execution.</span>
<span class="sd">    Prints per-cell execution time and accumulated execution time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_NEUROFORGE_TOTAL_EXEC_TIME</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Per-cell timing</span>
        <span class="k">if</span> <span class="n">_NEUROFORGE_LAST_CELL_START</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cell_elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">_NEUROFORGE_LAST_CELL_START</span>
            <span class="n">_NEUROFORGE_TOTAL_EXEC_TIME</span> <span class="o">+=</span> <span class="n">cell_elapsed</span>
            <span class="n">cell_label</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{cell_elapsed:6.3f}</span><span class="s2">s&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Only happens on bootstrap</span>
            <span class="n">cell_elapsed</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">cell_label</span> <span class="o">=</span> <span class="s2">&quot;0.000s*&quot;</span>

        <span class="c1"># System utilization</span>
        <span class="n">cpu_pct</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">mem_pct</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">percent</span>

        <span class="c1"># GPU telemetry (safe, last NVML snapshot)</span>
        <span class="n">gpu_util</span> <span class="o">=</span> <span class="n">gpu_nvml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;util_gpu_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">)</span>
        <span class="n">gpu_temp</span> <span class="o">=</span> <span class="n">gpu_nvml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_c&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> CPU  </span><span class="si">{cpu_pct:5.1f}</span><span class="s2">% | &quot;</span>
            <span class="n">f</span><span class="s2">&quot; Mem  </span><span class="si">{mem_pct:5.1f}</span><span class="s2">% | &quot;</span>
            <span class="n">f</span><span class="s2">&quot; GPU  </span><span class="si">{gpu_util:&gt;4}</span><span class="s2">% @ </span><span class="si">{gpu_temp}</span><span class="s2">C | &quot;</span>
            <span class="n">f</span><span class="s2">&quot; cell </span><span class="si">{cell_label}</span><span class="s2"> | &quot;</span>
            <span class="n">f</span><span class="s2">&quot; total </span><span class="si">{_NEUROFORGE_TOTAL_EXEC_TIME:7.2f}</span><span class="s2">s&quot;</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Telemetry must never break execution</span>
        <span class="k">pass</span>

<span class="c1"># Register hooks (idempotent and safe)</span>
<span class="k">if</span> <span class="n">_ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_ip</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="s2">&quot;pre_run_cell&quot;</span><span class="p">,</span> <span class="n">_neuroforge_pre_cell</span><span class="p">)</span>
        <span class="n">_ip</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="s2">&quot;post_run_cell&quot;</span><span class="p">,</span> <span class="n">_neuroforge_post_cell</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">_ip</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;pre_run_cell&quot;</span><span class="p">,</span> <span class="n">_neuroforge_pre_cell</span><span class="p">)</span>
    <span class="n">_ip</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;post_run_cell&quot;</span><span class="p">,</span> <span class="n">_neuroforge_post_cell</span><span class="p">)</span>
    
<span class="c1"># ============================================================</span>
<span class="c1"># FORENSIC HELPERS</span>
<span class="c1"># ============================================================</span>

<span class="n">PROC</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">now_utc</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s2">&quot;seconds&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bytes_to_gb</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bytes_to_mb</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">safe_run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">stdout</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">stderr</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">err</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;ERROR: </span><span class="si">{e}</span><span class="s2">&quot;</span>

<span class="k">def</span> <span class="nf">pkg_ver</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">importlib_metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">wsl_detect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">rel</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">plat</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;is_wsl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;microsoft&quot;</span> <span class="ow">in</span> <span class="n">rel</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;wsl&quot;</span> <span class="ow">in</span> <span class="n">rel</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;microsoft&quot;</span> <span class="ow">in</span> <span class="n">plat</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;wsl&quot;</span> <span class="ow">in</span> <span class="n">plat</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
        <span class="s2">&quot;release&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">proc_snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mem</span> <span class="o">=</span> <span class="n">PROC</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;pid&quot;</span><span class="p">:</span> <span class="n">PROC</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span>
            <span class="s2">&quot;rss_mb&quot;</span><span class="p">:</span> <span class="n">bytes_to_mb</span><span class="p">(</span><span class="n">mem</span><span class="o">.</span><span class="n">rss</span><span class="p">),</span>
            <span class="s2">&quot;vms_mb&quot;</span><span class="p">:</span> <span class="n">bytes_to_mb</span><span class="p">(</span><span class="n">mem</span><span class="o">.</span><span class="n">vms</span><span class="p">),</span>
            <span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">PROC</span><span class="o">.</span><span class="n">num_threads</span><span class="p">(),</span>
            <span class="s2">&quot;cpu_percent_process&quot;</span><span class="p">:</span> <span class="n">PROC</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

<span class="k">def</span> <span class="nf">sys_mem_snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vm</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">swap_memory</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;ram_total_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">vm</span><span class="o">.</span><span class="n">total</span><span class="p">),</span>
            <span class="s2">&quot;ram_available_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">vm</span><span class="o">.</span><span class="n">available</span><span class="p">),</span>
            <span class="s2">&quot;ram_used_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">vm</span><span class="o">.</span><span class="n">used</span><span class="p">),</span>
            <span class="s2">&quot;ram_percent&quot;</span><span class="p">:</span> <span class="n">vm</span><span class="o">.</span><span class="n">percent</span><span class="p">,</span>
            <span class="s2">&quot;swap_total_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">total</span><span class="p">),</span>
            <span class="s2">&quot;swap_used_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">used</span><span class="p">),</span>
            <span class="s2">&quot;swap_percent&quot;</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">percent</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

<span class="k">def</span> <span class="nf">disk_snapshot</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">du</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span>
            <span class="s2">&quot;total_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">total</span><span class="p">),</span>
            <span class="s2">&quot;used_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">used</span><span class="p">),</span>
            <span class="s2">&quot;free_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">free</span><span class="p">),</span>
            <span class="s2">&quot;percent&quot;</span><span class="p">:</span> <span class="n">du</span><span class="o">.</span><span class="n">percent</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

<span class="k">def</span> <span class="nf">nvml_snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">NVML_AVAILABLE</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">nvmlDeviceGetHandleByIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mem</span> <span class="o">=</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">nvmlDeviceGetMemoryInfo</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">util</span> <span class="o">=</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">nvmlDeviceGetUtilizationRates</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">power</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">sm_clock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">mem_clock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">nvmlDeviceGetTemperature</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">NVML_TEMPERATURE_GPU</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">power</span> <span class="o">=</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">nvmlDeviceGetPowerUsage</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sm_clock</span> <span class="o">=</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">nvmlDeviceGetClockInfo</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">NVML_CLOCK_SM</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mem_clock</span> <span class="o">=</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">nvmlDeviceGetClockInfo</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">pynvml</span><span class="o">.</span><span class="n">NVML_CLOCK_MEM</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;memory_used_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">mem</span><span class="o">.</span><span class="n">used</span><span class="p">),</span>
            <span class="s2">&quot;memory_free_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">mem</span><span class="o">.</span><span class="n">free</span><span class="p">),</span>
            <span class="s2">&quot;memory_total_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">mem</span><span class="o">.</span><span class="n">total</span><span class="p">),</span>
            <span class="s2">&quot;util_gpu_pct&quot;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">gpu</span><span class="p">,</span>
            <span class="s2">&quot;util_mem_pct&quot;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span>
            <span class="s2">&quot;temp_c&quot;</span><span class="p">:</span> <span class="n">temp</span><span class="p">,</span>
            <span class="s2">&quot;power_w&quot;</span><span class="p">:</span> <span class="n">power</span><span class="p">,</span>
            <span class="s2">&quot;sm_clock_mhz&quot;</span><span class="p">:</span> <span class="n">sm_clock</span><span class="p">,</span>
            <span class="s2">&quot;mem_clock_mhz&quot;</span><span class="p">:</span> <span class="n">mem_clock</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

<span class="k">def</span> <span class="nf">torch_gpu_snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;cuda_available&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">(),</span>
        <span class="s2">&quot;torch_version&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
        <span class="s2">&quot;torch_cuda_compiled&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">cuda</span><span class="p">,</span>
        <span class="s2">&quot;torch_cuda_arch_list_env&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;TORCH_CUDA_ARCH_LIST&quot;</span><span class="p">),</span>
        <span class="s2">&quot;cudnn_version&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">torch.backends.cudnn</span> <span class="k">as</span> <span class="nn">cudnn</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cudnn_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cudnn</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_properties</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;gpu_count&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">device_count</span><span class="p">(),</span>
            <span class="s2">&quot;gpu_index&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">current_device</span><span class="p">(),</span>
            <span class="s2">&quot;gpu_name&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;gpu_capability&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_capability</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;gpu_total_mem_gb&quot;</span><span class="p">:</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">total_memory</span><span class="p">),</span>
            <span class="s2">&quot;gpu_multi_processor_count&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s2">&quot;multi_processor_count&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">})</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;torch_mem_allocated_gb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">memory_allocated</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;torch_mem_reserved_gb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bytes_to_gb</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">memory_reserved</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">info</span>

<span class="k">def</span> <span class="nf">micro_gpu_sanity</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Tiny GPU compute test to confirm device execution (safe + fast).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;ran&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;cuda_not_available&quot;</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">@</span> <span class="n">b</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;ran&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;seconds&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">],</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="s2">&quot;float16&quot;</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;ran&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

<span class="k">def</span> <span class="nf">format_kv_block</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{pad}{k:34s}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">check_write_access</span><span class="p">(</span><span class="n">out_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">out_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="s2">&quot;__write_test.tmp&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">fsync</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

<span class="c1"># ============================================================</span>
<span class="c1"># SYSTEM SNAPSHOT</span>
<span class="c1"># ============================================================</span>

<span class="n">wsl</span> <span class="o">=</span> <span class="n">wsl_detect</span><span class="p">()</span>
<span class="n">system_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
    <span class="s2">&quot;python_version&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
    <span class="s2">&quot;python_version_short&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">(),</span>
    <span class="s2">&quot;release&quot;</span><span class="p">:</span> <span class="n">wsl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;release&quot;</span><span class="p">),</span>
    <span class="s2">&quot;is_wsl&quot;</span><span class="p">:</span> <span class="n">wsl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_wsl&quot;</span><span class="p">),</span>
    <span class="s2">&quot;machine&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">machine</span><span class="p">(),</span>
    <span class="s2">&quot;processor&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">processor</span><span class="p">(),</span>
    <span class="s2">&quot;cpu_count_logical&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(</span><span class="n">logical</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="s2">&quot;cpu_count_physical&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(</span><span class="n">logical</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="s2">&quot;cwd&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()),</span>
    <span class="s2">&quot;env_virtual_env&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;VIRTUAL_ENV&quot;</span><span class="p">),</span>
    <span class="s2">&quot;env_conda_prefix&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CONDA_PREFIX&quot;</span><span class="p">),</span>
    <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="n">SEED</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># ============================================================</span>
<span class="c1"># GPU SNAPSHOT</span>
<span class="c1"># ============================================================</span>

<span class="n">gpu_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch_gpu_snapshot</span><span class="p">()</span>
<span class="n">gpu_nvml</span> <span class="o">=</span> <span class="n">nvml_snapshot</span><span class="p">()</span>
<span class="n">gpu_sanity</span> <span class="o">=</span> <span class="n">micro_gpu_sanity</span><span class="p">()</span>

<span class="c1"># ============================================================</span>
<span class="c1"># TOOLING SNAPSHOT</span>
<span class="c1"># ============================================================</span>

<span class="n">tooling</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;nvidia_smi_driver&quot;</span><span class="p">:</span> <span class="n">safe_run</span><span class="p">([</span><span class="s2">&quot;nvidia-smi&quot;</span><span class="p">,</span> <span class="s2">&quot;--query-gpu=driver_version&quot;</span><span class="p">,</span> <span class="s2">&quot;--format=csv,noheader&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;nvidia_smi_name&quot;</span><span class="p">:</span> <span class="n">safe_run</span><span class="p">([</span><span class="s2">&quot;nvidia-smi&quot;</span><span class="p">,</span> <span class="s2">&quot;--query-gpu=name&quot;</span><span class="p">,</span> <span class="s2">&quot;--format=csv,noheader&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;nvidia_smi_cuda&quot;</span><span class="p">:</span> <span class="n">safe_run</span><span class="p">([</span><span class="s2">&quot;nvidia-smi&quot;</span><span class="p">,</span> <span class="s2">&quot;--query-gpu=cuda_version&quot;</span><span class="p">,</span> <span class="s2">&quot;--format=csv,noheader&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;nvcc_version_raw&quot;</span><span class="p">:</span> <span class="n">safe_run</span><span class="p">([</span><span class="s2">&quot;nvcc&quot;</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;pip_version&quot;</span><span class="p">:</span> <span class="n">safe_run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;pip&quot;</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">]),</span>
<span class="p">}</span>

<span class="c1"># ============================================================</span>
<span class="c1"># LIBRARY VERSIONS (AUTHORITATIVE)</span>
<span class="c1"># ============================================================</span>

<span class="n">lib_versions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;torch&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
    <span class="s2">&quot;transformers&quot;</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
    <span class="s2">&quot;accelerate&quot;</span><span class="p">:</span> <span class="n">accelerate</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
    <span class="s2">&quot;sentence_transformers&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;sentence-transformers&quot;</span><span class="p">),</span>
    <span class="s2">&quot;chromadb&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;chromadb&quot;</span><span class="p">),</span>
    <span class="s2">&quot;llama_cpp_python&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;llama-cpp-python&quot;</span><span class="p">),</span>
    <span class="s2">&quot;pydantic&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;pydantic&quot;</span><span class="p">),</span>
    <span class="s2">&quot;protobuf&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;protobuf&quot;</span><span class="p">),</span>
    <span class="s2">&quot;pymupdf&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;PyMuPDF&quot;</span><span class="p">),</span>
    <span class="s2">&quot;tiktoken&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;tiktoken&quot;</span><span class="p">),</span>
    <span class="s2">&quot;numpy&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;numpy&quot;</span><span class="p">),</span>
    <span class="s2">&quot;pandas&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;pandas&quot;</span><span class="p">),</span>
    <span class="s2">&quot;matplotlib&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">),</span>
    <span class="s2">&quot;seaborn&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;seaborn&quot;</span><span class="p">),</span>
    <span class="s2">&quot;psutil&quot;</span><span class="p">:</span> <span class="n">pkg_ver</span><span class="p">(</span><span class="s2">&quot;psutil&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># ============================================================</span>
<span class="c1"># FLAGSHIP VALIDATION LOGIC (ROBUST &amp; DYNAMIC)</span>
<span class="c1"># ============================================================</span>

<span class="n">python_ver</span> <span class="o">=</span> <span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;python_version_short&quot;</span><span class="p">]</span>
<span class="n">venv_path</span> <span class="o">=</span> <span class="n">system_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env_virtual_env&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
<span class="n">gpu_name</span> <span class="o">=</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gpu_name&quot;</span><span class="p">)</span>
<span class="n">gpu_cap</span> <span class="o">=</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gpu_capability&quot;</span><span class="p">)</span>
<span class="n">cuda_compiled</span> <span class="o">=</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;torch_cuda_compiled&quot;</span><span class="p">)</span>

<span class="c1"># Parse driver and toolkit signals if present</span>
<span class="n">driver_ok</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nvidia_smi_driver&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nvidia_smi_driver&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
<span class="n">nvcc_ok</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nvcc_version_raw&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nvcc_version_raw&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>

<span class="c1"># Helper for semver-ish compare (minimal)</span>
<span class="k">def</span> <span class="nf">major</span><span class="p">(</span><span class="n">version_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">version_str</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version_str</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Runtime truth</span>
    <span class="s2">&quot;python_ok_3_10&quot;</span><span class="p">:</span> <span class="n">python_ver</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;3.10&quot;</span><span class="p">),</span>
    <span class="s2">&quot;venv_active&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">venv_path</span><span class="p">),</span>
    <span class="s2">&quot;venv_is_visionlab&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;visionlab&quot;</span> <span class="ow">in</span> <span class="n">venv_path</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">if</span> <span class="n">venv_path</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;wsl_detected&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">system_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_wsl&quot;</span><span class="p">)),</span>

    <span class="c1"># GPU truth</span>
    <span class="s2">&quot;cuda_available&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cuda_available&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;gpu_name_detected&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">gpu_name</span><span class="p">),</span>
    <span class="s2">&quot;gpu_is_rtx_5090&quot;</span><span class="p">:</span> <span class="p">((</span><span class="s2">&quot;5090&quot;</span> <span class="ow">in</span> <span class="n">gpu_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">gpu_name</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span>
    <span class="s2">&quot;gpu_capability_is_sm120&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">gpu_cap</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">if</span> <span class="n">gpu_cap</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;torch_cuda_compiled_is_13&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cuda_compiled</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;13&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">cuda_compiled</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span>
    <span class="s2">&quot;nvml_available&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">gpu_nvml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;available&quot;</span><span class="p">)),</span>

    <span class="c1"># Tooling truth</span>
    <span class="s2">&quot;nvidia_smi_available&quot;</span><span class="p">:</span> <span class="n">driver_ok</span><span class="p">,</span>
    <span class="s2">&quot;nvcc_available&quot;</span><span class="p">:</span> <span class="n">nvcc_ok</span><span class="p">,</span>

    <span class="c1"># Library contract truth</span>
    <span class="s2">&quot;protobuf_major_is_4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">major</span><span class="p">(</span><span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protobuf&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">4</span><span class="p">),</span>
    <span class="s2">&quot;pydantic_major_is_2&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">major</span><span class="p">(</span><span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pydantic&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">),</span>
    <span class="s2">&quot;sentence_transformers_present&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sentence_transformers&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;chromadb_present&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chromadb&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;llama_cpp_present&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;llama_cpp_python&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;pymupdf_present&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pymupdf&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;tiktoken_present&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tiktoken&quot;</span><span class="p">)),</span>

    <span class="c1"># Execution sanity</span>
    <span class="s2">&quot;gpu_micro_compute_ok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">gpu_sanity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ran&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gpu_sanity</span><span class="p">)),</span>
<span class="p">}</span>

<span class="c1"># Required gates (non-negotiable for Phase II)</span>
<span class="n">required_gates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;python_ok_3_10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;venv_active&quot;</span><span class="p">,</span>
    <span class="s2">&quot;venv_is_visionlab&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cuda_available&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gpu_is_rtx_5090&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gpu_capability_is_sm120&quot;</span><span class="p">,</span>
    <span class="s2">&quot;torch_cuda_compiled_is_13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;protobuf_major_is_4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pydantic_major_is_2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sentence_transformers_present&quot;</span><span class="p">,</span>
    <span class="s2">&quot;chromadb_present&quot;</span><span class="p">,</span>
    <span class="s2">&quot;llama_cpp_present&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pymupdf_present&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tiktoken_present&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gpu_micro_compute_ok&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">validation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required_gates</span><span class="p">)</span>

<span class="c1"># ============================================================</span>
<span class="c1"># FORENSIC MANIFEST WRITE</span>
<span class="c1"># ============================================================</span>

<span class="n">OUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>
<span class="n">write_access</span> <span class="o">=</span> <span class="n">check_write_access</span><span class="p">(</span><span class="n">OUT_DIR</span><span class="p">)</span>

<span class="n">manifest</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;0A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;notebook_start_utc&quot;</span><span class="p">:</span> <span class="n">NOTEBOOK_START_UTC</span><span class="p">,</span>
    <span class="s2">&quot;notebook_start_perf_counter&quot;</span><span class="p">:</span> <span class="n">NOTEBOOK_START_TS</span><span class="p">,</span>
    <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="p">,</span>
    <span class="s2">&quot;process&quot;</span><span class="p">:</span> <span class="n">proc_snapshot</span><span class="p">(),</span>
    <span class="s2">&quot;system_memory&quot;</span><span class="p">:</span> <span class="n">sys_mem_snapshot</span><span class="p">(),</span>
    <span class="s2">&quot;disk&quot;</span><span class="p">:</span> <span class="n">disk_snapshot</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gpu&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="p">,</span>
    <span class="s2">&quot;gpu_nvml&quot;</span><span class="p">:</span> <span class="n">gpu_nvml</span><span class="p">,</span>
    <span class="s2">&quot;gpu_sanity&quot;</span><span class="p">:</span> <span class="n">gpu_sanity</span><span class="p">,</span>
    <span class="s2">&quot;libraries&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="p">,</span>
    <span class="s2">&quot;tooling&quot;</span><span class="p">:</span> <span class="n">tooling</span><span class="p">,</span>
    <span class="s2">&quot;validation&quot;</span><span class="p">:</span> <span class="n">validation</span><span class="p">,</span>
    <span class="s2">&quot;write_access&quot;</span><span class="p">:</span> <span class="n">write_access</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">OUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">OUT_DIR</span> <span class="o">/</span> <span class="s2">&quot;system_boot.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">fsync</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span>

<span class="c1"># ============================================================</span>
<span class="c1"># HUMAN-READABLE FLAGSHIP OUTPUT (ROBUST &amp; DYNAMIC)</span>
<span class="c1"># ============================================================</span>

<span class="k">def</span> <span class="nf">badge</span><span class="p">(</span><span class="n">ok</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot; PASS&quot;</span> <span class="k">if</span> <span class="n">ok</span> <span class="k">else</span> <span class="s2">&quot; FAIL&quot;</span>

<span class="k">def</span> <span class="nf">stage_header</span><span class="p">(</span><span class="n">stage</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;NEUROFORGE72 PIPELINE  </span><span class="si">{stage}</span><span class="s2"> </span><span class="si">{title}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">stage_section</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{name}</span><span class="s2">]&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">stage_status</span><span class="p">(</span><span class="n">stage</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ok</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">success_msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fail_msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{stage}</span><span class="s2">] STATUS&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot; VERIFIED  </span><span class="si">{success_msg}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot; FAILED  </span><span class="si">{fail_msg}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NEUROFORGE72 PIPELINE  STAGE 0A SYSTEM BOOT (LOCAL-FIRST  BLACKLABEL/VISIONLAB)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PROJECT ROOT SET TO:&quot;</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[IDENTITY]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">format_kv_block</span><span class="p">({</span>
    <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;timestamp_utc&quot;</span><span class="p">],</span>
    <span class="s2">&quot;cwd&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;cwd&quot;</span><span class="p">],</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;python_executable&quot;</span><span class="p">],</span>
    <span class="s2">&quot;python_version&quot;</span><span class="p">:</span> <span class="n">python_ver</span><span class="p">,</span>
    <span class="s2">&quot;VIRTUAL_ENV&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env_virtual_env&quot;</span><span class="p">),</span>
    <span class="s2">&quot;CONDA_PREFIX&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env_conda_prefix&quot;</span><span class="p">),</span>
    <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">],</span>
    <span class="s2">&quot;is_wsl&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_wsl&quot;</span><span class="p">),</span>
    <span class="s2">&quot;kernel_release&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;release&quot;</span><span class="p">),</span>
<span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CPU / MEMORY / DISK]&quot;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">manifest</span><span class="p">[</span><span class="s2">&quot;system_memory&quot;</span><span class="p">]</span>
<span class="n">dk</span> <span class="o">=</span> <span class="n">manifest</span><span class="p">[</span><span class="s2">&quot;disk&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">format_kv_block</span><span class="p">({</span>
    <span class="s2">&quot;cpu_logical&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;cpu_count_logical&quot;</span><span class="p">],</span>
    <span class="s2">&quot;cpu_physical&quot;</span><span class="p">:</span> <span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;cpu_count_physical&quot;</span><span class="p">],</span>
    <span class="s2">&quot;ram_total_gb&quot;</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ram_total_gb&quot;</span><span class="p">),</span>
    <span class="s2">&quot;ram_available_gb&quot;</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ram_available_gb&quot;</span><span class="p">),</span>
    <span class="s2">&quot;ram_used_gb&quot;</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ram_used_gb&quot;</span><span class="p">),</span>
    <span class="s2">&quot;ram_percent&quot;</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ram_percent&quot;</span><span class="p">),</span>
    <span class="s2">&quot;disk_path&quot;</span><span class="p">:</span> <span class="n">dk</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">),</span>
    <span class="s2">&quot;disk_free_gb&quot;</span><span class="p">:</span> <span class="n">dk</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;free_gb&quot;</span><span class="p">),</span>
    <span class="s2">&quot;disk_percent&quot;</span><span class="p">:</span> <span class="n">dk</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;percent&quot;</span><span class="p">),</span>
<span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[GPU  TORCH]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">format_kv_block</span><span class="p">({</span>
    <span class="s2">&quot;cuda_available&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cuda_available&quot;</span><span class="p">),</span>
    <span class="s2">&quot;torch_version&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;torch_version&quot;</span><span class="p">),</span>
    <span class="s2">&quot;torch_cuda_compiled&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;torch_cuda_compiled&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gpu_name&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gpu_name&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gpu_capability&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gpu_capability&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gpu_total_mem_gb&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gpu_total_mem_gb&quot;</span><span class="p">),</span>
    <span class="s2">&quot;torch_mem_allocated_gb&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;torch_mem_allocated_gb&quot;</span><span class="p">),</span>
    <span class="s2">&quot;torch_mem_reserved_gb&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;torch_mem_reserved_gb&quot;</span><span class="p">),</span>
    <span class="s2">&quot;TORCH_CUDA_ARCH_LIST&quot;</span><span class="p">:</span> <span class="n">gpu_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;torch_cuda_arch_list_env&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gpu_micro_compute_seconds&quot;</span><span class="p">:</span> <span class="n">gpu_sanity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;seconds&quot;</span><span class="p">),</span>
<span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[GPU  NVML]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">format_kv_block</span><span class="p">(</span><span class="n">gpu_nvml</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[TOOLING]&quot;</span><span class="p">)</span>
<span class="c1"># Keep nvcc concise</span>
<span class="n">nvcc_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="k">if</span> <span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nvcc_version_raw&quot;</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">tooling</span><span class="p">[</span><span class="s2">&quot;nvcc_version_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">nvcc_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">lines</span> <span class="k">else</span> <span class="n">tooling</span><span class="p">[</span><span class="s2">&quot;nvcc_version_raw&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">format_kv_block</span><span class="p">({</span>
    <span class="s2">&quot;nvidia_smi_driver&quot;</span><span class="p">:</span> <span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nvidia_smi_driver&quot;</span><span class="p">),</span>
    <span class="s2">&quot;nvidia_smi_name&quot;</span><span class="p">:</span> <span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nvidia_smi_name&quot;</span><span class="p">),</span>
    <span class="s2">&quot;nvidia_smi_cuda&quot;</span><span class="p">:</span> <span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nvidia_smi_cuda&quot;</span><span class="p">),</span>
    <span class="s2">&quot;nvcc&quot;</span><span class="p">:</span> <span class="n">nvcc_line</span> <span class="k">if</span> <span class="n">nvcc_line</span> <span class="k">else</span> <span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nvcc_version_raw&quot;</span><span class="p">),</span>
    <span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="n">tooling</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pip_version&quot;</span><span class="p">),</span>
<span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[LIBRARIES  CONTRACT]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">format_kv_block</span><span class="p">({</span>
    <span class="s2">&quot;protobuf&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protobuf&quot;</span><span class="p">),</span>
    <span class="s2">&quot;pydantic&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pydantic&quot;</span><span class="p">),</span>
    <span class="s2">&quot;transformers&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transformers&quot;</span><span class="p">),</span>
    <span class="s2">&quot;accelerate&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;accelerate&quot;</span><span class="p">),</span>
    <span class="s2">&quot;sentence-transformers&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sentence_transformers&quot;</span><span class="p">),</span>
    <span class="s2">&quot;chromadb&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chromadb&quot;</span><span class="p">),</span>
    <span class="s2">&quot;llama-cpp-python&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;llama_cpp_python&quot;</span><span class="p">),</span>
    <span class="s2">&quot;PyMuPDF&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pymupdf&quot;</span><span class="p">),</span>
    <span class="s2">&quot;tiktoken&quot;</span><span class="p">:</span> <span class="n">lib_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tiktoken&quot;</span><span class="p">),</span>
<span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[WRITE ACCESS]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">format_kv_block</span><span class="p">({</span>
    <span class="s2">&quot;OUT/manifests writable&quot;</span><span class="p">:</span> <span class="n">write_access</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">),</span>
    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">write_access</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">),</span>
    <span class="s2">&quot;system_boot_json_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">OUT_DIR</span> <span class="o">/</span> <span class="s2">&quot;system_boot.json&quot;</span><span class="p">),</span>
<span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[FLAGSHIP VALIDATION MATRIX]&quot;</span><span class="p">)</span>
<span class="c1"># Print required gates first, then the rest</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Required gates:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required_gates</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;    </span><span class="si">{k:34s}</span><span class="s2">: {badge(bool(validation.get(k)))}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Additional signals:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required_gates</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;    </span><span class="si">{k:34s}</span><span class="s2">: {badge(bool(v))}&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[STAGE 0A] STATUS&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; VERIFIED - BlackLabel / VisionLab runtime  proceeding with pipeline execution.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; FAILED - Runtime validation FAILED  DO NOT PROCEED.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Fix failing gates above, restart kernel, then re-run Stage 0A.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 0A SYSTEM BOOT (LOCAL-FIRST  BLACKLABEL/VISIONLAB)
====================================================================================================

PROJECT ROOT SET TO: /home/daddy72/Blackwell/medical_rag

[IDENTITY]
  timestamp_utc                     : 2025-12-22T03:06:38+00:00
  cwd                               : /home/daddy72/Blackwell/medical_rag
  python_executable                 : /home/daddy72/blackwell/envs/visionlab/bin/python
  python_version                    : 3.10.12
  VIRTUAL_ENV                       : /home/daddy72/blackwell/envs/visionlab
  CONDA_PREFIX                      : None
  platform                          : Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.35
  is_wsl                            : True
  kernel_release                    : 6.6.87.2-microsoft-standard-WSL2

[CPU / MEMORY / DISK]
  cpu_logical                       : 16
  cpu_physical                      : 16
  ram_total_gb                      : 31.34
  ram_available_gb                  : 23.74
  ram_used_gb                       : 7.6
  ram_percent                       : 24.3
  disk_path                         : /home/daddy72/Blackwell/medical_rag
  disk_free_gb                      : 558.27
  disk_percent                      : 41.6

[GPU  TORCH]
  cuda_available                    : True
  torch_version                     : 2.10.0.dev20251102+cu130
  torch_cuda_compiled               : 13.0
  gpu_name                          : NVIDIA GeForce RTX 5090 Laptop GPU
  gpu_capability                    : (12, 0)
  gpu_total_mem_gb                  : 23.89
  torch_mem_allocated_gb            : 0.0
  torch_mem_reserved_gb             : 0.0
  TORCH_CUDA_ARCH_LIST              : None
  gpu_micro_compute_seconds         : 0.5636

[GPU  NVML]
  available                         : True
  memory_used_gb                    : 1.91
  memory_free_gb                    : 21.98
  memory_total_gb                   : 23.89
  util_gpu_pct                      : 5
  util_mem_pct                      : 1
  temp_c                            : 49
  power_w                           : 46.219
  sm_clock_mhz                      : 1597
  mem_clock_mhz                     : 14101

[TOOLING]
  nvidia_smi_driver                 : 581.57
  nvidia_smi_name                   : NVIDIA GeForce RTX 5090 Laptop GPU
  nvidia_smi_cuda                   : Field &#34;cuda_version&#34; is not a valid field to query.
  nvcc                              : Build cuda_13.0.r13.0/compiler.36424714_0
  pip                               : pip 25.3 from /home/daddy72/blackwell/envs/visionlab/lib/python3.10/site-packages/pip (python 3.10)

[LIBRARIES  CONTRACT]
  protobuf                          : 4.25.8
  pydantic                          : 2.12.5
  transformers                      : 4.57.1
  accelerate                        : 1.10.1
  sentence-transformers             : 5.1.2
  chromadb                          : 1.3.5
  llama-cpp-python                  : 0.3.16
  PyMuPDF                           : 1.26.7
  tiktoken                          : 0.12.0

[WRITE ACCESS]
  OUT/manifests writable            : True
  error                             : None
  system_boot_json_path             : OUT/manifests/system_boot.json

[FLAGSHIP VALIDATION MATRIX]
  Required gates:
    python_ok_3_10                    :  PASS
    venv_active                       :  PASS
    venv_is_visionlab                 :  PASS
    cuda_available                    :  PASS
    gpu_is_rtx_5090                   :  PASS
    gpu_capability_is_sm120           :  PASS
    torch_cuda_compiled_is_13         :  PASS
    protobuf_major_is_4               :  PASS
    pydantic_major_is_2               :  PASS
    sentence_transformers_present     :  PASS
    chromadb_present                  :  PASS
    llama_cpp_present                 :  PASS
    pymupdf_present                   :  PASS
    tiktoken_present                  :  PASS
    gpu_micro_compute_ok              :  PASS

  Additional signals:
    wsl_detected                      :  PASS
    gpu_name_detected                 :  PASS
    nvml_available                    :  PASS
    nvidia_smi_available              :  PASS
    nvcc_available                    :  PASS

[STAGE 0A] STATUS
 VERIFIED - BlackLabel / VisionLab runtime  proceeding with pipeline execution.
====================================================================================================

 CPU    6.7% |  Mem   24.3% |  GPU     5% @ 49C |  cell 0.000s* |  total    0.00s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 1A  CORPUS INGESTION (MERCK MANUAL) &amp; FORENSIC FINGERPRINT</span>
<span class="c1"># ============================================================</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># REQUIRED PRECONDITIONS</span>
<span class="c1"># ----------------------------</span>
<span class="c1"># Stage 0A has already executed successfully and created OUT/manifests/system_boot.json</span>
<span class="c1"># Merck Manual PDF is placed at:</span>
<span class="c1">#   data/raw/merck_manual.pdf</span>
<span class="c1">#</span>
<span class="c1"># This stage DOES NOT chunk, embed, or build a vector DB.</span>
<span class="c1"># This stage ONLY ingests, validates, fingerprints, and records corpus truth.</span>

<span class="n">STAGE_1A_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_1A_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PATH CONTRACT</span>
<span class="c1"># ----------------------------</span>
<span class="n">PDF_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/raw/merck_manual.pdf&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>
<span class="n">OUT_CORPUS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/corpus&quot;</span><span class="p">)</span>

<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">OUT_CORPUS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># HELPERS (LOCAL TO THIS STAGE)</span>
<span class="c1"># ----------------------------</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="k">def</span> <span class="nf">sha256_file</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">safe_pdf_open</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Open PDF via PyMuPDF and extract deterministic metadata signals.</span>
<span class="sd">    Returns summary only  raw content stays in later stages.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="c1"># Minimal deterministic checks:</span>
    <span class="n">page_count</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_count</span>

    <span class="c1"># Sample 3 pages (first, middle, last) for a deterministic &quot;readability probe&quot;</span>
    <span class="n">sample_pages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">page_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">page_count</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">page_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">load_page</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="c1"># Keep only a short snippet for logging (avoid huge writes)</span>
            <span class="n">snippet</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">shorten</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()),</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot; ...&quot;</span><span class="p">)</span>
            <span class="n">sample_pages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;page_index&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;chars&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
                <span class="s2">&quot;snippet&quot;</span><span class="p">:</span> <span class="n">snippet</span>
            <span class="p">})</span>

    <span class="c1"># Metadata (may be empty depending on source)</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;page_count&quot;</span><span class="p">:</span> <span class="n">page_count</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="p">,</span>
        <span class="s2">&quot;samples&quot;</span><span class="p">:</span> <span class="n">sample_pages</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">write_json_atomic</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">+</span> <span class="s2">&quot;.tmp&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">fsync</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATE FILE EXISTS</span>
<span class="c1"># ----------------------------</span>
<span class="n">file_exists</span> <span class="o">=</span> <span class="n">PDF_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">file_size_bytes</span> <span class="o">=</span> <span class="n">PDF_PATH</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="k">if</span> <span class="n">file_exists</span> <span class="k">else</span> <span class="kc">None</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># HASH + PDF OPEN VALIDATION</span>
<span class="c1"># ----------------------------</span>
<span class="n">pdf_sha256</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pdf_info</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pdf_open_ok</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">pdf_open_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">file_exists</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pdf_sha256</span> <span class="o">=</span> <span class="n">sha256_file</span><span class="p">(</span><span class="n">PDF_PATH</span><span class="p">)</span>
        <span class="n">pdf_info</span> <span class="o">=</span> <span class="n">safe_pdf_open</span><span class="p">(</span><span class="n">PDF_PATH</span><span class="p">)</span>
        <span class="n">pdf_open_ok</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">pdf_open_ok</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">pdf_open_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># BUILD MANIFEST (CORPUS TRUTH)</span>
<span class="c1"># ----------------------------</span>
<span class="n">corpus_manifest</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;1A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
    <span class="s2">&quot;stage_start_utc&quot;</span><span class="p">:</span> <span class="n">STAGE_1A_START_UTC</span><span class="p">,</span>
    <span class="s2">&quot;pdf_contract&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;expected_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">PDF_PATH</span><span class="p">),</span>
        <span class="s2">&quot;exists&quot;</span><span class="p">:</span> <span class="n">file_exists</span><span class="p">,</span>
        <span class="s2">&quot;size_bytes&quot;</span><span class="p">:</span> <span class="n">file_size_bytes</span><span class="p">,</span>
        <span class="s2">&quot;sha256&quot;</span><span class="p">:</span> <span class="n">pdf_sha256</span><span class="p">,</span>
        <span class="s2">&quot;open_ok&quot;</span><span class="p">:</span> <span class="n">pdf_open_ok</span><span class="p">,</span>
        <span class="s2">&quot;open_error&quot;</span><span class="p">:</span> <span class="n">pdf_open_error</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;pdf_summary&quot;</span><span class="p">:</span> <span class="n">pdf_info</span><span class="p">,</span>
    <span class="s2">&quot;execution&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
        <span class="s2">&quot;cwd&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()),</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES (STRICT)</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_1a_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pdf_exists&quot;</span><span class="p">:</span> <span class="n">file_exists</span><span class="p">,</span>
    <span class="s2">&quot;pdf_open_ok&quot;</span><span class="p">:</span> <span class="n">pdf_open_ok</span><span class="p">,</span>
    <span class="s2">&quot;page_count_reasonable&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">pdf_info</span><span class="p">[</span><span class="s2">&quot;page_count&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">pdf_open_ok</span> <span class="ow">and</span> <span class="n">pdf_info</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Merck manual is huge</span>
    <span class="s2">&quot;sha256_present&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">pdf_sha256</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">stage_1a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span>
    <span class="n">stage_1a_validation</span><span class="p">[</span><span class="s2">&quot;pdf_exists&quot;</span><span class="p">],</span>
    <span class="n">stage_1a_validation</span><span class="p">[</span><span class="s2">&quot;pdf_open_ok&quot;</span><span class="p">],</span>
    <span class="n">stage_1a_validation</span><span class="p">[</span><span class="s2">&quot;sha256_present&quot;</span><span class="p">],</span>
    <span class="n">stage_1a_validation</span><span class="p">[</span><span class="s2">&quot;page_count_reasonable&quot;</span><span class="p">],</span>
<span class="p">])</span>

<span class="n">corpus_manifest</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_1a_validation</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># WRITE ARTIFACTS</span>
<span class="c1"># ----------------------------</span>
<span class="n">manifest_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;corpus_manifest.json&quot;</span>
<span class="n">write_json_atomic</span><span class="p">(</span><span class="n">corpus_manifest</span><span class="p">,</span> <span class="n">manifest_path</span><span class="p">)</span>

<span class="c1"># Also store a lightweight pointer file under OUT/corpus/</span>
<span class="n">pointer_path</span> <span class="o">=</span> <span class="n">OUT_CORPUS</span> <span class="o">/</span> <span class="s2">&quot;corpus_pointer.json&quot;</span>
<span class="n">write_json_atomic</span><span class="p">({</span>
    <span class="s2">&quot;pdf_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">PDF_PATH</span><span class="p">),</span>
    <span class="s2">&quot;sha256&quot;</span><span class="p">:</span> <span class="n">pdf_sha256</span><span class="p">,</span>
    <span class="s2">&quot;page_count&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">pdf_info</span><span class="p">[</span><span class="s2">&quot;page_count&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">pdf_info</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;created_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
<span class="p">},</span> <span class="n">pointer_path</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="k">def</span> <span class="nf">badge</span><span class="p">(</span><span class="n">ok</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot; PASS&quot;</span> <span class="k">if</span> <span class="n">ok</span> <span class="k">else</span> <span class="s2">&quot; FAIL&quot;</span>

<span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">STAGE_1A_START_TS</span>

<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 1A&quot;</span><span class="p">,</span> <span class="s2">&quot;CORPUS INGESTION (MERCK MANUAL)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;CONTRACT&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Expected PDF path     : </span><span class="si">{PDF_PATH}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Exists                : </span><span class="si">{file_exists}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Size (bytes)          : </span><span class="si">{file_size_bytes}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;SHA256                : </span><span class="si">{pdf_sha256}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;PDF open OK           : </span><span class="si">{pdf_open_ok}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;PDF SUMMARY&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">pdf_info</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Page count            : </span><span class="si">{pdf_info[&#39;page_count&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Metadata keys         : {list((pdf_info.get(&#39;metadata&#39;) or </span><span class="si">{}</span><span class="s2">).keys())}&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PDF summary unavailable (PDF missing or failed to open).&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_1a_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:22s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 1A&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_1a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;corpus ingested, fingerprinted, and ready for governance + chunking.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;corpus ingestion failed  fix issues before proceeding.&quot;</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;corpus_manifest.json  : </span><span class="si">{manifest_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;corpus_pointer.json   : </span><span class="si">{pointer_path}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 1A CORPUS INGESTION (MERCK MANUAL)
====================================================================================================

[CONTRACT]
Expected PDF path     : data/raw/merck_manual.pdf
Exists                : True
Size (bytes)          : 20173144
SHA256                : a1b024264d3b345ce67a7893b02ee93e35fea3f11042fa3555bdfa1a93bd278c
PDF open OK           : True

[PDF SUMMARY]
Page count            : 4114
Metadata keys         : [&#39;format&#39;, &#39;title&#39;, &#39;author&#39;, &#39;subject&#39;, &#39;keywords&#39;, &#39;creator&#39;, &#39;producer&#39;, &#39;creationDate&#39;, &#39;modDate&#39;, &#39;trapped&#39;, &#39;encryption&#39;]

[VALIDATION GATES]
pdf_exists            :  PASS
pdf_open_ok           :  PASS
page_count_reasonable :  PASS
sha256_present        :  PASS

[STAGE 1A] STATUS
 VERIFIED  corpus ingested, fingerprinted, and ready for governance + chunking.
====================================================================================================

[ARTIFACTS WRITTEN]
corpus_manifest.json  : OUT/manifests/corpus_manifest.json
corpus_pointer.json   : OUT/corpus/corpus_pointer.json
====================================================================================================

 CPU    6.5% |  Mem   24.3% |  GPU     5% @ 49C |  cell  0.143s |  total    0.14s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 2A  CORPUS GOVERNANCE &amp; SCHEMA</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_2A_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_2A_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>
<span class="n">OUT_CORPUS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/corpus&quot;</span><span class="p">)</span>

<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># DEFINE DOCUMENT SCHEMA</span>
<span class="c1"># ----------------------------</span>
<span class="n">CORPUS_SCHEMA</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;schema_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;merck_manual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;doc_id&quot;</span><span class="p">:</span> <span class="s2">&quot;string (stable, deterministic)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;page_number&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
        <span class="s2">&quot;section&quot;</span><span class="p">:</span> <span class="s2">&quot;string | null&quot;</span><span class="p">,</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;governance_rules&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;ordering&quot;</span><span class="p">:</span> <span class="s2">&quot;page_number asc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;empty_text_policy&quot;</span><span class="p">:</span> <span class="s2">&quot;drop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;normalization&quot;</span><span class="p">:</span> <span class="s2">&quot;strip whitespace, preserve case&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;created_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
<span class="p">}</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD CORPUS POINTER (DEFENSIVE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">pointer_path</span> <span class="o">=</span> <span class="n">OUT_CORPUS</span> <span class="o">/</span> <span class="s2">&quot;corpus_pointer.json&quot;</span>

<span class="n">corpus_pointer</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pointer_exists</span> <span class="o">=</span> <span class="n">pointer_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">pointer_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">pointer_exists</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pointer_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">corpus_pointer</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">pointer_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># BUILD FINGERPRINT (ONLY IF POINTER OK)</span>
<span class="c1"># ----------------------------</span>
<span class="n">schema_bytes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">CORPUS_SCHEMA</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="n">schema_hash</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;hashlib&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">schema_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="n">CORPUS_FINGERPRINT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;merck_manual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pdf_sha256&quot;</span><span class="p">:</span> <span class="n">corpus_pointer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sha256&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">corpus_pointer</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;page_count&quot;</span><span class="p">:</span> <span class="n">corpus_pointer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_count&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">corpus_pointer</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;schema_hash&quot;</span><span class="p">:</span> <span class="n">schema_hash</span><span class="p">,</span>
    <span class="s2">&quot;schema_version&quot;</span><span class="p">:</span> <span class="n">CORPUS_SCHEMA</span><span class="p">[</span><span class="s2">&quot;schema_version&quot;</span><span class="p">],</span>
    <span class="s2">&quot;created_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
<span class="p">}</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_2a_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pointer_exists&quot;</span><span class="p">:</span> <span class="n">pointer_exists</span><span class="p">,</span>
    <span class="s2">&quot;pointer_loaded&quot;</span><span class="p">:</span> <span class="n">corpus_pointer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;pdf_sha256_present&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">CORPUS_FINGERPRINT</span><span class="p">[</span><span class="s2">&quot;pdf_sha256&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;page_count_present&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">CORPUS_FINGERPRINT</span><span class="p">[</span><span class="s2">&quot;page_count&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;schema_hash_present&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">schema_hash</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">stage_2a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_2a_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># WRITE ARTIFACTS </span>
<span class="c1"># ----------------------------</span>
<span class="n">schema_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;corpus_schema.json&quot;</span>
<span class="n">fingerprint_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;corpus_fingerprint.json&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">CORPUS_SCHEMA</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fingerprint_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">CORPUS_FINGERPRINT</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 2A&quot;</span><span class="p">,</span> <span class="s2">&quot;CORPUS GOVERNANCE &amp; SCHEMA&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;SCHEMA VERSION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Version                : </span><span class="si">{CORPUS_SCHEMA[&#39;schema_version&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;CORPUS POINTER&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Pointer path           : </span><span class="si">{pointer_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Pointer exists         : {badge(pointer_exists)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Pointer loaded         : {badge(corpus_pointer is not None)}&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">pointer_error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Pointer load error     : </span><span class="si">{pointer_error}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;FINGERPRINT&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;PDF SHA256             : </span><span class="si">{CORPUS_FINGERPRINT[&#39;pdf_sha256&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Page count             : </span><span class="si">{CORPUS_FINGERPRINT[&#39;page_count&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Schema hash            : </span><span class="si">{schema_hash}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_2a_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:22s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 2A&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_2a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;corpus schema and governance fingerprint established.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;corpus governance failed  fix pointer or schema issues before proceeding.&quot;</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;corpus_schema.json      : </span><span class="si">{schema_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;corpus_fingerprint.json : </span><span class="si">{fingerprint_path}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 2A CORPUS GOVERNANCE &amp; SCHEMA
====================================================================================================

[SCHEMA VERSION]
Version                : 1.0

[CORPUS POINTER]
Pointer path           : OUT/corpus/corpus_pointer.json
Pointer exists         :  PASS
Pointer loaded         :  PASS

[FINGERPRINT]
PDF SHA256             : a1b024264d3b345ce67a7893b02ee93e35fea3f11042fa3555bdfa1a93bd278c
Page count             : 4114
Schema hash            : debac6dda26782a1eabdec39e2d3d7c4b6121061b09d05e86731f41d9a327cc9

[VALIDATION GATES]
pointer_exists        :  PASS
pointer_loaded        :  PASS
pdf_sha256_present    :  PASS
page_count_present    :  PASS
schema_hash_present   :  PASS

[STAGE 2A] STATUS
 VERIFIED  corpus schema and governance fingerprint established.
====================================================================================================

[ARTIFACTS WRITTEN]
corpus_schema.json      : OUT/manifests/corpus_schema.json
corpus_fingerprint.json : OUT/manifests/corpus_fingerprint.json
====================================================================================================

 CPU    8.9% |  Mem   24.3% |  GPU     5% @ 49C |  cell  0.009s |  total    0.15s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note</strong>:</p>
<ul>
<li>After running the above cell, kindly restart the runtime (for Google Colab) or notebook kernel (for Jupyter Notebook), and run all cells sequentially from the next cell.</li>
<li>On executing the above line of code, you might see a warning regarding package dependencies. This error message can be ignored as the above code ensures that all necessary libraries and their dependencies are maintained to successfully execute the code in <strong><em>this notebook</em></strong>.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 3A  TEXT EDA (CORPUS PROFILING)</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_3A_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_3A_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="n">OUT_CORPUS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/corpus&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>
<span class="n">REPORTS_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;reports/figs&quot;</span><span class="p">)</span>

<span class="n">REPORTS_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD CORPUS POINTER (DEFENSIVE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">pointer_path</span> <span class="o">=</span> <span class="n">OUT_CORPUS</span> <span class="o">/</span> <span class="s2">&quot;corpus_pointer.json&quot;</span>

<span class="n">corpus_pointer</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pointer_exists</span> <span class="o">=</span> <span class="n">pointer_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">pointer_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">pointer_exists</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pointer_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">corpus_pointer</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">pointer_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">PDF_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">corpus_pointer</span><span class="p">[</span><span class="s2">&quot;pdf_path&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">corpus_pointer</span> <span class="k">else</span> <span class="kc">None</span>
<span class="n">pdf_exists</span> <span class="o">=</span> <span class="n">PDF_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">if</span> <span class="n">PDF_PATH</span> <span class="k">else</span> <span class="kc">False</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># TOKENIZER SETUP (FOR STATS ONLY)</span>
<span class="c1"># ----------------------------</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tiktoken</span><span class="o">.</span><span class="n">get_encoding</span><span class="p">(</span><span class="s2">&quot;cl100k_base&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># COLLECT PAGE-LEVEL STATS</span>
<span class="c1"># ----------------------------</span>
<span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">if</span> <span class="n">pdf_exists</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PDF_PATH</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">page_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="p">):</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">load_page</span><span class="p">(</span><span class="n">page_idx</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;page_number&quot;</span><span class="p">:</span> <span class="n">page_idx</span><span class="p">,</span>
            <span class="s2">&quot;char_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
            <span class="s2">&quot;word_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">),</span>
            <span class="s2">&quot;token_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">),</span>
            <span class="s2">&quot;is_empty&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">})</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_pages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># METRICS</span>
<span class="c1"># ----------------------------</span>
<span class="n">total_pages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_pages</span><span class="p">)</span>
<span class="n">empty_pages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df_pages</span><span class="p">[</span><span class="s2">&quot;is_empty&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># AGGREGATE CORPUS METRICS</span>
<span class="c1"># ----------------------------</span>
<span class="n">total_words</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df_pages</span><span class="p">[</span><span class="s2">&quot;word_count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">total_chars</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df_pages</span><span class="p">[</span><span class="s2">&quot;char_count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">total_tokens</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df_pages</span><span class="p">[</span><span class="s2">&quot;token_count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_3a_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pointer_exists&quot;</span><span class="p">:</span> <span class="n">pointer_exists</span><span class="p">,</span>
    <span class="s2">&quot;pointer_loaded&quot;</span><span class="p">:</span> <span class="n">corpus_pointer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;pdf_exists&quot;</span><span class="p">:</span> <span class="n">pdf_exists</span><span class="p">,</span>
    <span class="s2">&quot;pages_loaded&quot;</span><span class="p">:</span> <span class="n">total_pages</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;token_stats_computed&quot;</span><span class="p">:</span> <span class="s2">&quot;token_count&quot;</span> <span class="ow">in</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;word_stats_computed&quot;</span><span class="p">:</span> <span class="s2">&quot;word_count&quot;</span> <span class="ow">in</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;char_stats_computed&quot;</span><span class="p">:</span> <span class="s2">&quot;char_count&quot;</span> <span class="ow">in</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">stage_3a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_3a_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VISUALIZATIONS (ONLY IF DATA OK)</span>
<span class="c1"># ----------------------------</span>
<span class="k">if</span> <span class="n">stage_3a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df_pages</span><span class="p">[</span><span class="s2">&quot;token_count&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Token Count Distribution per Page&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tokens&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">REPORTS_DIR</span> <span class="o">/</span> <span class="s2">&quot;token_count_distribution.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df_pages</span><span class="p">[</span><span class="s2">&quot;word_count&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Word Count Distribution per Page&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Words&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">REPORTS_DIR</span> <span class="o">/</span> <span class="s2">&quot;word_count_distribution.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df_pages</span><span class="p">[</span><span class="s2">&quot;char_count&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Character Count Distribution per Page&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Characters&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">REPORTS_DIR</span> <span class="o">/</span> <span class="s2">&quot;char_count_distribution.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 3A&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXT EDA (CORPUS PROFILING)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;CORPUS SOURCE&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Pointer path           : </span><span class="si">{pointer_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Pointer exists         : {badge(pointer_exists)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;PDF path               : </span><span class="si">{PDF_PATH}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;PDF exists             : {badge(pdf_exists)}&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">pointer_error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Pointer load error     : </span><span class="si">{pointer_error}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;PAGE STATISTICS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total pages            : </span><span class="si">{total_pages}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Empty pages            : </span><span class="si">{empty_pages}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total words (corpus)   : </span><span class="si">{total_words}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total tokens (corpus)  : </span><span class="si">{total_tokens}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total characters       : </span><span class="si">{total_chars}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="ow">not</span> <span class="n">df_pages</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Mean tokens per page   : {df_pages[&#39;token_count&#39;].mean():.1f}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Median tokens per page : {df_pages[&#39;token_count&#39;].median():.1f}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Max tokens per page    : {df_pages[&#39;token_count&#39;].max()}&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Mean words per page    : {df_pages[&#39;word_count&#39;].mean():.1f}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Median words per page  : {df_pages[&#39;word_count&#39;].median():.1f}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Max words per page     : {df_pages[&#39;word_count&#39;].max()}&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Mean chars per page    : {df_pages[&#39;char_count&#39;].mean():.1f}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Median chars per page  : {df_pages[&#39;char_count&#39;].median():.1f}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Max chars per page     : {df_pages[&#39;char_count&#39;].max()}&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_3a_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:24s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 3A&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_3a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;corpus profiling completed; statistics ready for chunking design.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;text EDA failed  fix corpus ingestion or pointer issues before proceeding.&quot;</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;token_count_distribution.png : {REPORTS_DIR / &#39;token_count_distribution.png&#39;}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;word_count_distribution.png  : {REPORTS_DIR / &#39;word_count_distribution.png&#39;}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;char_count_distribution.png  : {REPORTS_DIR / &#39;char_count_distribution.png&#39;}&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 3A TEXT EDA (CORPUS PROFILING)
====================================================================================================

[CORPUS SOURCE]
Pointer path           : OUT/corpus/corpus_pointer.json
Pointer exists         :  PASS
PDF path               : data/raw/merck_manual.pdf
PDF exists             :  PASS

[PAGE STATISTICS]
Total pages            : 4114
Empty pages            : 0
Total words (corpus)   : 1992803
Total tokens (corpus)  : 3268572
Total characters       : 13773538
Mean tokens per page   : 794.5
Median tokens per page : 814.0
Max tokens per page    : 1326
Mean words per page    : 484.4
Median words per page  : 514.0
Max words per page     : 834
Mean chars per page    : 3348.0
Median chars per page  : 3553.0
Max chars per page     : 9619

[VALIDATION GATES]
pointer_exists          :  PASS
pointer_loaded          :  PASS
pdf_exists              :  PASS
pages_loaded            :  PASS
token_stats_computed    :  PASS
word_stats_computed     :  PASS
char_stats_computed     :  PASS

[STAGE 3A] STATUS
 VERIFIED  corpus profiling completed; statistics ready for chunking design.
====================================================================================================

[ARTIFACTS WRITTEN]
token_count_distribution.png : reports/figs/token_count_distribution.png
word_count_distribution.png  : reports/figs/word_count_distribution.png
char_count_distribution.png  : reports/figs/char_count_distribution.png

 CPU    7.2% |  Mem   24.6% |  GPU     5% @ 49C |  cell 10.604s |  total   10.76s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 4A  CHUNKING PIPELINE (CORPUS  RETRIEVAL UNITS)</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_4A_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_4A_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="n">OUT_CORPUS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/corpus&quot;</span><span class="p">)</span>
<span class="n">OUT_CHUNKS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/chunks&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>

<span class="n">OUT_CHUNKS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># DESIGN PARAMETERS (LOCKED)</span>
<span class="c1"># ----------------------------</span>
<span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">CHUNK_OVERLAP</span> <span class="o">=</span> <span class="mi">200</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD CORPUS POINTER (DEFENSIVE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">pointer_path</span> <span class="o">=</span> <span class="n">OUT_CORPUS</span> <span class="o">/</span> <span class="s2">&quot;corpus_pointer.json&quot;</span>

<span class="n">corpus_pointer</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pointer_exists</span> <span class="o">=</span> <span class="n">pointer_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">pointer_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">pointer_exists</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pointer_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">corpus_pointer</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">pointer_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">PDF_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">corpus_pointer</span><span class="p">[</span><span class="s2">&quot;pdf_path&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">corpus_pointer</span> <span class="k">else</span> <span class="kc">None</span>
<span class="n">pdf_exists</span> <span class="o">=</span> <span class="n">PDF_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">if</span> <span class="n">PDF_PATH</span> <span class="k">else</span> <span class="kc">False</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># TOKENIZER (SAME AS STAGE 3A)</span>
<span class="c1"># ----------------------------</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tiktoken</span><span class="o">.</span><span class="n">get_encoding</span><span class="p">(</span><span class="s2">&quot;cl100k_base&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># CHUNKING LOGIC</span>
<span class="c1"># ----------------------------</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">chunk_id</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">pdf_exists</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PDF_PATH</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">page_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">page_count</span><span class="p">):</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">load_page</span><span class="p">(</span><span class="n">page_idx</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">CHUNK_SIZE</span>
            <span class="n">chunk_tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="n">chunk_text</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">chunk_tokens</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">chunk_text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;chunk_id&quot;</span><span class="p">:</span> <span class="n">f</span><span class="s2">&quot;chunk_</span><span class="si">{chunk_id}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;merck_manual&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;page_number&quot;</span><span class="p">:</span> <span class="n">page_idx</span><span class="p">,</span>
                    <span class="s2">&quot;token_start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span>
                    <span class="s2">&quot;token_end&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)),</span>
                    <span class="s2">&quot;token_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_tokens</span><span class="p">),</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">chunk_text</span><span class="p">,</span>
                <span class="p">})</span>
                <span class="n">chunk_id</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">start</span> <span class="o">+=</span> <span class="p">(</span><span class="n">CHUNK_SIZE</span> <span class="o">-</span> <span class="n">CHUNK_OVERLAP</span><span class="p">)</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_chunks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># AGGREGATE METRICS</span>
<span class="c1"># ----------------------------</span>
<span class="n">total_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_chunks</span><span class="p">)</span>
<span class="n">total_tokens</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df_chunks</span><span class="p">[</span><span class="s2">&quot;token_count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_chunks</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_4a_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pointer_exists&quot;</span><span class="p">:</span> <span class="n">pointer_exists</span><span class="p">,</span>
    <span class="s2">&quot;pointer_loaded&quot;</span><span class="p">:</span> <span class="n">corpus_pointer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;pdf_exists&quot;</span><span class="p">:</span> <span class="n">pdf_exists</span><span class="p">,</span>
    <span class="s2">&quot;chunks_generated&quot;</span><span class="p">:</span> <span class="n">total_chunks</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;token_counts_present&quot;</span><span class="p">:</span> <span class="s2">&quot;token_count&quot;</span> <span class="ow">in</span> <span class="n">df_chunks</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_chunks</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">stage_4a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_4a_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># WRITE ARTIFACTS</span>
<span class="c1"># ----------------------------</span>
<span class="n">chunks_path</span> <span class="o">=</span> <span class="n">OUT_CHUNKS</span> <span class="o">/</span> <span class="s2">&quot;chunks.json&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chunks_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">chunk_manifest</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;4A&quot;</span><span class="p">,</span>
    <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
    <span class="s2">&quot;chunking_strategy&quot;</span><span class="p">:</span> <span class="s2">&quot;token-based sliding window&quot;</span><span class="p">,</span>
    <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="n">CHUNK_SIZE</span><span class="p">,</span>
    <span class="s2">&quot;chunk_overlap&quot;</span><span class="p">:</span> <span class="n">CHUNK_OVERLAP</span><span class="p">,</span>
    <span class="s2">&quot;total_chunks&quot;</span><span class="p">:</span> <span class="n">total_chunks</span><span class="p">,</span>
    <span class="s2">&quot;mean_tokens_per_chunk&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">df_chunks</span><span class="p">[</span><span class="s2">&quot;token_count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_chunks</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;median_tokens_per_chunk&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">df_chunks</span><span class="p">[</span><span class="s2">&quot;token_count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_chunks</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;max_tokens_per_chunk&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">df_chunks</span><span class="p">[</span><span class="s2">&quot;token_count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df_chunks</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">manifest_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;chunk_manifest.json&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">chunk_manifest</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 4A&quot;</span><span class="p">,</span> <span class="s2">&quot;CHUNKING PIPELINE (CORPUS  RETRIEVAL UNITS)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;CHUNKING CONFIGURATION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Chunk size (tokens)        : </span><span class="si">{CHUNK_SIZE}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Chunk overlap (tokens)     : </span><span class="si">{CHUNK_OVERLAP}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;CHUNK STATISTICS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total chunks generated     : </span><span class="si">{total_chunks}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">df_chunks</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Mean tokens per chunk      : {df_chunks[&#39;token_count&#39;].mean():.1f}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Median tokens per chunk    : {df_chunks[&#39;token_count&#39;].median():.1f}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Max tokens per chunk       : {df_chunks[&#39;token_count&#39;].max()}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total tokens (corpus)      : </span><span class="si">{total_tokens}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_4a_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:24s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 4A&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_4a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;chunking completed; retrieval units ready for embedding.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;chunking failed  check corpus ingestion or tokenization.&quot;</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;chunks.json               : </span><span class="si">{chunks_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;chunk_manifest.json       : </span><span class="si">{manifest_path}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 4A CHUNKING PIPELINE (CORPUS  RETRIEVAL UNITS)
====================================================================================================

[CHUNKING CONFIGURATION]
Chunk size (tokens)        : 800
Chunk overlap (tokens)     : 200

[CHUNK STATISTICS]
Total chunks generated     : 7787
Mean tokens per chunk      : 496.8
Median tokens per chunk    : 526.0
Max tokens per chunk       : 800
Total tokens (corpus)      : 3868562

[VALIDATION GATES]
pointer_exists          :  PASS
pointer_loaded          :  PASS
pdf_exists              :  PASS
chunks_generated        :  PASS
token_counts_present    :  PASS

[STAGE 4A] STATUS
 VERIFIED  chunking completed; retrieval units ready for embedding.
====================================================================================================

[ARTIFACTS WRITTEN]
chunks.json               : OUT/chunks/chunks.json
chunk_manifest.json       : OUT/manifests/chunk_manifest.json

 CPU    6.7% |  Mem   24.7% |  GPU     5% @ 49C |  cell  9.433s |  total   20.19s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 5A  EMBEDDINGS (CHUNKS  VECTORS)</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_5A_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_5A_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="n">OUT_CHUNKS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/chunks&quot;</span><span class="p">)</span>
<span class="n">OUT_EMB</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/embeddings&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>

<span class="n">OUT_EMB</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">CHUNKS_PATH</span> <span class="o">=</span> <span class="n">OUT_CHUNKS</span> <span class="o">/</span> <span class="s2">&quot;chunks.json&quot;</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD CHUNKS (DEFENSIVE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">chunks_exist</span> <span class="o">=</span> <span class="n">CHUNKS_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">chunks_loaded</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">chunks_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">chunks_exist</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">CHUNKS_PATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">chunks_loaded</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">chunks_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span> <span class="k">if</span> <span class="n">chunks_loaded</span> <span class="k">else</span> <span class="p">[]</span>
<span class="n">chunk_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span> <span class="k">if</span> <span class="n">chunks_loaded</span> <span class="k">else</span> <span class="p">[]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EMBEDDING MODEL CONFIG (LOCKED)</span>
<span class="c1"># ----------------------------</span>
<span class="n">EMBEDDING_MODEL_ID</span> <span class="o">=</span> <span class="s2">&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span>
<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>

<span class="n">embedding_dim</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">embedding_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># GENERATE EMBEDDINGS</span>
<span class="c1"># ----------------------------</span>
<span class="k">if</span> <span class="n">chunks_loaded</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">emb_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="n">EMBEDDING_MODEL_ID</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="n">embedding_dim</span> <span class="o">=</span> <span class="n">emb_model</span><span class="o">.</span><span class="n">get_sentence_embedding_dimension</span><span class="p">()</span>

        <span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">64</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">emb_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">texts</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span>
            <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">convert_to_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">normalize_embeddings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">embedding_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># AGGREGATE METRICS</span>
<span class="c1"># ----------------------------</span>
<span class="n">num_vectors</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk_ids</span><span class="p">))</span> <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">total_embedding_values</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">embeddings</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_5a_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;chunks_file_exists&quot;</span><span class="p">:</span> <span class="n">chunks_exist</span><span class="p">,</span>
    <span class="s2">&quot;chunks_loaded&quot;</span><span class="p">:</span> <span class="n">chunks_loaded</span><span class="p">,</span>
    <span class="s2">&quot;chunks_non_empty&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;embeddings_generated&quot;</span><span class="p">:</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;embedding_dim_known&quot;</span><span class="p">:</span> <span class="n">embedding_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;vector_count_match&quot;</span><span class="p">:</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_ids</span><span class="p">)</span> <span class="o">==</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;device_resolved&quot;</span><span class="p">:</span> <span class="n">device</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">stage_5a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_5a_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># WRITE ARTIFACTS (ONLY IF VALID)</span>
<span class="c1"># ----------------------------</span>
<span class="n">emb_path</span> <span class="o">=</span> <span class="n">OUT_EMB</span> <span class="o">/</span> <span class="s2">&quot;embeddings.npy&quot;</span>
<span class="n">chunk_ids_path</span> <span class="o">=</span> <span class="n">OUT_EMB</span> <span class="o">/</span> <span class="s2">&quot;chunk_ids.json&quot;</span>
<span class="n">manifest_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;embedding_model_manifest.json&quot;</span>

<span class="k">if</span> <span class="n">stage_5a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">emb_path</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chunk_ids_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">chunk_ids</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">embedding_manifest</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;5A&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
        <span class="s2">&quot;embedding_model_id&quot;</span><span class="p">:</span> <span class="n">EMBEDDING_MODEL_ID</span><span class="p">,</span>
        <span class="s2">&quot;embedding_dimension&quot;</span><span class="p">:</span> <span class="n">embedding_dim</span><span class="p">,</span>
        <span class="s2">&quot;num_vectors&quot;</span><span class="p">:</span> <span class="n">num_vectors</span><span class="p">,</span>
        <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
        <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span>
        <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">embeddings</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
        <span class="s2">&quot;total_embedding_values&quot;</span><span class="p">:</span> <span class="n">total_embedding_values</span><span class="p">,</span>
        <span class="s2">&quot;source_chunks&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">CHUNKS_PATH</span><span class="p">),</span>
        <span class="s2">&quot;artifacts&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;embeddings_npy&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">emb_path</span><span class="p">),</span>
            <span class="s2">&quot;chunk_ids_json&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">chunk_ids_path</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">embedding_manifest</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT </span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 5A&quot;</span><span class="p">,</span> <span class="s2">&quot;EMBEDDINGS (CHUNKS  VECTOR SPACE)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;EMBEDDING CONFIGURATION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Embedding model         : </span><span class="si">{EMBEDDING_MODEL_ID}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Device                  : </span><span class="si">{device}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Embedding dimension     : </span><span class="si">{embedding_dim}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VECTOR STATISTICS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Vectors generated       : </span><span class="si">{num_vectors}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Embedding matrix shape  : {embeddings.shape if embeddings is not None else None}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Embedding dtype         : {embeddings.dtype if embeddings is not None else None}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total values (corpus)   : </span><span class="si">{total_embedding_values}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_5a_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:26s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 5A&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_5a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;embeddings generated; vector representations ready for indexing.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;embedding stage failed  check chunk integrity or model availability.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_5a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;embeddings.npy               : </span><span class="si">{emb_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;chunk_ids.json               : </span><span class="si">{chunk_ids_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;embedding_model_manifest.json: </span><span class="si">{manifest_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No artifacts written due to validation failure.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>





 
 
<div id="17186fb4-f6d1-44a1-8786-8ad063047fa2"></div>
<div class="output_subarea output_widget_view ">
<script type="text/javascript">
var element = $('#17186fb4-f6d1-44a1-8786-8ad063047fa2');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"version_minor": 0, "model_id": "24411af32854490c90406abbc861634e", "version_major": 2}
</script>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 5A EMBEDDINGS (CHUNKS  VECTOR SPACE)
====================================================================================================

[EMBEDDING CONFIGURATION]
Embedding model         : sentence-transformers/all-MiniLM-L6-v2
Device                  : cuda
Embedding dimension     : 384

[VECTOR STATISTICS]
Vectors generated       : 7787
Embedding matrix shape  : (7787, 384)
Embedding dtype         : float32
Total values (corpus)   : 2990208

[VALIDATION GATES]
chunks_file_exists        :  PASS
chunks_loaded             :  PASS
chunks_non_empty          :  PASS
embeddings_generated      :  PASS
embedding_dim_known       :  PASS
vector_count_match        :  PASS
device_resolved           :  PASS

[STAGE 5A] STATUS
 VERIFIED  embeddings generated; vector representations ready for indexing.
====================================================================================================

[ARTIFACTS WRITTEN]
embeddings.npy               : OUT/embeddings/embeddings.npy
chunk_ids.json               : OUT/embeddings/chunk_ids.json
embedding_model_manifest.json: OUT/manifests/embedding_model_manifest.json
====================================================================================================

 CPU    9.9% |  Mem   26.5% |  GPU     5% @ 49C |  cell 10.270s |  total   30.46s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 6A  VECTOR DATABASE (EMBEDDINGS  RETRIEVAL INDEX)</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_6A_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_6A_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="n">OUT_EMB</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/embeddings&quot;</span><span class="p">)</span>
<span class="n">OUT_CHUNKS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/chunks&quot;</span><span class="p">)</span>
<span class="n">OUT_VDB</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/vectordb&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>

<span class="n">OUT_VDB</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">EMB_PATH</span> <span class="o">=</span> <span class="n">OUT_EMB</span> <span class="o">/</span> <span class="s2">&quot;embeddings.npy&quot;</span>
<span class="n">CHUNK_IDS_PATH</span> <span class="o">=</span> <span class="n">OUT_EMB</span> <span class="o">/</span> <span class="s2">&quot;chunk_ids.json&quot;</span>
<span class="n">CHUNKS_PATH</span> <span class="o">=</span> <span class="n">OUT_CHUNKS</span> <span class="o">/</span> <span class="s2">&quot;chunks.json&quot;</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD ARTIFACTS (DEFENSIVE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">chunk_ids</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">emb_exists</span> <span class="o">=</span> <span class="n">EMB_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">ids_exists</span> <span class="o">=</span> <span class="n">CHUNK_IDS_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">chunks_exists</span> <span class="o">=</span> <span class="n">CHUNKS_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

<span class="n">load_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">emb_exists</span> <span class="ow">and</span> <span class="n">ids_exists</span> <span class="ow">and</span> <span class="n">chunks_exists</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">EMB_PATH</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">CHUNK_IDS_PATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">chunk_ids</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">CHUNKS_PATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">load_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># BUILD RECORDS</span>
<span class="c1"># ----------------------------</span>
<span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chunk_ids</span> <span class="ow">and</span> <span class="n">chunks</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
        <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;chunk_id&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">],</span>
            <span class="s2">&quot;page_number&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;page_number&quot;</span><span class="p">],</span>
            <span class="s2">&quot;token_start&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;token_start&quot;</span><span class="p">],</span>
            <span class="s2">&quot;token_end&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;token_end&quot;</span><span class="p">],</span>
            <span class="s2">&quot;token_count&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;token_count&quot;</span><span class="p">],</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
        <span class="p">})</span>
        <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">])</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># INITIALIZE VECTOR STORE</span>
<span class="c1"># ----------------------------</span>
<span class="n">collection_name</span> <span class="o">=</span> <span class="s2">&quot;merck_manual_chunks&quot;</span>
<span class="n">collection</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">chroma_client</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
        <span class="n">Settings</span><span class="p">(</span>
            <span class="n">persist_directory</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">OUT_VDB</span><span class="p">),</span>
            <span class="n">anonymized_telemetry</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">collection_name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">list_collections</span><span class="p">()]:</span>
        <span class="n">chroma_client</span><span class="o">.</span><span class="n">delete_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>

    <span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;merck_manual&quot;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">MAX_BATCH_SIZE</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">),</span> <span class="n">MAX_BATCH_SIZE</span><span class="p">):</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">MAX_BATCH_SIZE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span>
            <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">metadatas</span><span class="o">=</span><span class="n">metadatas</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span>
            <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
        <span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_6a_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;embeddings_file_exists&quot;</span><span class="p">:</span> <span class="n">emb_exists</span><span class="p">,</span>
    <span class="s2">&quot;chunk_ids_file_exists&quot;</span><span class="p">:</span> <span class="n">ids_exists</span><span class="p">,</span>
    <span class="s2">&quot;chunks_file_exists&quot;</span><span class="p">:</span> <span class="n">chunks_exists</span><span class="p">,</span>
    <span class="s2">&quot;artifacts_loaded&quot;</span><span class="p">:</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chunk_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chunks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;vector_count_match&quot;</span><span class="p">:</span> <span class="n">embeddings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">==</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;collection_created&quot;</span><span class="p">:</span> <span class="n">collection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">stage_6a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_6a_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># WRITE MANIFEST</span>
<span class="c1"># ----------------------------</span>
<span class="n">manifest_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;vectordb_manifest.json&quot;</span>

<span class="k">if</span> <span class="n">stage_6a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="n">vectordb_manifest</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;6A&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
        <span class="s2">&quot;vector_store&quot;</span><span class="p">:</span> <span class="s2">&quot;Chroma&quot;</span><span class="p">,</span>
        <span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
        <span class="s2">&quot;persist_directory&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">OUT_VDB</span><span class="p">),</span>
        <span class="s2">&quot;num_vectors&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)),</span>
        <span class="s2">&quot;embedding_dimension&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="s2">&quot;distance_metric&quot;</span><span class="p">:</span> <span class="s2">&quot;cosine (default)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;source_embeddings&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">EMB_PATH</span><span class="p">),</span>
        <span class="s2">&quot;source_chunks&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">CHUNKS_PATH</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">vectordb_manifest</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 6A&quot;</span><span class="p">,</span> <span class="s2">&quot;VECTOR DATABASE (CHROMA INDEXING)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VECTOR STORE CONFIG&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Vector store            : Chroma&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Collection name         : </span><span class="si">{collection_name}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Persist directory       : </span><span class="si">{OUT_VDB}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VECTOR STATISTICS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Vectors indexed         : {len(ids)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Embedding dimension     : {embeddings.shape[1] if embeddings is not None else None}&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_6a_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:28s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 6A&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_6a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;vector database created and indexed; retrieval layer ready.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;vector database indexing failed  check embedding artifacts or index creation.&quot;</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_6a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;vectordb_manifest.json : </span><span class="si">{manifest_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;vector index directory : </span><span class="si">{OUT_VDB}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No artifacts written due to validation failure.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 6A VECTOR DATABASE (CHROMA INDEXING)
====================================================================================================

[VECTOR STORE CONFIG]
Vector store            : Chroma
Collection name         : merck_manual_chunks
Persist directory       : OUT/vectordb

[VECTOR STATISTICS]
Vectors indexed         : 7787
Embedding dimension     : 384

[VALIDATION GATES]
embeddings_file_exists      :  PASS
chunk_ids_file_exists       :  PASS
chunks_file_exists          :  PASS
artifacts_loaded            :  PASS
vector_count_match          :  PASS
collection_created          :  PASS

[STAGE 6A] STATUS
 VERIFIED  vector database created and indexed; retrieval layer ready.
====================================================================================================

[ARTIFACTS WRITTEN]
vectordb_manifest.json : OUT/manifests/vectordb_manifest.json
vector index directory : OUT/vectordb
====================================================================================================

 CPU    6.5% |  Mem   27.4% |  GPU     5% @ 49C |  cell  9.212s |  total   39.67s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 7A  RETRIEVER DEFINITION &amp; SANITY CHECK</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_7A_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_7A_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="n">OUT_VDB</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/vectordb&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>
<span class="n">OUT_RETRIEVAL</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/retrieval&quot;</span><span class="p">)</span>

<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">OUT_RETRIEVAL</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">collection_name</span> <span class="o">=</span> <span class="s2">&quot;merck_manual_chunks&quot;</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># RETRIEVER CONFIG (LOCKED)</span>
<span class="c1"># ----------------------------</span>
<span class="n">RETRIEVER_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;search_type&quot;</span><span class="p">:</span> <span class="s2">&quot;similarity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;distance_metric&quot;</span><span class="p">:</span> <span class="s2">&quot;cosine&quot;</span>
<span class="p">}</span>

<span class="n">test_queries</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;What are the initial management steps for sepsis?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Symptoms and treatment of appendicitis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;How is a fractured leg managed in emergency care?&quot;</span>
<span class="p">]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD VECTOR DB (DEFENSIVE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">vdb_exists</span> <span class="o">=</span> <span class="n">OUT_VDB</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">client_ok</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">collection_ok</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">load_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">collection</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">chroma_client</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">vdb_exists</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">chroma_client</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
            <span class="n">Settings</span><span class="p">(</span>
                <span class="n">persist_directory</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">OUT_VDB</span><span class="p">),</span>
                <span class="n">anonymized_telemetry</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">client_ok</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">load_error</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Chroma client init failed: </span><span class="si">{e}</span><span class="s2">&quot;</span>

<span class="k">if</span> <span class="n">client_ok</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ensure collection exists</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">list_collections</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">collection_name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
            <span class="n">collection_ok</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">load_error</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Collection not found: </span><span class="si">{collection_name}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">load_error</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Collection load failed: </span><span class="si">{e}</span><span class="s2">&quot;</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># RUN SANITY QUERIES</span>
<span class="c1"># ----------------------------</span>
<span class="n">retrieval_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">queries_ran</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">total_results_returned</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">collection_ok</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">test_queries</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="n">q</span><span class="p">],</span>
                <span class="n">n_results</span><span class="o">=</span><span class="n">RETRIEVER_CONFIG</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">retrieved_docs</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="p">[[]])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">retrieved_meta</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadatas&quot;</span><span class="p">,</span> <span class="p">[[]])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">queries_ran</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">total_results_returned</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">retrieved_docs</span><span class="p">)</span>

            <span class="n">retrieval_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">q</span><span class="p">,</span>
                <span class="s2">&quot;num_results&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">retrieved_docs</span><span class="p">),</span>
                <span class="s2">&quot;samples&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;chunk_id&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">retrieved_meta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">retrieved_meta</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="s2">&quot;page_number&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">retrieved_meta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_number&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">retrieved_meta</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="s2">&quot;token_count&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">retrieved_meta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token_count&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">retrieved_meta</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="s2">&quot;text_snippet&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">retrieved_docs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">300</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">retrieved_docs</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">retrieved_docs</span><span class="p">)))</span>
                <span class="p">]</span>
            <span class="p">})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">retrieval_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">q</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="s2">&quot;num_results&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;samples&quot;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">})</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_7a_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;vectordb_directory_exists&quot;</span><span class="p">:</span> <span class="n">vdb_exists</span><span class="p">,</span>
    <span class="s2">&quot;chroma_client_initialized&quot;</span><span class="p">:</span> <span class="n">client_ok</span><span class="p">,</span>
    <span class="s2">&quot;collection_loaded&quot;</span><span class="p">:</span> <span class="n">collection_ok</span><span class="p">,</span>
    <span class="s2">&quot;queries_configured&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_queries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;queries_executed_all&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">queries_ran</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_queries</span><span class="p">)),</span>
    <span class="s2">&quot;nonzero_results_returned&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_results_returned</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">stage_7a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_7a_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># WRITE ARTIFACTS</span>
<span class="c1"># ----------------------------</span>
<span class="n">retriever_manifest_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;retriever_manifest.json&quot;</span>
<span class="n">retrieval_checks_path</span> <span class="o">=</span> <span class="n">OUT_RETRIEVAL</span> <span class="o">/</span> <span class="s2">&quot;retrieval_sanity_checks.json&quot;</span>

<span class="k">if</span> <span class="n">stage_7a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="n">retriever_manifest</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;7A&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
        <span class="s2">&quot;vector_store&quot;</span><span class="p">:</span> <span class="s2">&quot;Chroma&quot;</span><span class="p">,</span>
        <span class="s2">&quot;persist_directory&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">OUT_VDB</span><span class="p">),</span>
        <span class="s2">&quot;collection_name&quot;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
        <span class="s2">&quot;retriever_config&quot;</span><span class="p">:</span> <span class="n">RETRIEVER_CONFIG</span><span class="p">,</span>
        <span class="s2">&quot;num_queries_tested&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_queries</span><span class="p">),</span>
        <span class="s2">&quot;queries_ran&quot;</span><span class="p">:</span> <span class="n">queries_ran</span><span class="p">,</span>
        <span class="s2">&quot;total_results_returned&quot;</span><span class="p">:</span> <span class="n">total_results_returned</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">retriever_manifest_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">retriever_manifest</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">retrieval_checks_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">retrieval_results</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 7A&quot;</span><span class="p">,</span> <span class="s2">&quot;RETRIEVER DEFINITION &amp; SANITY CHECK&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;RETRIEVER CONFIG&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Search type           : </span><span class="si">{RETRIEVER_CONFIG[&#39;search_type&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;k                     : </span><span class="si">{RETRIEVER_CONFIG[&#39;k&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Distance metric       : </span><span class="si">{RETRIEVER_CONFIG[&#39;distance_metric&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VECTOR DB CONTRACT&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Persist directory     : </span><span class="si">{OUT_VDB}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Vector DB exists      : {badge(vdb_exists)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Collection name       : </span><span class="si">{collection_name}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Collection loaded     : {badge(collection_ok)}&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">load_error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Load error            : </span><span class="si">{load_error}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;SANITY QUERIES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">retrieval_results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[QUERY]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;  {r.get(&#39;query&#39;)}&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;  ERROR: </span><span class="si">{r[&#39;error&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;  Results returned: {r.get(&#39;num_results&#39;, 0)}&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;samples&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;   - Chunk </span><span class="si">{s[&#39;chunk_id&#39;]}</span><span class="s2"> | page </span><span class="si">{s[&#39;page_number&#39;]}</span><span class="s2"> | tokens </span><span class="si">{s[&#39;token_count&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;     </span><span class="si">{s[&#39;text_snippet&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_7a_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:28s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 7A&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_7a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;retriever validated; ready for LLM-only QA and prompt engineering.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;retriever sanity check failed  fix vector DB/collection before proceeding.&quot;</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_7a_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;retriever_manifest.json      : </span><span class="si">{retriever_manifest_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;retrieval_sanity_checks.json : </span><span class="si">{retrieval_checks_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No artifacts written due to validation failure.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 7A RETRIEVER DEFINITION &amp; SANITY CHECK
====================================================================================================

[RETRIEVER CONFIG]
Search type           : similarity
k                     : 5
Distance metric       : cosine

[VECTOR DB CONTRACT]
Persist directory     : OUT/vectordb
Vector DB exists      :  PASS
Collection name       : merck_manual_chunks
Collection loaded     :  PASS

[SANITY QUERIES]

[QUERY]
  What are the initial management steps for sepsis?
  Results returned: 5
   - Chunk chunk_5714 | page 2995 | tokens 800
     can approximate bone marrow NSP levels. I:T ratios of &gt; 0.80 correlate with NSP depletion and death;
such a ratio may identify neonates who might benefit from granulocyte transfusion.
Treatment
 Antibiotic therapy
 Supportive therapy
Because sepsis may manifest with non-specific clinical signs and...
   - Chunk chunk_4674 | page 2453 | tokens 144
     , drainage tubes, and other foreign materials; and prior treatment with antibiotics or
corticosteroids. Common causative sites of infection include the lungs and the urinary, biliary, and GI
tracts.
Pathophysiology
The pathogenesis of septic shock is not completely understood. An inflammatory stimul...
   - Chunk chunk_2458 | page 1307 | tokens 800
     shaking chills, persistent fever, altered sensorium, hypotension, and GI symptoms (abdominal pain,
nausea, vomiting, diarrhea) suggests sepsis or septic shock. Septic shock develops in 25 to 40% of
patients with significant bacteremia.
Diagnosis
If bacteremia, sepsis, or septic shock is suspected, c...

[QUERY]
  Symptoms and treatment of appendicitis
  Results returned: 5
   - Chunk chunk_289 | page 173 | tokens 800
     Etiology
Appendicitis is thought to result from obstruction of the appendiceal lumen, typically by lymphoid
hyperplasia, but occasionally by a fecalith, foreign body, or even worms. The obstruction leads to
distention, bacterial overgrowth, ischemia, and inflammation. If untreated, necrosis, gangren...
   - Chunk chunk_291 | page 174 | tokens 800
      Surgical removal
 IV fluids and antibiotics
Treatment of acute appendicitis is open or laparoscopic appendectomy; because treatment delay
increases mortality, a negative appendectomy rate of 15% is considered acceptable. The surgeon can
usually remove the appendix even if perforated. Occasionally...
   - Chunk chunk_6799 | page 3567 | tokens 800
      Evaluating the quality and validity of the evidence
 Deciding how to apply the evidence to the care of a given patient
Formulating a clinical question: Questions must be specific. Specific questions are most likely to be
addressed in the medical literature. A well-designed question specifies the ...

[QUERY]
  How is a fractured leg managed in emergency care?
  Results returned: 5
   - Chunk chunk_6461 | page 3390 | tokens 800
     (eg, meniscal tears, cartilaginous injuries). Arteriography may be necessary for suspected arterial injuries
(eg, some popliteal artery injuries). Nerve conduction studies may be indicated for nerve injuries.
Treatment
 Treatment of life- or limb-threatening injuries
 Splinting
 Definitive treatm...
   - Chunk chunk_6474 | page 3396 | tokens 422
      is
severe. If a fracture is still suspected, MRI is done; if MRI is unavailable or contraindicated, CT is done. If
patients are expected to resume walking and have no contraindication to surgery, treatment is usually
surgical repair (typically ORIFsee
Fig. 323-6) and early ambulation.
If patients ...
   - Chunk chunk_6455 | page 3386 | tokens 192
      than minor) should probably stay off their feet for several days (eg, by using
crutches); restrictions on walking probably result in better healing.
Wound care is meticulous. The wound is kept clean and dry; dressings that are nonadherent and
impermeable to bacteria are usually applied. Antibiotic ...

[VALIDATION GATES]
vectordb_directory_exists   :  PASS
chroma_client_initialized   :  PASS
collection_loaded           :  PASS
queries_configured          :  PASS
queries_executed_all        :  PASS
nonzero_results_returned    :  PASS

[STAGE 7A] STATUS
 VERIFIED  retriever validated; ready for LLM-only QA and prompt engineering.
====================================================================================================

[ARTIFACTS WRITTEN]
retriever_manifest.json      : OUT/manifests/retriever_manifest.json
retrieval_sanity_checks.json : OUT/retrieval/retrieval_sanity_checks.json
====================================================================================================

 CPU   75.1% |  Mem   27.6% |  GPU     5% @ 49C |  cell  0.618s |  total   40.29s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Question-Answering-using-LLM">Question Answering using LLM<a class="anchor-link" href="#Question-Answering-using-LLM">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE PFU  GPU PREFLIGHT &amp; MEMORY SANITY CHECK (UTILITY)</span>
<span class="c1"># ============================================================</span>
<span class="c1"># Purpose:</span>
<span class="c1"># Validate that the GPU is visible, idle, and memory-clean</span>
<span class="c1"># before executing any model-loading or training stages.</span>
<span class="c1">#</span>
<span class="c1"># This stage is read-only and does NOT mutate pipeline state.</span>
<span class="c1"># ============================================================</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># STAGE METADATA</span>
<span class="c1"># ----------------------------</span>
<span class="n">STAGE_PFU_START_TS</span>  <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_PFU_START_UTC</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s2">&quot;seconds&quot;</span><span class="p">)</span>

<span class="n">stage_PFU_validation</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT  HEADER</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NEUROFORGE72 PIPELINE  STAGE PFU GPU PREFLIGHT &amp; MEMORY SANITY CHECK&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Utility Stage  Read-Only Diagnostic&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Start UTC: </span><span class="si">{STAGE_PFU_START_UTC}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># GPU AVAILABILITY</span>
<span class="c1"># ----------------------------</span>
<span class="n">cuda_available</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
<span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;cuda_available&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cuda_available</span>

<span class="k">if</span> <span class="n">cuda_available</span><span class="p">:</span>
    <span class="n">device_name</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">free_mem</span><span class="p">,</span> <span class="n">total_mem</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">mem_get_info</span><span class="p">()</span>
    <span class="n">free_gb</span>  <span class="o">=</span> <span class="n">free_mem</span>  <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">total_gb</span> <span class="o">=</span> <span class="n">total_mem</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;gpu_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
    <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;gpu_free_gb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">free_gb</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;gpu_total_gb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_gb</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Heuristic: GPU considered &quot;clean&quot; if &gt;90% memory is free</span>
    <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;gpu_memory_clean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">free_mem</span> <span class="o">/</span> <span class="n">total_mem</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.90</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;gpu_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;gpu_free_gb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;gpu_total_gb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;gpu_memory_clean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;cuda_available&quot;</span><span class="p">]</span>
    <span class="ow">and</span> <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;gpu_memory_clean&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT  DETAILS</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[GPU STATUS]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;CUDA available        : </span><span class="si">{stage_PFU_validation[&#39;cuda_available&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;GPU name              : </span><span class="si">{stage_PFU_validation[&#39;gpu_name&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;GPU memory free (GB)  : </span><span class="si">{stage_PFU_validation[&#39;gpu_free_gb&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;GPU memory total (GB) : </span><span class="si">{stage_PFU_validation[&#39;gpu_total_gb&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[VALIDATION GATES]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_PFU_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;gpu_name&quot;</span><span class="p">,</span> <span class="s2">&quot;gpu_free_gb&quot;</span><span class="p">,</span> <span class="s2">&quot;gpu_total_gb&quot;</span><span class="p">}:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:26s}</span><span class="s2">: {&#39; PASS&#39; if v else &#39; FAIL&#39;}&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># STATUS</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[STAGE PFU] STATUS&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_PFU_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; VERIFIED  GPU is available and memory is clean.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot; NOT READY  GPU memory is not clean.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Recommendation: restart the kernel/runtime before continuing.&quot;</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
====================================================================================================
NEUROFORGE72 PIPELINE  STAGE PFU GPU PREFLIGHT &amp; MEMORY SANITY CHECK
Utility Stage  Read-Only Diagnostic
====================================================================================================
====================================================================================================
Start UTC: 2025-12-22T03:07:17+00:00

[GPU STATUS]
CUDA available        : True
GPU name              : NVIDIA GeForce RTX 5090 Laptop GPU
GPU memory free (GB)  : 21.94
GPU memory total (GB) : 23.89

[VALIDATION GATES]
cuda_available            :  PASS
gpu_memory_clean          :  PASS
status                    :  PASS

[STAGE PFU] STATUS
 VERIFIED  GPU is available and memory is clean.
====================================================================================================

 CPU   10.4% |  Mem   27.6% |  GPU     5% @ 49C |  cell  0.008s |  total   40.30s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 0B  SENTIMENT &amp; CLINICAL TONE ANALYSIS (CROSS-STAGE UTILITY)</span>
<span class="c1"># Shared Evaluation Primitive for B / C / D / E Series</span>
<span class="c1"># ============================================================</span>
<span class="k">def</span> <span class="nf">analyze_answer_sentiment</span><span class="p">(</span><span class="n">answer</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deterministic, rule-based evaluation of LLM or RAG responses.</span>

<span class="sd">    Evaluation Dimensions:</span>
<span class="sd">    - Clinical Directiveness</span>
<span class="sd">    - Risk Escalation</span>
<span class="sd">    - Epistemic Caution</span>
<span class="sd">    - Actionability</span>
<span class="sd">    - Overall Clinical Tone</span>

<span class="sd">    Design Principles:</span>
<span class="sd">    - Transparent </span>
<span class="sd">    - Reproducible</span>
<span class="sd">    - Auditable </span>
<span class="sd">    - Consistent across Baseline, Prompt, and RAG outputs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">answer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># Lexical signal dictionaries</span>
    <span class="c1"># ----------------------------</span>
    <span class="n">hedging_terms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;may&quot;</span><span class="p">,</span> <span class="s2">&quot;might&quot;</span><span class="p">,</span> <span class="s2">&quot;could&quot;</span><span class="p">,</span> <span class="s2">&quot;consider&quot;</span><span class="p">,</span> <span class="s2">&quot;often&quot;</span><span class="p">,</span> <span class="s2">&quot;typically&quot;</span><span class="p">,</span>
        <span class="s2">&quot;generally&quot;</span><span class="p">,</span> <span class="s2">&quot;sometimes&quot;</span><span class="p">,</span> <span class="s2">&quot;can be&quot;</span><span class="p">,</span> <span class="s2">&quot;may be&quot;</span><span class="p">,</span> <span class="s2">&quot;possible&quot;</span>
    <span class="p">]</span>

    <span class="n">assertive_terms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;should&quot;</span><span class="p">,</span> <span class="s2">&quot;must&quot;</span><span class="p">,</span> <span class="s2">&quot;recommended&quot;</span><span class="p">,</span> <span class="s2">&quot;requires&quot;</span><span class="p">,</span> <span class="s2">&quot;indicated&quot;</span><span class="p">,</span>
        <span class="s2">&quot;standard&quot;</span><span class="p">,</span> <span class="s2">&quot;first-line&quot;</span><span class="p">,</span> <span class="s2">&quot;gold standard&quot;</span><span class="p">,</span> <span class="s2">&quot;is necessary&quot;</span>
    <span class="p">]</span>

    <span class="n">safety_terms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;emergency&quot;</span><span class="p">,</span> <span class="s2">&quot;urgent&quot;</span><span class="p">,</span> <span class="s2">&quot;immediately&quot;</span><span class="p">,</span> <span class="s2">&quot;hospital&quot;</span><span class="p">,</span> <span class="s2">&quot;icu&quot;</span><span class="p">,</span>
        <span class="s2">&quot;life-threatening&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span> <span class="s2">&quot;seek medical attention&quot;</span><span class="p">,</span>
        <span class="s2">&quot;surgery&quot;</span><span class="p">,</span> <span class="s2">&quot;surgical&quot;</span><span class="p">,</span> <span class="s2">&quot;perforation&quot;</span><span class="p">,</span> <span class="s2">&quot;sepsis&quot;</span>
    <span class="p">]</span>

    <span class="n">uncertainty_terms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;uncertain&quot;</span><span class="p">,</span> <span class="s2">&quot;not fully understood&quot;</span><span class="p">,</span> <span class="s2">&quot;depends&quot;</span><span class="p">,</span> <span class="s2">&quot;varies&quot;</span><span class="p">,</span>
        <span class="s2">&quot;limited evidence&quot;</span><span class="p">,</span> <span class="s2">&quot;unclear&quot;</span><span class="p">,</span> <span class="s2">&quot;may differ&quot;</span><span class="p">,</span> <span class="s2">&quot;individual&quot;</span>
    <span class="p">]</span>

    <span class="n">step_indicators</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">,</span> <span class="s2">&quot;then&quot;</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1.&quot;</span><span class="p">,</span> <span class="s2">&quot;2.&quot;</span><span class="p">,</span> <span class="s2">&quot;3.&quot;</span><span class="p">,</span> <span class="s2">&quot;initial&quot;</span><span class="p">,</span> <span class="s2">&quot;follow-up&quot;</span>
    <span class="p">]</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># Signal counts</span>
    <span class="c1"># ----------------------------</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;hedging_terms&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">hedging_terms</span><span class="p">),</span>
        <span class="s2">&quot;assertive_terms&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">assertive_terms</span><span class="p">),</span>
        <span class="s2">&quot;safety_flags&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">safety_terms</span><span class="p">),</span>
        <span class="s2">&quot;uncertainty_flags&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">uncertainty_terms</span><span class="p">),</span>
        <span class="s2">&quot;step_indicators&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">step_indicators</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># Dimension scoring (interpretable)</span>
    <span class="c1"># ----------------------------</span>
    <span class="n">clinical_directiveness</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;High&quot;</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;assertive_terms&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;hedging_terms&quot;</span><span class="p">]</span>
        <span class="k">else</span> <span class="s2">&quot;Moderate&quot;</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;assertive_terms&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="s2">&quot;Low&quot;</span>
    <span class="p">)</span>

    <span class="n">risk_escalation</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;High&quot;</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;safety_flags&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="k">else</span> <span class="s2">&quot;Moderate&quot;</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;safety_flags&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">else</span> <span class="s2">&quot;Low&quot;</span>
    <span class="p">)</span>

    <span class="n">epistemic_caution</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;High&quot;</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;uncertainty_flags&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="k">else</span> <span class="s2">&quot;Moderate&quot;</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;uncertainty_flags&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">else</span> <span class="s2">&quot;Low&quot;</span>
    <span class="p">)</span>

    <span class="n">actionability</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;High&quot;</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;step_indicators&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span>
        <span class="k">else</span> <span class="s2">&quot;Moderate&quot;</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;step_indicators&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="k">else</span> <span class="s2">&quot;Low&quot;</span>
    <span class="p">)</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># Overall tone classification</span>
    <span class="c1"># ----------------------------</span>
    <span class="k">if</span> <span class="n">risk_escalation</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
        <span class="n">tone</span> <span class="o">=</span> <span class="s2">&quot;High clinical urgency&quot;</span>
    <span class="k">elif</span> <span class="n">clinical_directiveness</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
        <span class="n">tone</span> <span class="o">=</span> <span class="s2">&quot;Confident / directive&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tone</span> <span class="o">=</span> <span class="s2">&quot;Cautious / neutral&quot;</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;tone&quot;</span><span class="p">:</span> <span class="n">tone</span><span class="p">,</span>
        <span class="s2">&quot;clinical_directiveness&quot;</span><span class="p">:</span> <span class="n">clinical_directiveness</span><span class="p">,</span>
        <span class="s2">&quot;risk_escalation&quot;</span><span class="p">:</span> <span class="n">risk_escalation</span><span class="p">,</span>
        <span class="s2">&quot;epistemic_caution&quot;</span><span class="p">:</span> <span class="n">epistemic_caution</span><span class="p">,</span>
        <span class="s2">&quot;actionability&quot;</span><span class="p">:</span> <span class="n">actionability</span><span class="p">,</span>
        <span class="o">**</span><span class="n">counts</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">display_answer_with_audit</span><span class="p">(</span><span class="n">answer</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LLM Response&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Automatically applies to all downstream LLM and RAG responses.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NEUROFORGE72 PIPELINE  RESPONSE EVALUATION (CROSS-STAGE)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[INPUT]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Source label : </span><span class="si">{label}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Preview      : {answer[:300].replace(chr(10), &#39; &#39;)}...&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CORE DIMENSIONS]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Clinical directiveness : </span><span class="si">{analysis[&#39;clinical_directiveness&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Risk escalation        : </span><span class="si">{analysis[&#39;risk_escalation&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Epistemic caution      : </span><span class="si">{analysis[&#39;epistemic_caution&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Actionability          : </span><span class="si">{analysis[&#39;actionability&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[LEXICAL SIGNALS]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Hedging terms          : </span><span class="si">{analysis[&#39;hedging_terms&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Assertive terms        : </span><span class="si">{analysis[&#39;assertive_terms&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Safety flags           : </span><span class="si">{analysis[&#39;safety_flags&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Uncertainty flags      : </span><span class="si">{analysis[&#39;uncertainty_flags&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Step indicators        : </span><span class="si">{analysis[&#39;step_indicators&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[OVERALL TONE]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tone classification    : </span><span class="si">{analysis[&#39;tone&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[INTERPRETATION]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;tone&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;High clinical urgency&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Response appropriately escalates risk and urgency.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;tone&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Confident / directive&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Response provides clear, actionable clinical guidance.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Response maintains a cautious, explanatory clinical tone.&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[STAGE 0B] STATUS&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Evaluation completed  metrics ready for comparison.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scope: Shared evaluation utility across B, C, D, and E series.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; STAGE 0B Sentiment &amp; Clinical Analyzer loaded.&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Scope: Shared evaluation utility across B, C, D, and E series.
 STAGE 0B Sentiment &amp; Clinical Analyzer loaded.

 CPU   15.8% |  Mem   27.6% |  GPU     5% @ 49C |  cell  0.010s |  total   40.31s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="nb">print</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">())</span>
<span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="n">free</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">mem_get_info</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Free GB: {free / 1024**3:.2f}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total GB: {total / 1024**3:.2f}&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>True
Free GB: 21.94
Total GB: 23.89

 CPU   13.6% |  Mem   27.6% |  GPU     5% @ 49C |  cell  0.002s |  total   40.31s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Downloading-and-Loading-the-model">Downloading and Loading the model<a class="anchor-link" href="#Downloading-and-Loading-the-model">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 1B  BASELINE LLM (LLM-ONLY QA)</span>
<span class="c1"># Model Behavior Layer  No Retrieval</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_1B_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_1B_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PATH CONTRACT</span>
<span class="c1"># ----------------------------</span>
<span class="n">OUT_LLM_ONLY</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/llm_only&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>

<span class="n">OUT_LLM_ONLY</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># MODEL CONTRACT</span>
<span class="c1"># ----------------------------</span>
<span class="n">MODEL_REPO_ID</span> <span class="o">=</span> <span class="s2">&quot;bartowski/Meta-Llama-3.1-8B-Instruct-GGUF&quot;</span>
<span class="n">MODEL_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;Meta-Llama-3.1-8B-Instruct-Q5_K_M.gguf&quot;</span>

<span class="n">model_path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model_loaded</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">model_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">hf_hub_download</span><span class="p">(</span>
        <span class="n">repo_id</span><span class="o">=</span><span class="n">MODEL_REPO_ID</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">MODEL_FILENAME</span><span class="p">,</span>
        <span class="n">local_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">local_dir_use_symlinks</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">model_loaded</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">model_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LLM CONFIGURATION</span>
<span class="c1"># ----------------------------</span>
<span class="n">N_CTX</span> <span class="o">=</span> <span class="mi">4096</span>
<span class="n">MAX_TOKENS</span> <span class="o">=</span> <span class="mi">512</span>

<span class="n">llm</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">llm_ready</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">if</span> <span class="n">model_loaded</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">llm</span> <span class="o">=</span> <span class="n">Llama</span><span class="p">(</span>
            <span class="n">model_path</span><span class="o">=</span><span class="n">model_path</span><span class="p">,</span>
            <span class="n">n_ctx</span><span class="o">=</span><span class="n">N_CTX</span><span class="p">,</span>
            <span class="n">n_gpu_layers</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">llm_ready</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">model_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># GENERATION FUNCTION</span>
<span class="c1"># ----------------------------</span>
<span class="k">def</span> <span class="nf">llm_only_answer</span><span class="p">(</span>
    <span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">top_p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MAX_TOKENS</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">create_chat_completion</span><span class="p">(</span>
        <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="s2">&quot;You are a medical assistant. &quot;</span>
                    <span class="s2">&quot;Answer clearly and concisely. &quot;</span>
                    <span class="s2">&quot;Provide step-by-step guidance when appropriate. &quot;</span>
                    <span class="s2">&quot;If you are uncertain, say so.&quot;</span>
                <span class="p">),</span>
            <span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
        <span class="p">],</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">top_p</span><span class="o">=</span><span class="n">top_p</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># QUESTIONS</span>
<span class="c1"># ----------------------------</span>
<span class="n">QUESTIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;What is the protocol for managing sepsis in a critical care unit?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the common symptoms of appendicitis, and can it be cured via medicine? If not, what surgical procedure should be followed to treat it?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the effective treatments or solutions for addressing sudden patchy hair loss, commonly seen as localized bald spots on the scalp, and what could be the possible causes behind it?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What treatments are recommended for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip, and what should be considered for their care and recovery?&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PARAMETER GRID</span>
<span class="c1"># ----------------------------</span>
<span class="n">PARAM_GRID</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">},</span>
<span class="p">]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># RUN INFERENCE</span>
<span class="c1"># ----------------------------</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">llm_ready</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; LLM not initialized  skipping inference.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">llm_ready</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">PARAM_GRID</span><span class="p">:</span>
        <span class="n">cfg_block</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">],</span>
            <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;top_p&quot;</span><span class="p">],</span>
            <span class="s2">&quot;n_ctx&quot;</span><span class="p">:</span> <span class="n">N_CTX</span><span class="p">,</span>
            <span class="s2">&quot;max_tokens&quot;</span><span class="p">:</span> <span class="n">MAX_TOKENS</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">run</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">cfg_block</span><span class="p">,</span> <span class="s2">&quot;answers&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">QUESTIONS</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;[Stage 1B] temp=</span><span class="si">{cfg[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg[&#39;top_p&#39;]}</span><span class="s2"> | Q: </span><span class="si">{q[:60]}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">llm_only_answer</span><span class="p">(</span>
                <span class="n">q</span><span class="p">,</span>
                <span class="n">temperature</span><span class="o">=</span><span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">],</span>
                <span class="n">top_p</span><span class="o">=</span><span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;top_p&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">run</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="n">q</span><span class="p">,</span> <span class="s2">&quot;answer&quot;</span><span class="p">:</span> <span class="n">ans</span><span class="p">})</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_1B_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model_downloaded&quot;</span><span class="p">:</span> <span class="n">model_loaded</span><span class="p">,</span>
    <span class="s2">&quot;llm_initialized&quot;</span><span class="p">:</span> <span class="n">llm_ready</span><span class="p">,</span>
    <span class="s2">&quot;questions_present&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTIONS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;param_grid_valid&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">PARAM_GRID</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># baseline = single config</span>
    <span class="s2">&quot;responses_generated&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">PARAM_GRID</span><span class="p">)</span> <span class="k">if</span> <span class="n">llm_ready</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">stage_1B_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_1B_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># WRITE ARTIFACTS (ONLY IF VALID)</span>
<span class="c1"># ----------------------------</span>
<span class="n">answers_path</span> <span class="o">=</span> <span class="n">OUT_LLM_ONLY</span> <span class="o">/</span> <span class="s2">&quot;llm_only_answers.json&quot;</span>
<span class="n">obs_path</span> <span class="o">=</span> <span class="n">OUT_LLM_ONLY</span> <span class="o">/</span> <span class="s2">&quot;llm_only_observations.md&quot;</span>
<span class="n">manifest_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;llm_manifest.json&quot;</span>

<span class="k">if</span> <span class="n">stage_1B_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">answers_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">obs_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# LLM-Only Observations (Stage 1B)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;1B&quot;</span><span class="p">,</span>
                <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
                <span class="s2">&quot;backend&quot;</span><span class="p">:</span> <span class="s2">&quot;llama-cpp-python&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model_repo_id&quot;</span><span class="p">:</span> <span class="n">MODEL_REPO_ID</span><span class="p">,</span>
                <span class="s2">&quot;model_filename&quot;</span><span class="p">:</span> <span class="n">MODEL_FILENAME</span><span class="p">,</span>
                <span class="s2">&quot;model_path&quot;</span><span class="p">:</span> <span class="n">model_path</span><span class="p">,</span>
                <span class="s2">&quot;n_ctx&quot;</span><span class="p">:</span> <span class="n">N_CTX</span><span class="p">,</span>
                <span class="s2">&quot;n_gpu_layers&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;param_grid&quot;</span><span class="p">:</span> <span class="n">PARAM_GRID</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">f</span><span class="p">,</span>
            <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 1B&quot;</span><span class="p">,</span> <span class="s2">&quot;BASELINE LLM (LLM-ONLY QA)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;MODEL CONFIGURATION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Model repo              : </span><span class="si">{MODEL_REPO_ID}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Model file              : </span><span class="si">{MODEL_FILENAME}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Context window          : </span><span class="si">{N_CTX}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Max tokens              : </span><span class="si">{MAX_TOKENS}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;EXECUTION SUMMARY&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Questions evaluated     : {len(QUESTIONS)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Parameter combinations  : {len(PARAM_GRID)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Runs completed          : {len(results)}&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_1B_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:26s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 1B&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_1B_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;baseline LLM responses generated successfully (LLM-only).&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="n">f</span><span class="s2">&quot;LLM baseline failed  </span><span class="si">{model_error}</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_1B_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;llm_only_answers.json     : </span><span class="si">{answers_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;llm_only_observations.md  : </span><span class="si">{obs_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;llm_manifest.json         : </span><span class="si">{manifest_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No artifacts written due to validation failure.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>llama_context: n_ctx_per_seq (4096) &lt; n_ctx_train (131072) -- the full capacity of the model will not be utilized
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[Stage 1B] temp=0.2 | top_p=0.9 | Q: What is the protocol for managing sepsis in a critical care ...
[Stage 1B] temp=0.2 | top_p=0.9 | Q: What are the common symptoms of appendicitis, and can it be ...
[Stage 1B] temp=0.2 | top_p=0.9 | Q: What are the effective treatments or solutions for addressin...
[Stage 1B] temp=0.2 | top_p=0.9 | Q: What treatments are recommended for a person who has sustain...
[Stage 1B] temp=0.2 | top_p=0.9 | Q: What are the necessary precautions and treatment steps for a...
====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 1B BASELINE LLM (LLM-ONLY QA)
====================================================================================================

[MODEL CONFIGURATION]
Model repo              : bartowski/Meta-Llama-3.1-8B-Instruct-GGUF
Model file              : Meta-Llama-3.1-8B-Instruct-Q5_K_M.gguf
Context window          : 4096
Max tokens              : 512

[EXECUTION SUMMARY]
Questions evaluated     : 5
Parameter combinations  : 1
Runs completed          : 1

[VALIDATION GATES]
model_downloaded          :  PASS
llm_initialized           :  PASS
questions_present         :  PASS
param_grid_valid          :  PASS
responses_generated       :  PASS

[STAGE 1B] STATUS
 VERIFIED  baseline LLM responses generated successfully (LLM-only).
====================================================================================================

[ARTIFACTS WRITTEN]
llm_only_answers.json     : OUT/llm_only/llm_only_answers.json
llm_only_observations.md  : OUT/llm_only/llm_only_observations.md
llm_manifest.json         : OUT/manifests/llm_manifest.json
====================================================================================================

 CPU   51.5% |  Mem   29.3% |  GPU     5% @ 49C |  cell 286.169s |  total  326.48s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 2B  GPU MEMORY HYGIENE (POST-INFERENCE BOUNDARY)</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_2B_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_2B_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EXECUTION</span>
<span class="c1"># ----------------------------</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_2B_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gc_executed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>                     <span class="c1"># gc.collect() always runs if reached</span>
    <span class="s2">&quot;cuda_available&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">(),</span>
<span class="p">}</span>

<span class="n">stage_2B_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_2B_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 2B&quot;</span><span class="p">,</span> <span class="s2">&quot;GPU MEMORY HYGIENE (POST-INFERENCE BOUNDARY)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;EXECUTION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Python garbage collection invoked.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CUDA allocator cache cleared.&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_2B_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:26s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 2B&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_2B_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;GPU memory hygiene completed; runtime ready for next model stage.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;GPU memory hygiene incomplete  investigate runtime state.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 2B GPU MEMORY HYGIENE (POST-INFERENCE BOUNDARY)
====================================================================================================

[EXECUTION]
Python garbage collection invoked.
CUDA allocator cache cleared.

[VALIDATION GATES]
gc_executed               :  PASS
cuda_available            :  PASS
status                    :  PASS

[STAGE 2B] STATUS
 VERIFIED  GPU memory hygiene completed; runtime ready for next model stage.
====================================================================================================
====================================================================================================

 CPU    7.0% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.287s |  total  326.76s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 3B  DISPLAY BASELINE LLM-ONLY ANSWERS (READ-ONLY)</span>
<span class="c1"># ============================================================</span>

<span class="n">ANSWERS_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/llm_only/llm_only_answers.json&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">ANSWERS_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span> <span class="n">f</span><span class="s2">&quot;Missing LLM answers file: </span><span class="si">{ANSWERS_PATH}</span><span class="s2">&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ANSWERS_PATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;LLM results file is empty or malformed&quot;</span>

<span class="c1"># ------------------------------------------------------------</span>
<span class="c1"># SELECT REFERENCE CONFIGURATION</span>
<span class="c1"># ------------------------------------------------------------</span>
<span class="c1"># By convention, we treat the first parameter set</span>
<span class="c1"># (temp=0.2, top_p=0.9) as the reference LLM-only configuration.</span>
<span class="n">REFERENCE_RUN_INDEX</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">assert</span> <span class="s2">&quot;config&quot;</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="n">REFERENCE_RUN_INDEX</span><span class="p">],</span> <span class="s2">&quot;Reference run missing config&quot;</span>
<span class="k">assert</span> <span class="s2">&quot;answers&quot;</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="n">REFERENCE_RUN_INDEX</span><span class="p">],</span> <span class="s2">&quot;Reference run missing answers&quot;</span>

<span class="n">reference_config</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">REFERENCE_RUN_INDEX</span><span class="p">][</span><span class="s2">&quot;config&quot;</span><span class="p">]</span>
<span class="n">reference_answers</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">REFERENCE_RUN_INDEX</span><span class="p">][</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference_answers</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference_answers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;No answers found in reference run&quot;</span>

<span class="c1"># ------------------------------------------------------------</span>
<span class="c1"># BUILD LOOKUP</span>
<span class="c1"># ------------------------------------------------------------</span>
<span class="n">answers_by_question</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">qa</span><span class="p">[</span><span class="s2">&quot;question&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">qa</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">qa</span> <span class="ow">in</span> <span class="n">reference_answers</span>
    <span class="k">if</span> <span class="s2">&quot;question&quot;</span> <span class="ow">in</span> <span class="n">qa</span> <span class="ow">and</span> <span class="s2">&quot;answer&quot;</span> <span class="ow">in</span> <span class="n">qa</span>
<span class="p">}</span>

<span class="c1"># ------------------------------------------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ------------------------------------------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 3B&quot;</span><span class="p">,</span> <span class="s2">&quot;DISPLAY BASELINE LLM-ONLY ANSWERS (READ-ONLY)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;REFERENCE CONFIGURATION&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reference_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:22s}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ANSWER LOOKUP&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Questions loaded        : {len(answers_by_question)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 3B&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">answers_by_question</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;LLM-only answers loaded and ready for analysis.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;LLM-only answer lookup failed.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS READ&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;llm_only_answers.json   : </span><span class="si">{ANSWERS_PATH}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 3B DISPLAY BASELINE LLM-ONLY ANSWERS (READ-ONLY)
====================================================================================================

[REFERENCE CONFIGURATION]
temperature           : 0.2
top_p                 : 0.9
n_ctx                 : 4096
max_tokens            : 512

[ANSWER LOOKUP]
Questions loaded        : 5

[STAGE 3B] STATUS
 VERIFIED  LLM-only answers loaded and ready for analysis.
====================================================================================================

[ARTIFACTS READ]
llm_only_answers.json   : OUT/llm_only/llm_only_answers.json
====================================================================================================

 CPU   11.6% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.006s |  total  326.77s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-1:-What-is-the-protocol-for-managing-sepsis-in-a-critical-care-unit?">Query 1: What is the protocol for managing sepsis in a critical care unit?<a class="anchor-link" href="#Query-1:-What-is-the-protocol-for-managing-sepsis-in-a-critical-care-unit?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 1  Baseline Answer (Standardized Output + Audit)</span>

<span class="n">display_answer_with_audit</span><span class="p">(</span>
    <span class="n">answers_by_question</span><span class="p">[</span>
        <span class="s2">&quot;What is the protocol for managing sepsis in a critical care unit?&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline Sepsis Response&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Managing sepsis in a critical care unit requires a prompt and multi-step approach. Here&#39;s a general protocol:

**Initial Assessment (0-10 minutes)**

1. **Recognize sepsis**: Identify patients with suspected sepsis based on clinical presentation (e.g., fever, tachycardia, tachypnea, altered mental status).
2. **Activate the sepsis response team**: Alert the critical care team, including the physician, nurse, and other necessary personnel.
3. **Assess vital signs**: Monitor and record vital signs, including temperature, heart rate, blood pressure, respiratory rate, and oxygen saturation.

**Early Goal-Directed Therapy (EGDT) (0-60 minutes)**

1. **Administer broad-spectrum antibiotics**: Give antibiotics within 1 hour of suspected sepsis diagnosis.
2. **Fluid resuscitation**: Administer 30 mL/kg of crystalloid fluids (e.g., normal saline or lactated Ringer&#39;s solution) over 30 minutes to achieve a central venous pressure (CVP) of 8-12 mmHg.
3. **Monitor and adjust**: Continuously monitor vital signs, CVP, and urine output, and adjust fluid administration as needed.

**Continued Management (60-120 minutes)**

1. **Monitor lactate levels**: Check lactate levels to assess tissue perfusion.
2. **Optimize oxygenation**: Ensure adequate oxygenation and ventilation, and consider invasive mechanical ventilation if necessary.
3. **Maintain blood pressure**: Use vasopressors (e.g., norepinephrine) to maintain a mean arterial pressure (MAP) of 65 mmHg or higher.
4. **Monitor and adjust**: Continuously monitor vital signs, lactate levels, and urine output, and adjust treatment as needed.

**Ongoing Care (beyond 120 minutes)**

1. **Reassess and adjust**: Continuously reassess the patient&#39;s condition and adjust treatment as needed.
2. **Consider additional interventions**: Consider additional interventions, such as renal replacement therapy, vasopressor titration, or corticosteroids, based on the patient&#39;s response to treatment.
3. **Monitor for complications**: Monitor for potential complications, such as acute kidney injury, respiratory failure, or cardiac arrest.

**Documentation and Communication**

1. **Document all interventions**: Accurately document all interventions, including medications, fluids, and laboratory results.
2. **Communicate with the team**: Communic

====================================================================================================
NEUROFORGE72 PIPELINE  RESPONSE EVALUATION (CROSS-STAGE)
====================================================================================================

[INPUT]
Source label : Baseline Sepsis Response
Preview      : Managing sepsis in a critical care unit requires a prompt and multi-step approach. Here&#39;s a general protocol:  **Initial Assessment (0-10 minutes)**  1. **Recognize sepsis**: Identify patients with suspected sepsis based on clinical presentation (e.g., fever, tachycardia, tachypnea, altered mental s...

[CORE DIMENSIONS]
Clinical directiveness : Moderate
Risk escalation        : High
Epistemic caution      : Low
Actionability          : High

[LEXICAL SIGNALS]
Hedging terms          : 3
Assertive terms        : 1
Safety flags           : 7
Uncertainty flags      : 0
Step indicators        : 16

[OVERALL TONE]
Tone classification    : High clinical urgency

[INTERPRETATION]
 Response appropriately escalates risk and urgency.

[STAGE 0B] STATUS
 Evaluation completed  metrics ready for comparison.
====================================================================================================

 CPU   18.5% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.001s |  total  326.77s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-2:-What-are-the-common-symptoms-for-appendicitis,-and-can-it-be-cured-via-medicine?-If-not,-what-surgical-procedure-should-be-followed-to-treat-it?">Query 2: What are the common symptoms for appendicitis, and can it be cured via medicine? If not, what surgical procedure should be followed to treat it?<a class="anchor-link" href="#Query-2:-What-are-the-common-symptoms-for-appendicitis,-and-can-it-be-cured-via-medicine?-If-not,-what-surgical-procedure-should-be-followed-to-treat-it?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 2  Baseline Answer</span>
<span class="n">display_answer_with_audit</span><span class="p">(</span>
    <span class="n">answers_by_question</span><span class="p">[</span>
        <span class="s2">&quot;What are the common symptoms of appendicitis, and can it be cured via medicine? If not, what surgical procedure should be followed to treat it?&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline Appendicitis Response&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>**Common Symptoms of Appendicitis:**

Appendicitis is a medical emergency that requires prompt attention. The common symptoms include:

1. **Abdominal pain**: A sharp, stabbing pain in the lower right abdomen that may worsen over time.
2. **Nausea and vomiting**: Feeling queasy or vomiting due to the inflammation and irritation of the appendix.
3. **Loss of appetite**: A decrease in appetite due to the discomfort and pain.
4. **Fever**: A temperature elevation, usually above 100.4F (38C), indicating an infection.
5. **Rebound tenderness**: Pain when pressing on the abdomen and then releasing it.
6. **Abdominal tenderness**: Pain when touching the abdomen, especially in the lower right area.

**Can Appendicitis be Cured via Medicine?**

Unfortunately, appendicitis cannot be cured solely with medication. Antibiotics may be prescribed to treat the infection, but they do not address the underlying issue of the inflamed appendix. If left untreated, the appendix can rupture, leading to severe complications, such as peritonitis (inflammation of the abdominal lining) and sepsis (blood infection).

**Surgical Procedure to Treat Appendicitis:**

The standard treatment for appendicitis is surgical removal of the appendix, known as an **appendectomy**. There are two types of appendectomies:

1. **Open appendectomy**: A traditional surgical procedure where the surgeon makes a large incision in the abdomen to access the appendix.
2. **Laparoscopic appendectomy**: A minimally invasive procedure where the surgeon makes several small incisions and uses a laparoscope (a thin tube with a camera) to visualize the appendix.

In both cases, the surgeon will:

1. **Make an incision**: In the abdomen to access the appendix.
2. **Locate the appendix**: Identify the inflamed appendix and surrounding tissues.
3. **Remove the appendix**: Carefully remove the appendix, taking care not to damage surrounding tissues.
4. **Close the incision**: Close the incision with sutures or staples.

After the surgery, patients are usually monitored for a few hours to ensure there are no complications. They may be prescribed pain medication and antibiotics to prevent infection.

It is essential to seek medical attention immediately if you suspect appendicitis. Delaying treatment can lead to serious complications.

====================================================================================================
NEUROFORGE72 PIPELINE  RESPONSE EVALUATION (CROSS-STAGE)
====================================================================================================

[INPUT]
Source label : Baseline Appendicitis Response
Preview      : **Common Symptoms of Appendicitis:**  Appendicitis is a medical emergency that requires prompt attention. The common symptoms include:  1. **Abdominal pain**: A sharp, stabbing pain in the lower right abdomen that may worsen over time. 2. **Nausea and vomiting**: Feeling queasy or vomiting due to th...

[CORE DIMENSIONS]
Clinical directiveness : Moderate
Risk escalation        : High
Epistemic caution      : Low
Actionability          : High

[LEXICAL SIGNALS]
Hedging terms          : 5
Assertive terms        : 2
Safety flags           : 8
Uncertainty flags      : 0
Step indicators        : 9

[OVERALL TONE]
Tone classification    : High clinical urgency

[INTERPRETATION]
 Response appropriately escalates risk and urgency.

[STAGE 0B] STATUS
 Evaluation completed  metrics ready for comparison.
====================================================================================================

 CPU   12.0% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.001s |  total  326.77s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-3:-What-are-the-effective-treatments-or-solutions-for-addressing-sudden-patchy-hair-loss,-commonly-seen-as-localized-bald-spots-on-the-scalp,-and-what-could-be-the-possible-causes-behind-it?">Query 3: What are the effective treatments or solutions for addressing sudden patchy hair loss, commonly seen as localized bald spots on the scalp, and what could be the possible causes behind it?<a class="anchor-link" href="#Query-3:-What-are-the-effective-treatments-or-solutions-for-addressing-sudden-patchy-hair-loss,-commonly-seen-as-localized-bald-spots-on-the-scalp,-and-what-could-be-the-possible-causes-behind-it?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 3  Baseline Answer</span>
<span class="n">display_answer_with_audit</span><span class="p">(</span>
    <span class="n">answers_by_question</span><span class="p">[</span>
        <span class="s2">&quot;What are the effective treatments or solutions for addressing sudden patchy hair loss, commonly seen as localized bald spots on the scalp, and what could be the possible causes behind it?&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline Hair Loss Response&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>As a medical assistant, I&#39;ll provide you with information on possible causes and effective treatments for sudden patchy hair loss.

**Possible Causes:**

1. **Alopecia Areata**: An autoimmune disease that causes hair loss in patches.
2. **Telogen Effluvium**: A condition where hair enters the resting phase and falls out, often due to stress, hormonal changes, or nutritional deficiencies.
3. **Traction Alopecia**: Hair loss caused by constant pulling or tension on the hair follicles, often due to tight hairstyles or hair extensions.
4. **Fungal Infections**: Fungal infections like ringworm can cause hair loss in patches.
5. **Nutritional Deficiencies**: Lack of essential nutrients like iron, zinc, or biotin can lead to hair loss.
6. **Hormonal Imbalance**: Hormonal changes, such as those experienced during pregnancy or menopause, can cause hair loss.
7. **Stress**: Physical or emotional stress can cause hair loss.

**Effective Treatments:**

1. **Minoxidil (Rogaine)**: Apply a 2% or 5% solution to the affected area to stimulate hair growth.
2. **Corticosteroid Injections**: Inject corticosteroids into the affected area to reduce inflammation and promote hair growth.
3. **Low-Level Laser Therapy (LLLT)**: Use a low-level laser or light-emitting device to stimulate hair growth.
4. **Platelet-Rich Plasma (PRP) Therapy**: Inject platelet-rich plasma (PRP) into the affected area to stimulate hair growth.
5. **Medications**: Antifungal medications, such as ketoconazole, may be prescribed to treat fungal infections.
6. **Dietary Changes**: Ensure adequate nutrition by consuming foods rich in essential nutrients, such as iron, zinc, and biotin.
7. **Reduce Stress**: Engage in stress-reducing activities, such as meditation or yoga.

**Step-by-Step Guidance:**

1. **Consult a Doctor**: Schedule an appointment with a dermatologist or primary care physician to determine the underlying cause of hair loss.
2. **Get a Hair Loss Diagnosis**: The doctor will examine your scalp, take a medical history, and perform tests to determine the cause of hair loss.
3. **Develop a Treatment Plan**: Based on the diagnosis, the doctor will recommend a treatment plan, which may include medications, topical treatments, or lifestyle changes.
4. **Follow Treatment Instructions**: Follow the

====================================================================================================
NEUROFORGE72 PIPELINE  RESPONSE EVALUATION (CROSS-STAGE)
====================================================================================================

[INPUT]
Source label : Baseline Hair Loss Response
Preview      : As a medical assistant, I&#39;ll provide you with information on possible causes and effective treatments for sudden patchy hair loss.  **Possible Causes:**  1. **Alopecia Areata**: An autoimmune disease that causes hair loss in patches. 2. **Telogen Effluvium**: A condition where hair enters the restin...

[CORE DIMENSIONS]
Clinical directiveness : Low
Risk escalation        : Low
Epistemic caution      : Low
Actionability          : High

[LEXICAL SIGNALS]
Hedging terms          : 7
Assertive terms        : 0
Safety flags           : 0
Uncertainty flags      : 0
Step indicators        : 11

[OVERALL TONE]
Tone classification    : Cautious / neutral

[INTERPRETATION]
 Response maintains a cautious, explanatory clinical tone.

[STAGE 0B] STATUS
 Evaluation completed  metrics ready for comparison.
====================================================================================================

 CPU    3.3% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.001s |  total  326.77s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-4:--What-treatments-are-recommended-for-a-person-who-has-sustained-a-physical-injury-to-brain-tissue,-resulting-in-temporary-or-permanent-impairment-of-brain-function?">Query 4:  What treatments are recommended for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function?<a class="anchor-link" href="#Query-4:--What-treatments-are-recommended-for-a-person-who-has-sustained-a-physical-injury-to-brain-tissue,-resulting-in-temporary-or-permanent-impairment-of-brain-function?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 4  Baseline Answer</span>
<span class="n">display_answer_with_audit</span><span class="p">(</span>
    <span class="n">answers_by_question</span><span class="p">[</span>
        <span class="s2">&quot;What treatments are recommended for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function?&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline Brain Injury Response&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>As a medical assistant, I&#39;ll provide general information on treatments for brain injuries. However, please note that specific treatment plans may vary depending on the severity and type of injury, as well as individual patient needs.

**Initial Treatment (Acute Phase)**

1. **Stabilization**: Ensure the patient&#39;s airway, breathing, and circulation (ABCs) are stable.
2. **Imaging studies**: Conduct CT or MRI scans to assess the extent of the injury.
3. **Monitoring**: Closely monitor vital signs, neurological status, and potential complications (e.g., seizures, increased intracranial pressure).
4. **Supportive care**: Provide oxygen therapy, pain management, and hydration as needed.

**Rehabilitation Phase**

1. **Neurological rehabilitation**: Engage in physical, occupational, and speech therapy to address cognitive, motor, and communication impairments.
2. **Medications**: Use medications to manage symptoms, such as:
	* Seizure control (e.g., anticonvulsants).
	* Pain management (e.g., analgesics, muscle relaxants).
	* Mood stabilization (e.g., antidepressants, mood stabilizers).
3. **Cognitive rehabilitation**: Focus on improving attention, memory, executive functions, and processing speed.
4. **Speech and language therapy**: Address communication difficulties, such as aphasia or dysarthria.
5. **Physical therapy**: Enhance mobility, balance, and strength.
6. **Occupational therapy**: Promote independence in daily activities, such as bathing, dressing, and feeding.

**Surgical Interventions**

1. **Surgical decompression**: Relieve pressure on the brain by removing blood clots or bone fragments.
2. **Cerebrospinal fluid (CSF) drainage**: Reduce intracranial pressure by draining excess CSF.
3. **Ventriculostomy**: Insert a catheter to drain CSF and monitor intracranial pressure.

**Long-term Management**

1. **Follow-up care**: Regularly schedule appointments with healthcare providers to monitor progress and adjust treatment plans.
2. **Lifestyle modifications**: Encourage patients to adopt a healthy lifestyle, including regular exercise, balanced diet, and stress management.
3. **Cognitive training**: Engage in cognitive training programs to improve cognitive function and prevent further decline.
4. **Support groups**: Join support groups to connect with others who have experienced similar brain injuries.

Please note that this is a general overview, and specific

====================================================================================================
NEUROFORGE72 PIPELINE  RESPONSE EVALUATION (CROSS-STAGE)
====================================================================================================

[INPUT]
Source label : Baseline Brain Injury Response
Preview      : As a medical assistant, I&#39;ll provide general information on treatments for brain injuries. However, please note that specific treatment plans may vary depending on the severity and type of injury, as well as individual patient needs.  **Initial Treatment (Acute Phase)**  1. **Stabilization**: Ensure...

[CORE DIMENSIONS]
Clinical directiveness : Low
Risk escalation        : High
Epistemic caution      : Moderate
Actionability          : High

[LEXICAL SIGNALS]
Hedging terms          : 1
Assertive terms        : 0
Safety flags           : 4
Uncertainty flags      : 1
Step indicators        : 14

[OVERALL TONE]
Tone classification    : High clinical urgency

[INTERPRETATION]
 Response appropriately escalates risk and urgency.

[STAGE 0B] STATUS
 Evaluation completed  metrics ready for comparison.
====================================================================================================

 CPU   18.5% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.001s |  total  326.77s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-5:-What-are-the-necessary-precautions-and-treatment-steps-for-a-person-who-has-fractured-their-leg-during-a-hiking-trip,-and-what-should-be-considered-for-their-care-and-recovery?">Query 5: What are the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip, and what should be considered for their care and recovery?<a class="anchor-link" href="#Query-5:-What-are-the-necessary-precautions-and-treatment-steps-for-a-person-who-has-fractured-their-leg-during-a-hiking-trip,-and-what-should-be-considered-for-their-care-and-recovery?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 5  Baseline Answer</span>
<span class="n">display_answer_with_audit</span><span class="p">(</span>
    <span class="n">answers_by_question</span><span class="p">[</span>
        <span class="s2">&quot;What are the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip, and what should be considered for their care and recovery?&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline Fractured Leg Response&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>If a person has fractured their leg during a hiking trip, it&#39;s essential to take immediate action to prevent further injury and promote proper healing. Here are the necessary precautions and treatment steps:

**Precautions:**

1. **Immobilize the leg**: Use a splint or a makeshift splint (e.g., a hiking pole, a stick, or a piece of clothing) to keep the leg straight and prevent further movement.
2. **Stop activity**: Immediately stop any physical activity and rest the leg.
3. **Assess the injury**: Check for any other injuries, such as cuts or swelling, and provide basic first aid if necessary.
4. **Call for help**: If possible, call for emergency assistance or have someone hike back to civilization to seek medical help.

**Treatment steps:**

1. **Apply the RICE principle**:
	* **R**est: Avoid putting weight on the injured leg.
	* **I**ce: Apply ice to the affected area to reduce pain and swelling.
	* **C**ompression: Use an elastic bandage or a compression wrap to help reduce swelling.
	* **E**levation: Elevate the injured leg above the level of the heart to reduce swelling.
2. **Provide pain relief**: Offer over-the-counter pain medication, such as acetaminophen or ibuprofen, to help manage pain and discomfort.
3. **Monitor for signs of complications**: Keep an eye out for signs of infection, such as redness, swelling, or increased pain, and seek medical attention if these symptoms occur.

**Care and recovery considerations:**

1. **Seek medical attention**: As soon as possible, seek medical attention from a doctor or a medical professional.
2. **Get an X-ray**: An X-ray will help confirm the diagnosis and determine the severity of the fracture.
3. **Follow treatment plan**: Adhere to the treatment plan, which may include casting, bracing, or surgery, and follow any instructions provided by the medical professional.
4. **Rest and recovery**: Allow the leg to rest and recover, and avoid putting weight on the injured leg until it&#39;s fully healed.
5. **Physical therapy**: After the initial healing period, consider physical therapy to regain strength and mobility in the affected leg.
6. **Follow-up care**: Schedule follow-up appointments with the medical professional to monitor progress and address any concerns.

**Additional considerations:**

1. **Altitude and weather**: If the injury occurs at high altitude or in extreme weather conditions

====================================================================================================
NEUROFORGE72 PIPELINE  RESPONSE EVALUATION (CROSS-STAGE)
====================================================================================================

[INPUT]
Source label : Baseline Fractured Leg Response
Preview      : If a person has fractured their leg during a hiking trip, it&#39;s essential to take immediate action to prevent further injury and promote proper healing. Here are the necessary precautions and treatment steps:  **Precautions:**  1. **Immobilize the leg**: Use a splint or a makeshift splint (e.g., a hi...

[CORE DIMENSIONS]
Clinical directiveness : Low
Risk escalation        : High
Epistemic caution      : Low
Actionability          : High

[LEXICAL SIGNALS]
Hedging terms          : 6
Assertive terms        : 0
Safety flags           : 6
Uncertainty flags      : 0
Step indicators        : 16

[OVERALL TONE]
Tone classification    : High clinical urgency

[INTERPRETATION]
 Response appropriately escalates risk and urgency.

[STAGE 0B] STATUS
 Evaluation completed  metrics ready for comparison.
====================================================================================================

 CPU   20.0% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.001s |  total  326.78s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Question-Answering-using-LLM-with-Prompt-Engineering">Question Answering using LLM with Prompt Engineering<a class="anchor-link" href="#Question-Answering-using-LLM-with-Prompt-Engineering">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 0C  PROMPT-ENGINEERED LLM (LLM-ONLY QA)</span>
<span class="c1"># Model Behavior Layer  No Retrieval</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_0C_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_0C_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PATH CONTRACT</span>
<span class="c1"># ----------------------------</span>
<span class="n">OUT_LLM_ONLY</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/llm_only&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>

<span class="n">OUT_LLM_ONLY</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># MODEL CONTRACT</span>
<span class="c1"># ----------------------------</span>
<span class="n">MODEL_REPO_ID</span> <span class="o">=</span> <span class="s2">&quot;bartowski/Meta-Llama-3.1-8B-Instruct-GGUF&quot;</span>
<span class="n">MODEL_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;Meta-Llama-3.1-8B-Instruct-Q5_K_M.gguf&quot;</span>

<span class="n">model_path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model_loaded</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">model_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">hf_hub_download</span><span class="p">(</span>
        <span class="n">repo_id</span><span class="o">=</span><span class="n">MODEL_REPO_ID</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">MODEL_FILENAME</span><span class="p">,</span>
        <span class="n">local_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">local_dir_use_symlinks</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">model_loaded</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">model_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LLM CONFIGURATION</span>
<span class="c1"># ----------------------------</span>
<span class="n">N_CTX</span> <span class="o">=</span> <span class="mi">4096</span>
<span class="n">MAX_TOKENS</span> <span class="o">=</span> <span class="mi">512</span>

<span class="n">llm</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">llm_ready</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">if</span> <span class="n">model_loaded</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">llm</span> <span class="o">=</span> <span class="n">Llama</span><span class="p">(</span>
            <span class="n">model_path</span><span class="o">=</span><span class="n">model_path</span><span class="p">,</span>
            <span class="n">n_ctx</span><span class="o">=</span><span class="n">N_CTX</span><span class="p">,</span>
            <span class="n">n_gpu_layers</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">llm_ready</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">model_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># GENERATION FUNCTION</span>
<span class="c1"># ----------------------------</span>
<span class="k">def</span> <span class="nf">llm_only_answer</span><span class="p">(</span>
    <span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">top_p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MAX_TOKENS</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">create_chat_completion</span><span class="p">(</span>
        <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="s2">&quot;You are a medical assistant. &quot;</span>
                    <span class="s2">&quot;Answer clearly and concisely. &quot;</span>
                    <span class="s2">&quot;Provide step-by-step guidance when appropriate. &quot;</span>
                    <span class="s2">&quot;If you are uncertain, say so.&quot;</span>
                <span class="p">),</span>
            <span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
        <span class="p">],</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">top_p</span><span class="o">=</span><span class="n">top_p</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># QUESTIONS</span>
<span class="c1"># ----------------------------</span>
<span class="n">QUESTIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;What is the protocol for managing sepsis in a critical care unit?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the common symptoms of appendicitis, and can it be cured via medicine? If not, what surgical procedure should be followed to treat it?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the effective treatments or solutions for addressing sudden patchy hair loss, commonly seen as localized bald spots on the scalp, and what could be the possible causes behind it?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What treatments are recommended for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip, and what should be considered for their care and recovery?&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PARAMETER GRID</span>
<span class="c1"># ----------------------------</span>
<span class="n">PARAM_GRID</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">},</span>
<span class="p">]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># RUN INFERENCE</span>
<span class="c1"># ----------------------------</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">llm_ready</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; LLM not initialized  skipping inference.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">llm_ready</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">PARAM_GRID</span><span class="p">:</span>
        <span class="n">cfg_block</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">],</span>
            <span class="s2">&quot;top_p&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;top_p&quot;</span><span class="p">],</span>
            <span class="s2">&quot;n_ctx&quot;</span><span class="p">:</span> <span class="n">N_CTX</span><span class="p">,</span>
            <span class="s2">&quot;max_tokens&quot;</span><span class="p">:</span> <span class="n">MAX_TOKENS</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">run</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">cfg_block</span><span class="p">,</span> <span class="s2">&quot;answers&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">QUESTIONS</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;[Stage 0C] temp=</span><span class="si">{cfg[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg[&#39;top_p&#39;]}</span><span class="s2"> | Q: </span><span class="si">{q[:60]}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">llm_only_answer</span><span class="p">(</span>
                <span class="n">q</span><span class="p">,</span>
                <span class="n">temperature</span><span class="o">=</span><span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">],</span>
                <span class="n">top_p</span><span class="o">=</span><span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;top_p&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">run</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="n">q</span><span class="p">,</span> <span class="s2">&quot;answer&quot;</span><span class="p">:</span> <span class="n">ans</span><span class="p">})</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_0C_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model_downloaded&quot;</span><span class="p">:</span> <span class="n">model_loaded</span><span class="p">,</span>
    <span class="s2">&quot;llm_initialized&quot;</span><span class="p">:</span> <span class="n">llm_ready</span><span class="p">,</span>
    <span class="s2">&quot;questions_present&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTIONS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;param_grid_valid&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">PARAM_GRID</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;responses_generated&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">PARAM_GRID</span><span class="p">)</span> <span class="k">if</span> <span class="n">llm_ready</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">stage_0C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_0C_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># WRITE ARTIFACTS (ONLY IF VALID)</span>
<span class="c1"># ----------------------------</span>
<span class="n">answers_path</span> <span class="o">=</span> <span class="n">OUT_LLM_ONLY</span> <span class="o">/</span> <span class="s2">&quot;llm_only_answers.json&quot;</span>
<span class="n">obs_path</span> <span class="o">=</span> <span class="n">OUT_LLM_ONLY</span> <span class="o">/</span> <span class="s2">&quot;llm_only_observations.md&quot;</span>
<span class="n">manifest_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;llm_manifest.json&quot;</span>

<span class="k">if</span> <span class="n">stage_0C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">answers_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">obs_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# LLM-Only Observations (Stage 1B)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;0C&quot;</span><span class="p">,</span>
                <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
                <span class="s2">&quot;backend&quot;</span><span class="p">:</span> <span class="s2">&quot;llama-cpp-python&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model_repo_id&quot;</span><span class="p">:</span> <span class="n">MODEL_REPO_ID</span><span class="p">,</span>
                <span class="s2">&quot;model_filename&quot;</span><span class="p">:</span> <span class="n">MODEL_FILENAME</span><span class="p">,</span>
                <span class="s2">&quot;model_path&quot;</span><span class="p">:</span> <span class="n">model_path</span><span class="p">,</span>
                <span class="s2">&quot;n_ctx&quot;</span><span class="p">:</span> <span class="n">N_CTX</span><span class="p">,</span>
                <span class="s2">&quot;n_gpu_layers&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;param_grid&quot;</span><span class="p">:</span> <span class="n">PARAM_GRID</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">f</span><span class="p">,</span>
            <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 0C&quot;</span><span class="p">,</span> <span class="s2">&quot;PROMPT-ENGINEERED LLM (LLM-ONLY QA)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;MODEL CONFIGURATION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Model repo              : </span><span class="si">{MODEL_REPO_ID}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Model file              : </span><span class="si">{MODEL_FILENAME}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Context window          : </span><span class="si">{N_CTX}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Max tokens              : </span><span class="si">{MAX_TOKENS}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;EXECUTION SUMMARY&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Questions evaluated     : {len(QUESTIONS)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Parameter combinations  : {len(PARAM_GRID)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Runs completed          : {len(results)}&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_0C_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:26s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 0C&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_0C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;PROMPT-ENGINEERED responses generated successfully (LLM-only).&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="n">f</span><span class="s2">&quot;PROMPT-ENGINEERED failed  </span><span class="si">{model_error}</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_0C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;llm_only_answers.json     : </span><span class="si">{answers_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;llm_only_observations.md  : </span><span class="si">{obs_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;llm_manifest.json         : </span><span class="si">{manifest_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No artifacts written due to validation failure.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>llama_context: n_ctx_per_seq (4096) &lt; n_ctx_train (131072) -- the full capacity of the model will not be utilized
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[Stage 0C] temp=0.2 | top_p=0.9 | Q: What is the protocol for managing sepsis in a critical care ...
[Stage 0C] temp=0.2 | top_p=0.9 | Q: What are the common symptoms of appendicitis, and can it be ...
[Stage 0C] temp=0.2 | top_p=0.9 | Q: What are the effective treatments or solutions for addressin...
[Stage 0C] temp=0.2 | top_p=0.9 | Q: What treatments are recommended for a person who has sustain...
[Stage 0C] temp=0.2 | top_p=0.9 | Q: What are the necessary precautions and treatment steps for a...
[Stage 0C] temp=0.3 | top_p=0.9 | Q: What is the protocol for managing sepsis in a critical care ...
[Stage 0C] temp=0.3 | top_p=0.9 | Q: What are the common symptoms of appendicitis, and can it be ...
[Stage 0C] temp=0.3 | top_p=0.9 | Q: What are the effective treatments or solutions for addressin...
[Stage 0C] temp=0.3 | top_p=0.9 | Q: What treatments are recommended for a person who has sustain...
[Stage 0C] temp=0.3 | top_p=0.9 | Q: What are the necessary precautions and treatment steps for a...
[Stage 0C] temp=0.2 | top_p=0.8 | Q: What is the protocol for managing sepsis in a critical care ...
[Stage 0C] temp=0.2 | top_p=0.8 | Q: What are the common symptoms of appendicitis, and can it be ...
[Stage 0C] temp=0.2 | top_p=0.8 | Q: What are the effective treatments or solutions for addressin...
[Stage 0C] temp=0.2 | top_p=0.8 | Q: What treatments are recommended for a person who has sustain...
[Stage 0C] temp=0.2 | top_p=0.8 | Q: What are the necessary precautions and treatment steps for a...
[Stage 0C] temp=0.4 | top_p=0.95 | Q: What is the protocol for managing sepsis in a critical care ...
[Stage 0C] temp=0.4 | top_p=0.95 | Q: What are the common symptoms of appendicitis, and can it be ...
[Stage 0C] temp=0.4 | top_p=0.95 | Q: What are the effective treatments or solutions for addressin...
[Stage 0C] temp=0.4 | top_p=0.95 | Q: What treatments are recommended for a person who has sustain...
[Stage 0C] temp=0.4 | top_p=0.95 | Q: What are the necessary precautions and treatment steps for a...
[Stage 0C] temp=0.1 | top_p=0.9 | Q: What is the protocol for managing sepsis in a critical care ...
[Stage 0C] temp=0.1 | top_p=0.9 | Q: What are the common symptoms of appendicitis, and can it be ...
[Stage 0C] temp=0.1 | top_p=0.9 | Q: What are the effective treatments or solutions for addressin...
[Stage 0C] temp=0.1 | top_p=0.9 | Q: What treatments are recommended for a person who has sustain...
[Stage 0C] temp=0.1 | top_p=0.9 | Q: What are the necessary precautions and treatment steps for a...
====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 0C PROMPT-ENGINEERED LLM (LLM-ONLY QA)
====================================================================================================

[MODEL CONFIGURATION]
Model repo              : bartowski/Meta-Llama-3.1-8B-Instruct-GGUF
Model file              : Meta-Llama-3.1-8B-Instruct-Q5_K_M.gguf
Context window          : 4096
Max tokens              : 512

[EXECUTION SUMMARY]
Questions evaluated     : 5
Parameter combinations  : 5
Runs completed          : 5

[VALIDATION GATES]
model_downloaded          :  PASS
llm_initialized           :  PASS
questions_present         :  PASS
param_grid_valid          :  PASS
responses_generated       :  PASS

[STAGE 0C] STATUS
 VERIFIED  PROMPT-ENGINEERED responses generated successfully (LLM-only).
====================================================================================================

[ARTIFACTS WRITTEN]
llm_only_answers.json     : OUT/llm_only/llm_only_answers.json
llm_only_observations.md  : OUT/llm_only/llm_only_observations.md
llm_manifest.json         : OUT/manifests/llm_manifest.json
====================================================================================================

 CPU   51.3% |  Mem   29.3% |  GPU     5% @ 49C |  cell 1391.447s |  total 1718.22s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 1C  GPU MEMORY HYGIENE (POST-INFERENCE BOUNDARY)</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_1C_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_1C_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EXECUTION</span>
<span class="c1"># ----------------------------</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_1C_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gc_executed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;cuda_cache_cleared&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">(),</span>
<span class="p">}</span>

<span class="n">stage_1C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_1C_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 1C&quot;</span><span class="p">,</span> <span class="s2">&quot;GPU MEMORY HYGIENE (POST-INFERENCE BOUNDARY)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;EXECUTION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Python garbage collection invoked.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CUDA cache cleared (allocator reset).&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_1C_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:26s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 1C&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_1C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;GPU memory hygiene completed; runtime ready for next model stage.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;GPU memory hygiene incomplete  investigate runtime state.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 1C GPU MEMORY HYGIENE (POST-INFERENCE BOUNDARY)
====================================================================================================

[EXECUTION]
Python garbage collection invoked.
CUDA cache cleared (allocator reset).

[VALIDATION GATES]
gc_executed               :  PASS
cuda_cache_cleared        :  PASS
status                    :  PASS

[STAGE 1C] STATUS
 VERIFIED  GPU memory hygiene completed; runtime ready for next model stage.
====================================================================================================
====================================================================================================

 CPU    8.2% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.300s |  total 1718.52s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 2C  PROMPT-ENGINEERED LLM OUTPUT SELECTION (READ-ONLY)</span>
<span class="c1"># Comparison Preparation Layer</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_2C_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_2C_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PATH CONTRACT</span>
<span class="c1"># ----------------------------</span>
<span class="n">LLM_ONLY_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/llm_only/llm_only_answers.json&quot;</span><span class="p">)</span>

<span class="n">llm_runs</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">runs_loaded</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">runs_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD ARTIFACT (DEFENSIVE)</span>
<span class="c1"># ----------------------------</span>
<span class="k">if</span> <span class="n">LLM_ONLY_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">LLM_ONLY_PATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">llm_runs</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">runs_loaded</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">runs_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_2C_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;answers_file_exists&quot;</span><span class="p">:</span> <span class="n">LLM_ONLY_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span>
    <span class="s2">&quot;runs_loaded&quot;</span><span class="p">:</span> <span class="n">runs_loaded</span><span class="p">,</span>
    <span class="s2">&quot;runs_is_list&quot;</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">llm_runs</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">if</span> <span class="n">runs_loaded</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;min_runs_available&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">llm_runs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">runs_loaded</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">stage_2C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_2C_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># SELECT RUNS (ONLY IF VALID)</span>
<span class="c1"># ----------------------------</span>
<span class="n">BASE_RUN</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">TUNED_RUN</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">stage_2C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="c1"># Convention (documented):</span>
    <span class="c1"># index 0  -&gt; baseline (default parameters)</span>
    <span class="c1"># index 1 -&gt; prompt-engineered variants</span>
    <span class="n">BASE_RUN</span> <span class="o">=</span> <span class="n">llm_runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Choose a representative tuned run (can be adjusted)</span>
    <span class="n">TUNED_RUN</span> <span class="o">=</span> <span class="n">llm_runs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">llm_runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">llm_runs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># HELPER: QUESTION ACCESSOR</span>
<span class="c1"># ----------------------------</span>
<span class="k">def</span> <span class="nf">show_q</span><span class="p">(</span><span class="n">run</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">q_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns (config, answer_text) for a given run and question index.</span>
<span class="sd">    Safe for E-series evaluation and comparison.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">answers</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;answers&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">if</span> <span class="n">q_index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">answers</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Question index out of range for selected run.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">answers</span><span class="p">[</span><span class="n">q_index</span><span class="p">][</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 2C&quot;</span><span class="p">,</span> <span class="s2">&quot;PROMPT LLM OUTPUT SELECTION (READ-ONLY)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACT SOURCE&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;LLM answers file        : </span><span class="si">{LLM_ONLY_PATH}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;File exists             : {badge(stage_2C_validation[&#39;answers_file_exists&#39;])}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Runs loaded             : {badge(stage_2C_validation[&#39;runs_loaded&#39;])}&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">runs_error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Load error              : </span><span class="si">{runs_error}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;RUN SUMMARY&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_2C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total runs available    : {len(llm_runs)}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Baseline run index      : 0&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tuned run index         : {llm_runs.index(TUNED_RUN)}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Baseline config         : {BASE_RUN.get(&#39;config&#39;)}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tuned config            : {TUNED_RUN.get(&#39;config&#39;)}&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_2C_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:26s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 2C&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_2C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;Prompt-engineered LLM runs loaded and ready for evaluation.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;Prompt LLM output selection failed  check artifacts.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 2C PROMPT LLM OUTPUT SELECTION (READ-ONLY)
====================================================================================================

[ARTIFACT SOURCE]
LLM answers file        : OUT/llm_only/llm_only_answers.json
File exists             :  PASS
Runs loaded             :  PASS

[RUN SUMMARY]
Total runs available    : 5
Baseline run index      : 0
Tuned run index         : 3
Baseline config         : {&#39;temperature&#39;: 0.2, &#39;top_p&#39;: 0.9, &#39;n_ctx&#39;: 4096, &#39;max_tokens&#39;: 512}
Tuned config            : {&#39;temperature&#39;: 0.4, &#39;top_p&#39;: 0.95, &#39;n_ctx&#39;: 4096, &#39;max_tokens&#39;: 512}

[VALIDATION GATES]
answers_file_exists       :  PASS
runs_loaded               :  PASS
runs_is_list              :  PASS
min_runs_available        :  PASS

[STAGE 2C] STATUS
 VERIFIED  Prompt-engineered LLM runs loaded and ready for evaluation.
====================================================================================================
====================================================================================================

 CPU   13.6% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.007s |  total 1718.53s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-1:-What-is-the-protocol-for-managing-sepsis-in-a-critical-care-unit?">Query 1: What is the protocol for managing sepsis in a critical care unit?<a class="anchor-link" href="#Query-1:-What-is-the-protocol-for-managing-sepsis-in-a-critical-care-unit?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 1  Baseline vs Prompt-Engineered Answer</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">cfg_b</span><span class="p">,</span> <span class="n">ans_b</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">BASE_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>
<span class="n">cfg_t</span><span class="p">,</span> <span class="n">ans_t</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">TUNED_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Baseline config: temp=</span><span class="si">{cfg_b[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_b[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tuned config:    temp=</span><span class="si">{cfg_t[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_t[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (tuned response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Baseline config: temp=0.2 | top_p=0.9

Managing sepsis in a critical care unit requires a prompt and multi-step approach. Here&#39;s a general protocol:

**Initial Assessment (0-10 minutes)**

1. **Recognize sepsis**: Identify patients with suspected sepsis based on clinical presentation (e.g., fever, tachycardia, tachypnea, altered mental status).
2. **Activate the sepsis response team**: Alert the critical care team, including the physician, nurse, and other necessary personnel.
3. **Assess vital signs**: Monitor and record vital signs, including temperature, heart rate, blood pressure, respiratory rate, and oxygen saturation.

**Early Goal-Directed Therapy (EGDT) (0-60 minutes)**

1. **Administer broad-spectrum antibiotics**: Give antibiotics within 1 hour of suspected sepsis diagnosis.
2. **Fluid resuscitation**: Administer 30 mL/kg of crystalloid fluids (e.g., normal saline or lactated Ringer&#39;s solution) over 30 minutes to achieve a central venous pressure (CVP) of 8-12 mmHg.
3. **Monitor and adjust**: Continuously monitor vital signs, CVP, and urine output, and adjust fluid administration as needed.

**Continued Management (60-120 minutes)**

1. **Monitor lactate levels**: Check lactate levels to assess tissue perfusion.
2. **Optimize oxygenation**: Ensure adequate oxygenation and ventilation, and consider invasive mechanical ventilation if necessary.
3. **Maintain blood pressure**: Use vasopressors (e.g., norepinephrine) to maintain a mean arterial pressure (MAP) of 65 mmHg or higher.
4. **Monitor and adjust**: Continuously monitor vital signs, lactate levels, and urine output, and adjust treatment as needed.

**Ongoing Care (beyond 120 minutes)**

1. **Reassess and adjust**: Continuously reassess the patient&#39;s condition and adjust treatment as needed.
2. **Consider additional interventions**: Consider additional interventions, such as renal replacement therapy, vasopressor titration, or corticosteroids, based on the patient&#39;s response to treatment.
3. **Monitor for complications**: Monitor for potential complications, such as acute kidney injury, respiratory failure, or cardiac arrest.

**Documentation and Communication**

1. **Document all interventions**: Accurately document all interventions, including medications, fluids, and laboratory results.
2. **Communicate with the team**: Communic

------------------------------------------------------------------------------------------

Tuned config:    temp=0.4 | top_p=0.95

Managing sepsis in a critical care unit involves a multi-step approach. Here&#39;s a general protocol:

**Recognition and Initial Assessment**

1. Identify patients at risk for sepsis, such as those with fever, tachycardia, tachypnea, or hypotension.
2. Assess vital signs, including temperature, pulse, respiratory rate, blood pressure, and oxygen saturation.
3. Obtain a complete medical history, including any recent infections or surgeries.

**Sepsis Screening**

1. Use the Systemic Inflammatory Response Syndrome (SIRS) criteria to identify patients at risk for sepsis:
	* Temperature &gt; 38C or &lt; 36C
	* Heart rate &gt; 90 beats per minute
	* Respiratory rate &gt; 20 breaths per minute
	* White blood cell count (WBC) &gt; 12,000 cells/L or &lt; 4,000 cells/L
2. Use the Quick Sepsis-related Organ Failure Assessment (qSOFA) tool to identify patients at high risk for sepsis:
	* Respiratory rate &gt; 30 breaths per minute
	* Altered mental status
	* Systolic blood pressure &lt; 65 mmHg

**Sepsis Diagnosis and Staging**

1. Obtain blood cultures and perform a complete blood count (CBC) with differential.
2. Measure lactate levels and assess organ function (e.g., creatinine, bilirubin).
3. Use the Sepsis-3 definition to diagnose sepsis:
	* Life-threatening organ dysfunction caused by a dysregulated host response to infection.

**Treatment and Management**

1. Administer broad-spectrum antibiotics within 1 hour of sepsis recognition.
2. Provide aggressive fluid resuscitation (30 mL/kg in the first 3 hours) to maintain adequate blood pressure and perfusion.
3. Monitor and manage oxygenation, ventilation, and hemodynamic support as needed.
4. Consider vasopressor support for refractory hypotension.
5. Maintain renal replacement therapy (RRT) as needed for acute kidney injury.
6. Monitor and manage organ function, including liver, lungs, and kidneys.

**Critical Care Unit (CCU) Management**

1. Transfer patients to the CCU for close monitoring and management.
2. Collaborate with intensivists and other specialists as needed.
3. Continuously reassess and adjust treatment plans based on patient response.

**Protocols and Guidelines**

1

==========================================================================================

Tone analysis (tuned response):
- tone: High clinical urgency
- clinical_directiveness: Low
- risk_escalation: High
- epistemic_caution: Low
- actionability: High
- hedging_terms: 1
- assertive_terms: 0
- safety_flags: 13
- uncertainty_flags: 0
- step_indicators: 17

 CPU    7.4% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.002s |  total 1718.53s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-2:-What-are-the-common-symptoms-for-appendicitis,-and-can-it-be-cured-via-medicine?-If-not,-what-surgical-procedure-should-be-followed-to-treat-it?">Query 2: What are the common symptoms for appendicitis, and can it be cured via medicine? If not, what surgical procedure should be followed to treat it?<a class="anchor-link" href="#Query-2:-What-are-the-common-symptoms-for-appendicitis,-and-can-it-be-cured-via-medicine?-If-not,-what-surgical-procedure-should-be-followed-to-treat-it?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 2  Baseline vs Prompt-Engineered Answer</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">cfg_b</span><span class="p">,</span> <span class="n">ans_b</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">BASE_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>
<span class="n">cfg_t</span><span class="p">,</span> <span class="n">ans_t</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">TUNED_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Baseline config: temp=</span><span class="si">{cfg_b[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_b[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tuned config:    temp=</span><span class="si">{cfg_t[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_t[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (tuned response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Baseline config: temp=0.2 | top_p=0.9

**Common Symptoms of Appendicitis:**

Appendicitis is a medical emergency that requires prompt attention. The common symptoms include:

1. **Abdominal pain**: A sharp, stabbing pain in the lower right abdomen that may worsen over time.
2. **Nausea and vomiting**: Feeling queasy or vomiting due to the inflammation and irritation of the appendix.
3. **Loss of appetite**: A decrease in appetite due to the discomfort and pain.
4. **Fever**: A temperature elevation, usually above 100.4F (38C), indicating an infection.
5. **Rebound tenderness**: Pain when pressing on the abdomen and then releasing it.
6. **Abdominal tenderness**: Pain when touching the abdomen, especially in the lower right area.

**Can Appendicitis be Cured via Medicine?**

Unfortunately, appendicitis cannot be cured solely with medication. Antibiotics may be prescribed to treat the infection, but they do not address the underlying issue of the inflamed appendix. If left untreated, the appendix can rupture, leading to severe complications, such as peritonitis (inflammation of the abdominal lining) and sepsis (blood infection).

**Surgical Procedure to Treat Appendicitis:**

The standard treatment for appendicitis is surgical removal of the appendix, known as an **appendectomy**. There are two types of appendectomies:

1. **Open appendectomy**: A traditional surgical procedure where the surgeon makes a large incision in the abdomen to access the appendix.
2. **Laparoscopic appendectomy**: A minimally invasive procedure where the surgeon makes several small incisions and uses a laparoscope (a thin tube with a camera) to visualize the appendix.

In both cases, the surgeon will:

1. **Make an incision**: In the abdomen to access the appendix.
2. **Locate the appendix**: Identify the inflamed appendix and surrounding tissues.
3. **Remove the appendix**: Carefully remove the appendix, taking care not to damage surrounding tissues.
4. **Close the incision**: Close the incision with sutures or staples.

After the surgery, patients are usually monitored for a few hours to ensure there are no complications. They may be prescribed pain medication and antibiotics to prevent infection.

It is essential to seek medical attention immediately if you suspect appendicitis. Delaying treatment can lead to serious complications.

------------------------------------------------------------------------------------------

Tuned config:    temp=0.4 | top_p=0.95

**Common Symptoms of Appendicitis:**

1. **Abdominal Pain**: The pain usually starts around the belly button and then moves to the lower right abdomen. It may worsen over time and become severe.
2. **Nausea and Vomiting**: Patients may experience nausea and vomiting, which can lead to dehydration.
3. **Fever**: A high fever (usually over 101.5F) can occur due to the infection.
4. **Loss of Appetite**: Patients may lose their appetite due to the discomfort and pain.
5. **Tenderness**: The abdomen may be tender to the touch, especially in the lower right area.
6. **Rebound Abdominal Pain**: When the doctor presses on the abdomen and then releases it, the patient may experience increased pain, known as rebound abdominal pain.

**Can Appendicitis be Cured via Medicine?**

No, appendicitis cannot be cured with medicine alone. Antibiotics may be prescribed to treat the infection, but they do not address the underlying issue  the inflamed appendix.

**Surgical Procedure to Treat Appendicitis:**

The most common surgical procedure to treat appendicitis is an **Appendectomy**. There are two types of appendectomies:

1. **Open Appendectomy**: This is a traditional surgical procedure where the surgeon makes a large incision in the abdomen to access the appendix.
2. **Laparoscopic Appendectomy**: This is a minimally invasive procedure where the surgeon makes several small incisions and uses a laparoscope (a thin tube with a camera) to visualize the appendix.

**Step-by-Step Procedure:**

1. **Preparation**: The patient is given general anesthesia to ensure they are comfortable and pain-free during the procedure.
2. **Incision**: The surgeon makes an incision in the abdomen, depending on the type of appendectomy.
3. **Appendix Removal**: The surgeon locates the appendix and removes it.
4. **Closure**: The surgeon closes the incision with sutures or staples.
5. **Recovery**: The patient is taken to the recovery room to rest and recover from the anesthesia.

It&#39;s essential to seek medical attention immediately if you suspect appendicitis. Delaying treatment can lead to complications, such as perforation of the appendix, which can be life-threatening.

==========================================================================================

Tone analysis (tuned response):
- tone: High clinical urgency
- clinical_directiveness: Low
- risk_escalation: High
- epistemic_caution: Low
- actionability: High
- hedging_terms: 9
- assertive_terms: 0
- safety_flags: 7
- uncertainty_flags: 0
- step_indicators: 13

 CPU   14.3% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.002s |  total 1718.53s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-3:-What-are-the-effective-treatments-or-solutions-for-addressing-sudden-patchy-hair-loss,-commonly-seen-as-localized-bald-spots-on-the-scalp,-and-what-could-be-the-possible-causes-behind-it?">Query 3: What are the effective treatments or solutions for addressing sudden patchy hair loss, commonly seen as localized bald spots on the scalp, and what could be the possible causes behind it?<a class="anchor-link" href="#Query-3:-What-are-the-effective-treatments-or-solutions-for-addressing-sudden-patchy-hair-loss,-commonly-seen-as-localized-bald-spots-on-the-scalp,-and-what-could-be-the-possible-causes-behind-it?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 3  Baseline vs Prompt-Engineered Answer</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">cfg_b</span><span class="p">,</span> <span class="n">ans_b</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">BASE_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>
<span class="n">cfg_t</span><span class="p">,</span> <span class="n">ans_t</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">TUNED_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Baseline config: temp=</span><span class="si">{cfg_b[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_b[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tuned config:    temp=</span><span class="si">{cfg_t[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_t[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (tuned response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Baseline config: temp=0.2 | top_p=0.9

As a medical assistant, I&#39;ll provide you with information on possible causes and effective treatments for sudden patchy hair loss.

**Possible Causes:**

1. **Alopecia Areata**: An autoimmune disease that causes hair loss in patches.
2. **Telogen Effluvium**: A condition where hair enters the resting phase and falls out, often due to stress, hormonal changes, or nutritional deficiencies.
3. **Traction Alopecia**: Hair loss caused by constant pulling or tension on the hair follicles, often due to tight hairstyles or hair extensions.
4. **Fungal Infections**: Fungal infections like ringworm can cause hair loss in patches.
5. **Nutritional Deficiencies**: Lack of essential nutrients like iron, zinc, or biotin can lead to hair loss.
6. **Hormonal Imbalance**: Hormonal changes, such as those experienced during pregnancy or menopause, can cause hair loss.
7. **Stress**: Physical or emotional stress can cause hair loss.

**Effective Treatments:**

1. **Minoxidil (Rogaine)**: Apply a 2% or 5% solution to the affected area to stimulate hair growth.
2. **Corticosteroid Injections**: Inject corticosteroids into the affected area to reduce inflammation and promote hair growth.
3. **Low-Level Laser Therapy (LLLT)**: Use a low-level laser or light-emitting device to stimulate hair growth.
4. **Platelet-Rich Plasma (PRP) Therapy**: Inject platelet-rich plasma (PRP) into the affected area to stimulate hair growth.
5. **Medications**: Antifungal medications, such as ketoconazole, may be prescribed to treat fungal infections.
6. **Dietary Changes**: Ensure adequate nutrition by consuming foods rich in essential nutrients, such as iron, zinc, and biotin.
7. **Reduce Stress**: Engage in stress-reducing activities, such as meditation or yoga.

**Step-by-Step Guidance:**

1. **Consult a Doctor**: Schedule an appointment with a dermatologist or primary care physician to determine the underlying cause of hair loss.
2. **Get a Hair Loss Diagnosis**: The doctor will examine your scalp, take a medical history, and perform tests to determine the cause of hair loss.
3. **Develop a Treatment Plan**: Based on the diagnosis, the doctor will recommend a treatment plan, which may include medications, topical treatments, or lifestyle changes.
4. **Follow Treatment Instructions**: Follow the

------------------------------------------------------------------------------------------

Tuned config:    temp=0.4 | top_p=0.95

As a medical assistant, I can provide you with some possible causes and treatments for sudden patchy hair loss, also known as localized bald spots on the scalp.

**Possible Causes:**

1. **Alopecia Areata**: An autoimmune disorder that causes hair loss in patches.
2. **Telogen Effluvium**: A condition where hair enters the resting phase and falls out, often due to stress, hormonal changes, or nutritional deficiencies.
3. **Traction Alopecia**: Hair loss caused by constant pulling or tension on the hair, often due to tight hairstyles or hair extensions.
4. **Scalp Infections**: Fungal or bacterial infections, such as ringworm or folliculitis, can cause hair loss.
5. **Hormonal Imbalance**: Imbalances in hormones, such as thyroid hormones or androgens, can lead to hair loss.
6. **Nutritional Deficiencies**: Lack of essential nutrients, such as iron, zinc, or biotin, can cause hair loss.
7. **Stress**: Physical or emotional stress can cause hair loss.

**Effective Treatments:**

1. **Medications**:
	* Minoxidil (Rogaine): Applied topically to stimulate hair growth.
	* Corticosteroids: Injected into the affected area to reduce inflammation.
	* Finasteride (Propecia): Oral medication to slow down hair loss.
2. **Topical Treatments**:
	* Coal tar: Applied to the scalp to slow down hair loss.
	* Sulfur: Applied to the scalp to reduce inflammation.
	* Biotin: Applied topically to promote hair growth.
3. **Lifestyle Changes**:
	* Reduce stress through meditation, yoga, or deep breathing exercises.
	* Maintain a balanced diet rich in essential nutrients.
	* Avoid tight hairstyles or hair extensions.
	* Keep the scalp clean and moisturized.
4. **Hair Transplantation**: A surgical procedure to transplant healthy hair follicles from one part of the scalp to the affected area.
5. **Low-Level Laser Therapy (LLLT)**: A non-invasive treatment using a low-level laser or light-emitting diode (LED) device to stimulate hair growth.

**When to Seek Medical Attention:**

If you experience any of the following, consult a healthcare professional:

* Sudden or rapid hair loss
* Hair loss in unusual patterns or shapes
* Hair loss accompanied by itching, redness, or scaling
* Hair loss that persists or

==========================================================================================

Tone analysis (tuned response):
- tone: High clinical urgency
- clinical_directiveness: Low
- risk_escalation: High
- epistemic_caution: Low
- actionability: High
- hedging_terms: 4
- assertive_terms: 0
- safety_flags: 3
- uncertainty_flags: 0
- step_indicators: 6

 CPU   14.3% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.002s |  total 1718.53s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-4:--What-treatments-are-recommended-for-a-person-who-has-sustained-a-physical-injury-to-brain-tissue,-resulting-in-temporary-or-permanent-impairment-of-brain-function?">Query 4:  What treatments are recommended for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function?<a class="anchor-link" href="#Query-4:--What-treatments-are-recommended-for-a-person-who-has-sustained-a-physical-injury-to-brain-tissue,-resulting-in-temporary-or-permanent-impairment-of-brain-function?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 4  Baseline vs Prompt-Engineered Answer</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">cfg_b</span><span class="p">,</span> <span class="n">ans_b</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">BASE_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>
<span class="n">cfg_t</span><span class="p">,</span> <span class="n">ans_t</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">TUNED_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Baseline config: temp=</span><span class="si">{cfg_b[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_b[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tuned config:    temp=</span><span class="si">{cfg_t[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_t[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (tuned response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Baseline config: temp=0.2 | top_p=0.9

As a medical assistant, I&#39;ll provide general information on treatments for brain injuries. However, please note that specific treatment plans may vary depending on the severity and type of injury, as well as individual patient needs.

**Initial Treatment (Acute Phase)**

1. **Stabilization**: Ensure the patient&#39;s airway, breathing, and circulation (ABCs) are stable.
2. **Imaging studies**: Conduct CT or MRI scans to assess the extent of the injury.
3. **Monitoring**: Closely monitor vital signs, neurological status, and potential complications (e.g., seizures, increased intracranial pressure).
4. **Supportive care**: Provide oxygen therapy, pain management, and hydration as needed.

**Rehabilitation Phase**

1. **Neurological rehabilitation**: Engage in physical, occupational, and speech therapy to address cognitive, motor, and communication impairments.
2. **Medications**: Use medications to manage symptoms, such as:
	* Seizure control (e.g., anticonvulsants).
	* Pain management (e.g., analgesics, muscle relaxants).
	* Mood stabilization (e.g., antidepressants, mood stabilizers).
3. **Cognitive rehabilitation**: Focus on improving attention, memory, executive functions, and processing speed.
4. **Speech and language therapy**: Address communication difficulties, such as aphasia or dysarthria.
5. **Physical therapy**: Enhance mobility, balance, and strength.
6. **Occupational therapy**: Promote independence in daily activities, such as bathing, dressing, and feeding.

**Surgical Interventions**

1. **Surgical decompression**: Relieve pressure on the brain by removing blood clots or bone fragments.
2. **Cerebrospinal fluid (CSF) drainage**: Reduce intracranial pressure by draining excess CSF.
3. **Ventriculostomy**: Insert a catheter to drain CSF and monitor intracranial pressure.

**Long-term Management**

1. **Follow-up care**: Regularly schedule appointments with healthcare providers to monitor progress and adjust treatment plans.
2. **Lifestyle modifications**: Encourage patients to adopt a healthy lifestyle, including regular exercise, balanced diet, and stress management.
3. **Cognitive training**: Engage in cognitive training programs to improve cognitive function and prevent further decline.
4. **Support groups**: Join support groups to connect with others who have experienced similar brain injuries.

Please note that this is a general overview, and specific

------------------------------------------------------------------------------------------

Tuned config:    temp=0.4 | top_p=0.95

As a medical assistant, I&#39;ll provide general information on treatments for brain injuries. However, please note that specific treatment plans may vary depending on the severity and location of the injury, as well as the individual&#39;s overall health.

**Initial Treatment (Acute Phase)**

1. **Stabilization**: The primary goal is to stabilize the patient&#39;s vital signs, prevent further injury, and manage any life-threatening conditions.
2. **Assessment**: A thorough neurological examination, imaging studies (e.g., CT or MRI scans), and laboratory tests (e.g., blood work, EEG) help determine the extent of the injury.
3. **Surgical intervention**: If necessary, surgery may be performed to relieve pressure on the brain, repair damaged blood vessels, or remove blood clots.
4. **Medications**: Pain management, anti-seizure medications, and corticosteroids may be prescribed to reduce inflammation and swelling.

**Rehabilitation and Recovery (Subacute Phase)**

1. **Physical therapy**: Gentle exercises and activities help maintain muscle strength, flexibility, and range of motion.
2. **Occupational therapy**: Therapists assist with daily living activities, such as bathing, dressing, and feeding, to promote independence.
3. **Speech and language therapy**: Speech therapists help with communication, swallowing, and cognitive skills.
4. **Cognitive rehabilitation**: Therapists work with the patient to improve attention, memory, problem-solving, and executive function.
5. **Psychological support**: Counseling and therapy help manage emotional and behavioral changes, such as anxiety, depression, or personality changes.

**Long-term Management (Chronic Phase)**

1. **Medications**: Ongoing management of symptoms, such as pain, seizures, or mood disorders.
2. **Rehabilitation and therapy**: Continued physical, occupational, speech, and cognitive therapy to maintain or improve function.
3. **Assistive devices**: The use of adaptive equipment, such as wheelchairs, walkers, or communication aids, to promote independence.
4. **Lifestyle modifications**: Patients and their families may need to make adjustments to daily routines, such as simplifying tasks, using memory aids, or creating a safe living environment.

**Experimental and Emerging Treatments**

1. **Stem cell therapy**: Researchers are exploring the use of stem cells to repair damaged brain tissue.
2. **Neurostimulation**: Techniques like transcranial magnetic stimulation (TMS) or transcranial direct current stimulation (tDCS) may help improve cognitive

==========================================================================================

Tone analysis (tuned response):
- tone: High clinical urgency
- clinical_directiveness: Low
- risk_escalation: High
- epistemic_caution: Moderate
- actionability: High
- hedging_terms: 7
- assertive_terms: 0
- safety_flags: 3
- uncertainty_flags: 1
- step_indicators: 12

 CPU   16.7% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.002s |  total 1718.54s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-5:-What-are-the-necessary-precautions-and-treatment-steps-for-a-person-who-has-fractured-their-leg-during-a-hiking-trip,-and-what-should-be-considered-for-their-care-and-recovery?">Query 5: What are the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip, and what should be considered for their care and recovery?<a class="anchor-link" href="#Query-5:-What-are-the-necessary-precautions-and-treatment-steps-for-a-person-who-has-fractured-their-leg-during-a-hiking-trip,-and-what-should-be-considered-for-their-care-and-recovery?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 5  Baseline vs Prompt-Engineered Answer</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">cfg_b</span><span class="p">,</span> <span class="n">ans_b</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">BASE_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>
<span class="n">cfg_t</span><span class="p">,</span> <span class="n">ans_t</span> <span class="o">=</span> <span class="n">show_q</span><span class="p">(</span><span class="n">TUNED_RUN</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Baseline config: temp=</span><span class="si">{cfg_b[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_b[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Tuned config:    temp=</span><span class="si">{cfg_t[&#39;temperature&#39;]}</span><span class="s2"> | top_p=</span><span class="si">{cfg_t[&#39;top_p&#39;]}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">ans_t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (tuned response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Baseline config: temp=0.2 | top_p=0.9

If a person has fractured their leg during a hiking trip, it&#39;s essential to take immediate action to prevent further injury and promote proper healing. Here are the necessary precautions and treatment steps:

**Precautions:**

1. **Immobilize the leg**: Use a splint or a makeshift splint (e.g., a hiking pole, a stick, or a piece of clothing) to keep the leg straight and prevent further movement.
2. **Stop activity**: Immediately stop any physical activity and rest the leg.
3. **Assess the injury**: Check for any other injuries, such as cuts or swelling, and provide basic first aid if necessary.
4. **Call for help**: If possible, call for emergency assistance or have someone hike back to civilization to seek medical help.

**Treatment steps:**

1. **Apply the RICE principle**:
	* **R**est: Avoid putting weight on the injured leg.
	* **I**ce: Apply ice to the affected area to reduce pain and swelling.
	* **C**ompression: Use an elastic bandage or a compression wrap to help reduce swelling.
	* **E**levation: Elevate the injured leg above the level of the heart to reduce swelling.
2. **Provide pain relief**: Offer over-the-counter pain medication, such as acetaminophen or ibuprofen, to help manage pain and discomfort.
3. **Monitor for signs of complications**: Keep an eye out for signs of infection, such as redness, swelling, or increased pain, and seek medical attention if these symptoms occur.

**Care and recovery considerations:**

1. **Seek medical attention**: As soon as possible, seek medical attention from a doctor or a medical professional.
2. **Get an X-ray**: An X-ray will help confirm the diagnosis and determine the severity of the fracture.
3. **Follow treatment plan**: Adhere to the treatment plan, which may include casting, bracing, or surgery, and follow any instructions provided by the medical professional.
4. **Rest and recovery**: Allow the leg to rest and recover, and avoid putting weight on the injured leg until it&#39;s fully healed.
5. **Physical therapy**: After the initial healing period, consider physical therapy to regain strength and mobility in the affected leg.
6. **Follow-up care**: Schedule follow-up appointments with the medical professional to monitor progress and address any concerns.

**Additional considerations:**

1. **Altitude and weather**: If the injury occurs at high altitude or in extreme weather conditions

------------------------------------------------------------------------------------------

Tuned config:    temp=0.4 | top_p=0.95

When a person fractures their leg during a hiking trip, it&#39;s crucial to take the right precautions and follow proper treatment steps to prevent further injury and promote a smooth recovery. Here&#39;s a step-by-step guide:

**Initial Response (On-Site):**

1. **Assess the injury**: Check for any other injuries, such as head trauma or internal bleeding.
2. **Immobilize the leg**: Use a makeshift splint or a backpack to immobilize the leg and prevent further movement.
3. **Apply cold compress**: Use a cold compress or a cold pack to reduce swelling and ease pain.
4. **Provide pain relief**: Administer pain medication, such as acetaminophen or ibuprofen, if available.

**Evacuation and Transportation:**

1. **Call for help**: If possible, call for emergency assistance or alert others in the hiking party.
2. **Evacuate carefully**: If the injury is severe, consider evacuating the person using a stretcher or a makeshift sled.
3. **Transport to a medical facility**: Get the person to a hospital or a medical facility as soon as possible.

**Medical Treatment:**

1. **Imaging studies**: The doctor will likely order X-rays or other imaging studies to confirm the fracture and assess its severity.
2. **Pain management**: The doctor will prescribe pain medication and may recommend other treatments, such as physical therapy or bracing.
3. **Surgery**: In some cases, surgery may be necessary to realign the bone fragments or stabilize the fracture.

**Post-Treatment Care and Recovery:**

1. **Rest and elevation**: The person should rest and elevate their leg to reduce swelling and promote healing.
2. **Physical therapy**: A physical therapist will help the person regain strength and mobility in their leg.
3. **Weight-bearing restrictions**: The person may need to avoid putting weight on their leg for several weeks, depending on the severity of the fracture.
4. **Follow-up appointments**: Schedule follow-up appointments with the doctor to monitor the person&#39;s progress and remove any hardware, such as casts or plates.
5. **Prevent complications**: Monitor for complications, such as infection or nerve damage, and seek medical attention if symptoms arise.

**Considerations for Care and Recovery:**

1. **Nutrition and hydration**: Ensure the person gets adequate nutrition and hydration to support healing.
2. **Pain management**: Monitor pain levels and adjust medication as needed.
3. **Wound care**: Keep the wound clean and dry to

==========================================================================================

Tone analysis (tuned response):
- tone: High clinical urgency
- clinical_directiveness: Moderate
- risk_escalation: High
- epistemic_caution: Low
- actionability: High
- hedging_terms: 8
- assertive_terms: 1
- safety_flags: 5
- uncertainty_flags: 0
- step_indicators: 21

 CPU   10.0% |  Mem   29.3% |  GPU     5% @ 49C |  cell  0.002s |  total 1718.54s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Preparation-for-RAG">Data Preparation for RAG<a class="anchor-link" href="#Data-Preparation-for-RAG">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#============================================================</span>
<span class="c1">#STAGE 0D  RAG INFERENCE (RETRIEVAL-AUGMENTED GENERATION)</span>
<span class="c1">#Model + Retriever Behavior Layer</span>
<span class="c1">#============================================================</span>
<span class="n">STAGE_0D_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_0D_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PATH CONTRACT</span>
<span class="c1"># ----------------------------</span>
<span class="n">OUT_VDB</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/vectordb&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>
<span class="n">OUT_RAG</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/rag&quot;</span><span class="p">)</span>

<span class="n">OUT_RAG</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD VECTOR DATABASE (DEFENSIVE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">collection_name</span> <span class="o">=</span> <span class="s2">&quot;merck_manual_chunks&quot;</span>

<span class="n">chroma_client</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">collection</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">vdb_loaded</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">vdb_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">chroma_client</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
        <span class="n">Settings</span><span class="p">(</span>
            <span class="n">persist_directory</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">OUT_VDB</span><span class="p">),</span>
            <span class="n">anonymized_telemetry</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
    <span class="n">vdb_loaded</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">vdb_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD LLM (REUSE CONTRACT)</span>
<span class="c1"># ----------------------------</span>
<span class="n">MODEL_REPO_ID</span> <span class="o">=</span> <span class="s2">&quot;bartowski/Meta-Llama-3.1-8B-Instruct-GGUF&quot;</span>
<span class="n">MODEL_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;Meta-Llama-3.1-8B-Instruct-Q5_K_M.gguf&quot;</span>

<span class="n">llm</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">llm_ready</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">llm_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">hf_hub_download</span><span class="p">(</span>
        <span class="n">repo_id</span><span class="o">=</span><span class="n">MODEL_REPO_ID</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">MODEL_FILENAME</span><span class="p">,</span>
        <span class="n">local_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">local_dir_use_symlinks</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">llm</span> <span class="o">=</span> <span class="n">Llama</span><span class="p">(</span>
        <span class="n">model_path</span><span class="o">=</span><span class="n">model_path</span><span class="p">,</span>
        <span class="n">n_ctx</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
        <span class="n">n_gpu_layers</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">llm_ready</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">llm_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># SYSTEM PROMPT (RAG CONTRACT)</span>
<span class="c1"># ----------------------------</span>
<span class="n">SYSTEM_PROMPT</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are a medical assistant using retrieved clinical reference material.</span>
<span class="s2">Use ONLY the provided context to answer the question.</span>
<span class="s2">If the answer is not supported by the context, say so explicitly.</span>
<span class="s2">Cite evidence implicitly through factual grounding.</span>
<span class="s2">Respond clearly, cautiously, and professionally.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># RETRIEVAL + GENERATION FUNCTION</span>
<span class="c1"># ----------------------------</span>
<span class="k">def</span> <span class="nf">rag_answer</span><span class="p">(</span>
    <span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">top_p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
        <span class="n">query_texts</span><span class="o">=</span><span class="p">[</span><span class="n">question</span><span class="p">],</span>
        <span class="n">n_results</span><span class="o">=</span><span class="n">k</span>
    <span class="p">)</span>

    <span class="n">docs</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="p">[[]])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">metas</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadatas&quot;</span><span class="p">,</span> <span class="p">[[]])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">context_blocks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">citations</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>
        <span class="n">context_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;[Source {i+1}]</span><span class="se">\n</span><span class="si">{doc}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">metas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">citations</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;chunk_id&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">),</span>
            <span class="s2">&quot;page_number&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_number&quot;</span><span class="p">),</span>
            <span class="s2">&quot;token_count&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token_count&quot;</span><span class="p">),</span>
        <span class="p">})</span>

    <span class="n">context_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context_blocks</span><span class="p">)</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">{SYSTEM_PROMPT}</span><span class="s2"></span>

<span class="s2">CONTEXT:</span>
<span class="si">{context_text}</span><span class="s2"></span>

<span class="s2">QUESTION:</span>
<span class="si">{question}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">create_chat_completion</span><span class="p">(</span>
        <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}],</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">top_p</span><span class="o">=</span><span class="n">top_p</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
        <span class="s2">&quot;answer&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
        <span class="s2">&quot;citations&quot;</span><span class="p">:</span> <span class="n">citations</span><span class="p">,</span>
    <span class="p">}</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># QUESTIONS (SAME DOMAIN)</span>
<span class="c1"># ----------------------------</span>
<span class="n">QUESTIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;What is the protocol for managing sepsis in a critical care unit?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the common symptoms of appendicitis, and can it be cured via medicine? If not, what surgical procedure should be followed to treat it?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the effective treatments or solutions for addressing sudden patchy hair loss, commonly seen as localized bald spots on the scalp, and what could be the possible causes behind it?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What treatments are recommended for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip, and what should be considered for their care and recovery?&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># RUN RAG INFERENCE</span>
<span class="c1"># ----------------------------</span>
<span class="n">rag_results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">vdb_loaded</span> <span class="ow">and</span> <span class="n">llm_ready</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; RAG prerequisites not met  skipping inference.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">QUESTIONS</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;[Stage 0D] RAG query: </span><span class="si">{q[:60]}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">rag_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_0D_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;vectordb_loaded&quot;</span><span class="p">:</span> <span class="n">vdb_loaded</span><span class="p">,</span>
    <span class="s2">&quot;llm_initialized&quot;</span><span class="p">:</span> <span class="n">llm_ready</span><span class="p">,</span>
    <span class="s2">&quot;questions_present&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTIONS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;rag_answers_generated&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rag_results</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTIONS</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">stage_0D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_0D_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># WRITE ARTIFACTS</span>
<span class="c1"># ----------------------------</span>
<span class="n">rag_answers_path</span> <span class="o">=</span> <span class="n">OUT_RAG</span> <span class="o">/</span> <span class="s2">&quot;rag_answers.json&quot;</span>
<span class="n">rag_manifest_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;rag_manifest.json&quot;</span>

<span class="k">if</span> <span class="n">stage_0D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rag_answers_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rag_results</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rag_manifest_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;0D&quot;</span><span class="p">,</span>
                <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">now_utc</span><span class="p">(),</span>
                <span class="s2">&quot;retriever_k&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s2">&quot;llm_model&quot;</span><span class="p">:</span> <span class="n">MODEL_FILENAME</span><span class="p">,</span>
                <span class="s2">&quot;num_questions&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTIONS</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="n">f</span><span class="p">,</span>
            <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 0D&quot;</span><span class="p">,</span> <span class="s2">&quot;RAG INFERENCE (RETRIEVAL-AUGMENTED GENERATION)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;PREREQUISITES&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Vector DB loaded        : {badge(vdb_loaded)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;LLM initialized        : {badge(llm_ready)}&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">vdb_error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Vector DB error        : </span><span class="si">{vdb_error}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">llm_error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;LLM error              : </span><span class="si">{llm_error}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;EXECUTION SUMMARY&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Questions evaluated    : {len(QUESTIONS)}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;RAG responses generated: {len(rag_results)}&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_0D_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:28s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 0D&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_0D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;RAG inference completed; grounded answers generated.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;RAG inference failed  check retriever or model state.&quot;</span>
<span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;ARTIFACTS WRITTEN&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_0D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;rag_answers.json       : </span><span class="si">{rag_answers_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;rag_manifest.json      : </span><span class="si">{rag_manifest_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No artifacts written due to validation failure.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>llama_context: n_ctx_per_seq (4096) &lt; n_ctx_train (131072) -- the full capacity of the model will not be utilized
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[Stage 0D] RAG query: What is the protocol for managing sepsis in a critical care ...
[Stage 0D] RAG query: What are the common symptoms of appendicitis, and can it be ...
[Stage 0D] RAG query: What are the effective treatments or solutions for addressin...
[Stage 0D] RAG query: What treatments are recommended for a person who has sustain...
[Stage 0D] RAG query: What are the necessary precautions and treatment steps for a...
====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 0D RAG INFERENCE (RETRIEVAL-AUGMENTED GENERATION)
====================================================================================================

[PREREQUISITES]
Vector DB loaded        :  PASS
LLM initialized        :  PASS

[EXECUTION SUMMARY]
Questions evaluated    : 5
RAG responses generated: 5

[VALIDATION GATES]
vectordb_loaded             :  PASS
llm_initialized             :  PASS
questions_present           :  PASS
rag_answers_generated       :  PASS

[STAGE 0D] STATUS
 VERIFIED  RAG inference completed; grounded answers generated.
====================================================================================================

[ARTIFACTS WRITTEN]
rag_answers.json       : OUT/rag/rag_answers.json
rag_manifest.json      : OUT/manifests/rag_manifest.json
====================================================================================================

 CPU   81.0% |  Mem   30.4% |  GPU     5% @ 49C |  cell 650.466s |  total 2369.00s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 1D  GPU MEMORY HYGIENE (POST-RAG INFERENCE BOUNDARY)</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_1D_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_1D_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EXECUTION</span>
<span class="c1"># ----------------------------</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_1D_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gc_executed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>                     <span class="c1"># gc.collect() always executes if reached</span>
    <span class="s2">&quot;cuda_available&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">(),</span>
<span class="p">}</span>

<span class="n">stage_1D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_1D_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_header</span><span class="p">(</span><span class="s2">&quot;STAGE 1D&quot;</span><span class="p">,</span> <span class="s2">&quot;GPU MEMORY HYGIENE (POST-RAG INFERENCE BOUNDARY)&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;EXECUTION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Python garbage collection invoked.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CUDA allocator cache cleared.&quot;</span><span class="p">)</span>

<span class="n">stage_section</span><span class="p">(</span><span class="s2">&quot;VALIDATION GATES&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_1D_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:26s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 1D&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_1D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;GPU memory hygiene completed; runtime ready for RAG output loading and evaluation.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;GPU memory hygiene incomplete  investigate runtime state.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 1D GPU MEMORY HYGIENE (POST-RAG INFERENCE BOUNDARY)
====================================================================================================

[EXECUTION]
Python garbage collection invoked.
CUDA allocator cache cleared.

[VALIDATION GATES]
gc_executed               :  PASS
cuda_available            :  PASS
status                    :  PASS

[STAGE 1D] STATUS
 VERIFIED  GPU memory hygiene completed; runtime ready for RAG output loading and evaluation.
====================================================================================================
====================================================================================================

 CPU    7.9% |  Mem   30.3% |  GPU     5% @ 49C |  cell  0.246s |  total 2369.25s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 2D  RAG OUTPUT LOADER &amp; CONTRACT CHECK (READ-ONLY)</span>
<span class="c1"># Display + Evaluation Preparation Layer</span>
<span class="c1"># ============================================================</span>

<span class="n">STAGE_2D_START_TS</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_2D_START_UTC</span> <span class="o">=</span> <span class="n">now_utc</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EXPECTED QUESTION CONTRACT</span>
<span class="c1"># ----------------------------</span>
<span class="n">QUESTIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;What is the protocol for managing sepsis in a critical care unit?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the common symptoms of appendicitis, and can it be cured via medicine? If not, what surgical procedure should be followed to treat it?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the effective treatments or solutions for addressing sudden patchy hair loss, commonly seen as localized bald spots on the scalp, and what could be the possible causes behind it?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What treatments are recommended for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What are the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip, and what should be considered for their care and recovery?&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">EXPECTED_QUESTION_SET</span> <span class="o">=</span> <span class="p">{</span><span class="n">q</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">QUESTIONS</span><span class="p">}</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PATH CONTRACT</span>
<span class="c1"># ----------------------------</span>
<span class="n">OUT_RAG</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/rag&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>

<span class="n">RAG_ANSWERS_PATH</span> <span class="o">=</span> <span class="n">OUT_RAG</span> <span class="o">/</span> <span class="s2">&quot;rag_answers.json&quot;</span>
<span class="n">RAG_MANIFEST_PATH</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;rag_manifest.json&quot;</span>

<span class="n">rag_answers</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">answers_loaded</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">load_error</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># LOAD ARTIFACT (DEFENSIVE)</span>
<span class="c1"># ----------------------------</span>
<span class="k">if</span> <span class="n">RAG_ANSWERS_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">RAG_ANSWERS_PATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">rag_answers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">answers_loaded</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">load_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_2D_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;rag_answers_file_exists&quot;</span><span class="p">:</span> <span class="n">RAG_ANSWERS_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span>
    <span class="s2">&quot;rag_answers_loaded&quot;</span><span class="p">:</span> <span class="n">answers_loaded</span><span class="p">,</span>
    <span class="s2">&quot;rag_answers_is_list&quot;</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rag_answers</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">if</span> <span class="n">answers_loaded</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;expected_answer_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rag_answers</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTIONS</span><span class="p">)</span> <span class="k">if</span> <span class="n">answers_loaded</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;answers_have_contract&quot;</span><span class="p">:</span> <span class="p">(</span>
        <span class="nb">all</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="ow">and</span> <span class="s2">&quot;question&quot;</span> <span class="ow">in</span> <span class="n">a</span>
            <span class="ow">and</span> <span class="s2">&quot;answer&quot;</span> <span class="ow">in</span> <span class="n">a</span>
            <span class="ow">and</span> <span class="s2">&quot;citations&quot;</span> <span class="ow">in</span> <span class="n">a</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rag_answers</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">answers_loaded</span>
        <span class="k">else</span> <span class="kc">False</span>
    <span class="p">),</span>
    <span class="s2">&quot;questions_match_expected&quot;</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;question&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rag_answers</span><span class="p">}</span> <span class="o">==</span> <span class="n">EXPECTED_QUESTION_SET</span>
        <span class="k">if</span> <span class="n">answers_loaded</span>
        <span class="k">else</span> <span class="kc">False</span>
    <span class="p">),</span>
<span class="p">}</span>

<span class="n">stage_2D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_2D_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># BUILD LOOKUP (READ-ONLY)</span>
<span class="c1"># ----------------------------</span>
<span class="n">rag_answers_by_question</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">if</span> <span class="n">stage_2D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="n">rag_answers_by_question</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">a</span><span class="p">[</span><span class="s2">&quot;question&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">a</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rag_answers</span>
    <span class="p">}</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT  HEADER</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STAGE 2D  RAG OUTPUT LOADER &amp; CONTRACT CHECK (READ-ONLY)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Display + Evaluation Preparation Layer&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT  ARTIFACT SOURCE</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[ARTIFACT SOURCE]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;RAG answers file        : </span><span class="si">{RAG_ANSWERS_PATH}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;File exists             : {badge(stage_2D_validation[&#39;rag_answers_file_exists&#39;])}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Loaded successfully     : {badge(stage_2D_validation[&#39;rag_answers_loaded&#39;])}&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">load_error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Load error              : </span><span class="si">{load_error}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT  SUMMARY</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[RAG ANSWER SUMMARY]&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_2D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Total RAG answers       : {len(rag_answers)}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Expected questions      : {len(QUESTIONS)}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Questions indexed       : {len(rag_answers_by_question)}&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RAG answers unavailable due to validation failure.&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT  VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[VALIDATION GATES]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_2D_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:32s}</span><span class="s2">: {badge(v)}&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># STATUS</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_status</span><span class="p">(</span>
    <span class="n">stage</span><span class="o">=</span><span class="s2">&quot;STAGE 2D&quot;</span><span class="p">,</span>
    <span class="n">ok</span><span class="o">=</span><span class="n">stage_2D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
    <span class="n">success_msg</span><span class="o">=</span><span class="s2">&quot;RAG outputs loaded and aligned with question contract; ready for evaluation.&quot;</span><span class="p">,</span>
    <span class="n">fail_msg</span><span class="o">=</span><span class="s2">&quot;RAG output loading failed  question mismatch or artifact integrity issue.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># ARTIFACTS READ</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[ARTIFACTS READ]&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_2D_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;rag_answers.json        : </span><span class="si">{RAG_ANSWERS_PATH}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;rag_manifest.json       : </span><span class="si">{RAG_MANIFEST_PATH}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No artifacts safely loaded.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
====================================================================================================
STAGE 2D  RAG OUTPUT LOADER &amp; CONTRACT CHECK (READ-ONLY)
Display + Evaluation Preparation Layer
====================================================================================================
====================================================================================================

[ARTIFACT SOURCE]
RAG answers file        : OUT/rag/rag_answers.json
File exists             :  PASS
Loaded successfully     :  PASS

[RAG ANSWER SUMMARY]
Total RAG answers       : 5
Expected questions      : 5
Questions indexed       : 5

[VALIDATION GATES]
rag_answers_file_exists         :  PASS
rag_answers_loaded              :  PASS
rag_answers_is_list             :  PASS
expected_answer_count           :  PASS
answers_have_contract           :  PASS
questions_match_expected        :  PASS

[STAGE 2D] STATUS
 VERIFIED  RAG outputs loaded and aligned with question contract; ready for evaluation.
====================================================================================================

[ARTIFACTS READ]
rag_answers.json        : OUT/rag/rag_answers.json
rag_manifest.json       : OUT/manifests/rag_manifest.json
====================================================================================================

 CPU    5.0% |  Mem   30.3% |  GPU     5% @ 49C |  cell  0.009s |  total 2369.26s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Question-Answering-using-RAG">Question Answering using RAG<a class="anchor-link" href="#Question-Answering-using-RAG">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-1:-What-is-the-protocol-for-managing-sepsis-in-a-critical-care-unit?">Query 1: What is the protocol for managing sepsis in a critical care unit?<a class="anchor-link" href="#Query-1:-What-is-the-protocol-for-managing-sepsis-in-a-critical-care-unit?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 1  RAG Answer (Grounded)</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>
<span class="n">rag_answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;RAG Answer  Query {q_idx + 1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (RAG response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: chunk={c.get(&#39;chunk_id&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;page={c.get(&#39;page_number&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;tokens={c.get(&#39;token_count&#39;)}&quot;</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>RAG Answer  Query 1

Based on the provided context, the protocol for managing sepsis in a critical care unit involves the following steps:

1. **Early recognition and diagnosis**: Sepsis is suspected in patients with shaking chills, persistent fever, altered sensorium, hypotension, and GI symptoms (abdominal pain, nausea, vomiting, diarrhea).
2. **Obtaining cultures**: Blood and other appropriate specimens are cultured to identify the causative organism.
3. **Empiric antibiotic therapy**: Antibiotics are started as soon as possible, preferably within 8 hours of presentation, based on likely pathogens and severity of illness.
4. **Supportive care**: Patients receive fluids, antipyretics, analgesics, and oxygen as needed.
5. **Monitoring**: Patients are closely monitored for signs of improvement or deterioration.
6. **Adjusting antibiotics**: Antibiotics are adjusted according to the results of culture and susceptibility testing.
7. **Surgical drainage**: Any abscesses are surgically drained.
8. **Removal of internal devices**: Any internal devices that are the suspected source of bacteria are removed.

In the context of neonates, the protocol for managing sepsis involves:

1. **Initial therapy**: Ampicillin or penicillin G plus an aminoglycoside is used for early-onset sepsis.
2. **Adding therapy for anaerobes**: Clindamycin or metronidazole is added if foul-smelling amniotic fluid is present at birth.
3. **Changing antibiotics**: Antibiotics are changed as soon as an organism is identified.
4. **Supportive therapy**: General supportive measures, including respiratory and hemodynamic management, are combined with antibiotic treatment.
5. **Exchange transfusions**: Exchange transfusions may be used for severely ill neonates to increase levels of circulating immunoglobulins, decrease circulating endotoxin, and improve perfusion.
6. **Fresh frozen plasma**: Fresh frozen plasma may be used to help reverse the heat-stable and heat-labile opsonin deficiencies that occur in LBW neonates.

It is essential to note that the specific protocol may vary depending on the individual patient&#39;s condition and the local hospital&#39;s policies.

==========================================================================================

Tone analysis (RAG response):
- tone: High clinical urgency
- clinical_directiveness: Low
- risk_escalation: High
- epistemic_caution: Moderate
- actionability: High
- hedging_terms: 6
- assertive_terms: 0
- safety_flags: 8
- uncertainty_flags: 1
- step_indicators: 8

[CITATIONS]
- Source 1: chunk=chunk_4568 | page=2400 | tokens=800
- Source 2: chunk=chunk_4674 | page=2453 | tokens=144
- Source 3: chunk=chunk_2458 | page=1307 | tokens=800
- Source 4: chunk=chunk_3972 | page=2094 | tokens=800
- Source 5: chunk=chunk_5714 | page=2995 | tokens=800

 CPU   11.8% |  Mem   30.3% |  GPU     5% @ 49C |  cell  0.002s |  total 2369.26s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-2:-What-are-the-common-symptoms-for-appendicitis,-and-can-it-be-cured-via-medicine?-If-not,-what-surgical-procedure-should-be-followed-to-treat-it?">Query 2: What are the common symptoms for appendicitis, and can it be cured via medicine? If not, what surgical procedure should be followed to treat it?<a class="anchor-link" href="#Query-2:-What-are-the-common-symptoms-for-appendicitis,-and-can-it-be-cured-via-medicine?-If-not,-what-surgical-procedure-should-be-followed-to-treat-it?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 2  RAG Answer (Grounded)</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>
<span class="n">rag_answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;RAG Answer  Query {q_idx + 1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (RAG response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: chunk={c.get(&#39;chunk_id&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;page={c.get(&#39;page_number&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;tokens={c.get(&#39;token_count&#39;)}&quot;</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>RAG Answer  Query 2

Based on the provided context, the common symptoms of appendicitis include:

1. Epigastric or periumbilical pain followed by brief nausea, vomiting, and anorexia.
2. Pain shifting to the right lower quadrant after a few hours.
3. Increased pain with cough and motion.
4. Right lower quadrant direct and rebound tenderness located at McBurney&#39;s point.
5. Low-grade fever (rectal temperature 37.7 to 38.3 C [100 to 101 F]).
6. Pain may not be localized, particularly in infants and children.
7. Tenderness may be diffuse or absent.
8. Bowel movements are usually less frequent or absent.
9. RBCs or WBCs may be present in the urine.

Appendicitis cannot be cured via medicine alone. According to the context, the prognosis without surgery or antibiotics is &gt; 50% mortality. With early surgery, the mortality rate is &lt; 1%, and convalescence is normally rapid and complete.

The surgical procedure for treating appendicitis is open or laparoscopic appendectomy. The surgeon can usually remove the appendix even if it is perforated. However, in cases of inflammatory bowel disease involving the cecum, appendectomy is contraindicated.

Before surgery, IV antibiotics should be administered. Third-generation cephalosporins are preferred. If the appendix is perforated, antibiotics should be continued until the patient&#39;s temperature and WBC count have normalized or continued for a fixed course, according to the surgeon&#39;s preference.

In late cases where a pericolic abscess has already formed, the abscess should be drained either by an ultrasound-guided percutaneous catheter or by open operation (with appendectomy to follow at a later date).

==========================================================================================

Tone analysis (RAG response):
- tone: High clinical urgency
- clinical_directiveness: Moderate
- risk_escalation: High
- epistemic_caution: Low
- actionability: High
- hedging_terms: 5
- assertive_terms: 4
- safety_flags: 5
- uncertainty_flags: 0
- step_indicators: 3

[CITATIONS]
- Source 1: chunk=chunk_289 | page=173 | tokens=800
- Source 2: chunk=chunk_291 | page=174 | tokens=800
- Source 3: chunk=chunk_288 | page=172 | tokens=124
- Source 4: chunk=chunk_6799 | page=3567 | tokens=800
- Source 5: chunk=chunk_2897 | page=1537 | tokens=297

 CPU   10.0% |  Mem   30.3% |  GPU     5% @ 49C |  cell  0.002s |  total 2369.26s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-3:-What-are-the-effective-treatments-or-solutions-for-addressing-sudden-patchy-hair-loss,-commonly-seen-as-localized-bald-spots-on-the-scalp,-and-what-could-be-the-possible-causes-behind-it?">Query 3: What are the effective treatments or solutions for addressing sudden patchy hair loss, commonly seen as localized bald spots on the scalp, and what could be the possible causes behind it?<a class="anchor-link" href="#Query-3:-What-are-the-effective-treatments-or-solutions-for-addressing-sudden-patchy-hair-loss,-commonly-seen-as-localized-bald-spots-on-the-scalp,-and-what-could-be-the-possible-causes-behind-it?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 3  RAG Answer (Grounded)</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>
<span class="n">rag_answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;RAG Answer  Query {q_idx + 1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (RAG response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: chunk={c.get(&#39;chunk_id&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;page={c.get(&#39;page_number&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;tokens={c.get(&#39;token_count&#39;)}&quot;</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>RAG Answer  Query 3

Based on the provided context, sudden patchy hair loss, commonly seen as localized bald spots on the scalp, is referred to as Alopecia Areata.

Effective treatments or solutions for addressing Alopecia Areata include:

1. **Topical corticosteroids**: These can be applied directly to the affected area to reduce inflammation and promote hair growth.
2. **Intralesional corticosteroids**: Injecting corticosteroids into the affected area can help reduce inflammation and promote hair growth.
3. **Topical minoxidil**: Applying minoxidil to the affected area can help stimulate hair growth.
4. **Topical anthralin**: Applying anthralin to the affected area can help reduce inflammation and promote hair growth.
5. **Topical immunotherapy**: Applying diphencyprone or squaric acid dibutylester to the affected area can help stimulate an immune response and promote hair growth.
6. **Psoralen plus ultraviolet A (PUVA)**: Exposing the affected area to PUVA can help stimulate hair growth.
7. **Systemic corticosteroids**: In severe cases, systemic corticosteroids may be prescribed to reduce inflammation and promote hair growth.

Possible causes behind Alopecia Areata include:

1. **Autoimmune disorder**: Alopecia Areata is thought to be an autoimmune disorder, where the immune system mistakenly attacks the hair follicles.
2. **Genetic susceptibility**: People with a family history of Alopecia Areata are more likely to develop the condition.
3. **Environmental triggers**: Unclear environmental triggers, such as stress, may contribute to the development of Alopecia Areata.

It is essential to note that a thorough evaluation by a healthcare professional is necessary to determine the underlying cause of hair loss and develop an effective treatment plan.

==========================================================================================

Tone analysis (RAG response):
- tone: Cautious / neutral
- clinical_directiveness: Moderate
- risk_escalation: Low
- epistemic_caution: Moderate
- actionability: High
- hedging_terms: 5
- assertive_terms: 1
- safety_flags: 0
- uncertainty_flags: 1
- step_indicators: 6

[CITATIONS]
- Source 1: chunk=chunk_1590 | page=858 | tokens=198
- Source 2: chunk=chunk_1589 | page=858 | tokens=798
- Source 3: chunk=chunk_1583 | page=855 | tokens=695
- Source 4: chunk=chunk_1584 | page=855 | tokens=95
- Source 5: chunk=chunk_1585 | page=856 | tokens=782

 CPU   14.3% |  Mem   30.4% |  GPU     5% @ 49C |  cell  0.002s |  total 2369.27s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-4:--What-treatments-are-recommended-for-a-person-who-has-sustained-a-physical-injury-to-brain-tissue,-resulting-in-temporary-or-permanent-impairment-of-brain-function?">Query 4:  What treatments are recommended for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function?<a class="anchor-link" href="#Query-4:--What-treatments-are-recommended-for-a-person-who-has-sustained-a-physical-injury-to-brain-tissue,-resulting-in-temporary-or-permanent-impairment-of-brain-function?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 4  RAG Answer (Grounded)</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>
<span class="n">rag_answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;RAG Answer  Query {q_idx + 1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (RAG response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: chunk={c.get(&#39;chunk_id&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;page={c.get(&#39;page_number&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;tokens={c.get(&#39;token_count&#39;)}&quot;</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>RAG Answer  Query 4

Based on the provided context, the recommended treatments for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function, are as follows:

1. **Initial treatment**: Ensuring a reliable airway and maintaining adequate ventilation, oxygenation, and blood pressure.
2. **Surgery**: May be needed in patients with more severe injury to place monitors to track and treat intracranial pressure, decompress the brain if intracranial pressure is increased, or remove intracranial hematomas.
3. **Rehabilitation**: Many patients require rehabilitation, which may include measures to prevent complications such as contractures, pressure ulcers, and pneumonia.
4. **Occupational therapy**: May help patients compensate for their deficits, particularly if they have agnosia.
5. **Radiation therapy**: May be directed diffusely to the whole head for diffuse or multicentric tumors or locally for well-demarcated tumors.
6. **Chemotherapy**: May benefit some patients with tumors infiltrating the brain parenchyma.
7. **Surgical excision of the tumor**: May be recommended for patients with a solitary metastasis before radiation therapy to improve outcome.

It is essential to note that the specific treatment plan will depend on the severity and nature of the injury, as well as the individual patient&#39;s needs and circumstances.

==========================================================================================

Tone analysis (RAG response):
- tone: High clinical urgency
- clinical_directiveness: Moderate
- risk_escalation: High
- epistemic_caution: Moderate
- actionability: High
- hedging_terms: 10
- assertive_terms: 2
- safety_flags: 3
- uncertainty_flags: 1
- step_indicators: 4

[CITATIONS]
- Source 1: chunk=chunk_3490 | page=1844 | tokens=604
- Source 2: chunk=chunk_6956 | page=3647 | tokens=335
- Source 3: chunk=chunk_3431 | page=1814 | tokens=800
- Source 4: chunk=chunk_6488 | page=3404 | tokens=800
- Source 5: chunk=chunk_3781 | page=1994 | tokens=272

 CPU   14.3% |  Mem   30.4% |  GPU     5% @ 49C |  cell  0.002s |  total 2369.27s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-5:-What-are-the-necessary-precautions-and-treatment-steps-for-a-person-who-has-fractured-their-leg-during-a-hiking-trip,-and-what-should-be-considered-for-their-care-and-recovery?">Query 5: What are the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip, and what should be considered for their care and recovery?<a class="anchor-link" href="#Query-5:-What-are-the-necessary-precautions-and-treatment-steps-for-a-person-who-has-fractured-their-leg-during-a-hiking-trip,-and-what-should-be-considered-for-their-care-and-recovery?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Query 5  RAG Answer (Grounded)</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>
<span class="n">rag_answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;RAG Answer  Query {q_idx + 1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">rag_answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tone analysis (RAG response):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: chunk={c.get(&#39;chunk_id&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;page={c.get(&#39;page_number&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;tokens={c.get(&#39;token_count&#39;)}&quot;</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>RAG Answer  Query 5

Based on the provided context, the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip are as follows:

**Initial Treatment (First 24-48 hours)**

1. **Immobilization**: The person should be immobilized immediately by splinting (immobilization with a nonrigid or noncircumferential device) to prevent further injury to soft tissues and to decrease pain.
2. **Pain management**: Pain should be treated with opioids (if necessary) and other analgesics.
3. **RICE**: Rest, Ice, Compression, and Elevation (RICE) should be applied to the injured area to reduce swelling and pain.
4. **Elevation**: The injured limb should be elevated above the heart to facilitate drainage of fluid and reduce swelling.

**Definitive Treatment**

1. **Closed reduction**: If possible, closed reduction (without skin incision) should be done to align the fracture.
2. **Casting**: The fracture should be maintained by casting, and some dislocations may require only a splint or sling.
3. **Open reduction**: If closed reduction is not possible, open reduction (with skin incision) should be done, and the fracture should be maintained by various surgical hardware (e.g., pins, screws, plates, external fixators).

**Rehabilitation and Recovery**

1. **Rest and recovery**: The person should rest and avoid putting weight on the injured leg for several days (e.g., by using crutches).
2. **Pain management**: Pain should be managed with analgesics and other medications as needed.
3. **Physical therapy**: The person should undergo physical therapy to regain strength and mobility in the affected leg.
4. **Gradual mobilization**: Gradual mobilization of the affected limb should be done to prevent further injury and promote healing.
5. **Avoidance of activities that exacerbate the injury**: The person should avoid activities that exacerbate the injury, such as heavy lifting, bending, or running.
6. **Follow-up care**: Regular follow-up care with a healthcare provider should be scheduled to monitor the person&#39;s progress and adjust treatment as needed.

**Additional Considerations**

1. **Prevention of complications**: The person should be monitored for potential complications, such as compartment syndrome, and treated promptly if they occur.
2. **Psychological support**: The person may benefit from psychological support and counseling to cope with the stress and anxiety associated with the injury.
3. **Return to

==========================================================================================

Tone analysis (RAG response):
- tone: High clinical urgency
- clinical_directiveness: High
- risk_escalation: High
- epistemic_caution: Low
- actionability: High
- hedging_terms: 6
- assertive_terms: 15
- safety_flags: 2
- uncertainty_flags: 0
- step_indicators: 17

[CITATIONS]
- Source 1: chunk=chunk_6461 | page=3390 | tokens=800
- Source 2: chunk=chunk_6953 | page=3646 | tokens=800
- Source 3: chunk=chunk_6455 | page=3386 | tokens=192
- Source 4: chunk=chunk_6684 | page=3508 | tokens=550
- Source 5: chunk=chunk_6667 | page=3499 | tokens=800

 CPU   16.0% |  Mem   30.4% |  GPU     5% @ 49C |  cell  0.002s |  total 2369.27s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Fine-tuning">Fine-tuning<a class="anchor-link" href="#Fine-tuning">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="NOTE:-Imports-are-intentionally-scoped-to-this-cell-to-preserve">NOTE: Imports are intentionally scoped to this cell to preserve<a class="anchor-link" href="#NOTE:-Imports-are-intentionally-scoped-to-this-cell-to-preserve">&#182;</a></h3><h3 id="STAGE-0A-system-invariants-and-Blackwell-GPU-stability.">STAGE 0A system invariants and Blackwell GPU stability.<a class="anchor-link" href="#STAGE-0A-system-invariants-and-Blackwell-GPU-stability.">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 0F  PARAMETER-EFFICIENT FINE-TUNING (ILLUSTRATIVE)</span>
<span class="c1"># ============================================================</span>
<span class="c1"># Purpose:</span>
<span class="c1"># Demonstrate how LoRA-based fine-tuning could be applied to</span>
<span class="c1"># the base LLM. This stage is intentionally illustrative and</span>
<span class="c1"># does NOT alter the production RAG pipeline or artifacts.</span>
<span class="c1">#</span>
<span class="c1"># Design notes:</span>
<span class="c1"># - Parameter-efficient (LoRA)</span>
<span class="c1"># - Minimal synthetic data</span>
<span class="c1"># - No artifact persistence</span>
<span class="c1"># - No downstream dependency</span>
<span class="c1"># ============================================================</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="k">import</span> <span class="n">Dataset</span>

<span class="kn">from</span> <span class="nn">transformers</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">AutoTokenizer</span><span class="p">,</span>
    <span class="n">AutoModelForCausalLM</span><span class="p">,</span>
    <span class="n">TrainingArguments</span><span class="p">,</span>
    <span class="n">Trainer</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">peft</span> <span class="k">import</span> <span class="n">LoraConfig</span><span class="p">,</span> <span class="n">get_peft_model</span><span class="p">,</span> <span class="n">TaskType</span>


<span class="c1"># ----------------------------</span>
<span class="c1"># STAGE METADATA</span>
<span class="c1"># ----------------------------</span>
<span class="n">STAGE_0F_START_TS</span>  <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_0F_START_UTC</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s2">&quot;seconds&quot;</span><span class="p">)</span>

<span class="n">stage_0F_validation</span> <span class="o">=</span> <span class="p">{}</span>


<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT  HEADER</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NEUROFORGE72 PIPELINE  STAGE 0F PARAMETER-EFFICIENT FINE-TUNING&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Illustrative Training Mechanics (LoRA)  ROBUST TRAINING SAFE MODE&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Start UTC: </span><span class="si">{STAGE_0F_START_UTC}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># ----------------------------</span>
<span class="c1"># GPU REQUIREMENT (TRAINING SAFE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">cuda_ok</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
<span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;cuda_available&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">cuda_ok</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">cuda_ok</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; CUDA is not available  cannot run fine-tuning safely.&quot;</span><span class="p">)</span>
    <span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[VALIDATION GATES]&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_0F_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:28s}</span><span class="s2">: {&#39; PASS&#39; if v else &#39; FAIL&#39;}&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[STAGE 0F] STATUS&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; FAILED  CUDA unavailable.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;CUDA unavailable: Stage 0F requires GPU for training-safe execution.&quot;</span><span class="p">)</span>


<span class="c1"># ----------------------------</span>
<span class="c1"># STABLE TRAINING DEFAULTS (CUBLAS DEFENSE)</span>
<span class="c1"># ----------------------------</span>
<span class="c1"># These defaults help reduce cuBLAS/half GEMM surprises on some driver stacks.</span>
<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">matmul</span><span class="o">.</span><span class="n">allow_tf32</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">allow_tf32</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Small, rubric-sufficient sequence length (reduces GEMM pressure).</span>
<span class="n">MAX_LEN</span> <span class="o">=</span> <span class="mi">256</span>

<span class="c1"># Reduce transient fragmentation issues.</span>
<span class="k">def</span> <span class="nf">_cleanup_cuda</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="c1"># ----------------------------</span>
<span class="c1"># MODEL &amp; TOKENIZER</span>
<span class="c1"># ----------------------------</span>
<span class="n">BASE_MODEL_NAME</span> <span class="o">=</span> <span class="s2">&quot;mistralai/Mistral-7B-Instruct-v0.2&quot;</span>
<span class="n">DEVICE</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">BASE_MODEL_NAME</span><span class="p">)</span>
<span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token</span>

<span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;tokenizer_loaded&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>


<span class="c1"># ----------------------------</span>
<span class="c1"># TORCH-NATIVE DATASET (SYNTHETIC)</span>
<span class="c1"># ----------------------------</span>
<span class="k">class</span> <span class="nc">FineTuneDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="n">MAX_LEN</span><span class="p">):</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
            <span class="n">texts</span><span class="p">,</span>
            <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;max_length&quot;</span><span class="p">,</span>
            <span class="n">max_length</span><span class="o">=</span><span class="n">max_length</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_ids</span> <span class="o">=</span> <span class="n">enc</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attention_mask</span> <span class="o">=</span> <span class="n">enc</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_ids</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attention_mask</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="c1"># labels = input_ids for causal LM</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;input_ids&quot;</span><span class="p">:</span> <span class="n">ids</span><span class="p">,</span>
            <span class="s2">&quot;attention_mask&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="p">,</span>
            <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">ids</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="p">}</span>


<span class="n">texts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Question: What are common symptoms of acute appendicitis?</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;Answer: Acute appendicitis commonly presents with abdominal pain that migrates to the lower right quadrant, &quot;</span>
    <span class="s2">&quot;nausea, vomiting, fever, and loss of appetite.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Question: How is hypertension typically diagnosed?</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;Answer: Hypertension is diagnosed through repeated blood pressure measurements taken on separate occasions, &quot;</span>
    <span class="s2">&quot;often supported by ambulatory or home monitoring.&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">FineTuneDataset</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span>
<span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;dataset_ready&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>


<span class="c1"># ----------------------------</span>
<span class="c1"># HELPERS  MODEL LOAD + LoRA + TRAIN</span>
<span class="c1"># ----------------------------</span>
<span class="k">def</span> <span class="nf">load_base_model</span><span class="p">(</span><span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load base model on a single device for training stability.</span>
<span class="sd">    - No device_map=&quot;auto&quot; to prevent meta/offload behavior</span>
<span class="sd">    - use_cache disabled for training stability</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">AutoModelForCausalLM</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
        <span class="n">BASE_MODEL_NAME</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
        <span class="n">low_cpu_mem_usage</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">)</span>

    <span class="c1"># Critical for training stability: KV cache should be disabled during training.</span>
    <span class="n">m</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_cache</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">m</span>


<span class="k">def</span> <span class="nf">attach_lora</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attach LoRA adapters (parameter-efficient fine-tuning).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lora_config</span> <span class="o">=</span> <span class="n">LoraConfig</span><span class="p">(</span>
        <span class="n">r</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">lora_alpha</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">target_modules</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;q_proj&quot;</span><span class="p">,</span> <span class="s2">&quot;v_proj&quot;</span><span class="p">],</span>
        <span class="n">lora_dropout</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="n">bias</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="n">task_type</span><span class="o">=</span><span class="n">TaskType</span><span class="o">.</span><span class="n">CAUSAL_LM</span>
    <span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">get_peft_model</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">lora_config</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>


<span class="k">def</span> <span class="nf">assert_no_meta_params</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hard fail fast if any parameters are meta tensors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">has_meta</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot;is_meta&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">has_meta</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Meta parameters detected  training unsafe. Ensure device_map is NOT used.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">run_training</span><span class="p">(</span><span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">use_fp16</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">use_bf16</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">mode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a minimal Trainer loop; returns a dict containing training mode and success flag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_cleanup_cuda</span><span class="p">()</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">load_base_model</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;model_loaded&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;model_on_cuda&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">attach_lora</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;lora_attached&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Show trainable parameters for rubric evidence</span>
    <span class="n">model</span><span class="o">.</span><span class="n">print_trainable_parameters</span><span class="p">()</span>

    <span class="n">assert_no_meta_params</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;no_meta_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Gradient accumulation reduced vs earlier version to reduce pressure.</span>
    <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./_tmp_lora_demo&quot;</span><span class="p">,</span>      <span class="c1"># intentionally non-canonical / non-persistent</span>
        <span class="n">per_device_train_batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">gradient_accumulation_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="mf">2e-4</span><span class="p">,</span>
        <span class="n">num_train_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">fp16</span><span class="o">=</span><span class="n">use_fp16</span><span class="p">,</span>
        <span class="n">bf16</span><span class="o">=</span><span class="n">use_bf16</span><span class="p">,</span>
        <span class="n">logging_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">save_strategy</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">,</span>
        <span class="n">report_to</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
    <span class="p">)</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
        <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span>
    <span class="p">)</span>

    <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;training_executed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Cleanup</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">_cleanup_cuda</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">mode_name</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>


<span class="c1"># ----------------------------</span>
<span class="c1"># EXECUTION  AUTO-FALLBACK PRECISION</span>
<span class="c1"># ----------------------------</span>
<span class="c1"># Try FP16 first (fast), then BF16 (often more stable), then FP32 (slow, very stable).</span>
<span class="n">precision_result</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">precision_result</span> <span class="o">=</span> <span class="n">run_training</span><span class="p">(</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span>
        <span class="n">use_fp16</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_bf16</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mode_name</span><span class="o">=</span><span class="s2">&quot;fp16&quot;</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e_fp16</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> FP16 training failed:</span><span class="se">\n</span><span class="si">{e_fp16}</span><span class="se">\n</span><span class="s2"> Retrying with BF16...&quot;</span><span class="p">)</span>
    <span class="n">_cleanup_cuda</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">precision_result</span> <span class="o">=</span> <span class="n">run_training</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">,</span>
            <span class="n">use_fp16</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">use_bf16</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mode_name</span><span class="o">=</span><span class="s2">&quot;bf16&quot;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e_bf16</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> BF16 training failed:</span><span class="se">\n</span><span class="si">{e_bf16}</span><span class="se">\n</span><span class="s2"> Retrying with FP32 (slow but stable)...&quot;</span><span class="p">)</span>
        <span class="n">_cleanup_cuda</span><span class="p">()</span>
        <span class="n">precision_result</span> <span class="o">=</span> <span class="n">run_training</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="n">use_fp16</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">use_bf16</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">mode_name</span><span class="o">=</span><span class="s2">&quot;fp32&quot;</span>
        <span class="p">)</span>

<span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;precision_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_result</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">precision_result</span> <span class="k">else</span> <span class="kc">None</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES + STATUS</span>
<span class="c1"># ----------------------------</span>
<span class="c1"># Only boolean gates should be included in the status rollup.</span>
<span class="n">_bool_gates</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_0F_validation</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)}</span>
<span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">_bool_gates</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[VALIDATION GATES]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_0F_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:28s}</span><span class="s2">: {&#39; PASS&#39; if v else &#39; FAIL&#39;}&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:28s}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[STAGE 0F] STATUS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot; VERIFIED  illustrative fine-tuning completed (robust mode).&quot;</span>
    <span class="k">if</span> <span class="n">stage_0F_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
    <span class="k">else</span> <span class="s2">&quot; FAILED  investigate Stage 0F validation gates.&quot;</span>
<span class="p">)</span>

<span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">STAGE_0F_START_TS</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Elapsed seconds: </span><span class="si">{elapsed:.2f}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 0F PARAMETER-EFFICIENT FINE-TUNING
Illustrative Training Mechanics (LoRA)  ROBUST TRAINING SAFE MODE
====================================================================================================
====================================================================================================
Start UTC: 2025-12-22T03:42:35+00:00
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/daddy72/blackwell/envs/visionlab/lib/python3.10/site-packages/torch/backends/__init__.py:46: UserWarning: Please use the new API settings to control TF32 behavior, such as torch.backends.cudnn.conv.fp32_precision = &#39;tf32&#39; or torch.backends.cuda.matmul.fp32_precision = &#39;ieee&#39;. Old settings, e.g, torch.backends.cuda.matmul.allow_tf32 = True, torch.backends.cudnn.allow_tf32 = True, allowTF32CuDNN() and allowTF32CuBLAS() will be deprecated after Pytorch 2.9. Please see https://pytorch.org/docs/main/notes/cuda.html#tensorfloat-32-tf32-on-ampere-and-later-devices (Triggered internally at /pytorch/aten/src/ATen/Context.cpp:45.)
  self.setter(val)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>





 
 
<div id="ba90638a-9718-4741-b6da-3e6822fce96e"></div>
<div class="output_subarea output_widget_view ">
<script type="text/javascript">
var element = $('#ba90638a-9718-4741-b6da-3e6822fce96e');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"version_minor": 0, "model_id": "18d1450659cd4d228993fb4400d17684", "version_major": 2}
</script>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>trainable params: 3,407,872 || all params: 7,245,139,968 || trainable%: 0.0470
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">

    <div>
      
      <progress value='2' max='2' style='width:300px; height:20px; vertical-align: middle;'></progress>
      [2/2 00:00, Epoch 1/1]
    </div>
    <table border="1" class="dataframe">
  <thead>
 <tr style="text-align: left;">
      <th>Step</th>
      <th>Training Loss</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>5.037700</td>
    </tr>
    <tr>
      <td>2</td>
      <td>5.374300</td>
    </tr>
  </tbody>
</table><p>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>
[VALIDATION GATES]
cuda_available              :  PASS
tokenizer_loaded            :  PASS
dataset_ready               :  PASS
model_loaded                :  PASS
model_on_cuda               :  PASS
lora_attached               :  PASS
no_meta_params              :  PASS
training_executed           :  PASS
precision_mode              : fp16

[STAGE 0F] STATUS
 VERIFIED  illustrative fine-tuning completed (robust mode).

Elapsed seconds: 15.19
====================================================================================================

 CPU   28.0% |  Mem   32.3% |  GPU     5% @ 49C |  cell 15.202s |  total 2384.47s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Output-Evaluation">Output Evaluation<a class="anchor-link" href="#Output-Evaluation">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let us now use the LLM-as-a-judge method to check the quality of the RAG system on two parameters - retrieval and generation. We illustrate this evaluation based on the answeres generated to the question from the previous section.</p>
<ul>
<li>We are using the same Mistral model for evaluation, so basically here the llm is rating itself on how well he has performed in the task.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># STAGE 6C  OUTPUT EVALUATION (LLM-AS-JUDGE)</span>
<span class="c1"># Groundedness + Relevance scoring (15)</span>
<span class="c1"># ============================================================</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># STAGE METADATA</span>
<span class="c1"># ----------------------------</span>
<span class="n">STAGE_6C_START_TS</span>  <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">STAGE_6C_START_UTC</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s2">&quot;seconds&quot;</span><span class="p">)</span>

<span class="n">stage_6C_validation</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">OUT_EVAL</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/evaluation&quot;</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;OUT/manifests&quot;</span><span class="p">)</span>
<span class="n">OUT_EVAL</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">OUT_MANIFESTS</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT  HEADER</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NEUROFORGE72 PIPELINE  STAGE 6C OUTPUT EVALUATION (LLM-AS-JUDGE)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Groundedness &amp; Relevance Scoring (15)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Start UTC: </span><span class="si">{STAGE_6C_START_UTC}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EVALUATOR PROMPTS (STRICT, PARSABLE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">GROUNDEDNESS_RATER_SYSTEM_MESSAGE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are a strict medical QA evaluator.</span>

<span class="s2">Rate GROUNDEDNESS of the answer using ONLY the provided citation metadata.</span>
<span class="s2">Groundedness measures whether claims are consistent with cited sources.</span>

<span class="s2">Return EXACTLY this format:</span>
<span class="s2">SCORE: &lt;1-5&gt;</span>
<span class="s2">RATIONALE: &lt;one concise sentence&gt;</span>

<span class="s2">Scoring rubric:</span>
<span class="s2">1 = Claims unsupported by citations</span>
<span class="s2">2 = Minimal alignment with citations</span>
<span class="s2">3 = Partial alignment; some gaps</span>
<span class="s2">4 = Strong alignment; minor gaps</span>
<span class="s2">5 = Fully aligned with cited evidence</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="n">RELEVANCE_RATER_SYSTEM_MESSAGE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are a strict medical QA evaluator.</span>

<span class="s2">Rate RELEVANCE of the answer to the question.</span>
<span class="s2">Relevance measures how directly and completely the answer addresses the question.</span>

<span class="s2">Return EXACTLY this format:</span>
<span class="s2">SCORE: &lt;1-5&gt;</span>
<span class="s2">RATIONALE: &lt;one concise sentence&gt;</span>

<span class="s2">Scoring rubric:</span>
<span class="s2">1 = Off-topic or non-answer</span>
<span class="s2">2 = Addresses small portion</span>
<span class="s2">3 = Partial answer</span>
<span class="s2">4 = Mostly complete answer</span>
<span class="s2">5 = Fully answers the question</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="n">USER_MESSAGE_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[QUESTION]</span>
<span class="si">{question}</span><span class="s2"></span>

<span class="s2">[ANSWER]</span>
<span class="si">{answer}</span><span class="s2"></span>

<span class="s2">[CITATIONS]</span>
<span class="si">{citations}</span><span class="s2"></span>

<span class="s2">Provide the rating in the required format.</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PARSING (DETERMINISTIC)</span>
<span class="c1"># ----------------------------</span>
<span class="n">_score_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;SCORE:\s*([1-5])&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="n">_rat_re</span>   <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;RATIONALE:\s*(.+)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parse_judge</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">_score_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">_rat_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">s</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">r</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">call_llm</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">llm</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
        <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">top_p</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
        <span class="n">top_k</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">stop</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;[/INST]&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">judge</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">system_msg</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">citations</span><span class="p">):</span>
    <span class="n">citation_block</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">&quot;- chunk=</span><span class="si">{c[&#39;chunk_id&#39;]}</span><span class="s2"> | page=</span><span class="si">{c[&#39;page_number&#39;]}</span><span class="s2"> | tokens=</span><span class="si">{c[&#39;token_count&#39;]}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">citations</span>
    <span class="p">)</span>

    <span class="n">user_msg</span> <span class="o">=</span> <span class="n">USER_MESSAGE_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
        <span class="n">answer</span><span class="o">=</span><span class="n">answer</span><span class="p">,</span>
        <span class="n">citations</span><span class="o">=</span><span class="n">citation_block</span>
    <span class="p">)</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;[INST]</span><span class="si">{system_msg}</span><span class="se">\n</span><span class="si">{user_msg}</span><span class="s2">[/INST]&quot;</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">call_llm</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="n">score</span><span class="p">,</span> <span class="n">rationale</span> <span class="o">=</span> <span class="n">parse_judge</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="n">metric</span><span class="p">,</span>
        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span>
        <span class="s2">&quot;rationale&quot;</span><span class="p">:</span> <span class="n">rationale</span><span class="p">,</span>
        <span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="n">raw</span>
    <span class="p">}</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EXECUTION</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[EXECUTION]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Evaluating RAG answers using LLM-as-Judge framework.&quot;</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">execution_ok</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">question</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">QUESTIONS</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>

    <span class="n">grounded</span> <span class="o">=</span> <span class="n">judge</span><span class="p">(</span>
        <span class="s2">&quot;groundedness&quot;</span><span class="p">,</span>
        <span class="n">GROUNDEDNESS_RATER_SYSTEM_MESSAGE</span><span class="p">,</span>
        <span class="n">question</span><span class="p">,</span>
        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">],</span>
        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">relevant</span> <span class="o">=</span> <span class="n">judge</span><span class="p">(</span>
        <span class="s2">&quot;relevance&quot;</span><span class="p">,</span>
        <span class="n">RELEVANCE_RATER_SYSTEM_MESSAGE</span><span class="p">,</span>
        <span class="n">question</span><span class="p">,</span>
        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">],</span>
        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">&quot;q_idx&quot;</span><span class="p">:</span> <span class="n">idx</span><span class="p">,</span>
        <span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
        <span class="s2">&quot;answer&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">],</span>
        <span class="s2">&quot;citations&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">],</span>
        <span class="s2">&quot;groundedness&quot;</span><span class="p">:</span> <span class="n">grounded</span><span class="p">,</span>
        <span class="s2">&quot;relevance&quot;</span><span class="p">:</span> <span class="n">relevant</span>
    <span class="p">})</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># VALIDATION GATES</span>
<span class="c1"># ----------------------------</span>
<span class="n">stage_6C_validation</span><span class="p">[</span><span class="s2">&quot;answers_evaluated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">QUESTIONS</span><span class="p">))</span>
<span class="n">stage_6C_validation</span><span class="p">[</span><span class="s2">&quot;scores_present&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
    <span class="n">r</span><span class="p">[</span><span class="s2">&quot;groundedness&quot;</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;relevance&quot;</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span>
<span class="p">)</span>

<span class="n">stage_6C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">stage_6C_validation</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[VALIDATION GATES]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stage_6C_validation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k:28s}</span><span class="s2">: {&#39; PASS&#39; if v else &#39; FAIL&#39;}&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># ARTIFACTS (RUBRIC EVIDENCE)</span>
<span class="c1"># ----------------------------</span>
<span class="n">results_path</span> <span class="o">=</span> <span class="n">OUT_EVAL</span> <span class="o">/</span> <span class="s2">&quot;evaluation_results.json&quot;</span>
<span class="n">manifest_path</span> <span class="o">=</span> <span class="n">OUT_MANIFESTS</span> <span class="o">/</span> <span class="s2">&quot;evaluation_manifest.json&quot;</span>

<span class="k">if</span> <span class="n">stage_6C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span>
            <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;STAGE 6C&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timestamp_utc&quot;</span><span class="p">:</span> <span class="n">STAGE_6C_START_UTC</span><span class="p">,</span>
            <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;groundedness&quot;</span><span class="p">,</span> <span class="s2">&quot;relevance&quot;</span><span class="p">],</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="s2">&quot;1-5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;evaluation_basis&quot;</span><span class="p">:</span> <span class="s2">&quot;citation_metadata_only&quot;</span><span class="p">,</span>
            <span class="s2">&quot;judge_model&quot;</span><span class="p">:</span> <span class="s2">&quot;same_llm_as_generator&quot;</span><span class="p">,</span>
            <span class="s2">&quot;artifacts&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;evaluation_results.json&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">results_path</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># STATUS</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[ARTIFACTS WRITTEN]&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">stage_6C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;evaluation_results.json : </span><span class="si">{results_path}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;evaluation_manifest.json: </span><span class="si">{manifest_path}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No artifacts written due to validation failure.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[STAGE 6C] STATUS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot; VERIFIED  RAG output evaluation completed successfully.&quot;</span>
    <span class="k">if</span> <span class="n">stage_6C_validation</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
    <span class="k">else</span> <span class="s2">&quot; FAILED  evaluation incomplete or invalid.&quot;</span>
<span class="p">)</span>

<span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">STAGE_6C_START_TS</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Elapsed seconds: </span><span class="si">{elapsed:.2f}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
====================================================================================================
NEUROFORGE72 PIPELINE  STAGE 6C OUTPUT EVALUATION (LLM-AS-JUDGE)
Groundedness &amp; Relevance Scoring (15)
====================================================================================================
====================================================================================================
Start UTC: 2025-12-22T03:42:50+00:00

[EXECUTION]
Evaluating RAG answers using LLM-as-Judge framework.

[VALIDATION GATES]
answers_evaluated           :  PASS
scores_present              :  PASS

[ARTIFACTS WRITTEN]
evaluation_results.json : OUT/evaluation/evaluation_results.json
evaluation_manifest.json: OUT/manifests/evaluation_manifest.json

[STAGE 6C] STATUS
 VERIFIED  RAG output evaluation completed successfully.

Elapsed seconds: 196.98
====================================================================================================

 CPU   88.9% |  Mem   32.3% |  GPU     5% @ 49C |  cell 197.001s |  total 2581.47s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-1:-What-is-the-protocol-for-managing-sepsis-in-a-critical-care-unit?">Query 1: What is the protocol for managing sepsis in a critical care unit?<a class="anchor-link" href="#Query-1:-What-is-the-protocol-for-managing-sepsis-in-a-critical-care-unit?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># QUERY 1  CASE-BASED RAG EVALUATION</span>
<span class="c1"># Protocol for Managing Sepsis in a Critical Care Unit</span>
<span class="c1"># ============================================================</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># QUERY INDEXING</span>
<span class="c1"># ----------------------------</span>
<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Query 1</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># IN-MEMORY PIPELINE ARTIFACTS</span>
<span class="c1"># ----------------------------</span>
<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;OUT/evaluation/evaluation_results.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">evaluation_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">eval_entry</span> <span class="o">=</span> <span class="n">evaluation_results</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>

<span class="n">answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>

<span class="n">groundedness</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;groundedness&quot;</span><span class="p">]</span>
<span class="n">relevance</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;relevance&quot;</span><span class="p">]</span>

<span class="c1"># Deterministic tone/safety analysis (already defined earlier)</span>
<span class="n">tone_analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># OUTPUT  HEADER</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CASE-BASED RAG EVALUATION  QUERY 1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Protocol for Managing Sepsis in a Critical Care Unit&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># RAG ANSWER</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[RAG ANSWER]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># CITATIONS</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: &quot;</span>
        <span class="n">f</span><span class="s2">&quot;chunk={c.get(&#39;chunk_id&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;page={c.get(&#39;page_number&#39;)} | &quot;</span>
        <span class="n">f</span><span class="s2">&quot;tokens={c.get(&#39;token_count&#39;)}&quot;</span>
    <span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># EVALUATION SUMMARY</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[EVALUATION SUMMARY]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">f</span><span class="s2">&quot;- Groundedness: </span><span class="si">{groundedness[&#39;score&#39;]}</span><span class="s2">/5  &quot;</span>
    <span class="n">f</span><span class="s2">&quot;</span><span class="si">{groundedness[&#39;rationale&#39;]}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">f</span><span class="s2">&quot;- Relevance   : </span><span class="si">{relevance[&#39;score&#39;]}</span><span class="s2">/5  &quot;</span>
    <span class="n">f</span><span class="s2">&quot;</span><span class="si">{relevance[&#39;rationale&#39;]}</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># TONE &amp; SAFETY ANALYSIS</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[TONE &amp; SAFETY SIGNALS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tone_analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># PROFESSIONAL JUDGMENT</span>
<span class="c1"># ----------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[PROFESSIONAL JUDGMENT]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The response demonstrates strong clinical alignment with established &quot;</span>
    <span class="s2">&quot;sepsis management principles, emphasizing early recognition, rapid &quot;</span>
    <span class="s2">&quot;initiation of empiric antibiotics, supportive care, and source control. &quot;</span>
    <span class="s2">&quot;The high groundedness and relevance scores indicate that the guidance is &quot;</span>
    <span class="s2">&quot;well-supported by authoritative references. While this output does not &quot;</span>
    <span class="s2">&quot;replace clinician judgment or local ICU protocols, it represents a &quot;</span>
    <span class="s2">&quot;reliable decision-support aid in time-sensitive critical care scenarios.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
CASE-BASED RAG EVALUATION  QUERY 1
Protocol for Managing Sepsis in a Critical Care Unit
====================================================================================================

[RAG ANSWER]
Based on the provided context, the protocol for managing sepsis in a critical care unit involves the following steps:

1. **Early recognition and diagnosis**: Sepsis is suspected in patients with shaking chills, persistent fever, altered sensorium, hypotension, and GI symptoms (abdominal pain, nausea, vomiting, diarrhea).
2. **Obtaining cultures**: Blood and other appropriate specimens are cultured to identify the causative organism.
3. **Empiric antibiotic therapy**: Antibiotics are started as soon as possible, preferably within 8 hours of presentation, based on likely pathogens and severity of illness.
4. **Supportive care**: Patients receive fluids, antipyretics, analgesics, and oxygen as needed.
5. **Monitoring**: Patients are closely monitored for signs of improvement or deterioration.
6. **Adjusting antibiotics**: Antibiotics are adjusted according to the results of culture and susceptibility testing.
7. **Surgical drainage**: Any abscesses are surgically drained.
8. **Removal of internal devices**: Any internal devices that are the suspected source of bacteria are removed.

In the context of neonates, the protocol for managing sepsis involves:

1. **Initial therapy**: Ampicillin or penicillin G plus an aminoglycoside is used for early-onset sepsis.
2. **Adding therapy for anaerobes**: Clindamycin or metronidazole is added if foul-smelling amniotic fluid is present at birth.
3. **Changing antibiotics**: Antibiotics are changed as soon as an organism is identified.
4. **Supportive therapy**: General supportive measures, including respiratory and hemodynamic management, are combined with antibiotic treatment.
5. **Exchange transfusions**: Exchange transfusions may be used for severely ill neonates to increase levels of circulating immunoglobulins, decrease circulating endotoxin, and improve perfusion.
6. **Fresh frozen plasma**: Fresh frozen plasma may be used to help reverse the heat-stable and heat-labile opsonin deficiencies that occur in LBW neonates.

It is essential to note that the specific protocol may vary depending on the individual patient&#39;s condition and the local hospital&#39;s policies.

[CITATIONS]
- Source 1: chunk=chunk_4568 | page=2400 | tokens=800
- Source 2: chunk=chunk_4674 | page=2453 | tokens=144
- Source 3: chunk=chunk_2458 | page=1307 | tokens=800
- Source 4: chunk=chunk_3972 | page=2094 | tokens=800
- Source 5: chunk=chunk_5714 | page=2995 | tokens=800

[EVALUATION SUMMARY]
- Groundedness: 5/5  The answer is fully aligned with the cited sources, as all claims are supported by the provided metadata.
- Relevance   : 5/5  The answer fully addresses the question by providing a comprehensive protocol for managing sepsis in a critical care unit, including early recognition, empiric antibiotic therapy, supportive care, and adjusting antibiotics based on culture and susceptibility testing. Additionally, it provides specific guidance for neonates.

[TONE &amp; SAFETY SIGNALS]
- tone: High clinical urgency
- clinical_directiveness: Low
- risk_escalation: High
- epistemic_caution: Moderate
- actionability: High
- hedging_terms: 6
- assertive_terms: 0
- safety_flags: 8
- uncertainty_flags: 1
- step_indicators: 8

[PROFESSIONAL JUDGMENT]
The response demonstrates strong clinical alignment with established sepsis management principles, emphasizing early recognition, rapid initiation of empiric antibiotics, supportive care, and source control. The high groundedness and relevance scores indicate that the guidance is well-supported by authoritative references. While this output does not replace clinician judgment or local ICU protocols, it represents a reliable decision-support aid in time-sensitive critical care scenarios.
====================================================================================================

 CPU   10.2% |  Mem   32.3% |  GPU     5% @ 49C |  cell  0.007s |  total 2581.48s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-2:-What-are-the-common-symptoms-for-appendicitis,-and-can-it-be-cured-via-medicine?-If-not,-what-surgical-procedure-should-be-followed-to-treat-it?">Query 2: What are the common symptoms for appendicitis, and can it be cured via medicine? If not, what surgical procedure should be followed to treat it?<a class="anchor-link" href="#Query-2:-What-are-the-common-symptoms-for-appendicitis,-and-can-it-be-cured-via-medicine?-If-not,-what-surgical-procedure-should-be-followed-to-treat-it?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># QUERY 2  CASE-BASED RAG EVALUATION</span>
<span class="c1"># Appendicitis: Symptoms, Medical vs Surgical Treatment</span>
<span class="c1"># ============================================================</span>
<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Query 2</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;OUT/evaluation/evaluation_results.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">evaluation_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">eval_entry</span> <span class="o">=</span> <span class="n">evaluation_results</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>

<span class="n">answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>
<span class="n">groundedness</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;groundedness&quot;</span><span class="p">]</span>
<span class="n">relevance</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;relevance&quot;</span><span class="p">]</span>

<span class="n">tone_analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CASE-BASED RAG EVALUATION  QUERY 2&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Appendicitis: Symptoms, Medical vs Surgical Treatment&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[RAG ANSWER]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: chunk=</span><span class="si">{c[&#39;chunk_id&#39;]}</span><span class="s2"> | page=</span><span class="si">{c[&#39;page_number&#39;]}</span><span class="s2"> | tokens=</span><span class="si">{c[&#39;token_count&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[EVALUATION SUMMARY]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Groundedness: </span><span class="si">{groundedness[&#39;score&#39;]}</span><span class="s2">/5  </span><span class="si">{groundedness[&#39;rationale&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Relevance   : </span><span class="si">{relevance[&#39;score&#39;]}</span><span class="s2">/5  </span><span class="si">{relevance[&#39;rationale&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[TONE &amp; SAFETY SIGNALS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tone_analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[PROFESSIONAL JUDGMENT]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The response clearly identifies classic appendicitis symptoms and correctly emphasizes that &quot;</span>
    <span class="s2">&quot;definitive treatment is surgical appendectomy rather than medication alone. The guidance is &quot;</span>
    <span class="s2">&quot;clinically appropriate, grounded in authoritative references, and aligns with standard surgical &quot;</span>
    <span class="s2">&quot;practice. As decision support, this response would be suitable for early triage and patient education.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
CASE-BASED RAG EVALUATION  QUERY 2
Appendicitis: Symptoms, Medical vs Surgical Treatment
====================================================================================================

[RAG ANSWER]
Based on the provided context, the common symptoms of appendicitis include:

1. Epigastric or periumbilical pain followed by brief nausea, vomiting, and anorexia.
2. Pain shifting to the right lower quadrant after a few hours.
3. Increased pain with cough and motion.
4. Right lower quadrant direct and rebound tenderness located at McBurney&#39;s point.
5. Low-grade fever (rectal temperature 37.7 to 38.3 C [100 to 101 F]).
6. Pain may not be localized, particularly in infants and children.
7. Tenderness may be diffuse or absent.
8. Bowel movements are usually less frequent or absent.
9. RBCs or WBCs may be present in the urine.

Appendicitis cannot be cured via medicine alone. According to the context, the prognosis without surgery or antibiotics is &gt; 50% mortality. With early surgery, the mortality rate is &lt; 1%, and convalescence is normally rapid and complete.

The surgical procedure for treating appendicitis is open or laparoscopic appendectomy. The surgeon can usually remove the appendix even if it is perforated. However, in cases of inflammatory bowel disease involving the cecum, appendectomy is contraindicated.

Before surgery, IV antibiotics should be administered. Third-generation cephalosporins are preferred. If the appendix is perforated, antibiotics should be continued until the patient&#39;s temperature and WBC count have normalized or continued for a fixed course, according to the surgeon&#39;s preference.

In late cases where a pericolic abscess has already formed, the abscess should be drained either by an ultrasound-guided percutaneous catheter or by open operation (with appendectomy to follow at a later date).

[CITATIONS]
- Source 1: chunk=chunk_289 | page=173 | tokens=800
- Source 2: chunk=chunk_291 | page=174 | tokens=800
- Source 3: chunk=chunk_288 | page=172 | tokens=124
- Source 4: chunk=chunk_6799 | page=3567 | tokens=800
- Source 5: chunk=chunk_2897 | page=1537 | tokens=297

[EVALUATION SUMMARY]
- Groundedness: 5/5  The answer is fully aligned with the cited evidence, as all claims are supported by the provided citations.
- Relevance   : 5/5  The answer fully addresses the question by listing symptoms of appendicitis, explaining the limitations of medical treatment, and describing the surgical procedure for treating the condition.

[TONE &amp; SAFETY SIGNALS]
- tone: High clinical urgency
- clinical_directiveness: Moderate
- risk_escalation: High
- epistemic_caution: Low
- actionability: High
- hedging_terms: 5
- assertive_terms: 4
- safety_flags: 5
- uncertainty_flags: 0
- step_indicators: 3

[PROFESSIONAL JUDGMENT]
The response clearly identifies classic appendicitis symptoms and correctly emphasizes that definitive treatment is surgical appendectomy rather than medication alone. The guidance is clinically appropriate, grounded in authoritative references, and aligns with standard surgical practice. As decision support, this response would be suitable for early triage and patient education.
====================================================================================================

 CPU    8.3% |  Mem   32.3% |  GPU     5% @ 49C |  cell  0.005s |  total 2581.49s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-3:-What-are-the-effective-treatments-or-solutions-for-addressing-sudden-patchy-hair-loss,-commonly-seen-as-localized-bald-spots-on-the-scalp,-and-what-could-be-the-possible-causes-behind-it?">Query 3: What are the effective treatments or solutions for addressing sudden patchy hair loss, commonly seen as localized bald spots on the scalp, and what could be the possible causes behind it?<a class="anchor-link" href="#Query-3:-What-are-the-effective-treatments-or-solutions-for-addressing-sudden-patchy-hair-loss,-commonly-seen-as-localized-bald-spots-on-the-scalp,-and-what-could-be-the-possible-causes-behind-it?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># QUERY 3  CASE-BASED RAG EVALUATION</span>
<span class="c1"># Patchy Hair Loss (Alopecia Areata)</span>
<span class="c1"># ============================================================</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Query 3</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;OUT/evaluation/evaluation_results.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">evaluation_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">eval_entry</span> <span class="o">=</span> <span class="n">evaluation_results</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>

<span class="n">answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>
<span class="n">groundedness</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;groundedness&quot;</span><span class="p">]</span>
<span class="n">relevance</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;relevance&quot;</span><span class="p">]</span>

<span class="n">tone_analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CASE-BASED RAG EVALUATION  QUERY 3&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Patchy Hair Loss: Causes and Treatments&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[RAG ANSWER]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: chunk=</span><span class="si">{c[&#39;chunk_id&#39;]}</span><span class="s2"> | page=</span><span class="si">{c[&#39;page_number&#39;]}</span><span class="s2"> | tokens=</span><span class="si">{c[&#39;token_count&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[EVALUATION SUMMARY]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Groundedness: </span><span class="si">{groundedness[&#39;score&#39;]}</span><span class="s2">/5  </span><span class="si">{groundedness[&#39;rationale&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Relevance   : </span><span class="si">{relevance[&#39;score&#39;]}</span><span class="s2">/5  </span><span class="si">{relevance[&#39;rationale&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[TONE &amp; SAFETY SIGNALS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tone_analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[PROFESSIONAL JUDGMENT]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The response appropriately identifies alopecia areata as the primary cause of sudden patchy hair loss &quot;</span>
    <span class="s2">&quot;and outlines evidence-based treatments, including corticosteroids and topical therapies. The guidance &quot;</span>
    <span class="s2">&quot;is clinically accurate and avoids overpromising outcomes, making it suitable for patient education &quot;</span>
    <span class="s2">&quot;and preliminary clinical reference.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
CASE-BASED RAG EVALUATION  QUERY 3
Patchy Hair Loss: Causes and Treatments
====================================================================================================

[RAG ANSWER]
Based on the provided context, sudden patchy hair loss, commonly seen as localized bald spots on the scalp, is referred to as Alopecia Areata.

Effective treatments or solutions for addressing Alopecia Areata include:

1. **Topical corticosteroids**: These can be applied directly to the affected area to reduce inflammation and promote hair growth.
2. **Intralesional corticosteroids**: Injecting corticosteroids into the affected area can help reduce inflammation and promote hair growth.
3. **Topical minoxidil**: Applying minoxidil to the affected area can help stimulate hair growth.
4. **Topical anthralin**: Applying anthralin to the affected area can help reduce inflammation and promote hair growth.
5. **Topical immunotherapy**: Applying diphencyprone or squaric acid dibutylester to the affected area can help stimulate an immune response and promote hair growth.
6. **Psoralen plus ultraviolet A (PUVA)**: Exposing the affected area to PUVA can help stimulate hair growth.
7. **Systemic corticosteroids**: In severe cases, systemic corticosteroids may be prescribed to reduce inflammation and promote hair growth.

Possible causes behind Alopecia Areata include:

1. **Autoimmune disorder**: Alopecia Areata is thought to be an autoimmune disorder, where the immune system mistakenly attacks the hair follicles.
2. **Genetic susceptibility**: People with a family history of Alopecia Areata are more likely to develop the condition.
3. **Environmental triggers**: Unclear environmental triggers, such as stress, may contribute to the development of Alopecia Areata.

It is essential to note that a thorough evaluation by a healthcare professional is necessary to determine the underlying cause of hair loss and develop an effective treatment plan.

[CITATIONS]
- Source 1: chunk=chunk_1590 | page=858 | tokens=198
- Source 2: chunk=chunk_1589 | page=858 | tokens=798
- Source 3: chunk=chunk_1583 | page=855 | tokens=695
- Source 4: chunk=chunk_1584 | page=855 | tokens=95
- Source 5: chunk=chunk_1585 | page=856 | tokens=782

[EVALUATION SUMMARY]
- Groundedness: 5/5  The answer is fully aligned with the cited sources, which provide detailed information on the effective treatments and possible causes of Alopecia Areata.
- Relevance   : 5/5  The answer fully addresses the question by providing a comprehensive list of effective treatments and possible causes behind sudden patchy hair loss, commonly seen as localized bald spots on the scalp.

[TONE &amp; SAFETY SIGNALS]
- tone: Cautious / neutral
- clinical_directiveness: Moderate
- risk_escalation: Low
- epistemic_caution: Moderate
- actionability: High
- hedging_terms: 5
- assertive_terms: 1
- safety_flags: 0
- uncertainty_flags: 1
- step_indicators: 6

[PROFESSIONAL JUDGMENT]
The response appropriately identifies alopecia areata as the primary cause of sudden patchy hair loss and outlines evidence-based treatments, including corticosteroids and topical therapies. The guidance is clinically accurate and avoids overpromising outcomes, making it suitable for patient education and preliminary clinical reference.
====================================================================================================

 CPU   21.1% |  Mem   32.3% |  GPU     5% @ 49C |  cell  0.005s |  total 2581.49s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-4:-What-treatments-are-recommended-for-a-person-who-has-sustained-a-physical-injury-to-brain-tissue,-resulting-in-temporary-or-permanent-impairment-of-brain-function?">Query 4: What treatments are recommended for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function?<a class="anchor-link" href="#Query-4:-What-treatments-are-recommended-for-a-person-who-has-sustained-a-physical-injury-to-brain-tissue,-resulting-in-temporary-or-permanent-impairment-of-brain-function?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># QUERY 4  CASE-BASED RAG EVALUATION</span>
<span class="c1"># Traumatic Brain Injury Management</span>
<span class="c1"># ============================================================</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Query 4</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;OUT/evaluation/evaluation_results.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">evaluation_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">eval_entry</span> <span class="o">=</span> <span class="n">evaluation_results</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>

<span class="n">answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>
<span class="n">groundedness</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;groundedness&quot;</span><span class="p">]</span>
<span class="n">relevance</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;relevance&quot;</span><span class="p">]</span>

<span class="n">tone_analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CASE-BASED RAG EVALUATION  QUERY 4&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Traumatic Brain Injury: Treatment and Rehabilitation&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[RAG ANSWER]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: chunk=</span><span class="si">{c[&#39;chunk_id&#39;]}</span><span class="s2"> | page=</span><span class="si">{c[&#39;page_number&#39;]}</span><span class="s2"> | tokens=</span><span class="si">{c[&#39;token_count&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[EVALUATION SUMMARY]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Groundedness: </span><span class="si">{groundedness[&#39;score&#39;]}</span><span class="s2">/5  </span><span class="si">{groundedness[&#39;rationale&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Relevance   : </span><span class="si">{relevance[&#39;score&#39;]}</span><span class="s2">/5  </span><span class="si">{relevance[&#39;rationale&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[TONE &amp; SAFETY SIGNALS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tone_analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[PROFESSIONAL JUDGMENT]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;This response demonstrates appropriate prioritization of acute stabilization, imaging, and monitoring, &quot;</span>
    <span class="s2">&quot;followed by rehabilitation and long-term care. The content is clinically grounded and reflects standard &quot;</span>
    <span class="s2">&quot;traumatic brain injury management pathways, making it a suitable decision-support reference rather than &quot;</span>
    <span class="s2">&quot;a prescriptive treatment plan.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
CASE-BASED RAG EVALUATION  QUERY 4
Traumatic Brain Injury: Treatment and Rehabilitation
====================================================================================================

[RAG ANSWER]
Based on the provided context, the recommended treatments for a person who has sustained a physical injury to brain tissue, resulting in temporary or permanent impairment of brain function, are as follows:

1. **Initial treatment**: Ensuring a reliable airway and maintaining adequate ventilation, oxygenation, and blood pressure.
2. **Surgery**: May be needed in patients with more severe injury to place monitors to track and treat intracranial pressure, decompress the brain if intracranial pressure is increased, or remove intracranial hematomas.
3. **Rehabilitation**: Many patients require rehabilitation, which may include measures to prevent complications such as contractures, pressure ulcers, and pneumonia.
4. **Occupational therapy**: May help patients compensate for their deficits, particularly if they have agnosia.
5. **Radiation therapy**: May be directed diffusely to the whole head for diffuse or multicentric tumors or locally for well-demarcated tumors.
6. **Chemotherapy**: May benefit some patients with tumors infiltrating the brain parenchyma.
7. **Surgical excision of the tumor**: May be recommended for patients with a solitary metastasis before radiation therapy to improve outcome.

It is essential to note that the specific treatment plan will depend on the severity and nature of the injury, as well as the individual patient&#39;s needs and circumstances.

[CITATIONS]
- Source 1: chunk=chunk_3490 | page=1844 | tokens=604
- Source 2: chunk=chunk_6956 | page=3647 | tokens=335
- Source 3: chunk=chunk_3431 | page=1814 | tokens=800
- Source 4: chunk=chunk_6488 | page=3404 | tokens=800
- Source 5: chunk=chunk_3781 | page=1994 | tokens=272

[EVALUATION SUMMARY]
- Groundedness: 5/5  The answer is fully aligned with the cited sources, which provide detailed information on the recommended treatments for brain injuries.
- Relevance   : 5/5  The answer fully addresses the question by providing a comprehensive list of recommended treatments for a person with a physical injury to brain tissue.

[TONE &amp; SAFETY SIGNALS]
- tone: High clinical urgency
- clinical_directiveness: Moderate
- risk_escalation: High
- epistemic_caution: Moderate
- actionability: High
- hedging_terms: 10
- assertive_terms: 2
- safety_flags: 3
- uncertainty_flags: 1
- step_indicators: 4

[PROFESSIONAL JUDGMENT]
This response demonstrates appropriate prioritization of acute stabilization, imaging, and monitoring, followed by rehabilitation and long-term care. The content is clinically grounded and reflects standard traumatic brain injury management pathways, making it a suitable decision-support reference rather than a prescriptive treatment plan.
====================================================================================================

 CPU   13.1% |  Mem   32.3% |  GPU     5% @ 49C |  cell  0.007s |  total 2581.50s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-5:-What-are-the-necessary-precautions-and-treatment-steps-for-a-person-who-has-fractured-their-leg-during-a-hiking-trip,-and-what-should-be-considered-for-their-care-and-recovery?">Query 5: What are the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip, and what should be considered for their care and recovery?<a class="anchor-link" href="#Query-5:-What-are-the-necessary-precautions-and-treatment-steps-for-a-person-who-has-fractured-their-leg-during-a-hiking-trip,-and-what-should-be-considered-for-their-care-and-recovery?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ============================================================</span>
<span class="c1"># QUERY 5  CASE-BASED RAG EVALUATION</span>
<span class="c1"># Fractured Leg: Emergency Care and Recovery</span>
<span class="c1"># ============================================================</span>

<span class="n">q_idx</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Query 5</span>
<span class="n">question</span> <span class="o">=</span> <span class="n">QUESTIONS</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
<span class="n">q_key</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">rag_entry</span> <span class="o">=</span> <span class="n">rag_answers_by_question</span><span class="p">[</span><span class="n">q_key</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;OUT/evaluation/evaluation_results.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">evaluation_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">eval_entry</span> <span class="o">=</span> <span class="n">evaluation_results</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>

<span class="n">answer</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">rag_entry</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span>
<span class="n">groundedness</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;groundedness&quot;</span><span class="p">]</span>
<span class="n">relevance</span> <span class="o">=</span> <span class="n">eval_entry</span><span class="p">[</span><span class="s2">&quot;relevance&quot;</span><span class="p">]</span>

<span class="n">tone_analysis</span> <span class="o">=</span> <span class="n">analyze_answer_sentiment</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CASE-BASED RAG EVALUATION  QUERY 5&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fractured Leg: Precautions, Treatment, and Recovery&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[RAG ANSWER]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[CITATIONS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">citations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Source </span><span class="si">{i}</span><span class="s2">: chunk=</span><span class="si">{c[&#39;chunk_id&#39;]}</span><span class="s2"> | page=</span><span class="si">{c[&#39;page_number&#39;]}</span><span class="s2"> | tokens=</span><span class="si">{c[&#39;token_count&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[EVALUATION SUMMARY]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Groundedness: </span><span class="si">{groundedness[&#39;score&#39;]}</span><span class="s2">/5  </span><span class="si">{groundedness[&#39;rationale&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- Relevance   : </span><span class="si">{relevance[&#39;score&#39;]}</span><span class="s2">/5  </span><span class="si">{relevance[&#39;rationale&#39;]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[TONE &amp; SAFETY SIGNALS]&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tone_analysis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;- </span><span class="si">{k}</span><span class="s2">: </span><span class="si">{v}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[PROFESSIONAL JUDGMENT]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The response appropriately emphasizes immobilization, pain control, and timely medical evaluation, &quot;</span>
    <span class="s2">&quot;followed by definitive fracture management and rehabilitation. The guidance is grounded in standard &quot;</span>
    <span class="s2">&quot;orthopedic practice and is suitable for emergency decision support and patient guidance.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>====================================================================================================
CASE-BASED RAG EVALUATION  QUERY 5
Fractured Leg: Precautions, Treatment, and Recovery
====================================================================================================

[RAG ANSWER]
Based on the provided context, the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip are as follows:

**Initial Treatment (First 24-48 hours)**

1. **Immobilization**: The person should be immobilized immediately by splinting (immobilization with a nonrigid or noncircumferential device) to prevent further injury to soft tissues and to decrease pain.
2. **Pain management**: Pain should be treated with opioids (if necessary) and other analgesics.
3. **RICE**: Rest, Ice, Compression, and Elevation (RICE) should be applied to the injured area to reduce swelling and pain.
4. **Elevation**: The injured limb should be elevated above the heart to facilitate drainage of fluid and reduce swelling.

**Definitive Treatment**

1. **Closed reduction**: If possible, closed reduction (without skin incision) should be done to align the fracture.
2. **Casting**: The fracture should be maintained by casting, and some dislocations may require only a splint or sling.
3. **Open reduction**: If closed reduction is not possible, open reduction (with skin incision) should be done, and the fracture should be maintained by various surgical hardware (e.g., pins, screws, plates, external fixators).

**Rehabilitation and Recovery**

1. **Rest and recovery**: The person should rest and avoid putting weight on the injured leg for several days (e.g., by using crutches).
2. **Pain management**: Pain should be managed with analgesics and other medications as needed.
3. **Physical therapy**: The person should undergo physical therapy to regain strength and mobility in the affected leg.
4. **Gradual mobilization**: Gradual mobilization of the affected limb should be done to prevent further injury and promote healing.
5. **Avoidance of activities that exacerbate the injury**: The person should avoid activities that exacerbate the injury, such as heavy lifting, bending, or running.
6. **Follow-up care**: Regular follow-up care with a healthcare provider should be scheduled to monitor the person&#39;s progress and adjust treatment as needed.

**Additional Considerations**

1. **Prevention of complications**: The person should be monitored for potential complications, such as compartment syndrome, and treated promptly if they occur.
2. **Psychological support**: The person may benefit from psychological support and counseling to cope with the stress and anxiety associated with the injury.
3. **Return to

[CITATIONS]
- Source 1: chunk=chunk_6461 | page=3390 | tokens=800
- Source 2: chunk=chunk_6953 | page=3646 | tokens=800
- Source 3: chunk=chunk_6455 | page=3386 | tokens=192
- Source 4: chunk=chunk_6684 | page=3508 | tokens=550
- Source 5: chunk=chunk_6667 | page=3499 | tokens=800

[EVALUATION SUMMARY]
- Groundedness: 5/5  The answer is fully aligned with the cited sources, which provide comprehensive information on the necessary precautions and treatment steps for a person who has fractured their leg during a hiking trip.
- Relevance   : 5/5  The answer fully addresses the question by providing a comprehensive and detailed treatment plan for a person who has fractured their leg during a hiking trip.

[TONE &amp; SAFETY SIGNALS]
- tone: High clinical urgency
- clinical_directiveness: High
- risk_escalation: High
- epistemic_caution: Low
- actionability: High
- hedging_terms: 6
- assertive_terms: 15
- safety_flags: 2
- uncertainty_flags: 0
- step_indicators: 17

[PROFESSIONAL JUDGMENT]
The response appropriately emphasizes immobilization, pain control, and timely medical evaluation, followed by definitive fracture management and rehabilitation. The guidance is grounded in standard orthopedic practice and is suitable for emergency decision support and patient guidance.
====================================================================================================

 CPU   15.2% |  Mem   32.3% |  GPU     5% @ 49C |  cell  0.005s |  total 2581.50s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Actionable-Insights-and-Business-Recommendations">Actionable Insights and Business Recommendations<a class="anchor-link" href="#Actionable-Insights-and-Business-Recommendations">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Actionable-Insights">Actionable Insights<a class="anchor-link" href="#Actionable-Insights">&#182;</a></h3><p><strong>1. Retrieval grounding is the primary driver of safety and reliability.</strong><br>
Across all five clinical scenarios, RAG based responses consistently demonstrated stronger factual alignment and clinical appropriateness than LLM only outputs. Constraining generation to authoritative medical sources materially reduces unsupported claims and improves trustworthiness. In a safety critical domain, this grounding is not optional. It is foundational.</p>
<p><strong>2. LLM as Judge evaluation is a practical quality control mechanism.</strong><br>
The LLM as Judge framework produced consistent, structured groundedness and relevance scores across all queries, with validation gates confirming completeness and parse integrity. This provides a scalable method for monitoring response quality without relying on continuous manual review, while still generating artifacts that are interpretable and auditable.</p>
<p><strong>3. Behavioral signals matter as much as correctness.</strong><br>
Deterministic analysis of tone, urgency, and safety signals showed that high quality RAG responses not only matched source material but also adopted appropriate clinical posture. This included high urgency for sepsis, escalation for trauma, and caution where uncertainty exists. Evaluating both what the system says and how it says it provides a more complete assessment of suitability for real world use.</p>
<p><strong>4. The architecture generalizes across medical domains.</strong><br>
The system performed reliably across critical care, surgery, dermatology, neurology, and emergency injury scenarios. This demonstrates that the pipeline is not narrowly tuned to a single problem but can adapt across domains when paired with a comprehensive reference corpus and consistent evaluation standards.</p>
<hr>
<h3 id="Business-Recommendations">Business Recommendations<a class="anchor-link" href="#Business-Recommendations">&#182;</a></h3><p><strong>1. Position the system as decision support, not decision authority.</strong><br>
This RAG system is best deployed as a clinical decision support adjunct. It supports clinicians, nurses, and trainees by summarizing evidence based guidance and surfacing relevant protocols. It should be explicitly positioned as assistive, reinforcing professional judgment and local policies rather than replacing them.</p>
<p><strong>2. Operationalize evaluation metrics as governance controls.</strong><br>
Groundedness and relevance scores should be logged continuously and used as governance signals. Responses that fall below defined thresholds, for example groundedness below 4 out of 5, can be flagged, reviewed, or suppressed automatically. This creates a built in safety and quality control layer suitable for regulated environments.</p>
<p><strong>3. Expand the reference corpus incrementally and deliberately.</strong><br>
While the Merck Manual provides strong baseline coverage, future iterations should incorporate additional authoritative sources such as specialty guidelines or institutional protocols. The current architecture supports this expansion without requiring structural changes to the pipeline.</p>
<p><strong>4. Deploy in stages with defined human oversight.</strong><br>
Initial deployment should focus on lower risk use cases such as education, protocol familiarization, and triage support. As confidence in performance and evaluation stability increases, the system can be extended into higher impact workflows with clearly defined human in the loop checkpoints.</p>
<p><strong>5. Preserve auditability as a non negotiable requirement.</strong><br>
Any production deployment should retain the artifact based logging demonstrated in this project, including retrieved context, citations, evaluation scores, and manifests. This supports compliance, post hoc review, and continuous improvement over time.</p>
<hr>
<h3 id="Final-Assessment">Final Assessment<a class="anchor-link" href="#Final-Assessment">&#182;</a></h3><p>This project demonstrates that a properly engineered RAG system, combined with structured evaluation and explicit audit controls, can deliver clinically relevant, evidence aligned outputs across multiple medical domains. When deployed with appropriate safeguards and governance, this architecture is production viable as a clinical decision support platform.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><font size=6 color='blue'>Power Ahead</font></p>
<hr>

</div>
</div>
</div>
    </div>
  </div>
</body>

 


</html>
